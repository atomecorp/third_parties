
if(typeof window=="undefined")window={};var zimDefaultFrame=window.zimDefaultFrame;var zdf=window.zdf;var createjs=window.createjs;var OPTIMIZE=window.OPTIMIZE;var ACTIONEVENT=window.ACTIONEVENT;var KEYFOCUS=window.KEYFOCUS;var TIMECHECK=window.TIMECHECK;var TIME=window.TIME;var STYLE=window.STYLE;var MOBILE=window.MOBILE;var LOCALSTORAGE=window.LOCALSTORAGE;var GET=window.GET;var POST=window.POST;var SOCKET=window.SOCKET;var FIT=window.FIT;var FILL=window.FILL;var FULL=window.FULL;var zimContactListener=window.zimContactListener;var zimDefaultPhysics=window.zimDefaultPhysics;var b2ContactListener=window.b2ContactListener;var b2Vec2=window.b2Vec2;if(typeof zon=="undefined")var zon=true;if(typeof zns=='undefined')var zns=false;var zog=zon?console.log.bind(console):function(){};var zogStyle=" border:thin solid black; color: black";var zogg=zon?console.log.bind(console,"%c Z ","background: #acd241;"+zogStyle):function(){};var zogp=zon?console.log.bind(console,"%c Z ","background: #e472c4;"+zogStyle):function(){};var zogb=zon?console.log.bind(console,"%c Z ","background: #50c4b7;"+zogStyle):function(){};var zogr=zon?console.log.bind(console,"%c Z ","background: #fb4758;"+zogStyle):function(){};var zogy=zon?console.log.bind(console,"%c Z ","background: #ebcb35;"+zogStyle):function(){};var zogo=zon?console.log.bind(console,"%c Z ","background: #f58e25;"+zogStyle):function(){};var zogl=zon?console.log.bind(console,"%c Z ","background: #eeeeee;"+zogStyle):function(){};var zogd=zon?console.log.bind(console,"%c Z ","background: #444444; border:thin solid black; color: white"):function(){};function zid(s){z_d("1");return document.getElementById(s);}
function zss(s){z_d("2");if(document.getElementById(s)){return document.getElementById(s).style;}
else if(zon)zogy("zss(): id not found");}
function zgo(u,t,w,h,f,m){z_d("3");if((zot(t)&&t!="")||t=="_self"){window.location.href=u;}else{var added="";if(w)added+="width="+w+",";if(h)added+="height="+h+",";if(f)added+="fullscreen=yes,";if(m)added+="modal=yes,alwaysRaised=yes";return window.open(u,t,added);}}
function zum(s){z_d("4");if(zot(s))return;return Number(String(s).replace(/[^\d\.\-]/g,''));}
function zot(v){return v==null;}
function zop(e){z_d("5");if(zot(e))return;if(e.stopImmediatePropagation)e.stopImmediatePropagation();if(window.event)window.event.cancelBubble=true;}
function zil(){z_d("6");var a=function(e){if(!e)e=event;if(e.keyCode&&(e.keyCode>=32&&e.keyCode<=40))e.preventDefault();};var b=function(e){if(!e)e=event;e.preventDefault();};var c=b;window.addEventListener("keydown",a,{passive:false});window.addEventListener("wheel",b,{passive:false});window.addEventListener("DOMMouseScroll",c,{passive:false});return[a,b,c];}
function zet(selector){z_d("6.1");function Zet(){var that=this;this.on=function(type,call){if(zot(selector)||zot(type)||zot(call))return;var tags=that.tags;for(var i=0;i<tags.length;i++){tags[i].addEventListener(type,call);}};this.off=function(type,call){if(zot(selector)||zot(type)||zot(call))return;var tags=that.tags;for(var i=0;i<tags.length;i++){tags[i].removeEventListener(type,call);}};Object.defineProperty(that,'tags',{get:function(){if(zot(selector))return[];if(typeof selector=='string'||selector instanceof String){return document.querySelectorAll(selector);}else{if(typeof(selector).innerHTML=="string")return[selector];return[];}},set:function(){}});this.css=function(property,value){var tags=that.tags;for(var i=0;i<tags.length;i++){if(arguments.length==1&&arguments[0].constructor==={}.constructor){for(var p in property){tags[i].style[p]=property[p];}}else if(arguments.length==1){return that.tags[0].style[property];}else{tags[i].style[property]=value;}}};this.prop=function(property,value){if(zot(property))return;var tags=that.tags;var a=[];for(var i=0;i<tags.length;i++){if(zot(value)){if(property.constructor==={}.constructor){for(var p in property){tags[i][p]=property[p];}}else{a.push(tags[i][property]);}}else{tags[i][property]=value;}}
if(zot(value))return a;};}
return new Zet();}
function isDUO(a){return a.length==1&&a[0]!=undefined&&a[0].constructor==={}.constructor;}
function zob(func,args,sig,scope){var zimon=(zim&&(zim.ZIMONON||ZIMONON));if(isDUO(args)){z_d("7");var zp=args[0];var za=(zot(sig))?func.toString().split(/\n/,1)[0].match(/\((.*)\)/)[1].replace(/\s+/g,"").split(","):sig.replace(/\s+/g,"").split(",");var zv=[];var zi;var zt;for(zi=0;zi<za.length;zi++){zt=za[zi].split("=")[0];za[zi]=zt;zv.push(zp[zt]);}
for(zi in zp){if(za.indexOf(zi)<0){if(zon)zogy(func,"bad argument "+zi);}}
var zr;if(zr=(func.prototype.isPrototypeOf(scope))?new(func.bind.apply(func,[null].concat(zv)))():func.apply(null,zv)){if(zimon&&!zr.arguments){zr.arguments=[zp];}return zr;}else{return true;}}else{if(zimon&&scope&&args&&zot(scope.arguments)){scope.arguments=Array.prototype.slice.call(args);}}}
function zik(v){z_d("7.5");z_d("17.6");if(zot(v))return;return zim.Pick.choose(v);}
var zta=console.table&&zon?console.table.bind(console):function(){};var zor=function(){for(var i=0;i<arguments.length;i++){if(!zot(arguments[i]))return arguments[i];}};var zim=function(zim){zim.chop=function(obj,cols,rows,tile,margin){z_d("7.8");if(zot(obj))return;if(zot(cols))cols=3;if(zot(rows))rows=3;if(zot(tile))tile=true;if(zot(margin))margin=0;var w=obj.width/cols;var h=obj.height/rows;var m=margin;var pieces=[];zim.loop(rows,function(r){zim.loop(cols,function(c){var p=new zim.Bitmap(obj,w+m*2,h+m*2,c*w-m,r*h-m);if(margin!=0){p.setBounds(m,m,w,h);p.regX=m;p.regY=m;}
pieces.push(p);});});if(tile)return new zim.Tile(pieces,cols,rows,0,0,true);else return pieces;};zim.shuffle=function(array){z_d("8");if(zot(array))return;var i=array.length,j,temp;if(i==0)return array;while(--i){j=Math.floor(Math.random()*(i+1));temp=array[i];array[i]=array[j];array[j]=temp;}
return array;};zim.rand=function(a,b,integer,negative){z_d("9");if(zot(a)&&zot(b))return Math.random();if(zot(a)||isNaN(a))a=0;if(zot(b)||isNaN(b))b=0;if(a%1!=0||b%1!=0)integer=false;if(zot(integer))integer=true;if(negative)if(Math.random()>.5){a*=-1;b*=-1;}
if(integer)if(a>b){a++;}else if(b>a){b++;}
var r;if(a==0&&b==0)return 0;else if(b==0)r=Math.random()*a;else r=Math.min(a,b)+Math.random()*(Math.max(a,b)-Math.min(a,b));if(integer)return Math.floor(r);else return r;};zim.series=function(){z_d("13.61");var array;var range;if(arguments.length==0)return function(){};if(arguments.length==1&&Array.isArray(arguments[0])){array=arguments[0];}else if(arguments.length==1&&arguments[0].constructor=={}.constructor){range=arguments[0];if(zot(range.min))range.min=0;if(zot(range.max))range.max=1;if(zot(range.step))range.step=1;array=[];zim.loop(Math.floor(Math.abs(range.max-range.min)+range.step),function(i){array.push(i+range.min);},null,range.step);range=null;}else{array=Array.prototype.slice.call(arguments);}
var count=0;var dir=1;var step=1;var every=0;var everyCount=0;var bounce=false;var constrain=false;var lastVal;var f=function(){if(every&&everyCount%(every)!=0){everyCount++;return lastVal;}
everyCount++;var length=array.length;var val;val=array[(length*10+count)%length];if(bounce){if(dir>0&&count+dir*step>=length){dir=-1;count=(length-1)-(count+step-(length-1));}else if(dir<0&&count+dir*step<0){dir=1;count=step-count;}else{count+=dir*step;}}else if(constrain){if(dir>0&&count+dir*step>=length)count=length-1;else if(dir<0&&count+dir*step<0)count=0;else count+=dir*step;}else{count+=dir*step;}
lastVal=val;return val;};f.array=array;f.type="series";Object.defineProperty(f,'index',{get:function(){var length=array.length;return(length*10+count)%length;},set:function(value){count=value;}});f.jump=function(value){count=value;return f;};f.reverse=function(value){if(zot(value))value=true;if(value)dir=-1;else dir=1;count=array.length-1;return f;};f.bounce=function(value){if(zot(value))value=true;var length=array.length;count=(length*10+count)%length;bounce=value;return f;};f.step=function(value){if(zot(value))value=1;step=Math.floor(value);return f;};f.every=function(value){if(zot(value))value=1;every=Math.abs(value);everyCount=0;return f;};f.constrain=function(value){if(zot(value))value=true;constrain=value;return f;};return f;};zim.makeSeries=function(array){z_d("13.6");if(zot(array))return function(){};var count=0;var f=function(){return array[(count++)%array.length];};f.array=array;return f;};zim.loop=function(obj,call,reverse,step,start,end){var sig="obj, call, reverse, step, start, end";var duo;if(duo=zob(zim.loop,arguments,sig))return duo;z_d("9.5");if(zot(obj)||zot(call))return undefined;if(zot(reverse))reverse=false;if(zot(step)||step<=0)step=1;var type=typeof obj=="number"?"number":(obj.constructor===Array?"array":(obj.constructor==={}.constructor?"object":(typeof obj=="string"?"string":(obj instanceof NodeList?"nodelist":(obj instanceof HTMLCollection?"htmlcollection":"invalid")))));if(type=="invalid"){return undefined;}
if(type=="number"||type=="string"||type=="array"||type=="nodelist"||type=="htmlcollection"){var length=type=="number"?obj:obj.length;var total=getTotal(length-1);if(total==0)return true;if(reverse){for(var i=start;i>=end;i-=step){var r;if(type=="number"){r=call(i,total,start,end,obj);}else if(type=="array"||type=="string"){r=call(obj[i],i,total,start,end,obj);}else{r=call(obj.item(i),i,total,start,end,obj);}
if(typeof r!='undefined')return r;}}else{for(var i=start;i<=end;i+=step){var r;if(type=="number"){r=call(i,total,start,end,obj);}else if(type=="array"||type=="string"){r=call(obj[i],i,total,start,end,obj);}else{r=call(obj.item(i),i,total,start,end,obj);}
if(typeof r!='undefined')return r;}}
return true;}else if(type=="object"){var length=0;var props=[];for(var i in obj){length++;props.push(i);}
var total=getTotal(length-1);if(total==0)return;if(reverse){for(var i=start;i>=end;i-=step){var r=call(props[i],obj[props[i]],i,total,start,end,obj);if(typeof r!='undefined')return r;}}else{for(var i=start;i<=end;i+=step){var r=call(props[i],obj[props[i]],i,total,start,end,obj);if(typeof r!='undefined')return r;}}
return true;}
function getTotal(max){if(zot(start))start=reverse?max:0;if(zot(end))end=reverse?0:max;if((reverse&&end>start)||(!reverse&&start>end))return 0;if((start<0&&end)<0||(start>max&&end>max))return 0;start=Math.max(0,Math.min(start,max));end=Math.max(0,Math.min(end,max));return Math.floor((reverse?(start-end):(end-start))/step)+1;}};function getTIME(time,timeUnit,minWarning,maxWarning,noWarning){if(!zim.timeCheck){z_d("9.99");zim.timeCheck=true;}
var timeType=zot(TIME)?zot(zim.TIME)?"seconds":zim.TIME:TIME;if(timeType&&timeType.toLowerCase)timeType=timeType.toLowerCase();if(timeType!="milliseconds"&&timeType!="ms")timeType="seconds";if(timeUnit&&timeUnit.toLowerCase)timeUnit=timeUnit.toLowerCase();if(timeUnit=="ms"||timeUnit=="milliseconds"||timeUnit=="seconds"||timeUnit=="s")timeType=timeUnit;if(zot(time))return timeType.charAt(0);if(timeType=="ms")timeType="milliseconds";if(timeType=="s")timeType="seconds";timeType=timeType.charAt(0);if(!noWarning)checkTIME(time,timeType,minWarning,maxWarning);return timeType;}
function checkTIME(time,timeChar,minWarning,maxWarning){if(zot(minWarning))minWarning=10;if(zot(maxWarning))maxWarning=9;if(!zim.TIMECHECK&&!TIMECHECK)return;if((timeChar!="m"&&time>minWarning)||(timeChar=="m"&&time<maxWarning)){if(zon)zogy("TIME - warning: time is in "+(timeChar=="m"?"milliseconds":"seconds")+" ("+time+")");}}
zim.timeout=function(time,call,pauseOnBlur,timeUnit){var sig="time, call, pauseOnBlur, timeUnit";var duo;if(duo=zob(zim.timeout,arguments,sig,this))return duo;z_d("9.7");if(zot(call))return;if(typeof call!='function')return;var timeType=getTIME(time,timeUnit);if(zot(time))time=timeType=="s"?1:1000;time=zim.Pick.choose(time);var obj={startTime:Date.now(),time:0,paused:false,done:false,timeUnit:timeUnit};if(pauseOnBlur){if(zot(zim.blurCheck))zim.setBlurDetect();zim.pauseOnBlur.push(obj);}
var lastTime=obj.startTime;function next(){var now=Date.now();obj.time+=(now-lastTime)/(timeType=="s"?1000:1);lastTime=now;if(obj.time>=time){obj.done=true;(call)(obj);obj.clear();return;}
obj.rid=requestAnimationFrame(next);}
obj.pause=function(state,immediate,reset){if(zot(state))state=true;if(state){cancelAnimationFrame(obj.rid);}else{if(immediate)lastTime=0;else if(reset){lastTime=Date.now();obj.time=0;}
else lastTime=Date.now();next();}
obj.paused=state;};obj.clear=function(){if(obj)cancelAnimationFrame(obj.rid);for(var i in obj){delete obj[i];}
obj.pause=function(){};obj.clear=function(){};};next();return obj;};zim.interval=function(time,call,total,immediate,pauseOnBlur,timeUnit){var sig="time, call, total, immediate, pauseOnBlur, timeUnit";var duo;if(duo=zob(zim.interval,arguments,sig,this))return duo;z_d("9.8");if(zot(call))return;if(typeof call!='function')return;var timeType=getTIME(time,timeUnit);if(zot(time))time=timeType=="s"?1:1000;if(zot(immediate))immediate=false;if(!zot(total)&&(isNaN(total)||total<=0))return;if(zot(total))total=-1;var obj={count:0,total:total,paused:false,time:time,active:true,timeUnit:timeUnit};if(pauseOnBlur){if(zot(zim.blurCheck))zim.setBlurDetect();zim.pauseOnBlur.push(obj);}
function interval(){obj.startTime=Date.now();obj.interval=zim.Pick.choose(obj.time);obj.id=setTimeout(function(){if(obj.paused)return;if(!obj.active)return;obj.count++;(call)(obj);interval();checkTotal();},obj.interval*(timeType=="s"?1000:1));}
if(immediate){setTimeout(function(){(call)(obj);checkTotal();},10);}
function checkTotal(){if(total==-1)return;if(obj.count>=(immediate?obj.total-1:obj.total))obj.clear();}
var pausedTimeout;obj.pause=function(state,immediate,reset){if(zot(state))state=true;if(state){clearTimeout(pausedTimeout);clearTimeout(obj.id);cancelAnimationFrame(obj.rid);obj.pauseTimeLeft=obj.interval-(Date.now()-obj.startTime)/(timeType=="s"?1000:1);}else{if(!obj.paused)obj.pause(true);pausedTimeout=setTimeout(function(){obj.count++;(call)(obj);interval();checkTotal();},immediate?0:(reset?obj.interval:obj.pauseTimeLeft)*(timeType=="s"?1000:1));obj.pauseTimeLeft=null;}
obj.paused=state;};obj.clear=function(){obj.active=false;clearTimeout(pausedTimeout);cancelAnimationFrame(obj.rid);clearTimeout(obj.id);var count=obj.count;for(var i in obj){delete obj[i];}
obj.active=false;obj.count=count;obj.pause=function(){};obj.clear=function(){};};interval();return obj;};zim.async=function(url,callback,callbackString,maxTime,maxCancel){z_d("29");if(zot(url))return;var tag=document.createElement("script");var timeType=getTIME(maxTime);if(zot(maxTime))maxTime=timeType=="s"?2:2000;if(callback){if(callbackString)var n=callbackString;else var n=callback.toString().split(/\n/,1)[0].match(/^function\s?([^\s(]*)/)[1];if(!zim.asyncList)zim.asyncList={};if(!zim.asyncList[n])zim.asyncList[n]=[];zim.asyncList[n].push(callback);zim.async[n]=function(){var t=tag;var cancelMe=false;var errorID=setTimeout(function(){cancelMe=maxCancel;if(typeof callback=="function")callback("asyncError",maxCancel?"cancelled":"timeout");},maxTime*(timeType=="s"?1000:1));return function(d){clearTimeout(errorID);if(zim.asyncList[n])callback=zim.asyncList[n].shift();if(typeof callback=="function"&&!cancelMe)callback(d);if(t)t.parentNode.removeChild(t);t=null;};}();}else{if(zim.async.z_s&&zim.async.z_s.parentNode)zim.async.z_s.parentNode.removeChild(zim.async.z_s);zim.async.z_s=tag;}
if(!url.match(/\?/))url+="?";tag.setAttribute("src",url+"&r="+Math.random());document.getElementsByTagName("head")[0].appendChild(tag);};zim.couple=function(json){z_d("29.2");if(!zim.isJSON(json))return json;var obj=JSON.parse(json);var obj2={};for(var i in obj){var o=obj[i];for(var j in o){obj2[i+"_"+j]=o[j];}}
return JSON.stringify(obj2);};zim.decouple=function(json){z_d("29.3");if(!zim.isJSON(json))return json;var obj=JSON.parse(json);var obj2={};for(var i in obj){var n=i.split("_",2);if(n.length!=2)return json;if(!obj2[n[0]])obj2[n[0]]={};obj2[n[0]][n[1]]=obj[i];}
return JSON.stringify(obj2);};zim.convertColor=function(color,toColorType,alpha){if(!zim.convertColorCheck){z_d("27.5");zim.convertColorCheck=true;}
if(zot(toColorType))toColorType="hex";if(zot(color))return;color=zik(color);var colors=['black','aliceblue','antiquewhite','aqua','aquamarine','azure','beige','bisque','blanchedalmond','blue','blueviolet','brown','burlywood','cadetblue','chartreuse','chocolate','coral','cornflowerblue','cornsilk','crimson','cyan','darkblue','darkcyan','darkgoldenrod','darkgray','darkgrey','darkgreen','darkkhaki','darkmagenta','darkolivegreen','darkorange','darkorchid','darkred','darksalmon','darkseagreen','darkslateblue','darkslategray','darkslategrey','darkturquoise','darkviolet','deeppink','deepskyblue','dimgray','dimgrey','dodgerblue','firebrick','floralwhite','forestgreen','fuchsia','gainsboro','ghostwhite','gold','goldenrod','gray','grey','green','greenyellow','honeydew','hotpink','indianred','indigo','ivory','khaki','lavender','lavenderblush','lawngreen','lemonchiffon','lightblue','lightcoral','lightcyan','lightgoldenrodyellow','lightgray','lightgrey','lightgreen','lightpink','lightsalmon','lightseagreen','lightskyblue','lightslategray','lightslategrey','lightsteelblue','lightyellow','lime','limegreen','linen','magenta','maroon','mediumaquamarine','mediumblue','mediumorchid','mediumpurple','mediumseagreen','mediumslateblue','mediumspringgreen','mediumturquoise','mediumvioletred','midnightblue','mintcream','mistyrose','moccasin','navajowhite','navy','oldlace','olive','olivedrab','orange','orangered','orchid','palegoldenrod','palegreen','paleturquoise','palevioletred','papayawhip','peachpuff','peru','pink','plum','powderblue','purple','rebeccapurple','red','rosybrown','royalblue','saddlebrown','salmon','sandybrown','seagreen','seashell','sienna','silver','skyblue','slateblue','slategray','slategrey','snow','springgreen','steelblue','tan','teal','thistle','tomato','turquoise','violet','wheat','white','whitesmoke','yellow','yellowgreen'];var hex=['000000','f0f8ff','faebd7','00ffff','7fffd4','f0ffff','f5f5dc','ffe4c4','ffebcd','0000ff','8a2be2','a52a2a','deb887','5f9ea0','7fff00','d2691e','ff7f50','6495ed','fff8dc','dc143c','00ffff','00008b','008b8b','b8860b','a9a9a9','a9a9a9','006400','bdb76b','8b008b','556b2f','ff8c00','9932cc','8b0000','e9967a','8fbc8f','483d8b','2f4f4f','2f4f4f','00ced1','9400d3','ff1493','00bfff','696969','696969','1e90ff','b22222','fffaf0','228b22','ff00ff','dcdcdc','f8f8ff','ffd700','daa520','808080','808080','008000','adff2f','f0fff0','ff69b4','cd5c5c','4b0082','fffff0','f0e68c','e6e6fa','fff0f5','7cfc00','fffacd','add8e6','f08080','e0ffff','fafad2','d3d3d3','d3d3d3','90ee90','ffb6c1','ffa07a','20b2aa','87cefa','778899','778899','b0c4de','ffffe0','00ff00','32cd32','faf0e6','ff00ff','800000','66cdaa','0000cd','ba55d3','9370db','3cb371','7b68ee','00fa9a','48d1cc','c71585','191970','f5fffa','ffe4e1','ffe4b5','ffdead','000080','fdf5e6','808000','6b8e23','ffa500','ff4500','da70d6','eee8aa','98fb98','afeeee','db7093','ffefd5','ffdab9','cd853f','ffc0cb','dda0dd','b0e0e6','800080','663399','ff0000','bc8f8f','4169e1','8b4513','fa8072','f4a460','2e8b57','fff5ee','a0522d','c0c0c0','87ceeb','6a5acd','708090','708090','fffafa','00ff7f','4682b4','d2b48c','008080','d8bfd8','ff6347','40e0d0','ee82ee','f5deb3','ffffff','f5f5f5','ffff00','9acd32'];if(toColorType.toLowerCase()=="zim"){var i=zim.colorsHex.indexOf(color);if(i<0)return color;return zim.colors[zim.colorsHex.indexOf(color)];}
var answer;if(answer=color.match(/rgba\((.*)\)/)){if(zot(alpha)){color="rgb("+answer[1]+")";}else{var c=color.split(",");c[3]=alpha+")";return c.join(",");}}
function rgbToHex(rgb){var hex=Number(rgb).toString(16);if(hex.length<2){hex="0"+hex;}
return hex;}
function getRGB(string){var c=string.split(",");var red=rgbToHex(c[0]);var green=rgbToHex(c[1]);var blue=rgbToHex(c[2]);return[red,green,blue];}
if(zot(alpha))alpha==1;if(answer=color.match(/rgb\((.*)\)/)){if(toColorType=="rgba"){var c=color.split(")");return c[0]+","+alpha+c[1];}else if(toColorType=="hex"){var colors=getRGB(answer[1]);return"#"+colors[0]+colors[1]+colors[2];}else if(toColorType=="hexNumber"){var colors=getRGB(answer[1]);return parseInt(colors[0]+colors[1]+colors[2],16);}else if(toColorType=="string"){var color=getRGB(answer[1]).join("").toLowerCase();var index=hex.indexOf(color);if(index==-1)return"#"+color;else return colors[index];}else return color;}
if(toColorType=="rgb"||toColorType=="rgba"){function hexToRgbA(hex){var c;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)){c=hex.substring(1).split('');if(c.length==3){c=[c[0],c[0],c[1],c[1],c[2],c[2]];}
c='0x'+c.join('');if(toColorType=="rgb"){return'rgb('+[(c>>16)&255,(c>>8)&255,c&255]+')';}else{return'rgba('+[(c>>16)&255,(c>>8)&255,c&255].join(',')+','+alpha+')';}}else{if(toColorType=="rgb"){return"rgb(0,0,0)";}else{return"rgba(0,0,0,1)";}}}
if(color.charAt(0)=="#"){return hexToRgbA(color);}else{return hexToRgbA(zim.convertColor(color));}}else if(toColorType=="hex"){if(color.charAt(0)=="#")return color;}else if(toColorType=="hexNumber"){if(color.charAt(0)=="#"){return parseInt(color.replace(/^#/,''),16);}}else{if(color.charAt(0)=="#"){color=color.replace("#","");if(color.length==3){color=color.charAt(0)+color.charAt(0)+color.charAt(1)+color.charAt(1)+color.charAt(2)+color.charAt(2);}}}
if(toColorType=="string"){var index=hex.indexOf(color);if(index==-1)return"#"+color;else return colors[index];}else if(toColorType=="hexNumber"){return parseInt(hex[colors.indexOf(color.toLowerCase())!=-1?colors.indexOf(color):0],16);}else{return"#"+hex[colors.indexOf(color.toLowerCase())!=-1?colors.indexOf(color):0];}};zim.colorRange=function(color1,color2,ratio){if(!zim.colorRangeCheck){z_d("27.6");zim.colorRangeCheck=true;}
if(zot(ratio))ratio=.5;ratio=Math.max(0,Math.min(1,ratio));if(zot(color1))color1="white";if(zot(color2))color2="black";var c1=zim.convertColor(color1,"rgb");var c2=zim.convertColor(color2,"rgb");var color1=c1.substring(4,c1.length-1).split(',');var color2=c2.substring(4,c2.length-1).split(',');var difference;var newColor="#";var c;for(var i=0;i<color1.length;i++){difference=color2[i]-color1[i];c=Math.floor(parseInt(color1[i],10)+difference*ratio).toString(16);if(c.length<2)c="0"+c;newColor+=c;}
return newColor;};zim.lighten=function(color,ratio){if(!zim.lightenCheck){z_d("27.65");zim.lightenCheck=true;}
if(zot(ratio))ratio=.5;if(ratio>=0)return zim.colorRange(String(color),"#FFFFFF",ratio);else return zim.colorRange(String(color),"#000000",-ratio);};zim.darken=function(color,ratio){if(zot(ratio))ratio=.5;if(!zim.darkenCheck){z_d("27.66");zim.darkenCheck=true;}
if(ratio>=0)return zim.colorRange(String(color),"#000000",ratio);else return zim.colorRange(String(color),"#ffffff",-ratio);};zim.toColor=function(color,targetColor,ratio){if(!zim.toColorCheck){z_d("27.67");zim.toColorCheck=true;}
if(zot(ratio))ratio=.5;return zim.colorRange(String(color),targetColor,ratio);};zim.toAlpha=function(color,ratio){if(!zim.toAlphaCheck){z_d("27.68");zim.toAlphaCheck=true;}
if(zot(ratio))ratio=.5;return zim.convertColor(String(color),"rgba",ratio);};zim.zimEase=function(points,polynomials,mirror,reverse,lockEnds){z_d("27.69");var two=false;if(zot(lockEnds))lockEnds=true;if(points){if(Array.isArray(points[1])){two=true;points2=points[1];points=points[0];var c0z=0;var c1z=points2[0];var c2z=points2[1];var c3z=points2[2];var c4z=points2[3];var c5z=1;var ez=5*(c1z-c0z);var dz=10*(c2z-c0z)-4*ez;var cz=10*(c3z-c0z)+30*(c1z-c2z);var bz=5*(c4z+c0z)-20*(c3z+c1z)+30*c2z;var az=c5z-c0z-bz-cz-dz-ez;}
var c0=0;var c1=points[0];var c2=points[1];var c3=points[2];var c4=points[3];var c5=1;var e=5*(c1-c0);var d=10*(c2-c0)-4*e;var c=10*(c3-c0)+30*(c1-c2);var b=5*(c4+c0)-20*(c3+c1)+30*c2;var a=c5-c0-b-c-d-e;}else if(polynomials){var a=polynomials[0];var b=polynomials[1];var c=polynomials[2];var d=polynomials[3];var e=polynomials[4];var c1=e/5;var c2=(d+4*e)/10;var c3=(c+6*e+3*d)/10;var c4=(b+4*e+3*d+2*c)/5;}else{var a=0;var b=0;var c=0;var d=0;var e=1;}
if(mirror){var rF=function(){return zim.zimEase(null,[a,b,c,d,e],true)};var obj={reverse:rF,points:[c1,c2,c3,c4],polynomials:[a,b,c,d,e]}
obj.noPick=function(k){if(lockEnds){if(k<.025)return 0;if(k>.975)return 1;}
if(k<.5){k*=2;var t=k*100;var di=100;var ts=(t/=di)*t;var tc=ts*t;return(a*tc*ts+b*ts*ts+c*tc+d*ts+e*t)/2;}else{k=1-(k-.5)*2;var t=k*100;var di=100;var ts=(t/=di)*t;var tc=ts*t;return 1-(a*tc*ts+b*ts*ts+c*tc+d*ts+e*t)/2;}}}else if(two){var rF=function(){if(zon)zogy("zimEase - multi array points cannot be reversed");return zim.zimEase(null,[a,b,c,d,e])};var obj={reverse:rF,points:[[c1,c2,c3,c4],[c1z,c2z,c3z,c4z]],polynomials:[[a,b,c,d,e],[az,bz,cz,dz,ez]]}
obj.noPick=function(k){if(lockEnds){if(k<.025)return 0;if(k>.975)return 1;}
if(k<.5){k*=2;var t=k*100;var di=100;var ts=(t/=di)*t;var tc=ts*t;return(a*tc*ts+b*ts*ts+c*tc+d*ts+e*t)/2;}else{k=(k-.5)*2;var t=k*100;var di=100;var ts=(t/=di)*t;var tc=ts*t;return.5+(az*tc*ts+bz*ts*ts+cz*tc+dz*ts+ez*t)/2;}}}else{var rF=function(){return zim.zimEase(null,[a,b,c,d,e],null,true)};var obj={reverse:rF,points:[c1,c2,c3,c4],polynomials:[a,b,c,d,e]}
if(reverse){obj.noPick=function(k){if(lockEnds){if(k<.025)return 0;if(k>.975)return 1;}
var t=100-k*100;var di=100;var ts=(t/=di)*t;var tc=ts*t;return 1-(a*tc*ts+b*ts*ts+c*tc+d*ts+e*t);}}else{obj.noPick=function(k){if(lockEnds){if(k<.025)return 0;if(k>.975)return 1;}
var t=k*100;var di=100;var ts=(t/=di)*t;var tc=ts*t;return(a*tc*ts+b*ts*ts+c*tc+d*ts+e*t);}}}
obj.noPick.reverse=rF;return obj;}
zim.pointAlongCurve=function(points,ratio,getAngle,even){z_d("27.7");if(!points||!points[0]||!points[1]||!points[2]||!points[3])return;if(zot(even))even=false;var cubic=new zim.Bezier(points[0],points[1],points[2],points[3]);if(even){var x=cubic.mx(ratio);var y=cubic.my(ratio);}else{var x=cubic.x(ratio);var y=cubic.y(ratio);}
if(getAngle){var lastRatio=ratio-.05;var nextRatio=ratio+.05;if(lastRatio<0)lastRatio=0;if(nextRatio>1)nextRatio=1;if(even){var x0=cubic.mx(lastRatio);var y0=cubic.my(lastRatio);var x2=cubic.mx(nextRatio);var y2=cubic.my(nextRatio);}else{var x0=cubic.x(lastRatio);var y0=cubic.y(lastRatio);var x2=cubic.x(nextRatio);var y2=cubic.y(nextRatio);}
var angle=zim.angle(x0,y0,x2,y2);return({x:x,y:y,angle:angle});}
return({x:x,y:y});};zim.distanceAlongCurve=function(points){z_d("27.8");var chord=zim.dist(points[0],points[3]);var controlDist=zim.dist(points[0],points[1])+zim.dist(points[1],points[2])+zim.dist(points[2],points[3]);return(chord+controlDist)/2;};zim.closestPointAlongCurve=function(point,segmentPoints,num,interpolate,percentage){z_d("27.9");var closest=10000000;var closestTestPoint;var index=0;var secondaryIndex=0;if(zot(num))num=10;zim.loop(segmentPoints,function(points,i,t){var cubic=new zim.Bezier(points[0],points[1],points[2],points[3]);zim.loop(num,function(j,total){var testPoint={x:cubic.x(j/total),y:cubic.y(j/total)};var d=zim.dist(point,testPoint);if(d<closest){closest=d;closestTestPoint=testPoint;index=i;secondaryIndex=j;}});});if(percentage){return(index*num+secondaryIndex)/(segmentPoints.length*num)*100;}else if(interpolate){return closestTestPoint;}
return index;};zim.transformPoints=function(points,transformType,amount,x,y){z_d("27.95");if(zot(points)||!Array.isArray(points))return;if(zot(x))x=0;if(zot(y))y=0;var points=zim.copy(points);var xStart=x;var yStart=y;if(transformType=="rotation"){if(x!=0)points=zim.transformPoints(points,"x",-xStart);if(y!=0)points=zim.transformPoints(points,"y",-yStart);}
var point;for(var i=0;i<points.length;i++){point=points[i];if(!Array.isArray(point))continue;if(transformType=="x"){point[0]+=amount;}else if(transformType=="y"){point[1]+=amount;}else if(transformType=="scaleX"){point[0]=(point[0]-x)*amount+x;point[4]=(point[4])*amount;point[6]=(point[6])*amount;}else if(transformType=="scaleY"){point[1]=(point[1]-y)*amount+y;point[5]=(point[5])*amount;point[7]=(point[7])*amount;}else if(transformType=="scale"){point[0]=(point[0]-x)*amount+x;point[4]=(point[4])*amount;point[6]=(point[6])*amount;point[1]=(point[1]-y)*amount+y;point[5]=(point[5])*amount;point[7]=(point[7])*amount;}else if(transformType=="rotation"){var a=amount*Math.PI/180;var x1=point[0];var y1=point[1];point[0]=x1*Math.cos(a)-y1*Math.sin(a);point[1]=y1*Math.cos(a)+x1*Math.sin(a);x1=point[4];y1=point[5];point[4]=x1*Math.cos(a)-y1*Math.sin(a);point[5]=y1*Math.cos(a)+x1*Math.sin(a);x1=point[6];y1=point[7];point[6]=x1*Math.cos(a)-y1*Math.sin(a);point[7]=y1*Math.cos(a)+x1*Math.sin(a);}}
if(transformType=="rotation"){if(x!=0)points=zim.transformPoints(points,"x",xStart);if(y!=0)points=zim.transformPoints(points,"y",yStart);}
return points;};zim.makeID=function(type,length,letterCase){z_d("13.5");if(zot(type))type="mixed";if(zot(length))length=5;if(zot(letterCase))letterCase="uppercase";var choices;var nums=[2,3,4,5,6,7,8,9];var lets="abcdefghjkmnpqrstuvwxyz".split("");if(type.constructor===Array){choices=type;}else if(type=="numbers"){choices=nums;}else if(type=="letters"){choices=lets;}else{choices=nums.concat(lets);}
var id="";var c;var rand;for(var i=0;i<length;i++){c=choices[Math.floor(Math.random()*choices.length)];rand=Math.random();if(letterCase=="uppercase"||(letterCase=="mixed"&&rand>.5)){if(c.toUpperCase)c=c.toUpperCase();}else{if(c.toLowerCase)c=c.toLowerCase();}
id+=String(c);}
return id;};zim.swapProperties=function(property,objA,objB){z_d("17.1");if(zot(objA)||zot(objB)||zot(objA[property])||zot(objB[property]))return false;var temp=objB[property];objB[property]=objA[property];objA[property]=temp;return true;};zim.mobile=function(orientation){z_d("28");if(typeof MOBILE!="undefined"&&MOBILE!="default")return MOBILE;if(!zot(zim.MOBILE)&&zim.MOBILE!="default")return zim.MOBILE;if(zot(orientation))orientation=true;if(/ip(hone|od|ad)/i.test(navigator.userAgent))return"ios";if(/android|nexus/i.test(navigator.userAgent))return"android";if(/blackberry/i.test(navigator.userAgent))return"blackberry";if(/nokia|phone|mobile/i.test(navigator.userAgent))return"windows";if(/opera mini|webos/i.test(navigator.userAgent))return"other";if(orientation&&window.orientation!==undefined){if(/safari/i.test(navigator.userAgent))return"ios";return true;}
return false;};zim.vee=function(obj){z_d("28.5");return!zot(obj)&&(obj.type=="Pick"||Array.isArray(obj)||(obj.constructor=={}.constructor&&(!zot(obj.max)||!zot(obj.noPick)))||typeof obj=="function");};zim.extend=function(subclass,superclass,override,prefix,prototype){var sig="subclass, superclass, override, prefix, prototype";var duo;if(duo=zob(zim.extend,arguments,sig))return duo;if(zot(subclass)||zot(superclass)){if(zon&&subclass!=zim.StageGL)zog("zim.extend() - please supply a class and its superclass");return;}
if(zot(prefix))prefix="super";if(zot(override))override=[];if(!Array.isArray(override))override=[override];if(zot(prototype))prototype=true;var existingP={};for(var f in subclass.prototype)Object.defineProperty(existingP,f,Object.getOwnPropertyDescriptor(subclass.prototype,f));function o(){this.constructor=subclass;}
o.prototype=superclass.prototype;subclass.prototype=new o();for(f in existingP){Object.defineProperty(subclass.prototype,f,Object.getOwnPropertyDescriptor(existingP,f));}
var subP=subclass.prototype;var supP=(Object.getPrototypeOf&&Object.getPrototypeOf(subP))||subP.__proto__;if(supP){subP[(prefix+="_")+"constructor"]=supP.constructor;var n;for(var i=0;i<override.length;i++){n=override[i];if(typeof supP[n]=="function"){subP[prefix+n]=supP[n];}}
if(prototype){for(n in supP){if(subP.hasOwnProperty(n)&&(typeof supP[n]=="function")){subP[prefix+n]=supP[n];}}}}
return subclass;};zim.copy=function(obj,clone,cloneContainer){if(!zim.copyCheck){z_d("10");zim.copyCheck=true;}
if(zot(clone))clone=false;if(zot(cloneContainer))cloneContainer=true;if(obj==null||!(obj instanceof Array||obj.constructor=={}.constructor))return clone&&obj!=null?(obj.clone?(obj.type&&((obj.type!="Container"&&obj.type!="Stage"&&obj.type!="StageGL")||cloneContainer)?obj.clone():obj):obj):obj;if(obj instanceof Array){var array=[];for(var i=0;i<obj.length;i++){array[i]=zim.copy(obj[i],clone,cloneContainer);}
return array;}
if(obj.constructor=={}.constructor){var copy={};for(var attr in obj){var answer=zim.copy(obj[attr],clone,cloneContainer);if(obj.hasOwnProperty(attr))copy[attr]=answer;}
return copy;}};zim.merge=function(){if(!zim.mergeCheck){z_d("12");zim.mergeCheck=true;}
var obj={};var i;var j;for(i=0;i<arguments.length;i++){for(j in arguments[i]){if(arguments[i].hasOwnProperty(j)){obj[j]=arguments[i][j];}}}
return obj;};zim.arraysEqual=function(a,b,strict){z_d("11");if(zot(a)||zot(b))return false;if(zot(strict))strict=true;if(a.length!=b.length)return false;for(var i=0;i<a.length;i++){if(a[i]instanceof Array&&b[i]instanceof Array){if(!zim.arraysEqual(a[i],b[i],strict))return false;}
else if(strict&&a[i]!=b[i]){return false;}
else if(!strict){return zim.arraysEqual(a.sort(),b.sort(),true);}}
return true;};zim.isEmpty=function(obj){if(!zim.zimEmptyCheck){z_d("11.5");zim.zimEmptyCheck=true;}
if(zot(obj))return;var count=0;for(var o in obj){count++;break;}
return(count==0);};zim.isJSON=function(str){z_d("11.6");if(typeof str!="string"){return false;}
try{JSON.parse(str);return true;}
catch(error){return false;}};zim.isPick=function(obj){if(!zim.zimPickCheck){z_d("11.7");zim.zimPickCheck=true;}
if(zot(obj))return;return(Array.isArray(obj)||(obj.constructor=={}.constructor&&obj.min!=null&&obj.max!=null)||(obj.constructor===Function&&(obj.array!=null||obj()!=null)));};zim.zut=function(e){if(zot(e)||typeof e=="object")return true;};zim.decimals=function(num,places,addZeros,addZerosBefore,includeZero,time,evt){if(!zim.zimDecimalCheck){z_d("13");zim.zimDecimalCheck=true;}
if(zot(num))return 0;if(zot(places))places=1;if(zot(addZeros))addZeros=0;if(zot(addZerosBefore))addZerosBefore=0;if(zot(addZerosBefore))addZerosBefore=0;if(zot(includeZero))includeZero=true;if(zot(time))time=false;var answer=Math.round(num*Math.pow(10,places))/Math.pow(10,places);if(time){var secs=answer-Math.floor(answer);answer=zim.decimals(Math.floor(answer)+secs*60/100,2);}
var sign=zim.sign(answer);if(addZeros>0){var place=String(answer).indexOf(".");var length=String(answer).length;if(place<0){place=length++;answer+=".";}
for(var i=0;i<addZeros-(length-place-1);i++){answer+="0";}}
if(addZerosBefore>0){if(sign==-1)answer=answer.substr(1,answer.length-1);var place=String(answer).indexOf(".");var length=String(answer).length;var left=(place<0)?length:place;for(var i=0;i<addZerosBefore-left;i++){answer="0"+answer;}
if(sign==-1)answer="-"+answer;}
if((addZeros+addZerosBefore>0)&&!includeZero&&Number(answer)==0)answer=0;if(time)answer=String(answer).replace(".",":");return zim.zut(evt)?answer:null;};zim.sign=function(num){if(!zim.zimSignCheck){z_d("13.1");zim.zimSignCheck=true;}
return num?num<0?-1:1:0;};zim.constrain=function(num,min,max,negative){z_d("13.2");if(zot(num))return;if(zot(min))min=0;if(zot(max))max=Number.MAX_VALUE;if(max<min){var max2=min;max=min;min=max2;}
if(zot(negative))negative=false;if(negative&&num<0){return Math.max(-max,Math.min(num,-min));}else{return Math.max(min,Math.min(num,max));}};zim.dist=function(a,b,c,d){if(!zim.zimDistCheck){z_d("13.3");zim.zimDistCheck=true;}
if(zot(a)||zot(b))return;if(!zot(a.x)&&!zot(b.x)){d=b.y;c=b.x;b=a.y;a=a.x;}else{if(zot(c))c=0;if(zot(d))d=0;}
return Math.sqrt((Math.pow(c-a,2)+Math.pow(d-b,2)));};zim.rectIntersect=function(a,b,margin){if(!zim.zimRectIntersectCheck){z_d("13.32");zim.zimRectIntersectCheck=true;}
if(zot(margin))margin=0;if(a.x>=b.x+b.width+margin||a.x+a.width+margin<=b.x||a.y>=b.y+b.height+margin||a.y+a.height+margin<=b.y){return false;}else{return true;}};zim.boundsAroundPoints=function(points){if(!zim.zimBoundsAroundPointsCheck){z_d("13.34");zim.zimBoundsAroundPointsCheck=true;}
var tX=10000;var tY=10000;var bX=-10000;var bY=-10000;for(var i=0;i<points.length;i++){var p=points[i];if(p.x<tX)tX=p.x;if(p.x>bX)bX=p.x;if(p.y<tY)tY=p.y;if(p.y>bY)bY=p.y;}
return{x:tX,y:tY,width:bX-tX,height:bY-tY};};zim.angle=function(x1,y1,x2,y2){if(!zim.angleCheck){z_d("13.4");zim.angleCheck=true;}
if(zot(x1)||zot(y1))return;if(zot(x2)){x2=x1;x1=0;}
if(zot(y2)){y2=y1;y1=0;}
return(Math.atan2(y2-y1,x2-x1)*180/Math.PI+360)%360;};zim.TAU=Math.PI*2;zim.DEG=180/Math.PI;zim.RAD=Math.PI/180;zim.smoothStep=function(num,min,max){z_d("13.7");var x=zim.constrain((num-min)/(max-min),0,1);return x*x*x*(x*(x*6-15)+10);};zim.Ajax=function(master,couple,lock,unique){z_d("13.8");var http=new XMLHttpRequest();this.master=master;this.couple=couple;this.lock=lock;this.unique=unique;var that=this;this.get=function(url,callback){var addMaster=!zot(that.master)?"&master="+encodeURI(master):"";var addLock=!zot(that.lock)?"&lock="+encodeURI(lock):"";var addUnique=that.unique?"&unique=true":"";http.open('GET',url+addMaster+addLock+addUnique,true);http.onload=function(){if(http.status==200){callback(zim.isJSON(http.responseText)?JSON.parse(http.responseText):http.responseText);}else{callback(null,'Error: '+http.status);}};http.send();};this.post=function(url,data,command,extra,callback){var sig="url, data, command, extra, callback";var duo;if(duo=zob(that.post,arguments,sig))return duo;if(zot(url))return;http.open('POST',url,true);http.setRequestHeader('Content-type',"application/x-www-form-urlencoded");http.onload=function(){var r=http.responseText;if(zim.isJSON(r)){if(that.couple)r=zim.decouple(r);r=JSON.parse(r);}
callback(r);};if(!zim.isJSON(data))data=JSON.stringify(data);if(that.couple)data=zim.couple(data);var addMaster=!zot(that.master)?"&master="+encodeURIComponent(that.master):"";var addLock=!zot(that.lock)?"&lock="+encodeURIComponent(that.lock):"";var addCommand=!zot(command)?"&command="+encodeURIComponent(command):"";var addExtra=!zot(extra)?"&extra="+encodeURIComponent(extra):"";http.send("data="+encodeURIComponent(data)+addMaster+addLock+addCommand+addExtra);};this.put=function(url,data,callback){http.open('PUT',url,true);http.setRequestHeader('Content-type','application/json');http.onload=function(){callback(zim.isJSON(http.responseText)?JSON.parse(http.responseText):that.http.responseText);};http.send(JSON.stringify(data));};};zim.Noise=function(seed){"use strict";z_d("13.9");if(zot(seed))seed=Math.random()*1000000;var clientSeed=seed;this.seed=seed;var that=this;var con={};con.NORM_2D=1.0/47.0;con.NORM_3D=1.0/103.0;con.NORM_4D=1.0/30.0;con.SQUISH_2D=(Math.sqrt(2+1)-1)/2;con.SQUISH_3D=(Math.sqrt(3+1)-1)/3;con.SQUISH_4D=(Math.sqrt(4+1)-1)/4;con.STRETCH_2D=(1/Math.sqrt(2+1)-1)/2;con.STRETCH_3D=(1/Math.sqrt(3+1)-1)/3;con.STRETCH_4D=(1/Math.sqrt(4+1)-1)/4;con.base2D=[[1,1,0,1,0,1,0,0,0],[1,1,0,1,0,1,2,1,1]];con.base3D=[[0,0,0,0,1,1,0,0,1,0,1,0,1,0,0,1],[2,1,1,0,2,1,0,1,2,0,1,1,3,1,1,1],[1,1,0,0,1,0,1,0,1,0,0,1,2,1,1,0,2,1,0,1,2,0,1,1]];con.base4D=[[0,0,0,0,0,1,1,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1],[3,1,1,1,0,3,1,1,0,1,3,1,0,1,1,3,0,1,1,1,4,1,1,1,1],[1,1,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1,2,1,1,0,0,2,1,0,1,0,2,1,0,0,1,2,0,1,1,0,2,0,1,0,1,2,0,0,1,1],[3,1,1,1,0,3,1,1,0,1,3,1,0,1,1,3,0,1,1,1,2,1,1,0,0,2,1,0,1,0,2,1,0,0,1,2,0,1,1,0,2,0,1,0,1,2,0,0,1,1]];con.gradients2D=[5,2,2,5,-5,2,-2,5,5,-2,2,-5,-5,-2,-2,-5];con.gradients3D=[-11,4,4,-4,11,4,-4,4,11,11,4,4,4,11,4,4,4,11,-11,-4,4,-4,-11,4,-4,-4,11,11,-4,4,4,-11,4,4,-4,11,-11,4,-4,-4,11,-4,-4,4,-11,11,4,-4,4,11,-4,4,4,-11,-11,-4,-4,-4,-11,-4,-4,-4,-11,11,-4,-4,4,-11,-4,4,-4,-11];con.gradients4D=[3,1,1,1,1,3,1,1,1,1,3,1,1,1,1,3,-3,1,1,1,-1,3,1,1,-1,1,3,1,-1,1,1,3,3,-1,1,1,1,-3,1,1,1,-1,3,1,1,-1,1,3,-3,-1,1,1,-1,-3,1,1,-1,-1,3,1,-1,-1,1,3,3,1,-1,1,1,3,-1,1,1,1,-3,1,1,1,-1,3,-3,1,-1,1,-1,3,-1,1,-1,1,-3,1,-1,1,-1,3,3,-1,-1,1,1,-3,-1,1,1,-1,-3,1,1,-1,-1,3,-3,-1,-1,1,-1,-3,-1,1,-1,-1,-3,1,-1,-1,-1,3,3,1,1,-1,1,3,1,-1,1,1,3,-1,1,1,1,-3,-3,1,1,-1,-1,3,1,-1,-1,1,3,-1,-1,1,1,-3,3,-1,1,-1,1,-3,1,-1,1,-1,3,-1,1,-1,1,-3,-3,-1,1,-1,-1,-3,1,-1,-1,-1,3,-1,-1,-1,1,-3,3,1,-1,-1,1,3,-1,-1,1,1,-3,-1,1,1,-1,-3,-3,1,-1,-1,-1,3,-1,-1,-1,1,-3,-1,-1,1,-1,-3,3,-1,-1,-1,1,-3,-1,-1,1,-1,-3,-1,1,-1,-1,-3,-3,-1,-1,-1,-1,-3,-1,-1,-1,-1,-3,-1,-1,-1,-1,-3];con.lookupPairs2D=[0,1,1,0,4,1,17,0,20,2,21,2,22,5,23,5,26,4,39,3,42,4,43,3];con.lookupPairs3D=[0,2,1,1,2,2,5,1,6,0,7,0,32,2,34,2,129,1,133,1,160,5,161,5,518,0,519,0,546,4,550,4,645,3,647,3,672,5,673,5,674,4,677,3,678,4,679,3,680,13,681,13,682,12,685,14,686,12,687,14,712,20,714,18,809,21,813,23,840,20,841,21,1198,19,1199,22,1226,18,1230,19,1325,23,1327,22,1352,15,1353,17,1354,15,1357,17,1358,16,1359,16,1360,11,1361,10,1362,11,1365,10,1366,9,1367,9,1392,11,1394,11,1489,10,1493,10,1520,8,1521,8,1878,9,1879,9,1906,7,1910,7,2005,6,2007,6,2032,8,2033,8,2034,7,2037,6,2038,7,2039,6];con.lookupPairs4D=[0,3,1,2,2,3,5,2,6,1,7,1,8,3,9,2,10,3,13,2,16,3,18,3,22,1,23,1,24,3,26,3,33,2,37,2,38,1,39,1,41,2,45,2,54,1,55,1,56,0,57,0,58,0,59,0,60,0,61,0,62,0,63,0,256,3,258,3,264,3,266,3,272,3,274,3,280,3,282,3,2049,2,2053,2,2057,2,2061,2,2081,2,2085,2,2089,2,2093,2,2304,9,2305,9,2312,9,2313,9,16390,1,16391,1,16406,1,16407,1,16422,1,16423,1,16438,1,16439,1,16642,8,16646,8,16658,8,16662,8,18437,6,18439,6,18469,6,18471,6,18688,9,18689,9,18690,8,18693,6,18694,8,18695,6,18696,9,18697,9,18706,8,18710,8,18725,6,18727,6,131128,0,131129,0,131130,0,131131,0,131132,0,131133,0,131134,0,131135,0,131352,7,131354,7,131384,7,131386,7,133161,5,133165,5,133177,5,133181,5,133376,9,133377,9,133384,9,133385,9,133400,7,133402,7,133417,5,133421,5,133432,7,133433,5,133434,7,133437,5,147510,4,147511,4,147518,4,147519,4,147714,8,147718,8,147730,8,147734,8,147736,7,147738,7,147766,4,147767,4,147768,7,147770,7,147774,4,147775,4,149509,6,149511,6,149541,6,149543,6,149545,5,149549,5,149558,4,149559,4,149561,5,149565,5,149566,4,149567,4,149760,9,149761,9,149762,8,149765,6,149766,8,149767,6,149768,9,149769,9,149778,8,149782,8,149784,7,149786,7,149797,6,149799,6,149801,5,149805,5,149814,4,149815,4,149816,7,149817,5,149818,7,149821,5,149822,4,149823,4,149824,37,149825,37,149826,36,149829,34,149830,36,149831,34,149832,37,149833,37,149842,36,149846,36,149848,35,149850,35,149861,34,149863,34,149865,33,149869,33,149878,32,149879,32,149880,35,149881,33,149882,35,149885,33,149886,32,149887,32,150080,49,150082,48,150088,49,150098,48,150104,47,150106,47,151873,46,151877,45,151881,46,151909,45,151913,44,151917,44,152128,49,152129,46,152136,49,152137,46,166214,43,166215,42,166230,43,166247,42,166262,41,166263,41,166466,48,166470,43,166482,48,166486,43,168261,45,168263,42,168293,45,168295,42,168512,31,168513,28,168514,31,168517,28,168518,25,168519,25,280952,40,280953,39,280954,40,280957,39,280958,38,280959,38,281176,47,281178,47,281208,40,281210,40,282985,44,282989,44,283001,39,283005,39,283208,30,283209,27,283224,30,283241,27,283256,22,283257,22,297334,41,297335,41,297342,38,297343,38,297554,29,297558,24,297562,29,297590,24,297594,21,297598,21,299365,26,299367,23,299373,26,299383,23,299389,20,299391,20,299584,31,299585,28,299586,31,299589,28,299590,25,299591,25,299592,30,299593,27,299602,29,299606,24,299608,30,299610,29,299621,26,299623,23,299625,27,299629,26,299638,24,299639,23,299640,22,299641,22,299642,21,299645,20,299646,21,299647,20,299648,61,299649,60,299650,61,299653,60,299654,59,299655,59,299656,58,299657,57,299666,55,299670,54,299672,58,299674,55,299685,52,299687,51,299689,57,299693,52,299702,54,299703,51,299704,56,299705,56,299706,53,299709,50,299710,53,299711,50,299904,61,299906,61,299912,58,299922,55,299928,58,299930,55,301697,60,301701,60,301705,57,301733,52,301737,57,301741,52,301952,79,301953,79,301960,76,301961,76,316038,59,316039,59,316054,54,316071,51,316086,54,316087,51,316290,78,316294,78,316306,73,316310,73,318085,77,318087,77,318117,70,318119,70,318336,79,318337,79,318338,78,318341,77,318342,78,318343,77,430776,56,430777,56,430778,53,430781,50,430782,53,430783,50,431000,75,431002,72,431032,75,431034,72,432809,74,432813,69,432825,74,432829,69,433032,76,433033,76,433048,75,433065,74,433080,75,433081,74,447158,71,447159,68,447166,71,447167,68,447378,73,447382,73,447386,72,447414,71,447418,72,447422,71,449189,70,449191,70,449197,69,449207,68,449213,69,449215,68,449408,67,449409,67,449410,66,449413,64,449414,66,449415,64,449416,67,449417,67,449426,66,449430,66,449432,65,449434,65,449445,64,449447,64,449449,63,449453,63,449462,62,449463,62,449464,65,449465,63,449466,65,449469,63,449470,62,449471,62,449472,19,449473,19,449474,18,449477,16,449478,18,449479,16,449480,19,449481,19,449490,18,449494,18,449496,17,449498,17,449509,16,449511,16,449513,15,449517,15,449526,14,449527,14,449528,17,449529,15,449530,17,449533,15,449534,14,449535,14,449728,19,449729,19,449730,18,449734,18,449736,19,449737,19,449746,18,449750,18,449752,17,449754,17,449784,17,449786,17,451520,19,451521,19,451525,16,451527,16,451528,19,451529,19,451557,16,451559,16,451561,15,451565,15,451577,15,451581,15,451776,19,451777,19,451784,19,451785,19,465858,18,465861,16,465862,18,465863,16,465874,18,465878,18,465893,16,465895,16,465910,14,465911,14,465918,14,465919,14,466114,18,466118,18,466130,18,466134,18,467909,16,467911,16,467941,16,467943,16,468160,13,468161,13,468162,13,468163,13,468164,13,468165,13,468166,13,468167,13,580568,17,580570,17,580585,15,580589,15,580598,14,580599,14,580600,17,580601,15,580602,17,580605,15,580606,14,580607,14,580824,17,580826,17,580856,17,580858,17,582633,15,582637,15,582649,15,582653,15,582856,12,582857,12,582872,12,582873,12,582888,12,582889,12,582904,12,582905,12,596982,14,596983,14,596990,14,596991,14,597202,11,597206,11,597210,11,597214,11,597234,11,597238,11,597242,11,597246,11,599013,10,599015,10,599021,10,599023,10,599029,10,599031,10,599037,10,599039,10,599232,13,599233,13,599234,13,599235,13,599236,13,599237,13,599238,13,599239,13,599240,12,599241,12,599250,11,599254,11,599256,12,599257,12,599258,11,599262,11,599269,10,599271,10,599272,12,599273,12,599277,10,599279,10,599282,11,599285,10,599286,11,599287,10,599288,12,599289,12,599290,11,599293,10,599294,11,599295,10];con.p2D=[0,0,1,-1,0,0,-1,1,0,2,1,1,1,2,2,0,1,2,0,2,1,0,0,0];con.p3D=[0,0,1,-1,0,0,1,0,-1,0,0,-1,1,0,0,0,1,-1,0,0,-1,0,1,0,0,-1,1,0,2,1,1,0,1,1,1,-1,0,2,1,0,1,1,1,-1,1,0,2,0,1,1,1,-1,1,1,1,3,2,1,0,3,1,2,0,1,3,2,0,1,3,1,0,2,1,3,0,2,1,3,0,1,2,1,1,1,0,0,2,2,0,0,1,1,0,1,0,2,0,2,0,1,1,0,0,1,2,0,0,2,2,0,0,0,0,1,1,-1,1,2,0,0,0,0,1,-1,1,1,2,0,0,0,0,1,1,1,-1,2,3,1,1,1,2,0,0,2,2,3,1,1,1,2,2,0,0,2,3,1,1,1,2,0,2,0,2,1,1,-1,1,2,0,0,2,2,1,1,-1,1,2,2,0,0,2,1,-1,1,1,2,0,0,2,2,1,-1,1,1,2,0,2,0,2,1,1,1,-1,2,2,0,0,2,1,1,1,-1,2,0,2,0];con.p4D=[0,0,1,-1,0,0,0,1,0,-1,0,0,1,0,0,-1,0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,-1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,-1,0,0,-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,2,1,1,0,0,1,1,1,-1,0,1,1,1,0,-1,0,2,1,0,1,0,1,1,-1,1,0,1,1,0,1,-1,0,2,0,1,1,0,1,-1,1,1,0,1,0,1,1,-1,0,2,1,0,0,1,1,1,-1,0,1,1,1,0,-1,1,0,2,0,1,0,1,1,-1,1,0,1,1,0,1,-1,1,0,2,0,0,1,1,1,-1,0,1,1,1,0,-1,1,1,1,4,2,1,1,0,4,1,2,1,0,4,1,1,2,0,1,4,2,1,0,1,4,1,2,0,1,4,1,1,0,2,1,4,2,0,1,1,4,1,0,2,1,4,1,0,1,2,1,4,0,2,1,1,4,0,1,2,1,4,0,1,1,2,1,2,1,1,0,0,3,2,1,0,0,3,1,2,0,0,1,2,1,0,1,0,3,2,0,1,0,3,1,0,2,0,1,2,0,1,1,0,3,0,2,1,0,3,0,1,2,0,1,2,1,0,0,1,3,2,0,0,1,3,1,0,0,2,1,2,0,1,0,1,3,0,2,0,1,3,0,1,0,2,1,2,0,0,1,1,3,0,0,2,1,3,0,0,1,2,2,3,1,1,1,0,2,1,1,1,-1,2,2,0,0,0,2,3,1,1,0,1,2,1,1,-1,1,2,2,0,0,0,2,3,1,0,1,1,2,1,-1,1,1,2,2,0,0,0,2,3,1,1,1,0,2,1,1,1,-1,2,0,2,0,0,2,3,1,1,0,1,2,1,1,-1,1,2,0,2,0,0,2,3,0,1,1,1,2,-1,1,1,1,2,0,2,0,0,2,3,1,1,1,0,2,1,1,1,-1,2,0,0,2,0,2,3,1,0,1,1,2,1,-1,1,1,2,0,0,2,0,2,3,0,1,1,1,2,-1,1,1,1,2,0,0,2,0,2,3,1,1,0,1,2,1,1,-1,1,2,0,0,0,2,2,3,1,0,1,1,2,1,-1,1,1,2,0,0,0,2,2,3,0,1,1,1,2,-1,1,1,1,2,0,0,0,2,2,1,1,1,-1,0,1,1,1,0,-1,0,0,0,0,0,2,1,1,-1,1,0,1,1,0,1,-1,0,0,0,0,0,2,1,-1,1,1,0,1,0,1,1,-1,0,0,0,0,0,2,1,1,-1,0,1,1,1,0,-1,1,0,0,0,0,0,2,1,-1,1,0,1,1,0,1,-1,1,0,0,0,0,0,2,1,-1,0,1,1,1,0,-1,1,1,0,0,0,0,0,2,1,1,1,-1,0,1,1,1,0,-1,2,2,0,0,0,2,1,1,-1,1,0,1,1,0,1,-1,2,2,0,0,0,2,1,1,-1,0,1,1,1,0,-1,1,2,2,0,0,0,2,1,1,1,-1,0,1,1,1,0,-1,2,0,2,0,0,2,1,-1,1,1,0,1,0,1,1,-1,2,0,2,0,0,2,1,-1,1,0,1,1,0,1,-1,1,2,0,2,0,0,2,1,1,-1,1,0,1,1,0,1,-1,2,0,0,2,0,2,1,-1,1,1,0,1,0,1,1,-1,2,0,0,2,0,2,1,-1,0,1,1,1,0,-1,1,1,2,0,0,2,0,2,1,1,-1,0,1,1,1,0,-1,1,2,0,0,0,2,2,1,-1,1,0,1,1,0,1,-1,1,2,0,0,0,2,2,1,-1,0,1,1,1,0,-1,1,1,2,0,0,0,2,3,1,1,0,0,0,2,2,0,0,0,2,1,1,1,-1,3,1,0,1,0,0,2,0,2,0,0,2,1,1,1,-1,3,1,0,0,1,0,2,0,0,2,0,2,1,1,1,-1,3,1,1,0,0,0,2,2,0,0,0,2,1,1,-1,1,3,1,0,1,0,0,2,0,2,0,0,2,1,1,-1,1,3,1,0,0,0,1,2,0,0,0,2,2,1,1,-1,1,3,1,1,0,0,0,2,2,0,0,0,2,1,-1,1,1,3,1,0,0,1,0,2,0,0,2,0,2,1,-1,1,1,3,1,0,0,0,1,2,0,0,0,2,2,1,-1,1,1,3,1,0,1,0,0,2,0,2,0,0,2,-1,1,1,1,3,1,0,0,1,0,2,0,0,2,0,2,-1,1,1,1,3,1,0,0,0,1,2,0,0,0,2,2,-1,1,1,1,3,3,2,1,0,0,3,1,2,0,0,4,1,1,1,1,3,3,2,0,1,0,3,1,0,2,0,4,1,1,1,1,3,3,0,2,1,0,3,0,1,2,0,4,1,1,1,1,3,3,2,0,0,1,3,1,0,0,2,4,1,1,1,1,3,3,0,2,0,1,3,0,1,0,2,4,1,1,1,1,3,3,0,0,2,1,3,0,0,1,2,4,1,1,1,1,3,3,2,1,0,0,3,1,2,0,0,2,1,1,1,-1,3,3,2,0,1,0,3,1,0,2,0,2,1,1,1,-1,3,3,0,2,1,0,3,0,1,2,0,2,1,1,1,-1,3,3,2,1,0,0,3,1,2,0,0,2,1,1,-1,1,3,3,2,0,0,1,3,1,0,0,2,2,1,1,-1,1,3,3,0,2,0,1,3,0,1,0,2,2,1,1,-1,1,3,3,2,0,1,0,3,1,0,2,0,2,1,-1,1,1,3,3,2,0,0,1,3,1,0,0,2,2,1,-1,1,1,3,3,0,0,2,1,3,0,0,1,2,2,1,-1,1,1,3,3,0,2,1,0,3,0,1,2,0,2,-1,1,1,1,3,3,0,2,0,1,3,0,1,0,2,2,-1,1,1,1,3,3,0,0,2,1,3,0,0,1,2,2,-1,1,1,1];function shuffleSeed(seed){var newSeed=new Uint32Array(1);newSeed[0]=seed[0]*1664525+1013904223;return newSeed;}
function Contribution2(multiplier,xsb,ysb){this.dx=-xsb-multiplier*con.SQUISH_2D;this.dy=-ysb-multiplier*con.SQUISH_2D;this.xsb=xsb;this.ysb=ysb;}
function Contribution3(multiplier,xsb,ysb,zsb){this.dx=-xsb-multiplier*con.SQUISH_3D;this.dy=-ysb-multiplier*con.SQUISH_3D;this.dz=-zsb-multiplier*con.SQUISH_3D;this.xsb=xsb;this.ysb=ysb;this.zsb=zsb;}
function Contribution4(multiplier,xsb,ysb,zsb,wsb){this.dx=-xsb-multiplier*con.SQUISH_4D;this.dy=-ysb-multiplier*con.SQUISH_4D;this.dz=-zsb-multiplier*con.SQUISH_4D;this.dw=-wsb-multiplier*con.SQUISH_4D;this.xsb=xsb;this.ysb=ysb;this.zsb=zsb;this.wsb=wsb;}
var contributions2D=[];for(var i=0;i<con.p2D.length;i+=4){var baseSet=con.base2D[con.p2D[i]];var previous=null;var current=null;for(var k=0;k<baseSet.length;k+=3){current=new Contribution2(baseSet[k],baseSet[k+1],baseSet[k+2]);if(previous===null)
contributions2D[i/4]=current;else
previous.next=current;previous=current;}
current.next=new Contribution2(con.p2D[i+1],con.p2D[i+2],con.p2D[i+3]);}
this.lookup2D=[];for(var i=0;i<con.lookupPairs2D.length;i+=2){this.lookup2D[con.lookupPairs2D[i]]=contributions2D[con.lookupPairs2D[i+1]];}
var contributions3D=[];for(var i=0;i<con.p3D.length;i+=9){var baseSet=con.base3D[con.p3D[i]];var previous=null;var current=null;for(var k=0;k<baseSet.length;k+=4){current=new Contribution3(baseSet[k],baseSet[k+1],baseSet[k+2],baseSet[k+3]);if(previous===null)
contributions3D[i/9]=current;else
previous.next=current;previous=current;}
current.next=new Contribution3(con.p3D[i+1],con.p3D[i+2],con.p3D[i+3],con.p3D[i+4]);current.next.next=new Contribution3(con.p3D[i+5],con.p3D[i+6],con.p3D[i+7],con.p3D[i+8]);}
this.lookup3D=[];for(var i=0;i<con.lookupPairs3D.length;i+=2){this.lookup3D[con.lookupPairs3D[i]]=contributions3D[con.lookupPairs3D[i+1]];}
var contributions4D=[];for(var i=0;i<con.p4D.length;i+=16){var baseSet=con.base4D[con.p4D[i]];var previous=null;var current=null;for(var k=0;k<baseSet.length;k+=5){current=new Contribution4(baseSet[k],baseSet[k+1],baseSet[k+2],baseSet[k+3],baseSet[k+4]);if(previous===null)
contributions4D[i/16]=current;else
previous.next=current;previous=current;}
current.next=new Contribution4(con.p4D[i+1],con.p4D[i+2],con.p4D[i+3],con.p4D[i+4],con.p4D[i+5]);current.next.next=new Contribution4(con.p4D[i+6],con.p4D[i+7],con.p4D[i+8],con.p4D[i+9],con.p4D[i+10]);current.next.next.next=new Contribution4(con.p4D[i+11],con.p4D[i+12],con.p4D[i+13],con.p4D[i+14],con.p4D[i+15]);}
this.lookup4D=[];for(var i=0;i<con.lookupPairs4D.length;i+=2){this.lookup4D[con.lookupPairs4D[i]]=contributions4D[con.lookupPairs4D[i+1]];}
this.perm=new Uint8Array(256);this.perm2D=new Uint8Array(256);this.perm3D=new Uint8Array(256);this.perm4D=new Uint8Array(256);var source=new Uint8Array(256);for(var i=0;i<256;i++)
source[i]=i;var seed=new Uint32Array(1);seed[0]=clientSeed;seed=shuffleSeed(shuffleSeed(shuffleSeed(seed)));for(var i=255;i>=0;i--){seed=shuffleSeed(seed);var r=new Uint32Array(1);r[0]=(seed[0]+31)%(i+1);if(r[0]<0)
r[0]+=(i+1);this.perm[i]=source[r[0]];this.perm2D[i]=this.perm[i]&0x0E;this.perm3D[i]=(this.perm[i]%24)*3;this.perm4D[i]=this.perm[i]&0xFC;source[r[0]]=source[i];}
this.simplex1D=function(x){return that.simplex2D(x,1);};this.simplex2D=function(x,y){var stretchOffset=(x+y)*con.STRETCH_2D;var _a=[x+stretchOffset,y+stretchOffset],xs=_a[0],ys=_a[1];var _b=[Math.floor(xs),Math.floor(ys)],xsb=_b[0],ysb=_b[1];var squishOffset=(xsb+ysb)*con.SQUISH_2D;var _c=[x-(xsb+squishOffset),y-(ysb+squishOffset)],dx0=_c[0],dy0=_c[1];var _d=[xs-xsb,ys-ysb],xins=_d[0],yins=_d[1];var inSum=xins+yins;var hashVals=new Uint32Array(4);hashVals[0]=xins-yins+1;hashVals[1]=inSum;hashVals[2]=inSum+yins;hashVals[3]=inSum+xins;var hash=hashVals[0]|(hashVals[1]<<1)|(hashVals[2]<<2)|(hashVals[3]<<4);var c=that.lookup2D[hash];var value=0.0;while(typeof c!=='undefined'){var _e=[dx0+c.dx,dy0+c.dy],dx=_e[0],dy=_e[1];var attn=2-dx*dx-dy*dy;if(attn>0){var _f=[xsb+c.xsb,ysb+c.ysb],px=_f[0],py=_f[1];var i=that.perm2D[(that.perm[px&0xFF]+py)&0xFF];var valuePart=con.gradients2D[i]*dx+con.gradients2D[i+1]*dy;attn*=attn;value+=attn*attn*valuePart;}
c=c.next;}
return value*con.NORM_2D;};this.simplex3D=function(x,y,z){var stretchOffset=(x+y+z)*con.STRETCH_3D;var _a=[x+stretchOffset,y+stretchOffset,z+stretchOffset],xs=_a[0],ys=_a[1],zs=_a[2];var _b=[Math.floor(xs),Math.floor(ys),Math.floor(zs)],xsb=_b[0],ysb=_b[1],zsb=_b[2];var squishOffset=(xsb+ysb+zsb)*con.SQUISH_3D;var _c=[x-(xsb+squishOffset),y-(ysb+squishOffset),z-(zsb+squishOffset)],dx0=_c[0],dy0=_c[1],dz0=_c[2];var _d=[xs-xsb,ys-ysb,zs-zsb],xins=_d[0],yins=_d[1],zins=_d[2];var inSum=xins+yins+zins;var hashVals=new Uint32Array(7);hashVals[0]=yins-zins+1;hashVals[1]=xins-yins+1;hashVals[2]=xins-zins+1;hashVals[3]=inSum;hashVals[4]=inSum+zins;hashVals[5]=inSum+yins;hashVals[6]=inSum+xins;var hash=hashVals[0]|hashVals[1]<<1|hashVals[2]<<2|hashVals[3]<<3|hashVals[4]<<5|hashVals[5]<<7|hashVals[6]<<9;var c=that.lookup3D[hash];var value=0.0;while(typeof c!=='undefined'){var _e=[dx0+c.dx,dy0+c.dy,dz0+c.dz],dx=_e[0],dy=_e[1],dz=_e[2];var attn=2-dx*dx-dy*dy-dz*dz;if(attn>0){var _f=[xsb+c.xsb,ysb+c.ysb,zsb+c.zsb],px=_f[0],py=_f[1],pz=_f[2];var i=that.perm3D[(that.perm[(that.perm[px&0xFF]+py)&0xFF]+pz)&0xFF];var valuePart=con.gradients3D[i]*dx+con.gradients3D[i+1]*dy+con.gradients3D[i+2]*dz;attn*=attn;value+=attn*attn*valuePart;}
c=c.next;}
return value*con.NORM_3D;};this.simplex4D=function(x,y,z,w){var stretchOffset=(x+y+z+w)*con.STRETCH_4D;var _a=[x+stretchOffset,y+stretchOffset,z+stretchOffset,w+stretchOffset],xs=_a[0],ys=_a[1],zs=_a[2],ws=_a[3];var _b=[Math.floor(xs),Math.floor(ys),Math.floor(zs),Math.floor(ws)],xsb=_b[0],ysb=_b[1],zsb=_b[2],wsb=_b[3];var squishOffset=(xsb+ysb+zsb+wsb)*con.SQUISH_4D;var dx0=x-(xsb+squishOffset);var dy0=y-(ysb+squishOffset);var dz0=z-(zsb+squishOffset);var dw0=w-(wsb+squishOffset);var _c=[xs-xsb,ys-ysb,zs-zsb,ws-wsb],xins=_c[0],yins=_c[1],zins=_c[2],wins=_c[3];var inSum=xins+yins+zins+wins;var hashVals=new Uint32Array(11);hashVals[0]=zins-wins+1;hashVals[1]=yins-zins+1;hashVals[2]=yins-wins+1;hashVals[3]=xins-yins+1;hashVals[4]=xins-zins+1;hashVals[5]=xins-wins+1;hashVals[6]=inSum<<6;hashVals[7]=inSum+wins;hashVals[8]=inSum+zins;hashVals[9]=inSum+yins;hashVals[10]=inSum+xins;var hash=hashVals[0]|hashVals[1]<<1|hashVals[2]<<2|hashVals[3]<<3|hashVals[4]<<4|hashVals[5]<<5|hashVals[6]<<6|hashVals[7]<<8|hashVals[8]<<11|hashVals[9]<<14|hashVals[10]<<17;var c=that.lookup4D[hash];var value=0.0;while(typeof c!=='undefined'){var _d=[dx0+c.dx,dy0+c.dy,dz0+c.dz,dw0+c.dw],dx=_d[0],dy=_d[1],dz=_d[2],dw=_d[3];var attn=2-dx*dx-dy*dy-dz*dz-dw*dw;if(attn>0){var _e=[xsb+c.xsb,ysb+c.ysb,zsb+c.zsb,wsb+c.wsb],px=_e[0],py=_e[1],pz=_e[2],pw=_e[3];var i=that.perm4D[(that.perm[(that.perm[(that.perm[px&0xFF]+py)&0xFF]+pz)&0xFF]+pw)&0xFF];var valuePart=con.gradients4D[i]*dx+con.gradients4D[i+1]*dy+con.gradients4D[i+2]*dz+con.gradients4D[i+3]*dw;attn*=attn;value+=attn*attn*valuePart;}
c=c.next;}
return value*con.NORM_4D;};};zim.Point=function(x,y,z,q,r,s,t,u,v,w){z_d("13.45");if(zot(x))x=0;if(zot(y))y=0;if(zot(z))z=0;if(zot(q))q=0;if(zot(r))r=0;if(zot(s))s=0;if(zot(t))t=0;if(zot(u))u=0;if(zot(v))v=0;if(zot(w))w=0;this.x=x;this.y=y;this.z=z;this.q=q;this.r=r;this.s=s;this.t=t;this.u=u;this.v=v;this.w=w;};zim.Bezier=function Bezier(a,b,c,d){z_d("13.47");this.a=a;this.b=b;this.c=c;this.d=d;this.len=100;this.arcLengths=new Array(this.len+1);this.arcLengths[0]=0;var ox=this.x(0),oy=this.y(0),clen=0;for(var i=1;i<=this.len;i+=1){var x=this.x(i*0.01),y=this.y(i*0.01);var dx=ox-x,dy=oy-y;clen+=Math.sqrt(dx*dx+dy*dy);this.arcLengths[i]=clen;ox=x,oy=y;}
this.length=clen;};zim.Bezier.prototype={map:function(u){var targetLength=u*this.arcLengths[this.len];var low=0,high=this.len,index=0;while(low<high){index=low+(((high-low)/2)|0);if(this.arcLengths[index]<targetLength){low=index+1;}else{high=index;}}
if(this.arcLengths[index]>targetLength){index--;}
var lengthBefore=this.arcLengths[index];if(lengthBefore===targetLength){return index/this.len;}else{return(index+(targetLength-lengthBefore)/(this.arcLengths[index+1]-lengthBefore))/this.len;}},mx:function(u){return this.x(this.map(u));},my:function(u){return this.y(this.map(u));},x:function(t){return((1-t)*(1-t)*(1-t))*this.a.x
+3*((1-t)*(1-t))*t*this.b.x
+3*(1-t)*(t*t)*this.c.x
+(t*t*t)*this.d.x;},y:function(t){return((1-t)*(1-t)*(1-t))*this.a.y
+3*((1-t)*(1-t))*t*this.b.y
+3*(1-t)*(t*t)*this.c.y
+(t*t*t)*this.d.y;}};zim.Boundary=function(x,y,width,height){z_d("13.46");if(zot(x)||zot(y)||zot(width)||zot(height))return;this.x=x;this.y=y;this.width=width;this.height=height;this.contract=function(a,b,c,d){if(zot(a))return this;if(zot(b))b=a;if(zot(c)){c=a*2;}else{c=c+a;}
if(zot(d)){d=b*2;}else{d=d+b;}
this.x+=a;this.y+=b;this.width-=c;this.height-=d;return this;};};zim.GradientColor=function(colors,ratios,x0,y0,x1,y1){z_d("13.465");this.type="GradientColor";this.colors=zot(colors)?["black","white"]:colors;this.ratios=zot(ratios)?[0,1]:ratios;this.x0=zot(x0)?0:x0;this.y0=zot(y0)?0:y0;this.x1=zot(x1)?0:x1;this.y1=zot(y1)?100:y1;};zim.RadialColor=function(colors,ratios,x0,y0,r0,x1,y1,r1){z_d("13.466");this.type="RadialColor";this.colors=zot(colors)?["black","white"]:colors;this.ratios=zot(ratios)?[0,1]:ratios;this.x0=zot(x0)?0:x0;this.y0=zot(y0)?0:y0;this.r0=zot(r0)?0:r0;this.x1=zot(x1)?0:x1;this.y1=zot(y1)?100:y1;this.r1=zot(r1)?100:r1;};zim.BitmapColor=function(image,repetition,matrix){z_d("13.467");this.type="BitmapColor";if(typeof image=="string"&&window.asset)image=window.asset(image);if(image.type=="Image")image=image.bitmap;this.image=image.type=="Bitmap"?image.image:image;this.repetition=repetition;this.matrix=matrix;};zim.Damp=function(startValue,damp){z_d("14");var sig="startValue, damp";var duo;if(duo=zob(zim.Damp,arguments,sig,this))return duo;this.lastValue=(zot(startValue))?0:startValue;this.damp=(zot(damp))?.1:damp;};zim.Damp.prototype.convert=function(desiredValue){return this.lastValue=this.lastValue+(desiredValue-this.lastValue)*this.damp;};zim.Damp.prototype.immediate=function(desiredValue){this.lastValue=desiredValue;return this;};zim.Proportion=function(baseMin,baseMax,targetMin,targetMax,factor,targetRound,clamp){var sig="baseMin, baseMax, targetMin, targetMax, factor, targetRound, clamp";var duo;if(duo=zob(zim.Proportion,arguments,sig,this))return duo;z_d("15");if(zot(targetMin))targetMin=0;if(zot(targetMax))targetMax=1;if(zot(factor))factor=1;if(zot(targetRound))targetRound=false;if(zot(clamp))clamp=true;var baseAmount;var proportion;var targetAmount;baseAmount=baseMin;this.convert=function(baseAmount){if(isNaN(baseAmount)||(baseMax-baseMin==0)){return;}
if(clamp){baseAmount=Math.max(baseAmount,baseMin);baseAmount=Math.min(baseAmount,baseMax);}
proportion=(baseAmount-baseMin)/(baseMax-baseMin);if(factor>0){targetAmount=targetMin+(targetMax-targetMin)*proportion;}else{targetAmount=targetMax-(targetMax-targetMin)*proportion;}
if(targetRound){targetAmount=Math.round(targetAmount);}
return targetAmount;};};zim.ProportionDamp=function(baseMin,baseMax,targetMin,targetMax,damp,factor,targetRound,clamp){var sig="baseMin, baseMax, targetMin, targetMax, damp, factor, targetRound, clamp";var duo;if(duo=zob(zim.ProportionDamp,arguments,sig,this))return duo;z_d("16");if(zot(targetMin))targetMin=0;if(zot(targetMax))targetMax=1;if(zot(damp))damp=.1;if(zot(factor))factor=1;if(zot(targetRound))targetRound=false;if(zot(clamp))clamp=true;this.damp=damp;var that=this;var baseAmount;var proportion;var targetDifference;var targetAmount;var differenceAmount;var desiredAmount=0;var lastAmount=0;baseAmount=baseMin;lastAmount=targetMin;var interval=setInterval(calculate,20);function calculate(){if(isNaN(baseAmount)||(baseMax-baseMin==0)){return;}
if(clamp){baseAmount=Math.max(baseAmount,baseMin);baseAmount=Math.min(baseAmount,baseMax);}
proportion=(baseAmount-baseMin)/(baseMax-baseMin);targetDifference=targetMax-targetMin;if(factor>0){targetAmount=targetMin+targetDifference*proportion;}else{targetAmount=targetMax-targetDifference*proportion;}
desiredAmount=targetAmount;differenceAmount=desiredAmount-lastAmount;lastAmount+=differenceAmount*that.damp;}
this.immediate=function(n){that.convert(n);calculate();lastAmount=targetAmount;if(targetRound){lastAmount=Math.round(lastAmount);}
return that;};this.convert=function(n){baseAmount=n;if(targetRound){return Math.round(lastAmount);}else{return lastAmount;}};this.dispose=function(a,b,disposing){clearInterval(interval);return true;};};zim.Dictionary=function(unique){z_d("17");this.length=0;this.unique=unique;var objects=this.objects=[];var values=this.values=[];this.add=function(o,v){if(zot(o))return;if(zot(v))v=true;if(this.unique)this.remove(o);objects.push(o);values.push(v);this.length++;};this.at=function(o){if(zot(o))return;var i=objects.indexOf(o);if(i>-1)return values[i];return null;};this.remove=function(o){if(zot(o))return false;var i=objects.indexOf(o);if(i>-1){objects.splice(i,1);values.splice(i,1);this.length--;return true;}else{return false;}};this.clear=function(){objects=this.objects=[];values=this.values=[];this.length=null;return this;};this.dispose=function(a,b,disposing){objects=null;values=null;this.length=null;return true;};};zim.Hierarchy=function(input,open){z_d("17.5");var that=this;if(zot(input))return;if(zot(open))open=false;var _length;that.processSimple=function(list){var count=0;var m={};function makeLevel(list,obj,level,last){if(list.constructor=={}.constructor){var originalList;if(list.list){originalList=list;list=list.list;}
if(last&&originalList){zim.loop(originalList,function(k,v){if(k=="list")return;last[k]=v;});}
zim.loop(list,function(key,val){var newList={};var current=obj["id"+count]={obj:key,level:level,open:open,opened:false,list:newList};count++;makeLevel(val,newList,level+1,current);});}else if(Array.isArray(list)){zim.loop(list,function(val){var newList={};obj["id"+count]={obj:val};count++;});}}
makeLevel(input,m,0);_length=count;return m;};that.processComplex=function(input){var count=0;function innerFunction(inp,level){zim.loop(inp,function(key,val){val.level=level;if(zot(val.open))val.open=open;if(zot(val.opened))val.opened=false;if(val.list)innerFunction(val.list,level+1);count++;});}
innerFunction(input,0);_length=count;return input;};if(zot(input.id0)){that.data=that.processSimple(input);}else{that.data=that.processComplex(input);}
that.getLinearList=function(data){if(zot(data))data=that.data;return getLinear(data)[0];};that.getLinearIDs=function(data){if(zot(data))data=that.data;return getLinear(data)[1];};function getLinear(data){var linear=[];var ids=[];function getLevel(data,level){zim.loop(data,function(item,list){linear.push(list.obj);ids.push(item);if(list.open)getLevel(list.list,level+1);});}
getLevel(data,0);return[linear,ids];}
that.getData=function(id){var answer;function find(obj){zim.loop(obj,function(key,val){if(key==id){answer=val;return answer;}
find(val.list);});}
find(that.data);return answer;};that.getNextSibling=function(id){var current;var answer;function find(obj){zim.loop(obj,function(key,val){if(!answer&&current){answer=key;return answer;}
if(key==id){current=val;}else{find(val.list);}});}
find(that.data);return answer;};that.getPrevSibling=function(id){var lasts=[];var answer;function find(obj,lev){zim.loop(obj,function(key,val){if(key==id){answer=lasts[lev]||lasts[lev-1];return answer;}else{lasts[lev]=key;find(val.list,lev+1);}});}
find(that.data,0);return answer;};Object.defineProperty(that,'length',{get:function(){return _length;},set:function(value){if(zon)zogy("Hierarchy() - length is read only");}});};zim.Pick=function(choices){if(!zim.pickCheck){z_d("17.6");zim.pickCheck=true;}
this.choices=choices;this.num=function(num){var s=[];for(var i=0;i<num;i++){s.push(zim.Pick.choose(this));}
this.choices=zim.Pick.series(s);return this;};var that=this;this.loop=function(num,call){var r;for(var i=0;i<num;i++){r=call(zim.Pick.choose(that),i,num);if(typeof r!='undefined')return r;}};};zim.Pick.prototype.type="Pick";zim.Pick.series=function(){if(!zim.pickCheck){z_d("17.6");zim.pickCheck=true;}
return zim.series.apply(null,arguments);};zim.Pick.rand=function(a,b,integer,negative){if(!zim.pickCheck){z_d("17.6");zim.pickCheck=true;}
return zim.rand(a,b,integer,negative);};zim.Pick.choose=function(obj,literal,target){if(!zim.pickCheck){z_d("17.6");zim.pickCheck=true;}
if(literal==null)literal=true;if(obj==null)return obj;if(obj.type=="Pick"||literal){var c=obj.choices||obj;if(Array.isArray(c)){var val=c[Math.floor(Math.random()*(c.length))];return zim.Pick.choose(val);}else if(c.constructor==={}.constructor){if(!zot(c.noPick))return c.noPick;if(zot(c.max))return c;if(zot(c.integer))c.integer=false;var val=zim.Pick.rand(c.min,c.max,c.integer,c.negative);return val;}else if(c instanceof Function){if(c.count==null)c.count=0;else c.count++;return zim.Pick.choose((c)(target));}
return obj;}else{return obj;}};zim.scrollX=function(num,time){z_d("18");return zim.abstractScroll("X","Left",num,time);};zim.scrollY=function(num,time){z_d("19");return zim.abstractScroll("Y","Top",num,time);};zim.abstractScroll=function(dir,side,num,time){z_d("20");var timeType=getTIME(time);var perpend=(dir=="X")?"Y":"X";if(zot(num)){var safari=0;var browser=navigator.applicationName;var navindex=navigator.userAgent.indexOf('Safari');if(navindex!=-1||browser=='Safari'){var safari=1;}
return(document.documentElement&&document.documentElement["scroll"+side])||document.body["scroll"+side];}else if(zot(time)){window.scrollTo(zim["scroll"+perpend](),num);}else{var interval=50;var t=time*(timeType=="s"?1000:1);if(t<interval)t=interval;var steps=t/interval;var current=zim["scroll"+dir]();var amount=num-current;var diff=amount/steps;var count=0;var scrollInterval=setInterval(function(){count++;current+=diff;window.scrollTo(zim["scroll"+perpend](),current);if(count>=steps){window.scrollTo(zim["scroll"+perpend](),num);clearInterval(scrollInterval);}},interval);}
return num;};zim.windowWidth=function(){z_d("21");var w=isNaN(window.innerWidth)?window.clientWidth:window.innerWidth;var h=isNaN(window.innerHeight)?window.clientHeight:window.innerHeight;if(zim.mobile()&&!zot(window.orientation)&&!window.parent){if((w>h&&Math.abs(window.orientation)!=90)||h>w&&Math.abs(window.orientation)==90){var oldW=w;w=h;h=oldW;}}
return(typeof zdf!="undefined"&&zdf.swapRotation)?h:w;};zim.windowHeight=function(){z_d("22");var w=isNaN(window.innerWidth)?window.clientWidth:window.innerWidth;var h=isNaN(window.innerHeight)?window.clientHeight:window.innerHeight;if(zim.mobile()&&!zot(window.orientation)&&!window.parent){if((w>h&&Math.abs(window.orientation)!=90)||h>w&&Math.abs(window.orientation)==90){var oldW=w;w=h;h=oldW;}}
return(typeof zdf!="undefined"&&zdf.swapRotation)?w:h;};zim.getQueryString=function(s){z_d("22.5");if(zot(s))s=location.search.replace("?","");if(s=="")return{};var vars=s.split("&");var obj={};for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(typeof obj[pair[0]]=="undefined"){obj[pair[0]]=decodeURIComponent((pair[1]+'').replace(/\+/g,'%20'));}else if(typeof obj[pair[0]]=="string"){obj[pair[0]]=[obj[pair[0]],decodeURIComponent((pair[1]+'').replace(/\+/g,'%20'))];}else{obj[pair[0]].push(decodeURIComponent((pair[1]+'').replace(/\+/g,'%20')));}}
return obj;};zim.swapHTML=function(idA,idB){z_d("17.2");return zim.swapProperties("innerHTML",zid(idA),zid(idB));};zim.urlEncode=function(s){z_d("23");var s=(s+'').toString();return encodeURIComponent(s).replace(/!/g,'%21').replace(/'/g,'%27').replace(/\(/g,'%28').replace(/\)/g,'%29').replace(/\*/g,'%2A').replace(/%20/g,'+');};zim.urlDecode=function(s){z_d("24");return decodeURIComponent((s+'').replace(/\+/g,'%20'));};zim.setCookie=function(name,value,days){z_d("25");if(zot(name)||zot(value))return;if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires="; expires="+date.toGMTString();}else{var expires="";}
document.cookie=name+"="+escape(value)+expires+"; path=/";return true;};zim.getCookie=function(name){z_d("26");var outer=document.cookie.split(/;\s*/);var cookies=new Array();var inner;for(i=0;i<outer.length;i++){inner=outer[i].split("=");cookies[inner[0]]=inner[1];}
if(typeof cookies[name]=='undefined')return undefined;return unescape(cookies[name]);};zim.deleteCookie=function(name){z_d("27");if(zot(zim.getCookie(name)))return false;zim.setCookie(name,"",-1);return true;};if(createjs==null){if(zon){zogr("ZIM >= 4.3.0 requires createjs namespace to be loaded (import createjs before zim)");}return zim;}
zim.localToGlobal=function localToGlobal(x,y,scope,func){if(!zim.coordinatesCheck){z_d("50.43");zim.coordinatesCheck=true;}
if(x==null||y==null)return;var point=func.call(scope,x,y);var stage=scope.stage;if(typeof zdf=="undefined"){if(!stage)return point;zdf={stage:stage,canvas:stage.canvas};}
point.x/=zim.scaX;point.y/=zim.scaY;return point;};zim.globalToLocal=function globalToLocal(x,y,scope,func){if(!zim.coordinatesCheck){z_d("50.43");zim.coordinatesCheck=true;}
if(x==null||y==null)return;var stage=scope.stage;if(typeof zdf=="undefined"){if(!stage)return func.call(scope,x,y);zdf={stage:stage,canvas:stage.canvas};}
x*=zim.scaX;y*=zim.scaY;var point=func.call(scope,x,y);return point;};zim.localToLocal=function localToLocal(x,y,target,scope){if(!zim.coordinatesCheck){z_d("50.43");zim.coordinatesCheck=true;}
if(x==null||y==null||target==null)return;var point=scope.localToGlobal(x,y);var stage=scope.stage;if(typeof zdf=="undefined"){if(!stage)return target.globalToLocal(point.x,point.y);zdf={stage:stage,canvas:stage.canvas};}
if(!stage)stage=zdf.stage;if(target==stage)return point;if(point)return target.globalToLocal(point.x,point.y);};zim.displayBase=function(obj){if(!zim.zimDBCheck){z_d("50.432");zim.zimDBCheck=true;}
var that=obj;Object.defineProperty(obj,'width',{enumerable:true,get:function(){var b=this.getBounds();return(zot(b))?null:Math.abs(b.width*this.scaleX);},set:function(value){var b=this.getBounds();if(zot(b)||b.width==0){if(zon)zogy("DisplayObject() - width needs bounds set with setBounds()");return;}
var s=value/b.width;this.scaleX=this.scaleY=s;}});Object.defineProperty(obj,'height',{enumerable:true,get:function(){var b=this.getBounds();return(zot(b))?null:Math.abs(b.height*this.scaleY);},set:function(value){var b=this.getBounds();if(zot(b)||b.height==0){if(zon)zogy("DisplayObject() - height needs bounds set with setBounds()");return;}
var s=value/b.height;this.scaleX=this.scaleY=s;}});Object.defineProperty(obj,'widthOnly',{enumerable:true,get:function(){var b=this.getBounds();return(zot(b))?null:Math.abs(b.width*this.scaleX);},set:function(value){var b=this.getBounds();if((zot(b)||b.width==0)&&zon){zogy("DisplayObject() - widthOnly needs bounds set with setBounds()");return;}
var s=value/b.width;this.scaleX=s;}});Object.defineProperty(obj,'heightOnly',{enumerable:true,get:function(){var b=this.getBounds();return(zot(b))?null:Math.abs(b.height*this.scaleY);},set:function(value){var b=this.getBounds();if((zot(b)||b.height==0)&&zon){zogy("DisplayObject() - heightOnly needs bounds set with setBounds()");return;}
var s=value/b.height;this.scaleY=s;}});Object.defineProperty(obj,'level',{enumerable:true,get:function(){if(this.parent)return this.parent.getChildIndex(this);return null;},set:function(value){if(this.parent)this.parent.setChildIndex(this,Math.max(0,Math.min(value,this.parent.numChildren-1)));}});Object.defineProperty(obj,'depth',{enumerable:true,get:function(){return this._depth;},set:function(depth){this._depth=depth;if(!zot(this.vrChannel)){var parallaxShift=this.vrParallaxDistance?depth*this.vrParallax*this.vrParallaxDistance:0;if(this.vrChannel=="left"){this.x=this.vrStartX+depth+parallaxShift;}else if(this.vrChannel=="right"){this.x=this.vrStartX-depth+parallaxShift;}}}});Object.defineProperty(obj,'blendMode',{enumerable:true,get:function(){return this.compositeOperation;},set:function(value){this.compositeOperation=value;}});if(!that.name){var _name;Object.defineProperty(that,'name',{get:function(){return _name;},set:function(value){_name=value;zim.zimObjectIDs[value]=that;}});}
that._draggable;Object.defineProperty(that,'draggable',{get:function(){return this._draggable;},set:function(value){if(value==this._draggable)return;this._draggable=value;if(this._draggable)this.drag();else this.noDrag();}});var frame;var adCheck;that.on("mousedown",function(e){if(e.target.stage){frame=e.target.stage.frame;if(frame.allowDefault){adCheck=true;frame.allowDefault=false;}}});that.on("pressup",function(e){if(frame&&adCheck)frame.allowDefault=true;});var effects=["hue","saturation","brightness","contrast"];for(var i=0;i<effects.length;i++){-function(){var eff=effects[i];for(var j=0;j<2;j++){-function(){var add=j==0?"":"Batch";Object.defineProperty(that,eff+add,{get:function(){if(that.effects&&that.effects.multi)return that.effects.multi[eff];else return 0;},set:function(value){if(!that.effects||!that.effects.multi)that.effect(new MultiEffect(eff=="hue"?value:0,eff=="saturation"?value:0,eff=="brightness"?value:0,eff=="contrast"?value:0));else that.effects.multi[eff]=value;if(add=="")that.updateEffects();}});}();}}();}}
zim.gD=function(obj){if(!zim.zimGDCheck){z_d("50.435");zim.zimGDCheck=true;}
if(!obj)return;if(zim.KEYFOCUS==obj)zim.KEYFOCUS=null;if(obj.draggable)obj.noDrag();if(obj.zimTweens)obj.stopAnimate();if(obj.zimWire)obj.noWire();if(obj.zimWired)obj.noWired();if(obj.zimClickHoldDownEvent)obj.noHold();if(obj.transformControls)obj.transformControls.dispose();if(obj.zimClickDownEvent)obj.zimClickDownEvent=null;if(obj.zimClickUpEvent)obj.zimClickUpEvent=null;if(obj.physics)obj.removePhysics();if(obj.name&&zim.zimObjectIDs[obj.name]==obj)delete zim.zimObjectIDs[obj.name];}
zim.Stage=function(canvasID){z_d("50.44");if(zot(canvasID))return;var tag=canvasID.tagName=="CANVAS"?canvasID:zid(canvasID);if(zot(tag))return;this.cjsStage_constructor(canvasID);this.setBounds(0,0,tag.width,tag.height);this.type="Stage";if(typeof zdf=='undefined')zimDefaultFrame=zdf={stage:this};this.cache=function(a,b,c,d,scale,options){if(zot(c)){if(zot(a)){var bounds=this.getBounds();if(!zot(bounds)){var added=this.borderWidth>0?this.borderWidth/2:0;a=bounds.x-added;b=bounds.y-added;c=bounds.width+added*2;d=bounds.height+added*2;}}else{c=a;d=b;a=0;b=0;}}
this.cjsStage_cache(a,b,c,d,scale,options);return this;};this.on("mousedown",function(e){var e2=e.clone();e2.type="pressdown";e.target.dispatchEvent(e2);},undefined,false,undefined,true);this.loop=function(call,reverse,step,start,end){return zim.loop(this,call,reverse,step,start,end);};this.hitTestGrid=function(width,height,cols,rows,x,y,offsetX,offsetY,spacingX,spacingY,local,type){return zim.hitTestGrid(this,width,height,cols,rows,x,y,offsetX,offsetY,spacingX,spacingY,local,type);};this.disposeAllChildren=function(){for(var i=this.numChildren-1;i>=0;i--){var child=this.getChildAt(i)
if(child.dispose)child.dispose();}
return this;};var frame=zdf||1;if(createjs&&!createjs.stageTransformable&&(zdf.retina||typeof exportRoot!="undefined")){Object.defineProperty(this,'scale',{get:function(){return this.cjsStage_scale;},set:function(value){this.cjsStage_scaleX=value;this.cjsStage_scaleY=value;zim.scaX=createjs.stageTransformable?1:value;zim.scaY=createjs.stageTransformable?1:value;}});Object.defineProperty(this,'scaleX',{get:function(){return this.cjsStage_scaleX;},set:function(value){this.cjsStage_scaleX=value;zim.scaX=createjs.stageTransformable?1:value;}});Object.defineProperty(this,'scaleY',{get:function(){return this.cjsStage_scaleY;},set:function(value){this.cjsStage_scaleY=value;zim.scaY=createjs.stageTransformable?1:value;}});this.localToGlobal=function(x,y){return zim.localToGlobal(x,y,this,this.cjsStage_localToGlobal);};this.globalToLocal=function(x,y){return zim.globalToLocal(x,y,this,this.cjsStage_globalToLocal);};this.localToLocal=function(x,y,target){return zim.localToLocal(x,y,target,this);};}};zim.extend(zim.Stage,createjs.Stage,["cache","localToLocal","localToGlobal","globalToLocal"],"cjsStage",false);zim.StageGL=function(canvasID,options){z_d("50.45");if(zot(canvasID))return;var tag=canvasID.tagName=="CANVAS"?canvasID:zid(canvasID);if(zot(tag))return;this.cjsStageGL_constructor(canvasID,options);this.setBounds(0,0,tag.width,tag.height);this.type="StageGL";if(typeof zdf=='undefined')zdf={stage:this};this.cache=function(a,b,c,d,scale,options){if(zot(c)){if(zot(a)){var bounds=this.getBounds();if(!zot(bounds)){var added=this.borderWidth>0?this.borderWidth/2:0;a=bounds.x-added;b=bounds.y-added;c=bounds.width+added*2;d=bounds.height+added*2;}}else{c=a;d=b;a=0;b=0;}}
this.cjsStageGL_cache(a,b,c,d,scale,options);return this;};this.on("mousedown",function(e){var e2=e.clone();e2.type="pressdown";e.target.dispatchEvent(e2);},undefined,false,undefined,true);this.loop=function(call,reverse,step,start,end){return zim.loop(this,call,reverse,step,start,end);};this.hitTestGrid=function(width,height,cols,rows,x,y,offsetX,offsetY,spacingX,spacingY,local,type){return zim.hitTestGrid(this,width,height,cols,rows,x,y,offsetX,offsetY,spacingX,spacingY,local,type);};this.disposeAllChildren=function(){for(var i=this.numChildren-1;i>=0;i--){var child=this.getChildAt(i)
if(child.dispose)child.dispose();}
return this;};var frame=zdf||1;if(createjs&&!createjs.stageTransformable&&(zdf.retina||typeof exportRoot!="undefined")){Object.defineProperty(this,'scale',{get:function(){return this.cjsStage_scale;},set:function(value){this.cjsStage_scaleX=value;this.cjsStage_scaleY=value;zim.scaX=createjs.stageTransformable?1:value;zim.scaY=createjs.stageTransformable?1:value;}});Object.defineProperty(this,'scaleX',{get:function(){return this.cjsStage_scaleX;},set:function(value){this.cjsStage_scaleX=value;zim.scaX=createjs.stageTransformable?1:value;}});Object.defineProperty(this,'scaleY',{get:function(){return this.cjsStage_scaleY;},set:function(value){this.cjsStage_scaleY=value;zim.scaY=createjs.stageTransformable?1:value;}});this.localToGlobal=function(x,y){return zim.localToGlobal(x,y,this,this.cjsStageGL_localToGlobal);};this.globalToLocal=function(x,y){return zim.globalToLocal(x,y,this,this.cjsStageGL_globalToLocal);};this.localToLocal=function(x,y,target){return zim.localToLocal(x,y,target,this);};}};zim.extend(zim.StageGL,createjs.StageGL,["cache","localToLocal","localToGlobal","globalToLocal"],"cjsStageGL",false);zim.Container=function(a,b,c,d,style,group,inherit){var sig="a, b, c, d, style, group, inherit";var duo;if(duo=zob(zim.Container,arguments,sig,this))return duo;if(!zim.containerCheck){z_d("50.5");z_d("50.435");zim.containerCheck=true;}
this.cjsContainer_constructor();this.type="Container";this.group=group;var that=this;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(a))a=DS.a!=null?DS.a:null;if(zot(b))b=DS.b!=null?DS.b:null;if(zot(c))c=DS.c!=null?DS.c:null;if(zot(d))d=DS.d!=null?DS.d:null;var n=normalizeBounds(a,b,c,d);function normalizeBounds(a,b,c,d){var bounds=[];if(zot(a)){bounds=[a,b,c,d];}else if(zot(b)){bounds=[a.x,a.y,a.width,a.height];}else if(!zot(c)){bounds[0]=a;bounds[1]=b;bounds[2]=c;bounds[3]=d;}else{bounds[0]=0;bounds[1]=0;bounds[2]=a;bounds[3]=b;}
if(zot(bounds[3]))bounds[3]=bounds[2];return bounds;}
if(!zot(a))this.setBounds(n[0],n[1],n[2],n[3]);this.cache=function(a,b,c,d,scale,options,margin){if(this.type=="AC"&&zdf){zdf.ac("cache",arguments,this);return this;}
var sig="a,b,c,d,scale,options,margin";var duo;if(duo=zob(that.cache,arguments,sig))return duo;var bounds=that.getBounds();if(zot(c)){if(zot(a)){if(!zot(bounds)){var added=that.borderWidth>0?that.borderWidth/2:0;a=bounds.x-added;b=bounds.y-added;c=bounds.width+added*2;d=bounds.height+added*2;}}else{c=a;d=b;a=0;b=0;}}
if(that.type=="Triangle"){a-=that.borderWidth?that.borderWidth:0;c+=that.borderWidth?that.borderWidth*2:0;b-=that.borderWidth?that.borderWidth:0;d+=that.borderWidth?that.borderWidth*2:0;}
if(zot(margin))margin=0;that.cjsContainer_cache(a-margin,b-margin,c+margin*2,d+margin*2,scale,options);if(bounds)that.setBounds(bounds.x,bounds.y,bounds.width,bounds.height);return that;};this.uncache=function(){that.cjsContainer_uncache();return that;};this.childrenToBitmap=function(){var cached=this.cacheCanvas;var pic=new zim.Bitmap(this.cache().cacheCanvas);if(!cached)this.uncache();this.removeAllChildren();pic.addTo(this);return this;};var frame=zdf||1;if(createjs&&!createjs.stageTransformable&&frame.retina){this.localToGlobal=function(x,y){return zim.localToGlobal(x,y,this,this.cjsContainer_localToGlobal);};this.globalToLocal=function(x,y){return zim.globalToLocal(x,y,this,this.cjsContainer_globalToLocal);};this.localToLocal=function(x,y,target){return zim.localToLocal(x,y,target,this);};}
this.setBounds=function(a,b,c,d){var n=normalizeBounds(a,b,c,d);this.cjsContainer_setBounds(n[0],n[1],n[2],n[3]);return this;};this.disposeAllChildren=function(){for(var i=this.numChildren-1;i>=0;i--){var child=this.getChildAt(i)
if(child.dispose)child.dispose();}
return this;};zim.displayBase(that);if(style!==false)zim.styleTransforms(this,DS);this.clone=function(exact){if(this.type=="AC"&&zdf){zdf.ac("clone",arguments,this);return this;}
var currentBounds=this.getBounds();if(zot(currentBounds))currentBounds={x:null,y:null,width:null,height:null};return this.cloneChildren(this.cloneProps(new zim.Container(currentBounds.x,currentBounds.y,currentBounds.width,currentBounds.height,style,this.group,inherit)),exact);};this.hasProp=function(prop){return(!zot(this[prop])||this.hasOwnProperty(prop));};};zim.Container.prototype.dispose=function(disposing){recursiveDispose(this,disposing);return true;};zim.Container.prototype.specialColor=function(command,co){if(co.type=="GradientColor")command.linearGradient(co.colors,co.ratios,co.x0,co.y0,co.x1,co.y1);else if(co.type=="RadialColor")command.radialGradient(co.colors,co.ratios,co.x0,co.y0,co.r0,co.x1,co.y1,co.r1);else if(co.type=="BitmapColor")command.bitmap(co.image,co.repetition,co.matrix);};function recursiveDispose(obj,disposing){if(obj)zim.gD(obj);if(!disposing&&obj&&obj.dispose&&obj.dispose!==zim.Container.prototype.dispose){obj.dispose(null,null,true);}
if(obj&&obj.addChild){obj.dispatchEvent("removed");obj.removeAllEventListeners();if(obj.numChildren){for(var i=obj.numChildren-1;i>=0;i--){recursiveDispose(obj.getChildAt(i));}}}
if(obj&&obj.parent)obj.parent.removeChild(obj);}
zimify(zim.Container.prototype);zim.extend(zim.Container,createjs.Container,["cache","uncache","setBounds","clone","localToLocal","localToGlobal","globalToLocal"],"cjsContainer",false);zim.Shape=function(a,b,c,d,graphics,optimize,style,group,inherit){var sig="a, b, c, d, graphics, optimize, style, group, inherit";var duo;if(duo=zob(zim.Shape,arguments,sig,this))return duo;z_d("50.6");this.cjsShape_constructor(graphics);this.type="Shape";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);var that=this;if(zot(a))a=DS.a!=null?DS.a:null;if(zot(b))b=DS.b!=null?DS.b:null;if(zot(c))c=DS.c!=null?DS.c:null;if(zot(d))d=DS.d!=null?DS.d:null;if(zot(graphics))graphics=DS.graphics!=null?DS.graphics:null;if(zot(optimize))optimize=DS.optimize!=null?DS.optimize:false;var n=normalizeBounds(a,b,c,d);function normalizeBounds(a,b,c,d){var bounds=[];if(!zot(c)){bounds[0]=a;bounds[2]=c;bounds[1]=b;bounds[3]=d;}else{bounds[0]=0;bounds[2]=a;bounds[1]=0;bounds[3]=b;}
if(zot(bounds[3]))bounds[3]=bounds[2];return bounds;}
if(!zot(a))this.setBounds(n[0],n[1],n[2],n[3]);if(!optimize){var shorts=["mt","lt","a","at","bt","ct","qt","cp","c","f","lf","rf","bf","ef","ss","sd","s","ls","rs","bs","es","dr","rr","rc","dc","de","dp","pg","p"];for(var i=0;i<shorts.length;i++){~function(){var n=i;that[shorts[n]]=function(){if(shorts[n]=="ct")that.graphics.curveTo.apply(that.graphics,arguments);else that.graphics[shorts[n]].apply(that.graphics,arguments);return that;};}();}}
Object.defineProperty(that,'command',{get:function(){return that.graphics.command;},set:function(value){}});this.cache=function(a,b,c,d,scale,options,margin){var sig="a,b,c,d,scale,options,margin";var duo;if(duo=zob(that.cache,arguments,sig))return duo;var bounds=that.getBounds();if(zot(c)){if(zot(a)){if(!zot(bounds)){var added=that.borderWidth>0?that.borderWidth/2:0;a=bounds.x-added;b=bounds.y-added;c=bounds.width+added*2;d=bounds.height+added*2;}}else{c=a;d=b;a=0;b=0;}}
if(zot(margin))margin=0;that.cjsShape_cache(a-margin,b-margin,c+margin*2,d+margin*2,scale,options);return that;};this.setBounds=function(a,b,c,d){var n=normalizeBounds(a,b,c,d);this.cjsShape_setBounds(n[0],n[1],n[2],n[3]);return this;};if(style!==false)zim.styleTransforms(this,DS);this.clone=function(recursive){if(zot(recursive))recursive=true;var currentBounds=this.getBounds();if(zot(currentBounds))currentBounds={x:null,y:null,width:null,height:null};var c=that.cloneProps(new zim.Shape(currentBounds.x,currentBounds.y,currentBounds.width,currentBounds.height,graphics,style,group,inherit));if(recursive)c.graphics=that.graphics.clone();else c.graphics=that.graphics;return c;};var frame=zdf||1;if(createjs&&!createjs.stageTransformable&&frame.retina){this.localToGlobal=function(x,y){return zim.localToGlobal(x,y,this,this.cjsShape_localToGlobal);};this.globalToLocal=function(x,y){return zim.globalToLocal(x,y,this,this.cjsShape_globalToLocal);};this.localToLocal=function(x,y,target){return zim.localToLocal(x,y,target,this);};}
this.hasProp=function(prop){return(!zot(this[prop])||this.hasOwnProperty(prop));};zim.displayBase(that);this.dispose=function(a,b,disposing){zim.gD(this);this.graphics.c();this.dispatchEvent("removed");this.removeAllEventListeners();if(this.parent)this.parent.removeChild(this);};};zim.extend(zim.Shape,createjs.Shape,["cache","clone","setBounds","localToLocal","localToGlobal","globalToLocal"],"cjsShape",false);zimify(zim.Shape.prototype);zim.Bitmap=function(image,width,height,left,top,id,style,group,inherit){var sig="image, width, height, left, top, id, style, group, inherit";var duo;if(duo=zob(zim.Bitmap,arguments,sig,this))return duo;z_d("50.7");if(!zot(image)){if(image.uncache){var cached=image.cacheCanvas;var original=image;image=image.cache().cacheCanvas;}}
this.cjsBitmap_constructor(image);if(original&&!cached)original.uncache();var that=this;this.type="Bitmap";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);this.id=that.fileID=DS.id!=null?DS.id:id;if(zot(width))width=DS.width!=null?DS.width:image?image.width:100;if(zot(height))height=DS.height!=null?DS.height:image?image.height:100;if(!zot(width)&&!zot(height))that.setBounds(0,0,width,height);if(zot(left))left=DS.left!=null?DS.left:0;if(zot(top))top=DS.top!=null?DS.top:0;if(zdf){if(zdf.canvas.getContext("2d")){this.imageData=zdf.canvas.getContext("2d").createImageData(width,height);}else{this.imageData=document.createElement('canvas').getContext("2d").createImageData(width,height);}
this.drawImageData=function(x,y,sourceX,sourceY,sourceWidth,sourceHeight){if(zot(x))x=0;if(zot(y))y=0;if(zot(sourceX))sourceX=0;if(zot(sourceY))sourceY=0;if(zot(sourceWidth))sourceWidth=width;if(zot(sourceHeight))sourceHeight=height;if(!that.proxyCanvas){var c=that.proxyCanvas=document.createElement("canvas");c.setAttribute("width",width);c.setAttribute("height",height);that.proxyContext=c.getContext('2d');image=that.image=c;}
if(that.proxyContext){that.proxyContext.putImageData(that.imageData,x,y,sourceX,sourceY,sourceWidth,sourceHeight);}};if(zot(image))that.drawImageData();if(image.match&&image.match(/data:image/i))setTimeout(function(){if(that.stage)that.stage.update();setTimeout(function(){if(that.stage)that.stage.update();},50);},50);}
if(image&&image.nodeName&&image.nodeName.toLowerCase()!="video")that.sourceRect={x:left,y:top,width:width,height:height};this.cache=function(a,b,c,d,scale,options){if(zot(c)){if(zot(a)){var bounds=this.getBounds();if(!zot(bounds)){var added=this.borderWidth>0?this.borderWidth/2:0;a=bounds.x-added;b=bounds.y-added;c=bounds.width+added*2;d=bounds.height+added*2;}}else{c=a;d=b;a=0;b=0;}}
var bounds=this.getBounds();this.cjsBitmap_cache(a,b,c,d,scale,options);this.setBounds(bounds.x,bounds.y,bounds.width,bounds.height);return this;};this.clone=function(){var c=this.cloneProps(new zim.Bitmap(image,width,height,left,top,that.fileID,style,this.group,inherit));c.cloned=true;return c;};var frame=zdf||1;if(createjs&&!createjs.stageTransformable&&frame.retina){this.localToGlobal=function(x,y){return zim.localToGlobal(x,y,this,this.cjsBitmap_localToGlobal);};this.globalToLocal=function(x,y){return zim.globalToLocal(x,y,this,this.cjsBitmap_globalToLocal);};this.localToLocal=function(x,y,target){return zim.localToLocal(x,y,target,this);};}
this.hasProp=function(prop){return(!zot(this[prop])||this.hasOwnProperty(prop));};var myContext;this.getColorAt=function(x,y){if(!myContext){that.cache();myContext=that.cacheCanvas.getContext('2d');that.uncache();}
var d=myContext.getImageData(x,y,1,1).data;return"rgba("+d[0]+","+d[1]+","+d[2]+","+d[3]+")";};zim.displayBase(that);if(style!==false)zim.styleTransforms(this,DS);this.dispose=function(a,b,disposing){zim.gD(this);this.dispatchEvent("removed");this.removeAllEventListeners();if(!this.cloned){if(this.id){if(this.stage&&this.stage.frame)frame=this.stage.frame;else frame=zdf;if(frame&&frame.assets){if(frame.assets[this.id])delete frame.assets[this.id];}
if(zim.assets[this.id])delete zim.assets[this.id];}}
if(this.parent)this.parent.removeChild(this);};};zim.Bitmap.fromData=function(data,callback){var width=100;var height=100;var img=new Image();img.onload=function(){width=img.naturalWidth;height=img.naturalHeight;if(zot(width))width=img.width;if(zot(height))height=img.height;var bitmap=new zim.Bitmap(data,width,height);setTimeout(function(){callback(bitmap);},50);}
img.src=data;};zim.extend(zim.Bitmap,createjs.Bitmap,["cache","clone","dispose","localToLocal","localToGlobal","globalToLocal"],"cjsBitmap",false);zimify(zim.Bitmap.prototype);zim.Sprite=function(image,cols,rows,count,offsetX,offsetY,spacingX,spacingY,width,height,animations,json,id,globalControl,spriteSheet,label,frame,style,group,inherit){var sig="image, cols, rows, count, offsetX, offsetY, spacingX, spacingY, width, height, animations, json, id, globalControl, spriteSheet, label, frame, style, group, inherit";var duo;if(duo=zob(zim.Sprite,arguments,sig,this))return duo;z_d("50.8");this.type="Sprite";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);var that=this;var sheet;if(zot(frame))frame=DS.frame!=null?DS.frame:zdf;if(zot(json)&&!zot(image)){if(zot(cols))cols=DS.cols!=null?DS.cols:1;if(zot(rows))rows=DS.rows!=null?DS.rows:1;if(zot(count))count=DS.count!=null?DS.count:(cols*rows);if(zot(offsetX))offsetX=DS.offsetX!=null?DS.offsetX:0;if(zot(offsetY))offsetY=DS.offsetY!=null?DS.offsetY:0;if(zot(spacingX))spacingX=DS.spacingX!=null?DS.spacingX:0;if(zot(spacingY))spacingY=DS.spacingY!=null?DS.spacingY:0;if(zot(width))width=DS.width!=null?DS.width:image.width;if(zot(height))height=DS.height!=null?DS.height:image.height;var frameW=(width-offsetX+spacingX)/cols-spacingX;var frameH=(height-offsetY+spacingY)/rows-spacingY;var frames=[];var num=0;outer:for(var j=0;j<rows;j++){for(var i=0;i<cols;i++){if(++num>count)break outer;frames.push([offsetX+i*(frameW+spacingX),offsetY+j*(frameH+spacingY),frameW,frameH]);}}
makeSheet(image,frames,animations);}else if(spriteSheet){sheet=spriteSheet;animations=sheet.animations;}else if(json){frames=json.frames;animations=json.animations;if(!zot(image)){makeSheet(image,frames,animations);}else{var im=json.images?json.images[0]:null;if(!im||!im.split){sheet=new createjs.SpriteSheet(json);}else{var assets=[];zim.loop(json.images,function(im){var imEnd=im.split("/").pop();if(frame.asset(im)&&frame.asset(im).type!="EmptyAsset"){assets.push(frame.asset(im));}else if(frame.asset(imEnd)&&frame.asset(imEnd).type!="EmptyAsset"){assets.push(frame.asset(imEnd));}else if(frame.asset(im).type!="EmptyAsset"){assets.push(frame.asset(im));}else{if(zon)zogy("Sprite() - please preload Sprite in Frame or with loadAssets");}});makeSheet(assets,frames,animations);}}}else{return;}
function makeSheet(image,frames,animations){if(!Array.isArray(image))image=[image];zim.loop(image,function(im,i){image[i]=im.image;});var spriteData={images:image,frames:frames,animations:animations?animations:[]};sheet=new createjs.SpriteSheet(spriteData);}
this.animations=animations;this.cjsSprite_constructor(sheet,label);if(!zot(label))this.stop();if(zot(id))id=zim.makeID();this.id=id;if(zot(globalControl))globalControl=true;that.globalControl=globalControl;var _normalizedFrame=0;var _normalizedFrames;this.parseFrames=function(label,startFrame,endFrame,fromDynamo){var frames=[];var minSpeed=Number.MAX_VALUE;var maxSpeed=0;if(zot(label)){if(zot(startFrame))startFrame=0;if(zot(endFrame))endFrame=that.totalFrames-1;addSequential(startFrame,endFrame);}else{if(zot(that.animations)||zot(that.animations[label]))return[];var a=that.animations[label];processAnimation(a);}
function processAnimation(a){if(Array.isArray(a)){processArray(a);}else if(a.constructor=={}.constructor){processObject(a);}else if(!isNaN(a)){frames.push({f:Math.floor(a),s:1});}}
function processArray(a){addSequential(a[0],a[1],a[3]);if(a[2]&&!zot(that.animations[a[2]]))processAnimation(that.animations[a[2]]);}
function processObject(a){if(zot(a.frames))return;if(zot(a.speed))a.speed=1;for(var i=0;i<a.frames.length;i++){if(a.speed<minSpeed)minSpeed=a.speed;if(a.speed>maxSpeed)maxSpeed=a.speed;frames.push({f:a.frames[i],s:a.speed});}
if(a.next&&!zot(that.animations[a.next]))processAnimation(that.animations[a.next]);}
function addSequential(start,end,speed){if(zot(speed))speed=1;if(end>start){for(var i=start;i<=end;i++){inner(i);}}else{for(var i=end;i<=start;i++){inner(start-(i-end));}}
function inner(i){if(speed<minSpeed)minSpeed=speed;if(speed>maxSpeed)maxSpeed=speed;frames.push({f:i,s:speed});}}
if(fromDynamo)return frames;minSpeed=zim.constrain(zim.decimals(minSpeed),.1);maxSpeed=zim.constrain(zim.decimals(maxSpeed),.1);var framesNormalized=[];var normalize=(minSpeed!=maxSpeed);var fr;for(var i=0;i<frames.length;i++){fr=frames[i];if(normalize){for(var j=0;j<zim.constrain(Math.round(minSpeed<1?fr.s/minSpeed:fr.s),.1);j++){framesNormalized.push(fr.f);}}else{framesNormalized.push(fr.f);}}
return framesNormalized;};this.run=function(time,label,call,params,wait,waitedCall,waitedParams,loop,loopCount,loopWait,loopCall,loopParams,loopWaitCall,loopWaitParams,loopPick,rewind,rewindWait,rewindCall,rewindParams,rewindWaitCall,rewindWaitParams,rewindTime,rewindEase,startFrame,endFrame,tweek,id,globalControl,pauseOnBlur){var sig="time, label, call, params, wait, waitedCall, waitedParams, loop, loopCount, loopWait, loopCall, loopParams, loopWaitCall, loopWaitParams, loopPick, rewind, rewindWait, rewindCall, rewindParams, rewindWaitCall, rewindWaitParams, rewindTime, rewindEase, startFrame, endFrame, tweek, id, globalControl, pauseOnBlur";var duo;if(duo=zob(this.run,arguments,sig))return duo;var timeType=getTIME();var obj;var set;var lookup;if(zot(tweek))tweek=1;if(!zot(id))that.id=id;if(!zot(globalControl))that.globalControl=globalControl;if(Array.isArray(label)){var innerLabel;var lastLabel;obj=[];var extraTime=0;var firstStartFrame;for(var i=0;i<label.length;i++){innerLabel=label[i];innerLabel.lookup=that.parseFrames(innerLabel.label,innerLabel.startFrame,innerLabel.endFrame);if(i==0)firstStartFrame=innerLabel.lookup[0];delete innerLabel.startFrame;delete innerLabel.endFrame;innerLabel.obj=zim.merge(innerLabel.obj,{normalizedFrame:innerLabel.lookup.length-1});innerLabel.set=zim.merge(innerLabel.set,{normalizedFrames:{noPick:innerLabel.lookup},normalizedFrame:0});if(zot(innerLabel.wait))innerLabel.wait=extraTime*tweek;lastLabel=innerLabel.label;delete innerLabel.label;obj.push(innerLabel);extraTime=0;var tt=zot(innerLabel.time)?time:innerLabel.time;if(endFrame-startFrame>0)extraTime=tt/(endFrame-startFrame)/2;}
if(obj.length==0)return this;if(obj.length==1){time=obj[0].time;label=lastLabel;setSingle();}else{that.gotoAndStop(firstStartFrame);}}else{setSingle();}
function setSingle(){_normalizedFrames=that.parseFrames(label,startFrame,endFrame);_normalizedFrame=0;that.gotoAndStop(_normalizedFrames[_normalizedFrame]);startFrame=endFrame=null;obj={normalizedFrame:_normalizedFrames.length-1};}
if(zot(time))time=timeType=="s"?1:1000;if(that.running)that.stopAnimate(that.id);that.running=true;if(!Array.isArray(obj)){var extraTime=0;if(endFrame-startFrame>0)extraTime=time/Math.abs(endFrame-startFrame)/2;if(_normalizedFrames&&_normalizedFrames.length>0)extraTime=time/_normalizedFrames.length/2;if(zot(loopWait)){loopWait=extraTime*tweek;}
if(zot(rewindWait)){rewindWait=extraTime*tweek;}}
var localCall=function(){that.running=false;that.stop();if(call&&typeof call=='function')call(params||that);};zim.animate({target:that,obj:obj,time:time,ease:"linear",call:localCall,params:params,wait:wait,waitedCall:waitedCall,waitedParams:waitedParams,loop:loop,loopCount:loopCount,loopWait:loopWait,loopCall:loopCall,loopParams:loopParams,loopWaitCall:loopWaitCall,loopWaitParams:loopWaitParams,rewind:rewind,rewindWait:rewindWait,rewindCall:rewindCall,rewindParams:rewindParams,rewindWaitCall:rewindWaitCall,rewindWaitParams:rewindWaitParams,rewindTime:rewindTime,rewindEase:rewindEase,override:false,pauseOnBlur:pauseOnBlur,id:that.id});that.runPaused=false;return that;};this.runPaused=true;this.pauseRun=function(paused){if(zot(paused))paused=true;that.runPaused=paused;if(that.globalControl){zim.pauseAnimate(paused,that.id);}else{that.pauseAnimate(paused,that.id);}
return that;};this.stopRun=function(){that.runPaused=true;that.running=false;if(that.globalControl){zim.stopAnimate(that.id);}else{that.stopAnimate(that.id);}
return that;};Object.defineProperty(this,'frame',{get:function(){return this.currentFrame;},set:function(value){value=Math.round(value);if(this.paused){this.gotoAndStop(value);}else{this.gotoAndPlay(value);}}});Object.defineProperty(this,'normalizedFrame',{get:function(){return _normalizedFrame;},set:function(value){_normalizedFrame=Math.round(value);this.gotoAndStop(_normalizedFrames[_normalizedFrame]);}});Object.defineProperty(this,'normalizedFrames',{get:function(){return _normalizedFrames;},set:function(value){_normalizedFrames=value;}});Object.defineProperty(this,'totalFrames',{get:function(){return sheet.getNumFrames();},set:function(value){zog("zim.Sprite - totalFrames is read only");}});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return this.cloneProps(new zim.Sprite(image,cols,rows,count,offsetX,offsetY,spacingX,spacingY,width,height,animations,json,null,globalControl,spriteSheet,label,frame,style,this.group,inherit));};var frame=zdf||1;if(createjs&&!createjs.stageTransformable&&frame.retina){this.localToGlobal=function(x,y){return zim.localToGlobal(x,y,this,this.cjsSprite_localToGlobal);};this.globalToLocal=function(x,y){return zim.globalToLocal(x,y,this,this.cjsSprite_globalToLocal);};this.localToLocal=function(x,y,target){return zim.localToLocal(x,y,target,this);};}
this.hasProp=function(prop){return(!zot(this[prop])||this.hasOwnProperty(prop));};zim.displayBase(that);this.dispose=function(a,b,disposing){zim.gD(this);this.dispatchEvent("removed");this.removeAllEventListeners();if(this.parent)this.parent.removeChild(this);};};zim.extend(zim.Sprite,createjs.Sprite,["clone","localToLocal","localToGlobal","globalToLocal"],"cjsSprite",false);zimify(zim.Sprite.prototype);zim.MovieClip=function(mode,startPosition,loop,labels,style,group,inherit){var sig="mode, startPosition, loop, labels, style, group, inherit";var duo;if(duo=zob(zim.MovieClip,arguments,sig,this))return duo;z_d("50.9");this.type="MovieClip";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(mode))mode=DS.mode!=null?DS.mode:null;if(zot(startPosition))startPosition=DS.startPosition!=null?DS.startPosition:null;if(zot(loop))loop=DS.loop!=null?DS.loop:null;if(zot(labels))labels=DS.labels!=null?DS.labels:null;this.cjsMovieClip_constructor(mode,startPosition,loop,labels);if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return this.cloneProps(new zim.MovieClip(mode,startPosition,loop,labels,style,this.group,inherit));};this.hasProp=function(prop){return(!zot(this[prop])||this.hasOwnProperty(prop));};var frame=zdf||1;if(createjs&&!createjs.stageTransformable&&frame.retina){this.localToGlobal=function(x,y){return zim.localToGlobal(x,y,this,this.cjsMovieClip_localToGlobal);};this.globalToLocal=function(x,y){return zim.globalToLocal(x,y,this,this.cjsMovieClip_globalToLocal);};this.localToLocal=function(x,y,target){return zim.localToLocal(x,y,target,this);};}
zim.displayBase(this);this.dispose=function(a,b,disposing){zim.gD(this);this.dispatchEvent("removed");this.removeAllEventListeners();if(this.parent)this.parent.removeChild(this);};};zim.extend(zim.MovieClip,createjs.MovieClip,["clone","localToLocal","localToGlobal","globalToLocal"],"cjsMovieClip",false);zimify(zim.MovieClip.prototype);zim.SVGContainer=function(svg,splitTypes,geometric,showControls,interactive,style,group,inherit){var sig="svg, splitTypes, geometric, showControls, interactive, style, group, inherit";var duo;if(duo=zob(zim.SVGContainer,arguments,sig,this))return duo;z_d("50.95");this.group=group;var DS=style===false?{}:zim.getStyle("SVGContainer",this.group,inherit);if(svg&&svg.type=="Bitmap")svg=svg.svg;var that=this;var startPosition=new zim.Point(0,0);var aCommand=[];var arcToBezier;function makeArcCode(){function _sa(arr,i){return _ah(arr)||_il(arr,i)||_ua(arr,i)||_ni();}
function _ni(){throw new TypeError("Invalid");}
function _ua(o,minLen){if(!o)return;if(typeof o==="string")return _ala(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _ala(o,minLen);}
function _ala(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}
function _il(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}
function _ah(arr){if(Array.isArray(arr))return arr;}
var TAU=Math.PI*2;var me=function me(_ref,rx,ry,cosphi,sinphi,centerx,centery){var x=_ref.x,y=_ref.y;x*=rx;y*=ry;var xp=cosphi*x-sinphi*y;var yp=sinphi*x+cosphi*y;return{x:xp+centerx,y:yp+centery};};var approxUnitArc=function approxUnitArc(ang1,ang2){var a=ang2===1.5707963267948966?0.551915024494:ang2===-1.5707963267948966?-0.551915024494:4/3*Math.tan(ang2/4);var x1=Math.cos(ang1);var y1=Math.sin(ang1);var x2=Math.cos(ang1+ang2);var y2=Math.sin(ang1+ang2);return[{x:x1-y1*a,y:y1+x1*a},{x:x2+y2*a,y:y2-x2*a},{x:x2,y:y2}];};var vectorAngle=function vectorAngle(ux,uy,vx,vy){var sign=ux*vy-uy*vx<0?-1:1;var dot=ux*vx+uy*vy;if(dot>1){dot=1;}
if(dot<-1){dot=-1;}
return sign*Math.acos(dot);};var getArcCenter=function getArcCenter(px,py,cx,cy,rx,ry,largeArcFlag,sweepFlag,sinphi,cosphi,pxp,pyp){var rxsq=Math.pow(rx,2);var rysq=Math.pow(ry,2);var pxpsq=Math.pow(pxp,2);var pypsq=Math.pow(pyp,2);var radicant=rxsq*rysq-rxsq*pypsq-rysq*pxpsq;if(radicant<0){radicant=0;}
radicant/=rxsq*pypsq+rysq*pxpsq;radicant=Math.sqrt(radicant)*(largeArcFlag===sweepFlag?-1:1);var centerxp=radicant*rx/ry*pyp;var centeryp=radicant* -ry/rx*pxp;var centerx=cosphi*centerxp-sinphi*centeryp+(px+cx)/2;var centery=sinphi*centerxp+cosphi*centeryp+(py+cy)/2;var vx1=(pxp-centerxp)/rx;var vy1=(pyp-centeryp)/ry;var vx2=(-pxp-centerxp)/rx;var vy2=(-pyp-centeryp)/ry;var ang1=vectorAngle(1,0,vx1,vy1);var ang2=vectorAngle(vx1,vy1,vx2,vy2);if(sweepFlag===0&&ang2>0){ang2-=TAU;}
if(sweepFlag===1&&ang2<0){ang2+=TAU;}
return[centerx,centery,ang1,ang2];};return function arcToBezier(_ref2){var px=_ref2.px,py=_ref2.py,cx=_ref2.cx,cy=_ref2.cy,rx=_ref2.rx,ry=_ref2.ry,_ref2$xAxisRotation=_ref2.xAxisRotation,xAxisRotation=_ref2$xAxisRotation===void 0?0:_ref2$xAxisRotation,_ref2$largeArcFlag=_ref2.largeArcFlag,largeArcFlag=_ref2$largeArcFlag===void 0?0:_ref2$largeArcFlag,_ref2$sweepFlag=_ref2.sweepFlag,sweepFlag=_ref2$sweepFlag===void 0?0:_ref2$sweepFlag;var curves=[];if(rx===0||ry===0){return[];}
var sinphi=Math.sin(xAxisRotation*TAU/360);var cosphi=Math.cos(xAxisRotation*TAU/360);var pxp=cosphi*(px-cx)/2+sinphi*(py-cy)/2;var pyp=-sinphi*(px-cx)/2+cosphi*(py-cy)/2;if(pxp===0&&pyp===0){return[];}
rx=Math.abs(rx);ry=Math.abs(ry);var lambda=Math.pow(pxp,2)/Math.pow(rx,2)+Math.pow(pyp,2)/Math.pow(ry,2);if(lambda>1){rx*=Math.sqrt(lambda);ry*=Math.sqrt(lambda);}
var _getArcCenter=getArcCenter(px,py,cx,cy,rx,ry,largeArcFlag,sweepFlag,sinphi,cosphi,pxp,pyp),_getArcCenter2=_sa(_getArcCenter,4),centerx=_getArcCenter2[0],centery=_getArcCenter2[1],ang1=_getArcCenter2[2],ang2=_getArcCenter2[3];var ratio=Math.abs(ang2)/(TAU/4);if(Math.abs(1.0-ratio)<0.0000001){ratio=1.0;}
var segments=Math.max(Math.ceil(ratio),1);ang2/=segments;for(var i=0;i<segments;i++){curves.push(approxUnitArc(ang1,ang2));ang1+=ang2;}
return curves.map(function(curve){var _me=me(curve[0],rx,ry,cosphi,sinphi,centerx,centery),x1=_me.x,y1=_me.y;var _me2=me(curve[1],rx,ry,cosphi,sinphi,centerx,centery),x2=_me2.x,y2=_me2.y;var _me3=me(curve[2],rx,ry,cosphi,sinphi,centerx,centery),x=_me3.x,y=_me3.y;return{x1:x1,y1:y1,x2:x2,y2:y2,x:x,y:y};});};}
if(zot(splitTypes))splitTypes=false;if(zot(geometric))geometric=true;if(!zot(svg)){if(svg.replace)svg=svg.replace(/style\s?=[^"]*"[^"]*"/ig,"");if(!zot(svg.draggable)){var parser=new DOMParser();var svg=!svg.innerHTML?svg:parser.parseFromString(svg.innerHTML,"text/xml");var list=svg.getElementsByTagName("svg");var tag=this.svg=list?svg.getElementsByTagName("svg")[0]:null;}else{if(!svg.getAttribute){var parser=new DOMParser();svg=parser.parseFromString(svg,"image/svg+xml").documentElement;}
var tag=this.svg=svg;}
var w,h;if(!zot(tag)){var w=tag.getAttribute("width");var h=tag.getAttribute("height");}
if(w)w=Number(w.trim());if(h)h=Number(h.trim());this.zimContainer_constructor(w,h);this.type="SVGContainer";if(zot(tag))return;var defaultFill=zim.black,generalFill=zim.black;var defaultStroke=zim.black,generalStroke=zim.black;var defaultStrokeSize=2,generalStrokeSize=2;var defaultAlpha=1,generalAlpha=1;var defaultStrokeAlpha=1,generalStrokeAlpha=1;var currentTransform;function processTag(tag){zim.loop(tag,function(t){var tn=t.tagName.toLowerCase();if(tn=="path")processPath(t);if(tn=="circle")processShape("circle",t);if(tn=="rect")processShape("rect",t);if(tn=="ellipse")processShape("ellipse",t);if(tn=="line")processShape("line",t);if(tn=="polygon")processShape("polygon",t);if(tn=="polyline")processShape("polyline",t);if(tn=="g"){var style=t.getAttribute("style");var f,s,ss,a,aa;if(style){var styles=processStyle(style);f=styles[0];s=styles[1];ss=styles[2];a=styles[3];aa=styles[4];}
currentTransform=t.getAttribute("transform");generalFill=t.getAttribute("fill")?t.getAttribute("fill"):!zot(f)?f:defaultFill;generalStroke=t.getAttribute("stroke")?t.getAttribute("stroke"):!zot(s)?s:defaultStroke;generalStrokeSize=t.getAttribute("stroke-width")?t.getAttribute("stroke-width"):!zot(ss)?ss:defaultStrokeSize;generalAlpha=t.getAttribute("fill-opacity")?t.getAttribute("fill-opacity"):!zot(a)?a:defaultAlpha;generalStrokeAlpha=t.getAttribute("stroke-opacity")?t.getAttribute("stroke-opacity"):!zot(aa)?aa:defaultStrokeAlpha;}
processTag(t.children);if(t.tagName.toLowerCase()=="g"){generalFill=defaultFill;generalStroke=defaultStroke;generalStrokeSize=defaultStrokeSize;generalAlpha=defaultAlpha;generalStrokeAlpha=defaultStrokeAlpha;currentTransform=null;}});}
var process=svg.getElementsByTagName("svg");if(process.length==0)process=[svg];function processStyle(style){var st=style.split(";");var f,s,ss,a,aa;zim.loop(st,function(sty){var sty=sty.replace(/,/g,"");var styl=sty.split(":");var prop=styl[0].trim().toLowerCase();var val=styl[1].trim().toLowerCase().replace("px","");if(prop=="fill")f=val;if(prop=="stroke")s=val;if(prop=="stroke-width")ss=val;if(prop=="opacity")a=val,aa=val;if(prop=="fill-opacity")a=val;if(prop=="stroke-opacity")aa=val;});return[f,s,ss,a,aa];}
function processShape(type,tag){var shape;var g=processGeneral(tag);var f=g[0],s=g[1],ss=g[2],a=g[3],aa=g[4],x=g[5],y=g[6];if(type=="circle"){var r=Number(tag.getAttribute("r").trim());var d=r*.5523;if(geometric)shape=new zim.Circle(Number(tag.getAttribute("r")),f,s,ss);else shape=new zim.Blob(f,s,ss,4,r,d,"mirror",null,showControls,null,null,null,null,null,null,null,null,null,null,interactive);}else if(type=="rect"){if(geometric)shape=new zim.Rectangle(Number(tag.getAttribute("width")),Number(tag.getAttribute("height")),f,s,ss,Number(tag.getAttribute("rx")));else{var w=Number(tag.getAttribute("width"));var h=Number(tag.getAttribute("height"));var rx=Number(tag.getAttribute("rx"));var ry=Number(tag.getAttribute("ry"));if(rx&&ry){var dx=rx*.5523;var dy=ry*.5523;shape=new zim.Blob(f,s,ss,[[rx,0,0,0,-dx,0,0,0,"free"],[w-rx,0,0,0,0,0,dx,0,"free"],[w,ry,0,0,0,-dy,0,0,"free"],[w,h-ry,0,0,0,0,0,dy,"free"],[w-rx,h,0,0,dx,0,0,0,"free"],[rx,h,0,0,0,0,-dx,0,"free"],[0,h-ry,0,0,0,dy,0,0,"free"],[0,ry,0,0,0,0,0,-dy,"free"]],null,null,null,null,showControls,null,null,null,null,null,null,null,null,null,null,interactive);}else{shape=new zim.Blob(f,s,ss,[[0,0],[w,0],[w,h],[0,h]],null,null,null,null,showControls,null,null,null,null,null,null,null,null,null,null,interactive);}}}else if(type=="line"){shape=new zim.Squiggle(s,ss,[[Number(tag.getAttribute("x1")),Number(tag.getAttribute("y1"))],[Number(tag.getAttribute("x2")),Number(tag.getAttribute("y2"))]],null,null,null,null,showControls,null,null,null,null,null,null,null,null,null,null,interactive);}else if(type=="polygon"||type=="polyline"){var p=tag.getAttribute("points");p=p.replace(/-/g," -");p=p.replace(/\s+/g," ");var points=[];if(p.indexOf(",")!=-1){zim.loop(p.split(" "),function(point){var pp=point.split(",");points.push([Number(pp[0].trim()),Number(pp[1].trim())]);});}else{var lastP;zim.loop(p.split(" "),function(point,i){if((i+1)%2==0)points.push([lastP,point.trim()]);lastP=point.trim();});}
if(type=="polygon")shape=new Blob(f,s,ss,points);else shape=new zim.Squiggle(s,ss,points,null,null,null,null,showControls,null,null,null,null,null,null,null,null,null,null,interactive);}else if(type=="ellipse"){shape=new zim.Blob(f,s,ss,ellipse(0,0,Number(tag.getAttribute("rx")),Number(tag.getAttribute("ry"))),null,null,null,null,showControls,null,null,null,null,null,null,null,null,null,null,interactive);}
shape.loc(x,y,that);var transform=tag.getAttribute("transform");if(transform||currentTransform)processTransform(shape,transform||currentTransform);if(interactive&&(shape.type=="Rectangle"||shape.type=="Circle"))shape.transform({showReg:false,visible:showControls});}
function processTransform(shape,transform){var tr=transform.split(")");zim.loop(tr,function(tra){if(tra=="")return;var tran=tra.trim().split("(");var prop=tran[0].trim().toLowerCase();var val=tran[1].trim().toLowerCase().replace("px","").replace("deg","");if(prop=="translate"){var m=val.split(",");shape.mov(Number(m[0].trim()),m[1]?Number(m[1].trim()):0);}
if(prop=="scale"){var s=val.split(",");if(shape.type=="Blob"||shape.type=="Squiggle"){if(s.length==1)shape.transformPoints("scale",Number(s[0].trim()));else if(s.length==2){shape.transformPoints("scaleX",Number(s[0].trim()));shape.transformPoints("scaleY",Number(s[1].trim()));}}else{if(s.length==1)shape.sca(Number(s[0].trim()));else if(s.length==2){shape.sca(Number(s[0].trim()),Number(s[1].trim()));}}}
if(prop=="rotate"){var r=val.split(",");if(r.length==1)r.push(0,0);else if(r.length==2)r.push(0);shape.rot(Number(r[0].trim()),Number(r[1].trim()),Number(r[2].trim()));}
if(prop=="skewX")shape.skewX=val;if(prop=="skewY")shape.skewY=val;});}
function ellipse(x,y,xDis,yDis){var kappa=0.5522848,ox=xDis*kappa,oy=yDis*kappa,xe=x+xDis,ye=y+yDis;var points=[[x-xDis,y,0,0,x,ye+oy-yDis,x,y-oy,"mirror"],[x,y-yDis,0,0,x-ox,y,xe+ox-xDis,y,"mirror"],[xe,y,0,0,x,y-oy,x+ox-ox,ye+oy-yDis,"mirror"],[x,ye,0,0,xe-xDis+ox,y,x-ox,y,"mirror"]];return points;}
processTag(process);}
function processGeneral(tag){var f,s,ss,a,aa;var style=tag.getAttribute("style");if(style){var styles=processStyle(style);f=styles[0];s=styles[1];ss=styles[2];a=styles[3];aa=styles[4];}
f=tag.getAttribute("fill")?tag.getAttribute("fill"):!zot(f)?f:generalFill;s=tag.getAttribute("stroke")?tag.getAttribute("stroke"):!zot(s)?s:generalStroke;ss=tag.getAttribute("stroke-width")?tag.getAttribute("stroke-width"):!zot(ss)?ss:generalStrokeSize;a=tag.getAttribute("fill-opacity")?tag.getAttribute("fill-opacity"):!zot(a)?a:generalAlpha;aa=tag.getAttribute("stroke-opacity")?tag.getAttribute("stroke-opacity"):!zot(aa)?aa:generalStrokeAlpha;var x=tag.getAttribute("x")?tag.getAttribute("x"):0;x=tag.getAttribute("cx")?tag.getAttribute("cx"):x;var y=tag.getAttribute("y")?tag.getAttribute("y"):0;y=tag.getAttribute("cy")?tag.getAttribute("cy"):y;if(!zot(a)&&!zot(f))f=zim.convertColor(f,"rgba",Number(a));if(!zot(aa)&&!zot(s))s=zim.convertColor(s,"rgba",Number(aa));return[f,s,Number(ss),Number(a),Number(aa),Number(x),Number(y)];}
function processPath(path,make){if(zot(make))make=true;var commands=["M","m","L","l","H","h","V","v","C","c","S","s","Q","q","T","t","A","a","z","Z"];var commandsRelative=["m","l","h","v","c","s","q","t","a","z"];var position=new zim.Point(0,0);if(zot(path.getAttribute)){var d=path;}else{var id=path.getAttribute("id");var d=path.getAttribute("d");}
d=d.replace(/,/g," ");d=d.replace(/([a-zA-Z])/g," $1 ");d=d.replace(/-/g," -");d=d.replace(/\s+/g," ");d=d.replace(/\.(\d*)\./g,".$1 .");if(make){var g=processGeneral(path);var f=g[0];var s=g[1];var ss=g[2];var a=g[3];var aa=g[4];}
var shape;var aNumber;var points=[];var lastTempPoint=[0,0];var line=new zim.Point(0,0);var quad=new zim.Point(0,0,0,0);var cube=new zim.Point(0,0,0,0,0,0);var arc=new zim.Point(0,0,0,0,0,0,0);var dataOrigin=d.split(" ");var data=dataOrigin.slice(1,dataOrigin.length);var aCommand=[];var missingCommand=false;var lastCommand="";var previousCommand="";var adding=false;var what;var type="squiggle";var dataType=null;zim.loop(data,function(command,i){if(i==0){startPosition.x=0;startPosition.y=0;lastTempPoint=[0,0];lastCommand="";previousCommand="";}
if(commands.indexOf(command)==-1){if(what=="lxo"){what="lx";aCommand.push("l");missingCommand=true;}
if(what=="lyo"){what="ly";missingCommand=true;}
if(what=="Lxo"){what="Lx";aCommand.push("L");missingCommand=true;}
if(what=="Lyo"){what="Ly";missingCommand=true;}
aNumber=Number(command);aNumber=Math.round(aNumber*100)/100;if(what=="X"){startPosition.x=aNumber;what="Y";}else if(what=="Y"){startPosition.y=aNumber;what="Lxo";points.push([startPosition.x,startPosition.y]);}else if(what=="x"){startPosition.x=startPosition.x+aNumber;what="y";}else if(what=="y"){startPosition.y=startPosition.y+aNumber;what="lxo";points.push([startPosition.x,startPosition.y]);}
if(what=="H"||what=="h"){position.x=points[points.length-1][0];position.y=points[points.length-1][1];position.x=position.x+(what=="h"?aNumber:aNumber-startPosition.x);points.push([position.x,position.y]);what="Lx";}else if(what=="V"||what=="v"){position.x=points[points.length-1][0];position.y=points[points.length-1][1];position.y=position.y+(what=="v"?aNumber:aNumber-startPosition.y);points.push([position.x,position.y]);what="lx";}
if(what=="Lx"){line.x=aNumber;what="Ly";}else if(what=="Ly"){line.y=aNumber;position.x=line.x;position.y=line.y;points.push([position.x,position.y]);what="Lx";}else if(what=="lx"){if(aCommand.length>0){if(position.x!=0&&position.y!=0){startPosition.x=position.x;startPosition.y=position.y;}
else{startPosition.x=position.x+startPosition.x;startPosition.y=position.y+startPosition.y;}}
line.x=startPosition.x+aNumber;if(missingCommand){what="lyo";}else
what="ly";}else if(what=="ly"){line.y=startPosition.y+aNumber;position.x=line.x;position.y=line.y;points.push([position.x,position.y]);what="lx";}
if(what=="qx"||what=="Qx"){if(points.length>0){startPosition.x=points[points.length-1][0];startPosition.y=points[points.length-1][1];}else{startPosition.x=0;startPosition.y=0;}
quad.x=what=="qx"?startPosition.x+aNumber:aNumber;what=what=="qx"?"qy":"Qy";}else if(what=="qy"||what=="Qy"){quad.y=what=="qy"?startPosition.y+aNumber:aNumber;what=what=="qy"?"qz":"Qz";if(adding){adding=false;var lastPoint=points[points.length-1];lastPoint[6]=-lastPoint[4];lastPoint[7]=-lastPoint[5];lastPoint[8]="mirror";position.x=quad.x;position.y=quad.y;points[points.length]=[position.x,position.y,0,0,-lastPoint[6],lastPoint[7],0,0,"free"];what=what=="qy"?"qx":"Qx";}}else if(what=="qz"||what=="Qz"){quad.z=what=="qz"?startPosition.x+aNumber:aNumber;what=what=="qz"?"qq":"Qq";}else if(what=="qq"||what=="Qq"){quad.w=what=="qq"?startPosition.y+aNumber:aNumber;var lastPoint=points[points.length-1];position.x=lastPoint[0];position.y=lastPoint[1];if(points.length==1){lastPoint[2]=0;lastPoint[3]=0;lastPoint[4]=0;lastPoint[5]=0;lastPoint[6]=2/3*(quad.x-position.x);lastPoint[7]=2/3*(quad.y-position.y);lastPoint[8]="free";}
else{points[points.length]=[position.x,position.y,0,0,0,0,2/3*(quad.x-position.x),2/3*(quad.y-position.y),"free"];}
position.x=quad.z;position.y=quad.w;points[points.length]=[position.x,position.y,0,0,2/3*(quad.x-position.x),2/3*(quad.y-position.y),0,0,"free"];what=what=="qq"?"qx":"Qx";}
if(what=="cx"||what=="Cx"){if(points.length>0){startPosition.x=points[points.length-1][0];startPosition.y=points[points.length-1][1];}else{startPosition.x=0;startPosition.y=0;}
cube.x=what=="cx"?startPosition.x+aNumber:aNumber;what=what=="cx"?"cy":"Cy";}else if(what=="cy"||what=="Cy"){cube.y=what=="cy"?startPosition.y+aNumber:aNumber;what=what=="cy"?"cz":"Cz";}else if(what=="cz"||what=="Cz"){cube.z=what=="cz"?startPosition.x+aNumber:aNumber;what=what=="cz"?"cq":"Cq";}else if(what=="cq"||what=="Cq"){cube.q=what=="cq"?startPosition.y+aNumber:aNumber;what=what=="cq"?"cr":"Cr";if(adding){if(lastCommand=="s"){previousCommand="s";}else{previousCommand="S";}
var lastPoint=points[points.length-1];lastPoint[2]=0;lastPoint[3]=0;if(zot(lastPoint[4])){lastPoint[4]=0;}
if(zot(lastPoint[5])){lastPoint[5]=0;}
lastPoint[6]=-lastPoint[4];lastPoint[7]=-lastPoint[5];lastPoint[8]="mirror";position.x=cube.z;position.y=cube.q;points[points.length]=[position.x,position.y,0,0,cube.x-position.x,cube.y-position.y,0,0,"free"];what=what=="cr"?"cx":"Cx";}}else if(what=="cr"||what=="Cr"){cube.r=what=="cr"?startPosition.x+aNumber:aNumber;what=what=="cr"?"cs":"Cs";}else if(what=="cs"||what=="Cs"){cube.s=what=="cs"?startPosition.y+aNumber:aNumber;var lastPoint=points[points.length-1];if(points.length==1){lastPoint[2]=0;lastPoint[3]=0;lastPoint[4]=0;lastPoint[5]=0;}
lastPoint[6]=cube.x-lastPoint[0];lastPoint[7]=cube.y-lastPoint[1];lastPoint[8]="free";position.x=cube.r;position.y=cube.s;points[points.length]=[position.x,position.y,0,0,cube.z-position.x,cube.q-position.y,0,0,"free"];what=what=="cs"?"cx":"Cx";}else if(what=="ax"||what=="Ax"){if(points.length>0){startPosition.x=points[points.length-1][0];startPosition.y=points[points.length-1][1];}else{startPosition.x=0;startPosition.y=0;}
arc.x=aNumber;what=what=="ax"?"ay":"Ay";}else if(what=="ay"||what=="Ay"){arc.y=aNumber;what=what=="ay"?"az":"Az";}else if(what=="az"||what=="Az"){arc.z=aNumber;what=what=="az"?"aq":"Aq";}else if(what=="aq"||what=="Aq"){arc.q=aNumber;what=what=="aq"?"ar":"Ar";}else if(what=="ar"||what=="Ar"){arc.r=aNumber;what=what=="ar"?"as":"As";}else if(what=="as"||what=="As"){arc.s=what=="as"?startPosition.x+aNumber:aNumber;what=what=="as"?"at":"At";}else if(what=="at"||what=="At"){arc.t=what=="at"?startPosition.y+aNumber:aNumber;if(!arcToBezier)arcToBezier=makeArcCode();var curves=arcToBezier({px:startPosition.x,py:startPosition.y,cx:arc.s,cy:arc.t,rx:arc.x,ry:arc.y,xAxisRotation:arc.z,largeArcFlag:arc.q,sweepFlag:arc.r,});loop(curves,function(curve,ii){lastPoint=points[points.length-1];if(points.length==1){lastPoint[2]=0;lastPoint[3]=0;lastPoint[4]=0;lastPoint[5]=0;}
if(ii==0&&points.length==1){lastPoint[6]=curve.x1-position.x-startPosition.x;lastPoint[7]=curve.y1-position.y-startPosition.y;}else{lastPoint[6]=curve.x1-position.x;lastPoint[7]=curve.y1-position.y;}
lastPoint[8]="free";position.x=curve.x;position.y=curve.y;points[points.length]=[position.x,position.y,0,0,curve.x2-position.x,curve.y2-position.y,0,0,"free"];});what=what=="at"?"ax":"Ax";}}
else{aCommand.push(command);if(command!="s"){adding=false;}
if(aCommand.length>1){if(command=="M"||command=="m"){makeShape(aCommand);if(command=="M"){startPosition.x=0;startPosition.y=0;}
else{startPosition.x=points[points.length-1][0];startPosition.y=points[points.length-1][1];}
points=[];aCommand=[];aCommand.push(command);}}
if(command=="M"){what="X";}else if(command=="m"){what="x";}else if(command=="L"){what="Lx";if(splitTypes&&dataType&&(dataType!="l"))makeShape(aCommand);dataType="l";}else if(command=="l"){what="lx";if(splitTypes&&dataType&&(dataType!="l"))makeShape(aCommand);dataType="l";}else if(command=="H"){what="H";if(splitTypes&&dataType&&(dataType!="l"))makeShape(aCommand);dataType="l";}else if(command=="h"){what="h";if(splitTypes&&dataType&&(dataType!="l"))makeShape(aCommand);dataType="l";}else if(command=="V"){what="V";if(splitTypes&&dataType&&(dataType!="l"))makeShape(aCommand);dataType="l";}else if(command=="v"){what="v";if(splitTypes&&dataType&&(dataType!="l"))makeShape(aCommand);dataType="l";}else if(command=="C"){what="Cx";if(splitTypes&&dataType&&(dataType!="c"))makeShape(aCommand);dataType="c";}else if(command=="c"){what="cx";if(splitTypes&&dataType&&(dataType!="c"))makeShape(aCommand);dataType="c";}else if(command=="S"){adding=true;what="Cx";if(splitTypes&&dataType&&(dataType!="c"))makeShape(aCommand);dataType="c";}else if(command=="s"){adding=true;what="cx";if(splitTypes&&dataType&&(dataType!="c"))makeShape(aCommand);dataType="c";}else if(command=="Q"){what="Qx";if(splitTypes&&dataType&&(dataType!="q"))makeShape(aCommand);dataType="q";}else if(command=="q"){what="qx";if(splitTypes&&dataType&&(dataType!="q"))makeShape(aCommand);dataType="q";}else if(command=="T"){adding=true;what="Qx";if(splitTypes&&dataType&&(dataType!="q"))makeShape(aCommand);dataType="q";}else if(command=="t"){adding=true;what="qx";if(splitTypes&&dataType&&(dataType!="q"))makeShape(aCommand);dataType="q";}else if(command=="A"){what="Ax";if(splitTypes&&dataType&&(dataType!="a"))makeShape();dataType="a";}else if(command=="a"){what="ax";if(splitTypes&&dataType&&(dataType!="a"))makeShape();dataType="a";}else if(command=="z"||command=="Z"){type="blob";}}});function makeShape(myCommand,interest){var myCommand;lastCommand=aCommand[aCommand.length-1];if(points.length>=2)
if(lastCommand=="z"||lastCommand=="Z"){type="blob";}
if(type=="squiggle")shape=new zim.Squiggle(s,ss,points,null,null,null,null,showControls,null,null,null,null,null,null,null,null,null,null,interactive);else shape=new zim.Blob(f,s,ss,points,null,null,null,null,showControls,null,null,null,null,null,null,null,null,null,null,interactive);shape.loc(0,0,that);lastCommand=aCommand[aCommand.length-1];previousCommand=aCommand[aCommand.length-2];if(commandsRelative.indexOf(lastCommand)>=0){lastTempPoint[0]=points[points.length-1][0];lastTempPoint[1]=points[points.length-1][1];startPosition.x=points[points.length-1][0];startPosition.y=points[points.length-1][1];points=[];points.push([lastTempPoint[0],lastTempPoint[1]]);}else{lastTempPoint=[0,0];points=[[0,0]];}
aCommand=[];if(lastCommand!="z"&&lastCommand!="Z")aCommand.push(lastCommand);position.x=0;position.y=0;var transform=path.getAttribute("transform");if(transform||currentTransform)processTransform(shape,transform||currentTransform);}
if(make)makeShape();return points;}
that.processPath=function(path){return processPath(path,false);};if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.SVGContainer(svg,splitTypes,geometric,showControls,interactive,style,this.group,inherit));};};zim.extend(zim.SVGContainer,zim.Container,"clone","zimContainer",false);zim.CustomShape=function(x,y,w,h){if(!zim.zimCustomShapeCheck){z_d("50.97");zim.zimCustomShapeCheck=true;}
this.zimContainer_constructor(x,y,w,h,false);var that=this;this.mouseChildren=false;that._dashedOffset=5;Object.defineProperty(that,'color',{get:function(){return that._color;},set:function(value){if(zot(value))value="black";that._color=value;if(value&&value.type)that.specialColor(that.colorCommand,value);else that.colorCommand.style=value;}});this.setColorRange=function(color1,color2){if(zot(color2)){that.startColor=that.color;that.endColor=color1;}else if(zot(color1)){that.startColor=that.color;that.endColor=color2;}else{that.startColor=color1;that.endColor=color2;}
return that;};that._colorRange=0;Object.defineProperty(that,'colorRange',{get:function(){return that._colorRange;},set:function(value){that._colorRange=value;if(!zot(that.startColor)&&!zot(that.endColor)){that.color=zim.colorRange(that.startColor,that.endColor,value);}}});Object.defineProperty(that,'borderColor',{get:function(){return that._borderColor;},set:function(value){that._borderColor=value;if(value&&!that.borderWidth){that.borderWidth=1;}
if(!that.borderColorCommand){that.drawShape();}
else if(value&&value.type)that.specialColor(that.borderColorCommand,value);else that.borderColorCommand.style=value;}});Object.defineProperty(that,'borderWidth',{get:function(){return that._borderWidth;},set:function(value){if(!(value>0))value=0;that._borderWidth=value;if(!that.borderWidthCommand||that._borderWidth==0){that.borderWidthCommand=null;that.drawShape();}
else{that.borderWidthCommand.width=that._borderWidth;if(that._dashed){that.borderDashedCommand.segments=that._dashed;that.borderDashedCommand.offset=that._dashedOffset;}}}});Object.defineProperty(that,'thickness',{get:function(){return that._thickness;},set:function(value){if(!(value>0))value=0;that._thickness=value;if(!that.thicknessCommand||that._thickness==0)that.drawShape();else{that.thicknessCommand.width=that._thickness;if(that._dashed){that.dashedCommand.segments=that._dashed;that.dashedCommand.offset=that._dashedOffset;}}}});Object.defineProperty(that,'dashed',{get:function(){return that._dashed;},set:function(value){that._dashed=value;if(value&&!Array.isArray(that._dashed))that.dashed=[10,10];if(that.type=="Squiggle"||that.type=="Line"){if(!that.thicknessCommand||that._thickness==0)return;var dashedCommand=that.dashedCommand;}else{if(!that.borderWidthCommand||that._borderWidth==0)return;var dashedCommand=that.borderDashedCommand;}
if(!dashedCommand){that.drawShape();}else{if(that._dashed){dashedCommand.segments=that._dashed;dashedCommand.offset=that._dashedOffset;}else{dashedCommand.segments=null;dashedCommand.offset=null;}}}});Object.defineProperty(that,'dashedOffset',{get:function(){return that._dashedOffset;},set:function(value){if(isNaN(value))value=5;that._dashedOffset=value;if(that.type=="Squiggle"||that.type=="Line"){if(!that.thicknessCommand||that._thickness==0)return;var dashedCommand=that.dashedCommand;}else{if(!that.borderWidthCommand||that._borderWidth==0)return;var dashedCommand=that.borderDashedCommand;}
if(!dashedCommand){that.drawShape();}else{if(that._dashed){dashedCommand.segments=that._dashed;dashedCommand.offset=that._dashedOffset;}else{dashedCommand.segments=null;dashedCommand.offset=null;}}}});Object.defineProperty(that,'corner',{get:function(){return that._corner;},set:function(value){that._corner=value;that.drawShape();}});this.linearGradient=function(colors,ratios,x0,y0,x1,y1){this.linearGradientParams=Array.prototype.slice.call(arguments);this.colorCommand.linearGradient(colors,ratios,x0,y0,x1,y1);return this;};this.radialGradient=function(colors,ratios,x0,y0,radius0,x1,y1,radius1){this.radialGradientParams=Array.prototype.slice.call(arguments);this.colorCommand.radialGradient(colors,ratios,x0,y0,radius0,x1,y1,radius1);return this;};this.cloneAll=function(exact,style,group,inherit){var currentBounds=this.getBounds();if(zot(currentBounds))currentBounds={x:null,y:null,width:null,height:null};var body=this.cloneChildren(this.cloneProps(new zim.Container(currentBounds.x,currentBounds.y,currentBounds.width,currentBounds.height,style,group,inherit)),exact);body.mouseChildren=false;body.type=this.type;return body;};};zim.extend(zim.CustomShape,zim.Container,null,"zimContainer",false);zim.Circle=function(radius,color,borderColor,borderWidth,dashed,percent,percentClose,strokeObj,style,group,inherit){var sig="radius, color, borderColor, borderWidth, dashed, percent, percentClose, strokeObj, style, group, inherit";var duo;if(duo=zob(zim.Circle,arguments,sig,this))return duo;z_d("51");this.zimCustomShape_constructor(null,null,null,null,false);this.type="Circle";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(radius))radius=DS.radius!=null?DS.radius:50;if(zot(dashed))dashed=DS.dashed!=null?DS.dashed:false;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:null;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(color))color=DS.color!=null?DS.color:(borderWidth>0?"rgba(0,0,0,0)":"black");if(zot(percent))percent=DS.percent!=null?DS.percent:100;if(zot(percentClose))percentClose=DS.percentClose!=null?DS.percentClose:true;if(zot(strokeObj))strokeObj=DS.strokeObj!=null?DS.strokeObj:{};var oa=remember(radius,color,borderColor,borderWidth,percent);function remember(){return arguments;}
radius=zim.Pick.choose(radius);color=zim.Pick.choose(color);borderColor=zim.Pick.choose(borderColor);borderWidth=zim.Pick.choose(borderWidth);percent=zim.Pick.choose(percent);var that=this;that._radius=radius;that._color=color;that._borderColor=borderColor;that._borderWidth=borderWidth;that._dashed=dashed;if(that._dashed&&!Array.isArray(that._dashed))that._dashed=[10,10];var circle=this.shape=new createjs.Shape();this.addChild(circle);var g=circle.graphics;that.drawShape=function(){g.c();that.colorCommand=g.f(that._color).command;if(that._color&&that._color.type)that.specialColor(that.colorCommand,that._color);if(zot(that._borderWidth)||that._borderWidth>0){if(!zot(that._borderColor)||!zot(that._borderWidth)){if(zot(that._borderColor))that._borderColor="black";that.borderColorCommand=g.s(that._borderColor).command;if(that._borderColor&&that._borderColor.type)that.specialColor(that.borderColorCommand,that._borderColor);that.borderWidthCommand=g.ss(that._borderWidth,strokeObj.caps,strokeObj.joints,strokeObj.miterLimit,strokeObj.ignoreScale).command;if(that._dashed)that.borderDashedCommand=g.sd(Array.isArray(that._dashed)?that._dashed:[10,10],that._dashedOffset).command;}}
var h=that._radius*2;if(typeof percent=="number"&&percent>=0&&percent<100){var p=360*percent/100/2;g.arc(0,0,that._radius,(-p-90)*Math.PI/180,(p-90)*Math.PI/180,false);if(percentClose)g.cp();h=that._radius-Math.cos(p*Math.PI/180)*that._radius;}else{g.dc(0,0,that._radius);}
that.setBounds(-that._radius,-that._radius,that._radius*2,h);};that.drawShape();Object.defineProperty(that,'radius',{get:function(){return that._radius;},set:function(value){that._radius=value;that.drawShape();}});Object.defineProperty(that,'percent',{get:function(){return percent;},set:function(value){percent=value;that.drawShape();}});Object.defineProperty(that,'percentClose',{get:function(){return percentClose;},set:function(value){percentClose=value;that.drawShape();}});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(exact,container){var newShape=that.cloneProps(new zim.Circle((exact||!zim.isPick(oa[0]))?that.radius:oa[0],(exact||!zim.isPick(oa[1]))?that.color:oa[1],(exact||!zim.isPick(oa[2]))?that.borderColor:oa[2],(exact||!zim.isPick(oa[3]))?that.borderWidth:oa[3],that.dashed,(exact||!zim.isPick(oa[4]))?percent:oa[4],percentClose,strokeObj,style,this.group,inherit));if(that.linearGradientParams)newShape.linearGradient.apply(newShape,that.linearGradientParams);if(that.radialGradientParams)newShape.radialGradient.apply(newShape,that.radialGradientParams);return newShape;};};zim.extend(zim.Circle,zim.CustomShape,"clone","zimCustomShape",false);zim.Rectangle=function(width,height,color,borderColor,borderWidth,corner,dashed,strokeObj,style,group,inherit){var sig="width, height, color, borderColor, borderWidth, corner, dashed, strokeObj, style, group, inherit";var duo;if(duo=zob(zim.Rectangle,arguments,sig,this))return duo;z_d("52");this.zimCustomShape_constructor(null,null,null,null,false);this.type="Rectangle";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:null;if(zot(height))height=DS.height!=null?DS.height:!zot(width)?width:100;if(zot(width))width=height;if(zot(corner))corner=DS.corner!=null?DS.corner:0;if(zot(dashed))dashed=DS.dashed!=null?DS.dashed:false;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:null;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(color))color=DS.color!=null?DS.color:(borderWidth>0?"rgba(0,0,0,0)":"black");if(zot(strokeObj))strokeObj=DS.strokeObj!=null?DS.strokeObj:{};var oa=remember(width,height,color,borderColor,borderWidth);function remember(){return arguments;}
width=zim.Pick.choose(width);height=zim.Pick.choose(height);color=zim.Pick.choose(color);borderColor=zim.Pick.choose(borderColor);borderWidth=zim.Pick.choose(borderWidth);var that=this;that._color=color;that._borderColor=borderColor;that._borderWidth=borderWidth;that._dashed=dashed;if(that._dashed&&!Array.isArray(that._dashed))that._dashed=[10,10];that._corner=corner;var rectangle=this.shape=new createjs.Shape();this.addChild(rectangle);var g=rectangle.graphics;that.drawShape=function(){g.c();that.colorCommand=g.f(that._color).command;if(color&&color.type)that.specialColor(that.colorCommand,color);if(zot(that._borderWidth)||that._borderWidth>0){if(!zot(that._borderColor)||!zot(that._borderWidth)){if(zot(that._borderColor))that._borderColor="black";that.borderColorCommand=g.s(that._borderColor).command;if(that._borderColor&&that._borderColor.type)that.specialColor(that.borderColorCommand,that._borderColor);that.borderWidthCommand=g.ss(that._borderWidth,strokeObj.caps,strokeObj.joints,strokeObj.miterLimit,strokeObj.ignoreScale).command;if(that._dashed)that.borderDashedCommand=g.sd(Array.isArray(that._dashed)?that._dashed:[10,10],that._dashedOffset).command;}}
if(Array.isArray(that._corner)){g.rc(0,0,width,height,that._corner[0],that._corner[1],that._corner[2],that._corner[3]);}else if(that._corner>0){g.rr(0,0,width,height,that._corner);}else{g.r(0,0,width,height);}
that.setBounds(0,0,width,height);};that.drawShape();if(style!==false)zim.styleTransforms(this,DS);this.clone=function(exact){var newShape=that.cloneProps(new zim.Rectangle((exact||!zim.isPick(oa[0]))?width:oa[0],(exact||!zim.isPick(oa[1]))?height:oa[1],(exact||!zim.isPick(oa[2]))?that.color:oa[2],(exact||!zim.isPick(oa[3]))?that.borderColor:oa[3],(exact||!zim.isPick(oa[4]))?that.borderWidth:oa[4],corner,that._dashed,strokeObj,style,this.group,inherit));return newShape;};};zim.extend(zim.Rectangle,zim.CustomShape,"clone","zimCustomShape",false);zim.Triangle=function(a,b,c,color,borderColor,borderWidth,corner,center,adjust,dashed,strokeObj,style,group,inherit){var sig="a, b, c, color, borderColor, borderWidth, corner, center, adjust, dashed, strokeObj, style, group, inherit";var duo;if(duo=zob(zim.Triangle,arguments,sig,this))return duo;z_d("53");this.zimCustomShape_constructor(null,null,null,null,false);this.type="Triangle";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(a))a=DS.a!=null?DS.a:100;if(zot(b))b=DS.b!=null?DS.b:a;if(zot(c))c=DS.c!=null?DS.c:b;if(c==-1)c=Math.sqrt(Math.pow(a,2)+Math.pow(b,2));if(zot(corner))corner=DS.corner!=null?DS.corner:0;if(zot(center))center=DS.center!=null?DS.center:true;if(zot(adjust))adjust=DS.adjust!=null?DS.adjust:0;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:null;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(color))color=DS.color!=null?DS.color:(borderWidth>0?"rgba(0,0,0,0)":"black");if(zot(adjust))adjust=DS.adjust!=null?DS.adjust:0;if(zot(strokeObj))strokeObj=DS.strokeObj!=null?DS.strokeObj:{};var oa=remember(a,b,c,color,borderColor,borderWidth);function remember(){return arguments;}
a=zim.Pick.choose(a);b=zim.Pick.choose(b);c=zim.Pick.choose(c);this.a=a;this.b=b;this.c=c;color=zim.Pick.choose(color);borderColor=zim.Pick.choose(borderColor);borderWidth=zim.Pick.choose(borderWidth);var that=this;that._color=color;that._borderColor=borderColor;that._borderWidth=borderWidth;that._dashed=dashed;if(that._dashed&&!Array.isArray(that._dashed))that._dashed=[10,10];that._corner=corner;var lines=[a,b,c];lines.sort(function(a,b){return b-a;});var aa=lines[0];var bb=lines[1];var cc=lines[2];var order=[lines.indexOf(a),lines.indexOf(b),lines.indexOf(c)];if(aa>bb+cc){zog("zim display - Triangle(): invalid triangle lengths");return;}
var tri=this.shape=new createjs.Shape();this.adjusted=adjust;this.addChild(tri);var g=tri.graphics;that.drawShape=function(){var corners=[];if(Array.isArray(that._corner))corners=that._corner;else corners.push(that._corner,that._corner,that._corner);for(var i=0;i<3;i++){if(corner[i]<0||typeof corner[i]!="number")corner[i]=0;}
g.c();that.colorCommand=g.f(that._color).command;if(that._color&&that._color.type)that.specialColor(that.colorCommand,that._color);if(zot(that._borderWidth)||that._borderWidth>0){if(!zot(that._borderColor)||!zot(that._borderWidth)){if(zot(that._borderColor))that._borderColor="black";that.borderColorCommand=g.s(that._borderColor).command;if(that._borderColor&&that._borderColor.type)that.specialColor(that.borderColorCommand,that._borderColor);that.borderWidthCommand=g.ss(that._borderWidth,strokeObj.caps,strokeObj.joints,strokeObj.miterLimit,strokeObj.ignoreScale).command;if(that._dashed)that.borderDashedCommand=g.sd(Array.isArray(that._dashed)?that._dashed:[10,10],that._dashedOffset).command;}}
that.one={x:0,y:0};that.two={x:a,y:0};var angle1=Math.acos((Math.pow(bb,2)+Math.pow(cc,2)-Math.pow(aa,2))/(2*bb*cc))*180/Math.PI;var angle2=Math.asin(bb*Math.sin(angle1*Math.PI/180)/aa)*180/Math.PI;var angle3=180-angle1-angle2;var temp=[angle1,angle2,angle3];that.angles=[temp[order[1]],temp[order[2]],temp[order[0]]];var nextAngle=that.angles[1];var backX=Math.cos(nextAngle*Math.PI/180)*b;var upY=Math.sin(nextAngle*Math.PI/180)*b;var width=Math.max(a,a-backX);var height=upY;that.setBounds(0,adjust,width,height);tri.y=height;that.three={x:a-backX,y:0-upY};var sX=a*corners[0]/((corners[0]+corners[1])||1);g.mt(sX,0).at(a,0,a-backX,0-upY,corners[1]).at(a-backX,0-upY,0,0,corners[2]).at(0,0,a,0,corners[0]).lt(sX,0);g.cp();if(center){that.regX=width/2;that.regY=height/2;}
if(adjust){that.shape.y+=adjust;}};that.drawShape();if(style!==false)zim.styleTransforms(this,DS);this.clone=function(exact){var newShape=that.cloneProps(new zim.Triangle((exact||!zim.isPick(oa[0]))?a:oa[0],(exact||!zim.isPick(oa[1]))?b:oa[1],(exact||!zim.isPick(oa[2]))?c:oa[2],(exact||!zim.isPick(oa[3]))?that.color:oa[3],(exact||!zim.isPick(oa[4]))?that.borderColor:oa[4],(exact||!zim.isPick(oa[5]))?that.borderWidth:oa[5],center,adjust,dashed,strokeObj,style,this.group,inherit));if(that.linearGradientParams)newShape.linearGradient.apply(newShape,that.linearGradientParams);if(that.radialGradientParams)newShape.radialGradient.apply(newShape,that.radialGradientParams);return newShape;};};zim.extend(zim.Triangle,zim.CustomShape,"clone","zimCustomShape");zim.Poly=function(radius,sides,pointSize,color,borderColor,borderWidth,dashed,strokeObj,style,group,inherit){var sig="radius, sides, pointSize, color, borderColor, borderWidth, dashed, strokeObj, style, group, inherit";var duo;if(duo=zob(zim.Poly,arguments,sig,this))return duo;z_d("53.1");this.zimCustomShape_constructor(null,null,null,null,false);this.type="Poly";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(radius))radius=DS.radius!=null?DS.radius:50;if(zot(sides))sides=DS.sides!=null?DS.sides:5;if(zot(pointSize))pointSize=DS.pointSize!=null?DS.pointSize:0;if(zot(dashed))dashed=DS.dashed!=null?DS.dashed:false;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:null;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(color))color=DS.color!=null?DS.color:(borderWidth>0?"rgba(0,0,0,0)":"black");if(zot(strokeObj))strokeObj=DS.strokeObj!=null?DS.strokeObj:{};var oa=remember(radius,sides,pointSize,color,borderColor,borderWidth);function remember(){return arguments;}
radius=zim.Pick.choose(radius);sides=zim.Pick.choose(sides);pointSize=zim.Pick.choose(pointSize);color=zim.Pick.choose(color);borderColor=zim.Pick.choose(borderColor);borderWidth=zim.Pick.choose(borderWidth);var that=this;that._radius=radius;that._color=color;that._sides=sides;that._pointSize=pointSize;that._borderColor=borderColor;that._borderWidth=borderWidth;that._dashed=dashed;if(that._dashed&&!Array.isArray(that._dashed))that._dashed=[10,10];var poly=this.shape=new createjs.Shape();this.addChild(poly);poly.rotation=-90;var g=poly.graphics;that.drawShape=function(){g.c();that.colorCommand=g.f(that._color).command;if(that._color&&that._color.type)that.specialColor(that.colorCommand,that._color);if(zot(that._borderWidth)||that._borderWidth>0){if(!zot(that._borderColor)||!zot(that._borderWidth)){if(zot(that._borderColor))that._borderColor="black";that.borderColorCommand=g.s(that._borderColor).command;if(that._borderColor&&that._borderColor.type)that.specialColor(that.borderColorCommand,that._borderColor);that.borderWidthCommand=g.ss(that._borderWidth,strokeObj.caps,strokeObj.joints,strokeObj.miterLimit,strokeObj.ignoreScale).command;if(that._dashed)that.borderDashedCommand=g.sd(Array.isArray(that._dashed)?that._dashed:[10,10],that._dashedOffset).command;}}
g.dp(0,0,that._radius,that._sides,that._pointSize);that.setBounds(-that._radius,-that._radius,that._radius*2,that._radius*2);};that.drawShape();Object.defineProperty(that,'radius',{get:function(){return that._radius;},set:function(value){that._radius=value;that.drawShape();}});Object.defineProperty(that,'sides',{get:function(){return that._sides;},set:function(value){that._sides=value;that.drawShape();}});Object.defineProperty(that,'pointSize',{get:function(){return that._pointSize;},set:function(value){that._pointSize=value;that.drawShape();}});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(exact,container){var newShape=that.cloneProps(new zim.Poly((exact||!zim.isPick(oa[0]))?that.radius:oa[0],(exact||!zim.isPick(oa[1]))?that.sides:oa[1],(exact||!zim.isPick(oa[2]))?that.pointSize:oa[2],(exact||!zim.isPick(oa[3]))?that.color:oa[3],(exact||!zim.isPick(oa[4]))?that.borderColor:oa[4],(exact||!zim.isPick(oa[5]))?that.borderWidth:oa[5],that.dashed,strokeObj,style,this.group,inherit));if(that.linearGradientParams)newShape.linearGradient.apply(newShape,that.linearGradientParams);if(that.radialGradientParams)newShape.radialGradient.apply(newShape,that.radialGradientParams);return newShape;};};zim.extend(zim.Poly,zim.CustomShape,"clone","zimCustomShape",false);zim.Line=function(length,thickness,color,startHead,endHead,dashed,strokeObj,lineType,lineOrientation,curveH,curveV,points,style,group,inherit){var sig="length, thickness, color, startHead, endHead, dashed, strokeObj, lineType, lineOrientation, curveH, curveV, points, style, group, inherit";var duo;if(duo=zob(zim.Line,arguments,sig,this))return duo;z_d("53.15");this.zimCustomShape_constructor(null,null,null,null,false);this.type="Line";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(length))length=DS.length!=null?DS.length:100;if(zot(dashed))dashed=DS.dashed!=null?DS.dashed:false;if(zot(thickness))thickness=DS.thickness!=null?DS.thickness:3;if(zot(color))color=DS.color!=null?DS.color:"black";if(zot(startHead))startHead=DS.startHead!=null?DS.startHead:null;if(zot(endHead))endHead=DS.endHead!=null?DS.endHead:null;if(zot(strokeObj))strokeObj=DS.strokeObj!=null?DS.strokeObj:{};if(zot(lineType))lineType=DS.lineType!=null?DS.lineType:"straight";if(lineType!=="corner"&&lineType!="curve")lineType="straight";if(zot(lineOrientation))lineOrientation=DS.lineOrientation!=null?DS.lineOrientation:"auto";if(lineOrientation!=="vertical"&&lineOrientation!="horizontal")lineOrientation="auto";if(zot(curveH))curveH=DS.curveH!=null?DS.curveH:20;if(zot(curveV))curveV=DS.curveV!=null?DS.curveV:20;if(zot(strokeObj))strokeObj=DS.strokeObj!=null?DS.strokeObj:{};var oa=remember(length,color,thickness,startHead,endHead);function remember(){return arguments;}
length=zim.Pick.choose(length);color=zim.Pick.choose(color);thickness=zim.Pick.choose(thickness);startHead=zim.Pick.choose(startHead);endHead=zim.Pick.choose(endHead);if(startHead&&startHead.clone)startHead=startHead.clone();if(endHead&&endHead.clone)endHead=endHead.clone();var that=this;that._length=length;that._color=color;that._thickness=thickness;that._dashed=dashed;if(that._dashed&&!Array.isArray(that._dashed))that._dashed=[10,10];that._startX=0;that._startY=0;that._endX=length;that._endY=0;that._startHead=startHead;that._endHead=endHead;that._points=points;that._lineOrientation=lineOrientation;that.angle=0;that.lineType=lineType;var startRegY;if(that._startHead)prepareHead("start",that._startHead);if(that._endHead)prepareHead("end",that._endHead);function prepareHead(type,head){if(head=="triangle"||head=="arrow"){var h=that["_"+type+"Head"]=new zim.Triangle(thickness*4,thickness*4,thickness*4,color);h.rotation=90;}else if(head=="circle"){that["_"+type+"Head"]=new zim.Circle(thickness*2.2,color);}
if(zot(that["_"+type+"Head"].startAngle))that["_"+type+"Head"].startAngle=that["_"+type+"Head"].rotation;}
startHead=that._startHead;endHead=that._endHead;if(startHead&&startHead.type=="Triangle")startHead.startRegY=startHead.regY;if(endHead&&endHead.type=="Triangle")endHead.startRegY=endHead.regY;var shape=this.shape=new createjs.Shape();this.addChild(shape);var g=shape.graphics;that.drawShape=function(arrowAdjustStart,arrowAdjustEnd){g.c();that.colorCommand=g.s(that._color).command;if(color&&color.type)that.specialColor(that.colorCommand,color);that.thicknessCommand=g.ss(that._thickness,strokeObj.caps,strokeObj.joints,strokeObj.miterLimit,strokeObj.ignoreScale).command;if(that._dashed){that.dashedCommand=g.sd(Array.isArray(that._dashed)?that._dashed:[10,10],that._dashedOffset).command;}
var startArrowGuide;var endArrowGuide;if(that._points){var start=that._points[0];that._startX=start[0];that._startY=start[1];var endPoint=that._points[that._points.length-1];var end=[endPoint[endPoint.length-2],endPoint[endPoint.length-1]];that._endX=end[0];that._endY=end[1];g.mt(start[0],start[1]);for(var i=1;i<that._points.length;i++){var point=that._points[i];if(i==1)startArrowGuide=[that._startX,that._startY,point[0],point[1]];if(point.length==2)g.lt(point[0],point[1]);else if(point.length==4)g.qt(point[0],point[1],point[2],point[3]);else if(point.length==6)g.bt(point[0],point[1],point[2],point[3],point[4],point[5]);}
if(point.length>=4){endArrowGuide=[point[point.length-4],point[point.length-3],that._endX,that._endY];}else{var penPoint=that._points[that._points.length-2];endArrowGuide=[penPoint[penPoint.lenth-2],penPoint[penPoint.lenth-1],that._endX,that._endY];}}else{var sX=that._startX;var sY=that._startY;var eX=that._endX;var eY=that._endY;if(that.lineType=="straight"){if(startHead&&startHead.type=="Triangle"){startHead.regY=0;var d=zim.dist(sX,sY,eX,eY);if(d!=0)sX=sX+that._startHead.height/2*(eX-sX)/d;if(d!=0)sY=sY+that._startHead.height/2*(eY-sY)/d;}
if(endHead&&endHead.type=="Triangle"){endHead.regY=0;var d=zim.dist(sX,sY,eX,eY);if(d!=0)eX=eX-that._endHead.height/2*(eX-sX)/d;if(d!=0)eY=eY-that._endHead.height/2*(eY-sY)/d;}}else{if(arrowAdjustStart){if(that._lineOrientation=="horizontal"||that.autoOrientation=="horizontal"){if(startHead&&startHead.type=="Triangle"){startHead.regY=0;if(eX>sX){sX=Math.min(eX,sX+that._startHead.height/2);}else{sX=Math.max(eX,sX-that._startHead.height/2);}}}else{if(startHead&&startHead.type=="Triangle"){startHead.regY=0;if(eY>sY){sY=Math.min(eY,sY+that._startHead.height/2);}else{sY=Math.max(eY,sY-that._startHead.height/2);}}}}else{if(startHead&&startHead.type=="Triangle")startHead.regY=startHead.startRegY;}
if(arrowAdjustEnd){if(that._lineOrientation=="horizontal"||that.autoOrientation=="horizontal"){if(endHead&&endHead.type=="Triangle"){endHead.regY=0;if(eX>sX)eX-=that._endHead.height/2;else eX+=that._endHead.height/2;}}else{if(endHead&&endHead.type=="Triangle"){endHead.regY=0;if(eY>sY)eY-=that._endHead.height/2;else eY+=that._endHead.height/2;}}}else{if(endHead&&endHead.type=="Triangle")endHead.regY=endHead.startRegY;}}
if(that.lineType=="straight"){g.mt(sX,sY).lt(eX,eY);startArrowGuide=endArrowGuide=[sX,sY,eX,eY];}else if(that.lineType=="corner"){var midX=sX+(eX-sX)*.4;var midY=sY+(eY-sY)*.4;if(that._lineOrientation=="auto"){that.autoOrientation=(Math.abs(sX-eX)>Math.abs(sY-eY))?"horizontal":"vertical";}
if(that._lineOrientation=="horizontal"||that.autoOrientation=="horizontal"){startArrowGuide=endArrowGuide=[sX,sY,midX,sY];g.mt(sX,sY).lt(midX,sY).lt(midX,eY).lt(eX,eY);}else{startArrowGuide=endArrowGuide=[sX,sY,sX,midY];g.mt(sX,sY).lt(sX,midY).lt(eX,midY).lt(eX,eY);}}else{var hSign=(sX>eX)?-1:1;var vSign=(sY>eY)?-1:1;var nextX=sX;var nextY=sY;var distX=Math.abs(sX-eX);var distY=Math.abs(sY-eY);var curveX=Math.min(curveH,distX*.5);var curveY=Math.min(curveV,distY*.5);if(that._lineOrientation=="auto"){that.autoOrientation=(Math.abs(sX-eX)>Math.abs(sY-eY))?"horizontal":"vertical";}
if(that._lineOrientation=="horizontal"||that.autoOrientation=="horizontal"){var insideDistance=(distY-curveY*2);var outsideDistance=(distX-curveX*2)/2;g.mt(nextX,nextY);if(outsideDistance>0){nextX=nextX+outsideDistance*hSign;g.lt(nextX,nextY);}
var lastY=nextY;nextY=nextY+curveY*vSign;nextX=nextX+curveX*hSign;g.qt(nextX,lastY,nextX,nextY);startArrowGuide=endArrowGuide=[sX,sY,nextX,sY];if(insideDistance>0){nextY=nextY+insideDistance*vSign;g.lt(nextX,nextY);}
nextY=nextY+curveY*vSign;var lastX=nextX;nextX=nextX+curveX*hSign;g.qt(lastX,nextY,nextX,nextY);if(outsideDistance>0){nextX=nextX+outsideDistance*hSign;g.lt(nextX,nextY);}}else{var insideDistance=(distX-curveX*2);var outsideDistance=(distY-curveY*2)/2;g.mt(nextX,nextY);if(outsideDistance>0){nextY=nextY+outsideDistance*vSign;g.lt(nextX,nextY);}
var lastX=nextX;nextX=nextX+curveX*hSign;nextY=nextY+curveY*vSign;g.qt(lastX,nextY,nextX,nextY);startArrowGuide=endArrowGuide=[sX,sY,sX,nextY];if(insideDistance>0){nextX=nextX+insideDistance*hSign;g.lt(nextX,nextY);}
nextX=nextX+curveX*hSign;var lastY=nextY;nextY=nextY+curveY*vSign;g.qt(nextX,lastY,nextX,nextY);if(outsideDistance>0){nextY=nextY+outsideDistance*vSign;g.lt(nextX,nextY);}}}}
that.setBounds(Math.min(that._startX,that._endX),Math.min(that._startY,that._endY),Math.abs(that._startX-that._endX),Math.abs(that._startY-that._endY));that._length=Math.sqrt(Math.pow(that._startX-that._endX,2)+Math.pow(that._startY-that._endY,2));that.angle=Math.atan2(that._endY-that._startY,that._endX-that._startX)*180/Math.PI;if(that._startHead&&that._startHead.loc){that._startHead.loc(that._startX,that._startY,that);var startAngle=Math.atan2(startArrowGuide[3]-startArrowGuide[1],startArrowGuide[2]-startArrowGuide[0])*180/Math.PI;that._startHead.rotation=startAngle-180+that._startHead.startAngle;}
if(that._endHead&&that._endHead.loc){that._endHead.loc(that._endX,that._endY,that);var endAngle=Math.atan2(endArrowGuide[3]-endArrowGuide[1],endArrowGuide[2]-endArrowGuide[0])*180/Math.PI;that._endHead.rotation=endAngle+that._endHead.startAngle;}};that.drawShape();this.setPoints=function(a,b,c,d,arrowAdjustStart,arrowAdjustEnd){if(Array.isArray(a)&&zot(b)){that.points=a;return that;}else if(a&&!zot(a.x)){that._startX=zot(a.x)?that._startX:a.x;that._startY=zot(a.y)?that._startY:a.y;if(b){that._endX=zot(b.x)?that._endX:b.x;that._endY=zot(b.y)?that._endY:b.y;}}else{that._startX=zot(a)?that._startX:a;that._startY=zot(b)?that._startY:b;that._endX=zot(c)?that._endX:c;that._endY=zot(d)?that._endY:d;}
that.drawShape(arrowAdjustStart,arrowAdjustEnd);return that;};this.from=function(a,b){if(a&&!zot(a.x)){that._startX=zot(a.x)?that._startX:a.x;that._startY=zot(a.y)?that._startY:a.y;}else{that._startX=zot(a)?that._startX:a;that._startY=zot(b)?that._startY:b;}
that.drawShape();return that;};this.to=function(a,b){if(a&&!zot(a.x)){that._endX=zot(a.x)?that._endX:a.x;that._endY=zot(a.y)?that._endY:a.y;}else{that._endX=zot(a)?that._endX:a;that._endY=zot(b)?that._endY:b;}
that.drawShape();return that;};Object.defineProperty(that,'length',{get:function(){return that._length;},set:function(value){var s=that.length!=0?value/that.length:0;if(isNaN(s))return;var startScaleX=that.scaleX;var startScaleY=that.scaleY;that.scaleX*=s;that.scaleY*=s;var gStart=that.localToGlobal(that._startX,that._startY);var gEnd=that.localToGlobal(that._endX,that._endY);that.scaleX=startScaleX;that.scaleY=startScaleY;var lStart=that.globalToLocal(gStart.x,gStart.y);var lEnd=that.globalToLocal(gEnd.x,gEnd.y);that.setPoints(lStart,lEnd);}});Object.defineProperty(that,'startPoint',{get:function(){return new zim.Point(that._startX,that._startY);},set:function(value){that._startX=zot(value.x)?that._startX:value.x;that._startY=zot(value.y)?that._startY:value.y;that.drawShape();}});Object.defineProperty(that,'endPoint',{get:function(){return new zim.Point(that._endX,that._endY);},set:function(value){that._endX=zot(value.x)?that._endX:value.x;that._endY=zot(value.y)?that._endY:value.y;that.drawShape();}});Object.defineProperty(that,'startHead',{get:function(){return that._startHead;},set:function(value){that._startHead=value;that.drawShape();}});Object.defineProperty(that,'endHead',{get:function(){return that._endHead;},set:function(value){that._endHead=value;that.drawShape();}});Object.defineProperty(that,'startX',{get:function(){return that._startX;},set:function(value){that._startX=value||0;that.drawShape();}});Object.defineProperty(that,'startY',{get:function(){return that._startY;},set:function(value){that._startY=value||0;that.drawShape();}});Object.defineProperty(that,'endX',{get:function(){return that._endX;},set:function(value){that._endX=value||0;that.drawShape();}});Object.defineProperty(that,'endY',{get:function(){return that._endY;},set:function(value){that._endY=value||0;that.drawShape();}});Object.defineProperty(that,'points',{get:function(){return that._points;},set:function(value){if(!value)return;that._points=value;that.drawShape();}});Object.defineProperty(that,'lineOrientation',{get:function(){return that._lineOrientation;},set:function(value){if(!value)return;that._lineOrientation=value;that.drawShape();}});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(exact,container){var startH=(exact||!zim.isPick(oa[3]))?that._startHead:oa[3];if(startH){if(startH.clone){startH=startH.clone();startH.rotation=that._startHead.startAngle;}}
var endH=(exact||!zim.isPick(oa[4]))?that._endHead:oa[4];if(endH){if(endH.clone){endH=endH.clone();endH.rotation=that._endHead.startAngle;}}
var newShape=that.cloneProps(new zim.Line((exact||!zim.isPick(oa[0]))?that.length:oa[0],(exact||!zim.isPick(oa[2]))?that.thickness:oa[2],(exact||!zim.isPick(oa[1]))?that.color:oa[1],startH,endH,that.dashed,strokeObj,lineType,that._lineOrientation,curveH,curveV,zim.copy(points),style,this.group,inherit));if(that.points)newShape.setPoints(that.points);else newShape.setPoints(that._startX,that._startY,that._endX,that._endY);if(that.linearGradientParams)newShape.linearGradient.apply(newShape,that.linearGradientParams);if(that.radialGradientParams)newShape.radialGradient.apply(newShape,that.radialGradientParams);return newShape;};};zim.extend(zim.Line,zim.CustomShape,"clone","zimCustomShape",false);zim.Squiggle=function(color,thickness,points,length,controlLength,controlType,lockControlType,showControls,lockControls,handleSize,allowToggle,move,dashed,onTop,stickColor,selectColor,selectPoints,editPoints,interactive,strokeObj,style,group,inherit){var sig="color, thickness, points, length, controlLength, controlType, lockControlType, showControls, lockControls, handleSize, allowToggle, move, dashed, onTop, stickColor, selectColor, selectPoints, editPoints, interactive, strokeObj, style, group, inherit";var duo;if(duo=zob(zim.Squiggle,arguments,sig,this))return duo;z_d("53.2");this.group=group;var DS=style===false?{}:zim.getStyle("Squiggle",this.group,inherit);if(zot(thickness))thickness=DS.thickness!=null?DS.thickness:6;if(zot(length))length=DS.length!=null?DS.length:300;if(zot(points))points=DS.points!=null?DS.points:5;if(typeof points=="string"){var svgProcessor=new zim.SVGContainer();points=svgProcessor.processPath(points);}
var num=typeof points=="number"?points:points.length;if(num==0)return;if(zot(controlLength))controlLength=DS.controlLength!=null?DS.controlLength:(length/num);this.zimCustomShape_constructor(length,controlLength,null,null,false);this.type="Squiggle";this.mouseChildren=true;if(zot(dashed))dashed=DS.dashed!=null?DS.dashed:false;if(zot(color))color=DS.color!=null?DS.color:zim.blue;if(color.style){this.colorCommand=color;color="black";}
if(zot(controlType))controlType=DS.controlType!=null?DS.controlType:null;var originalControlType=controlType;if(zot(controlType))controlType="mirror";if(zot(lockControlType))lockControlType=DS.lockControlType!=null?DS.lockControlType:false;if(zot(interactive))interactive=DS.interactive!=null?DS.interactive:true;if(zot(showControls))showControls=DS.showControls!=null?DS.showControls:interactive;var _controls=showControls;if(zot(lockControls))lockControls=DS.lockControls!=null?DS.lockControls:!interactive;if(zot(handleSize))handleSize=DS.handleSize!=null?DS.handleSize:zim.mobile()?20:10;if(zot(allowToggle))allowToggle=DS.allowToggle!=null?DS.allowToggle:interactive;if(zot(move))move=DS.move!=null?DS.move:interactive;if(zot(stickColor))stickColor=DS.stickColor!=null?DS.stickColor:"#111";if(zot(selectColor))selectColor=DS.selectColor!=null?DS.selectColor:"#fff";if(zot(selectPoints))selectPoints=DS.selectPoints!=null?DS.selectPoints:interactive;this.stickColor=stickColor;if(zot(onTop))onTop=DS.onTop!=null?DS.onTop:true;if(zot(editPoints))editPoints=DS.editPoints!=null?DS.editPoints:interactive;if(zot(strokeObj))strokeObj=DS.strokeObj!=null?DS.strokeObj:{};var oa=remember(color);function remember(){return arguments;}
color=zim.Pick.choose(color);var that=this;var stage;var types=this.types=["mirror","straight","free","none"];this.interactive=interactive;this.num=num;this.onTop=onTop;this.move=move;this.editPoints=editPoints;this.allowToggle=allowToggle;this.lockControlType=lockControlType;this.selectPoints=selectPoints;this.lockControls=lockControls;var _points;var _pointCircles;var _pointControls;that._color=color;that._thickness=thickness;that._dashed=dashed;if(that._dashed&&!Array.isArray(that._dashed))that._dashed=[10,10];var shape;var moveDownEvent;var movePressEvent;var moveUpEvent;var draggingCheck=that.move;var min=2;var mapMove;var sets;if(originalControlType&&typeof points!="number"){zim.loop(points,function(point){point[8]=originalControlType;if(originalControlType=="none"){point[4]=point[5]=point[6]=point[7]=0;}});}
init();function init(){if(sets)sets.removeAllEventListeners();that.num=num=typeof points=="number"?points:points.length;num=Math.max(2,num);controlLength=length/num;shape=that.shape=new zim.Shape({style:false}).addTo(that);var sticks=that.sticks=new zim.Shape({style:false}).addTo(that);if(handleSize<=0)sticks.removeFrom();var g=shape.graphics;g.c();var s=sticks.graphics;s.c();var ballS=handleSize/10*8;var rectS=handleSize;if(that.selectPoints){that.selectedBalls=new zim.SelectionSet();that.selectedRect1s=new zim.SelectionSet();that.selectedRect2s=new zim.SelectionSet();that.selectionManager=new zim.SelectionManager([that.selectedBalls,that.selectedRect1s,that.selectedRect2s],"ctrl",false);}else{that.selectionManager=new zim.SelectionManager(null,"ctrl");}
var mobile=zim.mobile();sets=that.controls=new zim.Container({style:false}).addTo(that);if(that.interactive)sets.drag({onTop:!mobile});_points=[];_pointControls=[];_pointCircles=[];var angle,point,temp,set,rect1,rect2,ball,type,setInfo;for(var i=0;i<num;i++){set=new zim.Container({style:false}).addTo(sets);set.num=i;if(typeof points=="number"){var stickLength=zim.Pick.choose(controlLength);temp=new zim.Container(stickLength,thickness,null,null,false).addTo(that).loc({x:i*length/(num-1)-stickLength/2,y:i%2*stickLength});ball=new zim.Circle(ballS,that.selectPoints&&that.selectedBalls.isSelected(i)?selectColor:zim.light,zim.dark,2,null,null,null,null,false).centerReg(temp).loc({x:stickLength/2,y:0});rect1=new zim.Rectangle(rectS,rectS,that.selectPoints&&that.selectedRect1s.isSelected(i)?selectColor:getBackgroundColor(controlType),handleSize==0?null:zim.dark,handleSize==0?null:2,null,null,null,false).centerReg(temp).loc({x:0,y:0});rect2=new zim.Rectangle(rectS,rectS,that.selectPoints&&that.selectedRect2s.isSelected(i)?selectColor:getBackgroundColor(controlType),handleSize==0?null:zim.dark,handleSize==0?null:2,null,null,null,false).centerReg(temp).loc({x:stickLength,y:0});var ballPoint=temp.localToLocal(ball.x,ball.y,sets);ball.x=ballPoint.x;ball.y=ballPoint.y;ball.addTo(set,null,false);var rect1Point=temp.localToLocal(rect1.x,rect1.y,sets);rect1.x=controlType=="none"?0:rect1Point.x-ball.x;rect1.y=controlType=="none"?0:rect1Point.y-ball.y;rect1.addTo(set,null,false);var rect2Point=temp.localToLocal(rect2.x,rect2.y,sets);rect2.x=controlType=="none"?0:rect2Point.x-ball.x;rect2.y=controlType=="none"?0:rect2Point.y-ball.y;rect2.addTo(set,null,false);set.x=ball.x;set.y=ball.y;ball.x=0;ball.y=0;if(controlType=="none")ball.addTo(set,null,false);}else{setInfo=points[i];type=setInfo[8]?setInfo[8]:controlType;set.loc({x:setInfo[0],y:setInfo[1]});ball=new zim.Circle(ballS,zim.light,zim.dark,2,null,null,null,null,false).centerReg({add:false}).addTo(set).loc({x:setInfo[2],y:setInfo[3]});rect1=new zim.Rectangle(rectS,rectS,getBackgroundColor(type),handleSize==0?null:zim.dark,handleSize==0?null:2,null,null,null,false).centerReg({add:false}).addTo(set,0).loc({x:setInfo[4],y:setInfo[5]});rect2=new zim.Rectangle(rectS,rectS,getBackgroundColor(type),handleSize==0?null:zim.dark,handleSize==0?null:2,null,null,null,false).centerReg({add:false}).addTo(set,0).loc({x:setInfo[6],y:setInfo[7]});}
ball.mySet=set;ball.rect1=rect1;ball.rect2=rect2;ball.index=i;if(mobile){ball.on("mousedown",mobileDouble);}else{ball.on("dblclick",doubleIt);}
rect1.ball=ball;rect1.other=rect2;rect2.ball=ball;rect2.other=rect1;if(handleSize==0){ball.expand(10);rect1.expand(10);rect2.expand(10);}
if(mobile){ball.expand();rect1.expand();rect2.expand();}
point=[set,ball,rect1,rect2,setInfo?setInfo[8]:controlType];_points.push(point);_pointCircles.push(ball);_pointControls.push(set);}
var tappedTwice=false;function mobileDouble(e){if(!tappedTwice){tappedTwice=true;setTimeout(function(){tappedTwice=false;},300);}else{e.preventDefault();doubleIt(e);}}
function doubleIt(e){if(that.lockControlType)return;var ball=e.target;var type=_points[ball.index][4]?_points[ball.index][4]:controlType;if(Math.abs(ball.rect1.x)<=2&&Math.abs(ball.rect1.y)<=2&&Math.abs(ball.rect2.x)<=2&&Math.abs(ball.rect2.y)<=2){type="none";}
if(type=="none"){ball.parent.addChildAt(ball,0);}
type=that.types[(that.types.indexOf(type)+(that.shiftKey?-1:1)+that.types.length)%that.types.length];if(type=="none"){ball.rect1.x=ball.rect1.y=ball.rect2.x=ball.rect2.y=0;ball.parent.addChild(ball);e.stopImmediatePropagation();}
_points[ball.index][4]=type;ball.rect1.color=getBackgroundColor(type);ball.rect2.color=getBackgroundColor(type);that.drawShape();var ev=new createjs.Event("change");ev.controlType="bezierSwitch";that.dispatchEvent(ev);ball.stage.update();}
function getBackgroundColor(type){var colors={straight:zim.pink,free:zim.yellow,none:zim.blue};return colors[type]?colors[type]:zim.purple;}
that.drawShape=function(){g.c();var minThickness=zim.mobile()?10:6;if(thickness<minThickness){g.s("rgba(0,0,0,.01)").ss(minThickness);var set=_points[0][0];var ballPoint=set.localToLocal(_points[0][1].x,_points[0][1].y,shape);g.mt(ballPoint.x,ballPoint.y);var currentIndex;var nextIndex;for(var i=0;i<_points.length;i++){var currentIndex=i;var nextIndex=(i+1)%_points.length;var set=_points[currentIndex][0];var ball=_points[currentIndex][1];var control1=_points[currentIndex][2];var control2=_points[currentIndex][3];var nextSet=_points[nextIndex][0];var nextBall=_points[nextIndex][1];var nextControl1=_points[nextIndex][2];var nextControl2=_points[nextIndex][3];var control2Point=set.localToLocal(control2.x,control2.y,shape);var nextControl1Point=nextSet.localToLocal(nextControl1.x,nextControl1.y,shape);var nextBallPoint=nextSet.localToLocal(nextBall.x,nextBall.y,shape);if(i!=_points.length-1){g.bt(control2Point.x,control2Point.y,nextControl1Point.x,nextControl1Point.y,nextBallPoint.x,nextBallPoint.y);}}}
if(!that.colorCommand){that.colorCommand=g.s(that._color).command;if(color&&color.type)that.specialColor(that.colorCommand,color);}
if(!that.thicknessCommand)that.thicknessCommand=g.ss(that._thickness,strokeObj.caps,strokeObj.joints,strokeObj.miterLimit,strokeObj.ignoreScale).command;if(that._dashed){if(!that.dashedCommand)that.dashedCommand=g.sd(Array.isArray(that._dashed)?that._dashed:[10,10],that._dashedOffset).command;}
set=_points[0][0];ballPoint=set.localToLocal(_points[0][1].x,_points[0][1].y,shape);g.mt(ballPoint.x,ballPoint.y);s.c().s(that.stickColor).ss(1);var currentIndex;var nextIndex;for(var i=0;i<_points.length;i++){var currentIndex=i;var nextIndex=(i+1)%_points.length;var set=_points[currentIndex][0];var ball=_points[currentIndex][1];var control1=_points[currentIndex][2];var control2=_points[currentIndex][3];var nextSet=_points[nextIndex][0];var nextBall=_points[nextIndex][1];var nextControl1=_points[nextIndex][2];var nextControl2=_points[nextIndex][3];var control2Point=set.localToLocal(control2.x,control2.y,shape);var nextControl1Point=nextSet.localToLocal(nextControl1.x,nextControl1.y,shape);var nextBallPoint=nextSet.localToLocal(nextBall.x,nextBall.y,shape);if(i!=_points.length-1){g.bt(control2Point.x,control2Point.y,nextControl1Point.x,nextControl1Point.y,nextBallPoint.x,nextBallPoint.y);}
var ballPoint=set.localToLocal(ball.x,ball.y,shape);var control1Point=set.localToLocal(control1.x,control1.y,shape);if(i==0)control1.visible=0;if(i!=0)s.mt(ballPoint.x,ballPoint.y).lt(control1Point.x,control1Point.y);if(i!=_points.length-1)s.mt(ballPoint.x,ballPoint.y).lt(control2Point.x,control2Point.y);if(i==_points.length-1)control2.visible=0;}
if(that._dashed)g.append(that.dashedCommand);g.append(that.thicknessCommand);g.append(that.colorCommand);};that.drawShape();var startPosition;sets.on("mousedown",function(e){stage=e.target.stage;if(that.lockControls)return;if(that.selectPoints)that.keyFocus=true;startPosition={x:e.target.x,y:e.target.y};if(e.target.rect1){var ball=e.target;ball.startX=ball.x;ball.startY=ball.y;ball.rect1.startX=ball.rect1.x;ball.rect1.startY=ball.rect1.y;ball.rect2.startX=ball.rect2.x;ball.rect2.startY=ball.rect2.y;}else{var rect=e.target;rect.startX=rect.x;rect.startY=rect.y;var ball=rect.ball;var index=ball.index;var type=controlType;if(!zot(_points[index][4]))type=_points[index][4];if(type=="straight"){var other=rect.other;var dX=other.x-ball.x;var dY=other.y-ball.y;other.stickLength=Math.sqrt(Math.pow(dX,2)+Math.pow(dY,2));}}
if(that.selectPoints){var currentSet=that.selectionManager.currentSet;if(currentSet&&currentSet.selections&&currentSet.selections.length>0){for(var i=0;i<currentSet.selections.length;i++){var point=that.pointObjects[currentSet.selections[i]];point[1].startX=point[1].x;point[1].startY=point[1].y;point[2].startX=point[2].x;point[2].startY=point[2].y;point[3].startX=point[3].x;point[3].startY=point[3].y;}}}});if(that.selectPoints){sets.tap(function(e){if(e.target.rect1){var ball=e.target;that.selectedBalls.toggle(ball.parent.num);}else{var rect=e.target;rect.color="white";var ball=rect.ball;if(ball.rect1==rect)that.selectedRect1s.toggle(ball.parent.num);else that.selectedRect2s.toggle(ball.parent.num);}
for(var i=0;i<that.pointObjects.length;i++){var po=that.pointObjects[i];po[1].color=that.selectedBalls.isSelected(i)?zim.white:zim.light;po[2].color=that.selectedRect1s.isSelected(i)?zim.white:getBackgroundColor(po[4]);po[3].color=that.selectedRect2s.isSelected(i)?zim.white:getBackgroundColor(po[4]);}
stage.update();});}
sets.on("pressmove",function(e){if(that.lockControls)return;if(that.selectPoints){var currentSelected=getCurrentSelected();if(currentSelected.indexOf(e.target)==-1){mapMove(e.target);that.drawShape();}else{if(currentSelected.length>0){var diffX=e.target.x-e.target.startX;var diffY=e.target.y-e.target.startY;for(var i=0;i<currentSelected.length;i++){var pointObj=currentSelected[i];pointObj.x=pointObj.startX+diffX;pointObj.y=pointObj.startY+diffY;mapMove(pointObj);}
that.drawShape();}}}else{mapMove(e.target);that.drawShape();}});sets.on("pressup",function(e){if(that.lockControls)return;var moveControlCheck=(e.target.x!=startPosition.x||e.target.y!=startPosition.y);var ev=new createjs.Event("change");if(e.target.rect1){ev.controlType="bezierPoint";endMove(e.target);}else{ev.controlType="bezierHandle";}
if(moveControlCheck)that.dispatchEvent(ev);});function endMove(target){if(that.selectPoints){var currentSelected=getCurrentSelected();if(currentSelected&&currentSelected.indexOf(target)==-1){replaceControls(target);}else if(currentSelected&&currentSelected.length>0){for(var i=0;i<currentSelected.length;i++){replaceControls(currentSelected[i]);}}else{replaceControls(target);}}else{replaceControls(target);}}
that.changeControl=function(index,type,rect1X,rect1Y,rect2X,rect2Y,circleX,circleY,update){var sig="index, type, rect1X, rect1Y, rect2X, rect2Y, circleX, circleY, update";var duo;if(duo=zob(that.changeControl,arguments,sig))return duo;if(zot(index)){for(var i=0;i<_points.length;i++){that.changeControl(i,type,rect1X,rect1Y,rect2X,rect2Y,circleX,circleY);}
return;}
var point=_points[index];point[4]=type;if(type=="none"){if(!zot(circleX))point[2].x=circleX;if(!zot(circleY))point[2].y=circleY;point[2].x=point[1].x;point[2].y=point[1].y;point[3].x=point[1].x;point[3].y=point[1].y;point[1].parent.addChild(point[1]);}else{if(!zot(rect1X))point[2].x=rect1X;if(!zot(rect1Y))point[2].y=rect1Y;if(!zot(rect2X))point[3].x=rect2X;if(!zot(rect2Y))point[3].y=rect2Y;if(!zot(circleX))point[1].x=circleX;if(!zot(circleY))point[1].y=circleY;point[1].parent.addChildAt(point[1],0);}
if(update){that.update();if(stage)stage.update();}};that.transformPoints=function(transformType,amount,x,y){that.points=zim.transformPoints(that.points,transformType,amount,x,y);return that;};that.traverse=function(obj,start,end,time){var ratios=zim.copy(that.segmentRatios);ratios.unshift(0);if(zot(end))end=start+1;var forward=start<end;if(forward){var startPercent=ratios[start]*100;var endPercent=ratios[end]*100;}else{var startPercent=50+(100-ratios[start]*100)/2;var endPercent=50+(100-ratios[end]*100)/2;}
obj.percentComplete=obj.zimStartPercent=startPercent;obj.animate({ease:"linear",props:{path:that},rewind:!forward,time:time,events:true});obj.on("animation",function(e){if(obj.percentComplete>endPercent||obj.percentComplete==0){obj.stopAnimate();e.remove();var eventObj=new createjs.Event("traversed");eventObj.obj=obj;that.dispatchEvent(eventObj);}});return that;};that.update=function(normalize){if(normalize){that.points=that.pointsAdjusted;}else{that.drawShape();}
that.zimAnimateChanged=true;return that;};if(that.interactive){if(move)shape.drag({onTop:false});moveDownEvent=shape.on("mousedown",function(e){stage=e.target.stage;startPosition={x:shape.x,y:shape.y};if(that.selectPoints)that.keyFocus=true;upTop();});movePressEvent=shape.on("pressmove",function(){sets.x=shape.x;sets.y=shape.y;sticks.x=shape.x;sticks.y=shape.y;});moveUpEvent=shape.on("pressup",function(){var moveControlCheck=(shape.x!=startPosition.x||shape.y!=startPosition.y);var movePoint=shape.localToLocal(that.regX,that.regY,that.parent);that.x=movePoint.x;that.y=movePoint.y;sets.x=sets.y=sticks.x=sticks.y=shape.x=shape.y=0;if(moveControlCheck){var ev=new createjs.Event("change");ev.controlType="move";that.dispatchEvent(ev);}
if(stage)stage.update();});if(!that.move)stopDragging(true);}
function upTop(){if(that.onTop){var nc=that.parent.numChildren-1;if(that.parent.getChildAt(nc).type=="Keyboard")nc--;that.parent.setChildIndex(that,nc);}}
that.toggleEvent=that.on("mousedown",function(){if(!that.allowToggle)return;if(!_controls){that.showControls();that.dispatchEvent("controlsshow");}});that.added(function(){stage=that.stage;if(that.toggleStageEvent)stage.off("stagemousedown",that.toggleStageEvent);that.toggleStageEvent=stage.on("stagemousedown",function(e){if(!that.allowToggle||!that.stage)return;if(_controls&&!that.hitTestPoint(e.stageX/zim.scaX,e.stageY/zim.scaY,false)){that.hideControls();that.dispatchEvent("controlshide");}});});that.clickEvent=that.on("click",function(){if(that.ctrlKey){setTimeout(function(){that.clone(true).addTo(that.stage).mov(0,100);if(that.allowToggle){that.hideControls();that.dispatchEvent("controlshide");}
var ev=new createjs.Event("change");ev.controlType="move";that.dispatchEvent(ev);that.stage.update();},50);}});that.hideControls=function(){that.toggled=false;sets.visible=false;sticks.visible=false;_controls=false;if(that.stage)that.stage.update();if(!that.allowToggle&&that.move)stopDragging();return that;};if(!showControls)that.hideControls();that.showControls=function(){that.toggled=true;sets.visible=true;sticks.visible=true;_controls=true;sets.x=shape.x;sets.y=shape.y;sticks.x=shape.x;sticks.y=shape.y;that.addChildAt(shape,0);if(that.move&&!that.allowToggle)startDragging();if(that.stage)that.stage.update();return that;};that.toggle=function(state){if(state===true)that.showControls();else if(state===false)that.hideControls();else if(_controls)that.hideControls();else that.showControls();return that;};that.recordData=function(toJSON){if(zot(toJSON))toJSON=false;var obj={type:"Blob",index:that.parent?that.parent.getChildIndex(that):-1,x:that.x,y:that.y,points:that.recordPoints(),color:that.color,thickness:that.thickness,move:that.move,toggle:that.allowToggle,controlsVisible:_controls};if(toJSON)return JSON.stringify(obj);return obj;};that.setData=function(data,fromJSON){if(zot(data))return;if(fromJSON){try{data=JSON.parse(data);}catch(e){return;}}
var index=data.index;if(zot(index))index=-1;delete data.index;var pointData=data.points;if(!zot(pointData))that.setPoints(pointData);delete data.points;that.num=pointData.length;for(var d in data){that[d]=data[d];}
if(that.parent){that.parent.setChildIndex(that,index);}
that.update();return that;};that.recordPoints=function(popup){if(zot(popup))popup=false;var points=that.points;if(popup){if(!that.pane){var pane=that.pane=new zim.Pane({container:that.stage,width:Math.min(500,that.stage.width-20),height:Math.min(500,that.stage.height-20),draggable:true,});var textArea=that.textArea=new zim.TextArea(Math.min(400,that.stage.width-70),Math.min(400,that.stage.height-70));textArea.centerReg(pane);}
that.textArea.text=JSON.stringify(points);that.pane.show();}
return points;};that.setPoints=function(points){var p;var p2;for(var i=0;i<points.length;i++){p=_points[i];p2=points[i];if(zot(p))continue;p[0].x=p2[0];p[0].y=p2[1];p[1].x=p2[2];p[1].y=p2[3];p[2].x=p2[4];p[2].y=p2[5];p[3].x=p2[6];p[3].y=p2[7];p[4]=p2[8];}
that.update();return that;};if(style!==false)zim.styleTransforms(that,DS);that.clone=function(exact,commands){var newShape=that.cloneProps(new zim.Squiggle(commands?that.colorCommand:((exact||!zim.isPick(oa[0]))?that.color:oa[0]),that.thickness,that.recordPoints(),length,controlLength,controlType,lockControlType,sets.visible,lockControls,handleSize,that.allowToggle,that.move,dashed,onTop,stickColor,selectColor,selectPoints,that.editPoints,interactive,strokeObj,style,that.group,inherit));if(that.linearGradientParams)newShape.linearGradient.apply(newShape,that.linearGradientParams);if(that.radialGradientParams)newShape.radialGradient.apply(newShape,that.radialGradientParams);return newShape;};that.shape.on("mousedown",function(e){stage=e.target.stage;if(!that.editPoints)return;if(that.controlsVisible){that.pressX=e.stageX/zim.scaX;that.pressY=e.stageY/zim.scaX;}else{that.pressX=null;that.pressY=null;}});that.addPointFactor=10;that.addMinDistance=15;that.shape.on("pressup",function(e){if(!that.editPoints)return;if(that.pressX&&Math.abs(that.pressX-e.stageX/zim.scaX)<min&&Math.abs(that.pressY-e.stageY/zim.scaY)<min){if(that.selectPoints)that.lastPoints=zim.copy(that.points);var points=that.points;var point=that.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);var pointBefore=zim.closestPointAlongCurve(point,that.segmentPoints);if(that.editPoints=="anywhere"){points.splice(pointBefore+1,0,[point.x,point.y,0,0,0,0,0,0]);that.points=points;that.changeControl({index:pointBefore+1,type:"mirror",update:true});}else{var p=that.pointsAdjusted;var cubic=that.getSegmentPoint(p[pointBefore],p[(pointBefore+1)%p.length]);var length=zim.distanceAlongCurve(cubic);var testNum=Math.round(length/that.addPointFactor);var testPoints=that.interpolate(testNum,pointBefore,false,points);var closest=10000;var closestPoint;var closestIndex;zim.loop(testPoints,function(p,k){var d=zim.dist(p,point);if(d<closest){closest=d;closestIndex=k;closestPoint=p;}});if(closest<that.addMinDistance){var ratios=that.segmentRatios;var currentRatio=ratios[pointBefore];var lastRatio=pointBefore>0?ratios[pointBefore-1]:0;that.addPoint(100*(lastRatio+(currentRatio-lastRatio)*((closestIndex)/(testNum+1))));}}
that.lastSelectedIndex=pointBefore+1;that.lastSelected=that.controls.getChildAt(that.lastSelectedIndex);that.stage.update();}});that.controls.on("click",function(e){that.lastSelected=e.target.parent;var index=that.lastSelectedIndex=that.controls.getChildIndex(e.target.parent);if(!that.editPoints)return;if(that.selectionManager.shiftKey){removeControl(e);}});function removeControl(e){if(e.target.type=="Circle"){var index=that.lastSelectedIndex=that.controls.getChildIndex(e.target.parent);if(that.controls.numChildren<=2)return;var points=that.points;if(that.selectPoints)that.lastPoints=zim.copy(points);points.splice(index,1);that.points=points;that.stage.update();that.lastSelected=that.lastSelectedIndex=null;}}
that.controls.hold(removeControl);if(!_controls)that.hideControls();that.dispatchEvent("update");}
function getCurrentSelected(){var answer=[];var currentSet=that.selectionManager.currentSet;if(currentSet&&currentSet.selections&&currentSet.selections.length>0){for(var i=0;i<currentSet.selections.length;i++){var point=that.pointObjects[currentSet.selections[i]];if(currentSet==that.selectedBalls){answer.push(point[1]);}else if(currentSet==that.selectedRect1s){answer.push(point[2]);}else if(currentSet==that.selectedRect2s){answer.push(point[3]);}else{continue;}}}
return answer;}
function replaceControls(target){if(target.type!="Circle")return;var ball=target;var set=ball.mySet;var rect1=ball.rect1;var rect2=ball.rect2;rect1.x-=ball.x;rect1.y-=ball.y;rect2.x-=ball.x;rect2.y-=ball.y;set.x+=ball.x;set.y+=ball.y;ball.x=0;ball.y=0;}
that.selectionManager.on("keydown",function(e){if(!that.selectPoints)return;if(!that.keyFocus)return;if(e.keyCode>=37&&e.keyCode<=40){var currentSelected=getCurrentSelected();if(currentSelected.length>0){for(var i=0;i<currentSelected.length;i++){var pointObj=currentSelected[i];if(e.keyCode==37)pointObj.x-=that.selectionManager.shiftKey?10:1;else if(e.keyCode==39)pointObj.x+=that.selectionManager.shiftKey?10:1;else if(e.keyCode==38)pointObj.y-=that.selectionManager.shiftKey?10:1;else if(e.keyCode==40)pointObj.y+=that.selectionManager.shiftKey?10:1;mapMove(pointObj);}
that.drawShape();that.dispatchEvent("update");if(that.stage)that.stage.update();}}});that.selectionManager.on("keyup",function(e){if(!that.selectPoints)return;if(!that.keyFocus)return;if(e.keyCode>=37&&e.keyCode<=40){var currentSelected=getCurrentSelected();if(currentSelected.length>0){for(var i=0;i<currentSelected.length;i++){replaceControls(currentSelected[i]);}}}});that.selectionManager.on("undo",function(){if(!that.selectPoints)return;if(!that.keyFocus)return;if(that.lastPoints){var tempPoints=zim.copy(that.lastPoints);that.lastPoints=zim.copy(that.points);that.points=tempPoints;if(that.stage)that.stage.update();}});mapMove=function(target){if(that.lockControls)return;if(target.rect1){var ball=target;var diffX=ball.x-ball.startX;var diffY=ball.y-ball.startY;ball.rect1.x=ball.rect1.startX+diffX;ball.rect1.y=ball.rect1.startY+diffY;ball.rect2.x=ball.rect2.startX+diffX;ball.rect2.y=ball.rect2.startY+diffY;}else{var rect=target;var other=rect.other;var ball=rect.ball;var index=ball.index;var type=controlType;if(!zot(_points[index][4]))type=_points[index][4];if(type=="straight"||type=="mirror"){var dX=rect.x-ball.x;var dY=rect.y-ball.y;if(type=="mirror"){other.x=ball.x-dX;other.y=ball.y-dY;}else{var a=Math.atan2(dY,dX);var dNewX=-other.stickLength*Math.cos(a+Math.PI);var dNewY=-other.stickLength*Math.sin(a+Math.PI);other.x=ball.x-dNewX;other.y=ball.y-dNewY;}}}};Object.defineProperty(that,'move',{get:function(){return move;},set:function(value){if(move!=value){move=value;if(value){startDragging();}else{stopDragging();}}}});Object.defineProperty(that,'interactive',{get:function(){return interactive;},set:function(value){interactive=value;_controls=interactive;that.allowToggle=interactive;that.editPoints=interactive;that.lockControls=!interactive;that.selectPoints=interactive;that.move=interactive;that.points=that.points;}});Object.defineProperty(that,'allowToggle',{get:function(){return allowToggle;},set:function(value){if(allowToggle!=value){allowToggle=value;if(allowToggle){if(that.move)startDragging();}else{if(!_controls&&that.move)stopDragging();}}}});function startDragging(){if(that.move=="always")return;if(draggingCheck)return;draggingCheck=true;shape.drag({onTop:false});moveDownEvent=shape.on("mousedown",moveDownEvent);movePressEvent=shape.on("pressmove",movePressEvent);moveUpEvent=shape.on("pressup",moveUpEvent);}
function stopDragging(making){if(that.move=="always")return;if(!making&&!draggingCheck)return;draggingCheck=false;shape.noDrag();shape.off("mousedown",moveDownEvent);shape.off("pressmove",movePressEvent);shape.off("pressup",moveUpEvent);}
var _lockControls=lockControls;Object.defineProperty(that,'lockControls',{get:function(){return _lockControls;},set:function(value){_lockControls=value;if(value){that.controls.mouseChildren=false;that.controls.mouseEnabled=false;}else{that.controls.mouseChildren=true;that.controls.mouseEnabled=true;}}});that.lockControls=_lockControls;Object.defineProperty(that,'controlsVisible',{get:function(){return _controls;},set:function(value){_controls=value;if(value){that.showControls();}else{that.hideControls();}}});if(typeof KEYFOCUS!==typeof undefined)zim.KEYFOCUS=KEYFOCUS;Object.defineProperty(this,'keyFocus',{get:function(){return zim.KEYFOCUS==that;},set:function(value){zim.KEYFOCUS=that;}});if(!zim.KEYFOCUS)setFocus();function setFocus(){if(!that.selectPoints)return;that.keyFocus=true;var d=document.activeElement;if(d)d.blur();}
Object.defineProperty(that,'points',{get:function(){var points=[];var point;var p;for(var i=0;i<_points.length;i++){p=_points[i];point=[zim.decimals(p[0].x),zim.decimals(p[0].y),zim.decimals(p[1].x),zim.decimals(p[1].y),zim.decimals(p[2].x),zim.decimals(p[2].y),zim.decimals(p[3].x),zim.decimals(p[3].y)];if(p[4]&&p[4]!=="mirror")point.push(p[4]);points.push(point);}
return points;},set:function(value){var x=that.x;var y=that.y;var v=that.visible;that.dispose(true);points=value;init();that.lockControls=_lockControls;that.x=x;that.y=y;that.visible=v;}});Object.defineProperty(that,'pointsAdjusted',{get:function(){var points=[];var point;var p;var po;var pObjects=that.pointObjects;zim.loop(pObjects.length,function(i,t){po=pObjects[i];p=_points[i];if(po[0].rotation==0&&po[0].scaleX==0&&po[0].scaleY==0){point=[zim.decimals(p[0].x),zim.decimals(p[0].y),zim.decimals(p[1].x),zim.decimals(p[1].y),zim.decimals(p[2].x),zim.decimals(p[2].y),zim.decimals(p[3].x),zim.decimals(p[3].y)];}else{var lo1=po[0].localToLocal(po[2].x,po[2].y,po[0].parent);var lo2=po[0].localToLocal(po[3].x,po[3].y,po[0].parent);point=[zim.decimals(p[0].x),zim.decimals(p[0].y),zim.decimals(p[1].x),zim.decimals(p[1].y),zim.decimals(lo1.x-p[0].x),zim.decimals(lo1.y-p[0].y),zim.decimals(lo2.x-p[0].x),zim.decimals(lo2.y-p[0].y)];}
if(p[4]&&p[4]!=="mirror")point.push(p[4]);points.push(point);});return points;},set:function(value){if(zon)zogy("Squiggle() - pointsAdjusted is read only");}});Object.defineProperty(that,'pointObjects',{get:function(){return _points;},set:function(value){if(zon){zog("Squiggle() - pointObjects is read only - but its contents can be manipulated - use squiggle.update() after changes");}}});Object.defineProperty(that,'pointControls',{get:function(){return _pointControls;},set:function(value){if(zon){zog("Squiggle() - pointControls is read only - but its contents can be manipulated - use blob.update() after changes");}}});Object.defineProperty(that,'pointCircles',{get:function(){return _pointCircles;},set:function(value){if(zon){zog("Squiggle() - pointCircles is read only - but its contents can be manipulated - use blob.update() after changes");}}});Object.defineProperty(that,'segmentPoints',{get:function(){var array=[];var p=that.pointsAdjusted;zim.loop(p.length-1,function(i,t){var s=that.getSegmentPoint(p[i],p[i+1]);array.push(s);});return array;},set:function(value){if(zon){zog("Squiggle() - segmentPoints is read only");}}});Object.defineProperty(that,'segmentRatios',{get:function(){var distances=[];var total=0;zim.loop(that.segmentPoints,function(points){var d=zim.distanceAlongCurve(points);distances.push(d);total+=d;});var percents=[];var totalPercents=0;zim.loop(distances,function(d){var p=d/total;totalPercents+=p;percents.push(totalPercents);});return percents;},set:function(value){if(zon){zog("Squiggle() - segmentRatios is read only");}}});that.approximateBounds=function(num,showPoints,margin){if(zot(num))num=80;if(zot(margin))margin=0;num/=that.num;var points=that.interpolate(num,null,true,null,true);var bounds=zim.boundsAroundPoints(points);that.setBounds(bounds.x-margin,bounds.y-margin,bounds.width+margin*2,bounds.height+margin*2);if(showPoints){if(!that.parent){if(zon)zogy("approximateBounds() - add to stage to first to see points");return that;}
if(!that.hitPathPoints)that.hitPathPoints=new zim.Container().addTo();else that.hitPathPoints.removeAllChildren();that.hitPathPoints.top();for(var i=0;i<points.length;i++){var point=points[i];point=that.localToGlobal(point.x,point.y);new zim.Circle(3).loc(point.x,point.y,that.hitPathPoints);}}
return that;};that.getPointAngle=function(index){var p=that.pointObjects[index][0];var r1=that.pointObjects[index][2];var r2=that.pointObjects[index][3];if(p==that.stage){var globalR1=new zim.Point(r1.x,r1.y);var globalR2=new zim.Point(r2.x,r2.y);}else{var globalR1=p.localToGlobal(r1.x,r1.y);var globalR2=p.localToGlobal(r2.x,r2.y);}
return zim.angle(globalR1.x,globalR1.y,globalR2.x,globalR2.y);};that.getSegmentPoint=function(point1,point2){if(zot(point1)||zot(point2))return;if(point1[2]!=0||point1[3]!=0){point1[4]-=point1[2];point1[5]-=point1[3];point1[6]-=point1[2];point1[7]-=point1[3];point1[0]+=point1[2];point1[1]+=point1[3];point1[2]=0;point1[3]=0;}
if(point2[2]!=0||point2[3]!=0){point2[4]-=point2[2];point2[5]-=point2[3];point2[6]-=point2[2];point2[7]-=point2[3];point2[0]+=point2[2];point2[1]+=point2[3];point2[2]=0;point2[3]=0;}
var p1={x:point1[0],y:point1[1]};var p2={x:point1[0]+point1[6],y:point1[1]+point1[7]};var p3={x:point2[0]+point2[4],y:point2[1]+point2[5]};var p4={x:point2[0],y:point2[1]};if(sets.x!=0||sets.y!=0){p1.x+=sets.x;p2.x+=sets.x;p3.x+=sets.x;p4.x+=sets.x;p1.y+=sets.y;p2.y+=sets.y;p3.y+=sets.y;p4.y+=sets.y;}
return[p1,p2,p3,p4];};that.getAdjacentSegmentData=function(index){if(zot(index))index=0;var p=that.pointsAdjusted;if(that.num==2){return[[that.getSegmentPoint(p[0],p[1])],[0]];}
if(index==0){return[[that.getSegmentPoint(p[0],p[1]),that.getSegmentPoint(p[1],p[2])],[0,1]];}else if(index>=that.num-2){return[[that.getSegmentPoint(p[that.num-3],p[that.num-2]),that.getSegmentPoint(p[that.num-2],p[that.num-1])],[that.num-3,that.num-2]];}else{return[[that.getSegmentPoint(p[index-1],p[index]),that.getSegmentPoint(p[index],p[index+1]),that.getSegmentPoint(p[index+1],p[index+2])],[index-1,index,index+1]];}};that.getCurvePoint=function(ratio,segmentRatios,segmentPoints,getAngle,even){if(zot(ratio)||isNaN(ratio))ratio=0;if(zot(segmentRatios))segmentRatios=that.segmentRatios;if(zot(segmentPoints))segmentPoints=that.segmentPoints;if(zot(getAngle))getAngle=false;if(zot(even))even=false;var percents=segmentRatios;var segments=segmentPoints;var afterIndex=zim.loop(percents,function(p,i){if(p>=ratio)return i;});var earlierPercent=afterIndex>0?percents[afterIndex-1]:0;var localTotal=afterIndex>0?(percents[afterIndex]-percents[afterIndex-1]):percents[afterIndex];if(!localTotal)return undefined;var localPercent=(ratio-earlierPercent)/localTotal;var finalPoint=zim.pointAlongCurve(segments[afterIndex],localPercent,getAngle,true);var finalFinalPoint=that.localToGlobal(finalPoint.x,finalPoint.y);finalFinalPoint.angle=finalPoint.angle;finalFinalPoint.z=afterIndex;return!zot(finalFinalPoint)?finalFinalPoint:undefined;};function proportion(p1,p2,ratio){return{x:p1.x+(p2.x-p1.x)*ratio,y:p1.y+(p2.y-p1.y)*ratio};}
function insertPointData(points,controls,ratios,percent,controlType,skipPoint,dataOnly,even){var index=points.length-1;var lastRatio=0;var currentRatio=0;if(percent==100&&that.type=="Squiggle")percent=99.99;percent=(percent+100000)%100;zim.loop(ratios,function(ratio,i){if(percent/100<ratio){index=i;currentRatio=ratio;return true;}
lastRatio=ratio;});var segment=that.segmentPoints[index];var r=currentRatio>0?(percent/100-lastRatio)/(currentRatio-lastRatio):0;var point=zim.pointAlongCurve(segment,r,null,even);var newPoint=[point.x,point.y,0,0];if(skipPoint)return;if(dataOnly){that.interpolatedPoints.push({x:point.x,y:point.y,r:percent/100});return;}
if(controlType!="none"){var startHandle=proportion(segment[0],segment[1],r);var midPoint=proportion(segment[1],segment[2],r);var endHandle=proportion(segment[2],segment[3],r);var newStartHandle=proportion(startHandle,midPoint,r);var newEndHandle=proportion(midPoint,endHandle,r);newPoint[4]=newStartHandle.x-point.x;newPoint[5]=newStartHandle.y-point.y;newPoint[6]=newEndHandle.x-point.x;newPoint[7]=newEndHandle.y-point.y;var start=that.localToLocal(startHandle.x,startHandle.y,controls[index]);points[index][6]=start.x;points[index][7]=start.y;var end=that.localToLocal(endHandle.x,endHandle.y,controls[(index+1)%points.length]);points[(index+1)%points.length][4]=end.x;points[(index+1)%points.length][5]=end.y;}
if(controlType)newPoint[8]=controlType;points.splice(index+1,0,newPoint);}
this.addPoint=function(percent,controlType){if(zot(percent))percent=100;var points=that.points;var ratios=that.segmentRatios;var controls=that.pointControls;controlType=controlType?controlType:originalControlType;insertPointData(points,controls,ratios,percent,controlType);that.points=points;that.num=points.length;return that;};this.addPoints=function(num,controlType,startPoint,spread,dataOnly,points,even){if(zot(points))points=zim.copy(that.points);var ratios=zim.copy(that.segmentRatios);var lastRatio=0;if(dataOnly)that.interpolatedPoints=[];if(spread)var totalPoints=ratios.length*num;zim.loop(ratios,function(ratio,j){if(dataOnly)insertPointData(points,that.pointControls,that.segmentRatios,lastRatio*100,controlType,!zot(startPoint)&&j!=startPoint,dataOnly,even);var numCount=spread?Math.round(totalPoints*(ratio-lastRatio)):num;var div=1/(numCount+1);zim.loop(numCount,function(i){var r=lastRatio+(ratio-lastRatio)*div*(i+1);insertPointData(points,that.pointControls,that.segmentRatios,r*100,controlType,!zot(startPoint)&&j!=startPoint,dataOnly,even);if(!dataOnly&&num>0)that.points=points;});lastRatio=ratio;});if(dataOnly&&that.type=="Squiggle"){insertPointData(points,that.pointControls,that.segmentRatios,100,controlType,false,dataOnly,even);}
if(that.stage)that.stage.update();that.num=points.length;return that;};this.interpolate=function(num,startPoint,spread,points,even){if(zot(num))num=1;that.addPoints(num,"none",startPoint,spread,true,points,even);return that.interpolatedPoints;};this.dispose=function(temp,b,disposing){if(!that.shape)return;zim.gD(that);if(stage&&that.toggleStageEvent)stage.off("stagemousedown",that.toggleStageEvent);that.controls.noDrag();that.controls.removeAllEventListeners();if(that.selectPoints&&that.selectionManager)that.selectionManager.dispose();that.selectedBalls=null;that.selectedRect1s=null;that.selectedRect2s=null;that.selectionManager=null;that.off("mousedown",that.toggleEvent);that.off("click",that.clickEvent);if(temp){that.shape.dispose();that.shape=null;for(var i=0;i<that.points.length;i++){that.pointObjects[i][0].removeAllEventListeners();that.pointObjects[i][1].removeAllEventListeners();that.pointObjects[i][2].removeAllEventListeners();that.pointObjects[i][3].removeAllEventListeners();}
that.controls.removeFrom(that);that.sticks.dispose();_points=null;_pointCircles=null;}else{that.removeAllEventListeners();_points=null;_pointCircles=null;if(!disposing)this.zimCustomShape_dispose(true);}
return true;};};zim.extend(zim.Squiggle,zim.CustomShape,["clone","dispose"],"zimCustomShape",false);zim.Blob=function(color,borderColor,borderWidth,points,radius,controlLength,controlType,lockControlType,showControls,lockControls,handleSize,allowToggle,move,dashed,onTop,stickColor,selectColor,selectPoints,editPoints,interactive,strokeObj,style,group,inherit){var sig="color, borderColor, borderWidth, points, radius, controlLength, controlType, lockControlType, showControls, lockControls, handleSize, allowToggle, move, dashed, onTop, stickColor, selectColor, selectPoints, editPoints, interactive, strokeObj, style, group, inherit";var duo;if(duo=zob(zim.Blob,arguments,sig,this))return duo;z_d("53.5");this.group=group;var DS=style===false?{}:zim.getStyle("Blob",this.group,inherit);if(zot(radius))radius=DS.radius!=null?DS.radius:100;this.zimCustomShape_constructor(-radius,-radius,radius*2,radius*2,false);this.type="Blob";this.mouseChildren=true;if(zot(dashed))dashed=DS.dashed!=null?DS.dashed:false;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:null;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(color))color=DS.color!=null?DS.color:(borderWidth>0?"rgba(0,0,0,0)":zim.green);if(color.style){this.colorCommand=color;color="black";}
if(borderColor&&borderColor.style){this.borderColorCommand=borderColor;borderColor="black";}
if(zot(points))points=DS.points!=null?DS.points:4;var num=typeof points=="number"?points:points.length;var controlLengthOriginal=controlLength;if(zot(controlLength))controlLength=DS.controlLength!=null?DS.controlLength:(radius*4/num);if(zot(controlType))controlType=DS.controlType!=null?DS.controlType:null;var originalControlType=controlType;if(zot(controlType))controlType="straight";if(zot(lockControlType))lockControlType=DS.lockControlType!=null?DS.lockControlType:false;if(zot(interactive))interactive=DS.interactive!=null?DS.interactive:true;if(zot(showControls))showControls=DS.showControls!=null?DS.showControls:interactive;var _controls=showControls;if(zot(lockControls))lockControls=DS.lockControls!=null?DS.lockControls:!interactive;if(zot(handleSize))handleSize=DS.handleSize!=null?DS.handleSize:(zim.mobile()?20:10);if(zot(allowToggle))allowToggle=DS.allowToggle!=null?DS.allowToggle:interactive;if(zot(move))move=DS.move!=null?DS.move:interactive;if(zot(stickColor))stickColor=DS.stickColor!=null?DS.stickColor:"#111";if(zot(selectColor))selectColor=DS.selectColor!=null?DS.selectColor:"#fff";if(zot(selectPoints))selectPoints=DS.selectPoints!=null?DS.selectPoints:interactive;this.stickColor=stickColor;if(zot(onTop))onTop=DS.onTop!=null?DS.onTop:true;if(zot(editPoints))editPoints=DS.editPoints!=null?DS.editPoints:interactive;if(zot(strokeObj))strokeObj=DS.strokeObj!=null?DS.strokeObj:{};var oa=remember(color,borderColor);function remember(){return arguments;}
color=zim.Pick.choose(color);borderColor=zim.Pick.choose(borderColor);var that=this;this.interactive=interactive;this.num=num;this.editPoints=editPoints;this.selectPoints=selectPoints;this.lockControls=lockControls;this.onTop=onTop;this.move=move;this.allowToggle=allowToggle;this.lockControlType=lockControlType;var types=this.types=["mirror","straight","free","none"];var _points;var _pointCircles;var _pointControls;that._color=color;that._borderColor=borderColor;that._borderWidth=borderWidth;that._dashed=dashed;if(that._dashed&&!Array.isArray(that._dashed))that._dashed=[10,10];var shape;var moveDownEvent;var movePressEvent;var moveUpEvent;var stage;var draggingCheck=that.move;var min=2;var mapMove;var sets;points=checkForShape(points);function checkForShape(shape){if(shape=="circle"||shape=="rectangle"||shape=="triangle"){if(shape=="circle")shape=new zim.Circle(radius);if(shape=="rectangle")shape=new zim.Rectangle(radius*2,radius*2).centerReg({add:false});if(shape=="triangle")shape=new zim.Triangle(radius*2,radius*2,radius*2);}
var points;if(shape.type=="Circle"||shape.type=="Rectangle"||shape.type=="Triangle"){var b=shape.getBounds();if(shape.type=="Circle"){points=4;controlLengthOriginal=controlLength=radius*2*.5523;}else if(shape.type=="Rectangle"){shape.centerReg({add:false});points=[[b.x-b.width/2,b.y-b.height/2],[b.x+b.width/2,b.y-b.height/2],[b.x+b.width/2,b.y+b.height/2],[b.x-b.width/2,b.y+b.height/2]];that.setBounds(b.x-b.width/2,b.y-b.height/2,b.width,b.height);that.regX=shape.regX-b.width/2;that.regY=shape.regY-b.height/2;}else if(shape.type=="Triangle"){points=[[shape.three.x-shape.width/2,shape.three.y+shape.height/2+shape.adjusted],[shape.two.x-shape.width/2,shape.two.y+shape.height/2+shape.adjusted],[shape.one.x-shape.width/2,shape.one.y+shape.height/2+shape.adjusted]];that.setBounds(b.x-b.width/2,b.y-b.height/2,b.width,b.height);}
return points;}else{return shape;}}
if(typeof points=="string"){var svgProcessor=new zim.SVGContainer();points=svgProcessor.processPath(points);}
if(originalControlType&&typeof points!="number"){zim.loop(points,function(point){point[8]=originalControlType;if(originalControlType=="none"){point[4]=point[5]=point[6]=point[7]=0;}});}
init();function init(){if(sets)sets.removeAllEventListeners();if(that.selectPoints){that.selectedBalls=new zim.SelectionSet();that.selectedRect1s=new zim.SelectionSet();that.selectedRect2s=new zim.SelectionSet();that.selectionManager=new zim.SelectionManager([that.selectedBalls,that.selectedRect1s,that.selectedRect2s],"ctrl",false);}else{that.selectionManager=new zim.SelectionManager(null,"ctrl");}
num=typeof points=="number"?points:points.length;if(num<=0)return;if(zot(controlLengthOriginal))controlLength=radius*4/num;shape=that.shape=new zim.Shape({style:false}).addTo(that);var sticks=that.sticks=new zim.Shape({style:false}).addTo(that);if(handleSize<=0)sticks.removeFrom();var g=shape.graphics;g.c();var s=sticks.graphics;s.c();var ballS=handleSize/10*8;var rectS=handleSize;var mobile=zim.mobile();sets=that.controls=new zim.Container({style:false}).addTo(that);if(that.interactive)sets.drag({onTop:!mobile});_points=[];_pointControls=[];_pointCircles=[];var angle,point,temp,set,rect1,rect2,ball,type,setInfo;for(var i=0;i<num;i++){set=new zim.Container({style:false}).addTo(sets);set.num=i;if(typeof points=="number"){var length=zim.Pick.choose(controlLength);temp=new zim.Container(length,radius,null,null,false).reg(length/2,radius).addTo(that);temp.rotation=i/num*360;ball=new zim.Circle(ballS,that.selectPoints&&that.selectedBalls.isSelected(i)?selectColor:zim.light,zim.dark,2,null,null,null,null,false).centerReg(temp).loc({x:length/2,y:0});rect1=new zim.Rectangle(rectS,rectS,that.selectPoints&&that.selectedRect1s.isSelected(i)?selectColor:getBackgroundColor(controlType),handleSize==0?null:zim.dark,handleSize==0?null:2,null,null,null,false).centerReg(temp).loc({x:0,y:0});rect2=new zim.Rectangle(rectS,rectS,that.selectPoints&&that.selectedRect2s.isSelected(i)?selectColor:getBackgroundColor(controlType),handleSize==0?null:zim.dark,handleSize==0?null:2,null,null,null,false).centerReg(temp).loc({x:length,y:0});var ballPoint=temp.localToLocal(ball.x,ball.y,sets);ball.x=ballPoint.x;ball.y=ballPoint.y;ball.addTo(set,null,false);var rect1Point=temp.localToLocal(rect1.x,rect1.y,sets);rect1.x=controlType=="none"?0:rect1Point.x-ball.x;rect1.y=controlType=="none"?0:rect1Point.y-ball.y;rect1.addTo(set,null,false);var rect2Point=temp.localToLocal(rect2.x,rect2.y,sets);rect2.x=controlType=="none"?0:rect2Point.x-ball.x;rect2.y=controlType=="none"?0:rect2Point.y-ball.y;rect2.addTo(set,null,false);set.x=ball.x;set.y=ball.y;ball.x=0;ball.y=0;if(controlType=="none")ball.addTo(set,null,false);}else{setInfo=points[i];type=setInfo[8]?setInfo[8]:controlType;set.loc({x:setInfo[0],y:setInfo[1]});ball=new zim.Circle(ballS,zim.light,zim.dark,2,null,null,null,null,false).centerReg({add:false}).addTo(set).loc({x:setInfo[2],y:setInfo[3]});rect1=new zim.Rectangle(rectS,rectS,getBackgroundColor(type),handleSize==0?null:zim.dark,handleSize==0?null:2,null,null,null,false).centerReg({add:false}).addTo(set,0).loc({x:setInfo[4],y:setInfo[5]});rect2=new zim.Rectangle(rectS,rectS,getBackgroundColor(type),handleSize==0?null:zim.dark,handleSize==0?null:2,null,null,null,false).centerReg({add:false}).addTo(set,0).loc({x:setInfo[6],y:setInfo[7]});}
ball.mySet=set;ball.rect1=rect1;ball.rect2=rect2;ball.index=i;if(handleSize==0){ball.expand(10);rect1.expand(10);rect2.expand(10);}
if(mobile){ball.on("mousedown",mobileDouble);}else{ball.on("dblclick",doubleIt);}
rect1.ball=ball;rect1.other=rect2;rect2.ball=ball;rect2.other=rect1;if(mobile){ball.expand();rect1.expand();rect2.expand();}
point=[set,ball,rect1,rect2,setInfo?setInfo[8]:controlType];_points.push(point);_pointCircles.push(ball);_pointControls.push(set);}
var tappedTwice=false;function mobileDouble(e){if(!tappedTwice){tappedTwice=true;setTimeout(function(){tappedTwice=false;},300);}else{e.preventDefault();doubleIt(e);}}
function doubleIt(e){if(that.lockControlType)return;var ball=e.target;var type=_points[ball.index][4]?_points[ball.index][4]:controlType;if(Math.abs(ball.rect1.x)<=2&&Math.abs(ball.rect1.y)<=2&&Math.abs(ball.rect2.x)<=2&&Math.abs(ball.rect2.y)<=2){type="none";}
if(type=="none"){ball.parent.addChildAt(ball,0);}
type=that.types[(that.types.indexOf(type)+(that.shiftKey?-1:1)+that.types.length)%that.types.length];if(type=="none"){ball.rect1.x=ball.rect1.y=ball.rect2.x=ball.rect2.y=0;ball.parent.addChild(ball);e.stopImmediatePropagation();}
_points[ball.index][4]=type;ball.rect1.color=getBackgroundColor(type);ball.rect2.color=getBackgroundColor(type);that.drawShape();var ev=new createjs.Event("change");ev.controlType="bezierSwitch";that.dispatchEvent(ev);ball.stage.update();}
function getBackgroundColor(type){var colors={mirror:zim.purple,free:zim.yellow,none:zim.blue};return colors[type]?colors[type]:zim.pink;}
that.drawShape=function(){g.c();if(!that.colorCommand){that.colorCommand=g.f(that._color).command;if(color&&color.type)that.specialColor(that.colorCommand,color);}
if(zot(that._borderWidth)||that._borderWidth>0){if(!zot(that._borderColor)||!zot(that._borderWidth)){if(zot(that._borderColor))that._borderColor="black";if(!that.borderColorCommand){that.borderColorCommand=g.s(that._borderColor).command;if(that._borderColor&&that._borderColor.type)that.specialColor(that.borderColorCommand,that._borderColor);}
if(!that.borderWidthCommand)that.borderWidthCommand=g.ss(that._borderWidth,strokeObj.caps,strokeObj.joints,strokeObj.miterLimit,strokeObj.ignoreScale).command;if(that._dashed){if(!that.borderDashedCommand)that.borderDashedCommand=g.sd(Array.isArray(that._dashed)?that._dashed:[10,10],that._dashedOffset).command;}}}
var set=_points[0][0];var ballPoint=set.localToLocal(_points[0][1].x,_points[0][1].y,shape);g.mt(ballPoint.x,ballPoint.y);s.c().s(that.stickColor).ss(1);var currentIndex;var nextIndex;for(var i=0;i<_points.length;i++){var currentIndex=i;var nextIndex=(i+1)%_points.length;var set=_points[currentIndex][0];var ball=_points[currentIndex][1];var control1=_points[currentIndex][2];var control2=_points[currentIndex][3];var nextSet=_points[nextIndex][0];var nextBall=_points[nextIndex][1];var nextControl1=_points[nextIndex][2];var nextControl2=_points[nextIndex][3];var control2Point=set.localToLocal(control2.x,control2.y,shape);var nextControl1Point=nextSet.localToLocal(nextControl1.x,nextControl1.y,shape);var nextBallPoint=nextSet.localToLocal(nextBall.x,nextBall.y,shape);g.bt(control2Point.x,control2Point.y,nextControl1Point.x,nextControl1Point.y,nextBallPoint.x,nextBallPoint.y);var ballPoint=set.localToLocal(ball.x,ball.y,shape);var control1Point=set.localToLocal(control1.x,control1.y,shape);s.mt(ballPoint.x,ballPoint.y).lt(control1Point.x,control1Point.y);s.mt(ballPoint.x,ballPoint.y).lt(control2Point.x,control2Point.y);}
g.cp();g.append(that.colorCommand);if(that._dashed)g.append(that.borderDashedCommand);if(that.borderWidthCommand)g.append(that.borderWidthCommand);if(that.borderColorCommand)g.append(that.borderColorCommand);};that.drawShape();var startPosition;sets.on("mousedown",function(e){if(that.lockControls)return;if(that.selectPoints)that.keyFocus=true;startPosition={x:e.target.x,y:e.target.y};if(e.target.rect1){var ball=e.target;ball.startX=ball.x;ball.startY=ball.y;ball.rect1.startX=ball.rect1.x;ball.rect1.startY=ball.rect1.y;ball.rect2.startX=ball.rect2.x;ball.rect2.startY=ball.rect2.y;}else{var rect=e.target;rect.startX=rect.x;rect.startY=rect.y;var ball=rect.ball;var index=ball.index;var type=controlType;if(!zot(_points[index][4]))type=_points[index][4];if(type=="straight"){var other=rect.other;var dX=other.x-ball.x;var dY=other.y-ball.y;other.stickLength=Math.sqrt(Math.pow(dX,2)+Math.pow(dY,2));}}
if(that.selectPoints){var currentSet=that.selectionManager.currentSet;if(currentSet&&currentSet.selections&&currentSet.selections.length>0){for(var i=0;i<currentSet.selections.length;i++){var point=that.pointObjects[currentSet.selections[i]];point[1].startX=point[1].x;point[1].startY=point[1].y;point[2].startX=point[2].x;point[2].startY=point[2].y;point[3].startX=point[3].x;point[3].startY=point[3].y;}}}});if(that.selectPoints){sets.tap(function(e){if(e.target.rect1){var ball=e.target;that.selectedBalls.toggle(ball.parent.num);}else{var rect=e.target;rect.color="white";var ball=rect.ball;if(ball.rect1==rect)that.selectedRect1s.toggle(ball.parent.num);else that.selectedRect2s.toggle(ball.parent.num);}
for(var i=0;i<that.pointObjects.length;i++){var po=that.pointObjects[i];po[1].color=that.selectedBalls.isSelected(i)?zim.white:zim.light;po[2].color=that.selectedRect1s.isSelected(i)?zim.white:getBackgroundColor(po[4]);po[3].color=that.selectedRect2s.isSelected(i)?zim.white:getBackgroundColor(po[4]);}
e.target.stage.update();});}
sets.on("pressmove",function(e){if(that.lockControls)return;if(that.selectPoints){var currentSelected=getCurrentSelected();if(currentSelected.indexOf(e.target)==-1){mapMove(e.target);that.drawShape();}else{if(currentSelected.length>0){var diffX=e.target.x-e.target.startX;var diffY=e.target.y-e.target.startY;for(var i=0;i<currentSelected.length;i++){var pointObj=currentSelected[i];pointObj.x=pointObj.startX+diffX;pointObj.y=pointObj.startY+diffY;mapMove(pointObj);}
that.drawShape();}}}else{mapMove(e.target);that.drawShape();}});sets.on("pressup",function(e){if(that.lockControls)return;var moveControlCheck=(e.target.x!=startPosition.x||e.target.y!=startPosition.y);var ev=new createjs.Event("change");if(e.target.rect1){ev.controlType="bezierPoint";endMove(e.target);}else{ev.controlType="bezierHandle";}
if(moveControlCheck)that.dispatchEvent(ev);});function endMove(target){if(that.selectPoints){var currentSelected=getCurrentSelected();if(currentSelected&&currentSelected.indexOf(target)==-1){replaceControls(target);}else if(currentSelected&&currentSelected.length>0){for(var i=0;i<currentSelected.length;i++){replaceControls(currentSelected[i]);}}else{replaceControls(target);}}else{replaceControls(target);}}
that.changeControl=function(index,type,rect1X,rect1Y,rect2X,rect2Y,circleX,circleY,update){var sig="index, type, rect1X, rect1Y, rect2X, rect2Y, circleX, circleY, update";var duo;if(duo=zob(that.changeControl,arguments,sig))return duo;if(zot(index)){for(var i=0;i<_points.length;i++){that.changeControl(i,type,rect1X,rect1Y,rect2X,rect2Y,circleX,circleY);}
return that;}
var point=_points[index];point[4]=type;if(type=="none"){if(!zot(circleX))point[1].x=circleX;if(!zot(circleY))point[1].y=circleY;point[2].x=point[1].x,point[2].y=point[1].y;point[3].x=point[1].x,point[3].y=point[1].y;point[1].parent.addChild(point[1]);}else{if(!zot(circleX))point[1].x=circleX;if(!zot(circleY))point[1].y=circleY;if(!zot(rect1X))point[2].x=rect1X;if(!zot(rect1Y))point[2].y=rect1Y;if(!zot(rect2X))point[3].x=rect2X;if(!zot(rect2Y))point[3].y=rect2Y;point[1].parent.addChildAt(point[1],0);}
point[2].color=getBackgroundColor(type);point[3].color=getBackgroundColor(type);if(update){that.update();if(that.stage)that.stage.update();}
return that;};that.transformPoints=function(transformType,amount,x,y){that.points=zim.transformPoints(that.points,transformType,amount,x,y);return that;};that.traverse=function(obj,start,end,time){var ratios=zim.copy(that.segmentRatios);ratios.unshift(0);if(zot(end))end=start+1;var forward=start<end;if(forward){var startPercent=ratios[start]*100;var endPercent=ratios[end]*100;}else{var startPercent=50+(100-ratios[start]*100)/2;var endPercent=50+(100-ratios[end]*100)/2;}
obj.percentComplete=startPercent;obj.animate({ease:"linear",props:{path:that},rewind:!forward,time:time,events:true});obj.on("animation",function(e){if(obj.percentComplete>endPercent||obj.percentComplete==0){obj.stopAnimate();e.remove();var eventObj=new createjs.Event("traversed");eventObj.obj=obj;that.dispatchEvent(eventObj);}});return that;};that.update=function(normalize){if(normalize){that.points=that.pointsAdjusted;}else{that.drawShape();}
that.zimAnimateChanged=true;return that;};if(that.move&&that.interactive)shape.drag({onTop:false});moveDownEvent=shape.on("mousedown",function(e){stage=e.target.stage;startPosition={x:shape.x,y:shape.y};if(that.selectPoints)that.keyFocus=true;upTop();});movePressEvent=shape.on("pressmove",function(){sets.x=shape.x;sets.y=shape.y;sticks.x=shape.x;sticks.y=shape.y;});moveUpEvent=shape.on("pressup",function(){var moveControlCheck=(shape.x!=startPosition.x||shape.y!=startPosition.y);var movePoint=shape.localToLocal(that.regX,that.regY,that.parent);that.x=movePoint.x;that.y=movePoint.y;sets.x=sets.y=sticks.x=sticks.y=shape.x=shape.y=0;if(moveControlCheck){var ev=new createjs.Event("change");ev.controlType="move";that.dispatchEvent(ev);}
stage.update();});if(!move)stopDragging(true);function upTop(){if(that.onTop){var nc=that.parent.numChildren-1;if(that.parent.getChildAt(nc).type=="Keyboard")nc--;that.parent.setChildIndex(that,nc);}}
that.toggleEvent=that.on("mousedown",function(){if(!that.allowToggle)return;if(!_controls){that.showControls();that.dispatchEvent("controlsshow");}});that.added(function(){stage=that.stage;if(that.toggleStageEvent)that.stage.off("stagemousedown",that.toggleStageEvent);that.toggleStageEvent=that.stage.on("stagemousedown",function(e){if(!that.allowToggle||!that.stage)return;if(_controls&&!that.hitTestPoint(e.stageX/zim.scaX,e.stageY/zim.scaY,false)){that.hideControls();that.dispatchEvent("controlshide");}});});that.clickEvent=that.on("click",function(){if(that.ctrlKey){setTimeout(function(){that.clone(true).addTo(that.stage).mov(100);if(that.allowToggle){that.hideControls();that.dispatchEvent("controlshide");}
var ev=new createjs.Event("change");ev.controlType="move";that.dispatchEvent(ev);that.stage.update();},50);}});that.hideControls=function(){that.toggled=false;sets.visible=false;sticks.visible=false;_controls=false;if(that.stage)that.stage.update();if(!that.allowToggle&&that.move)stopDragging();return that;};if(!_controls)that.hideControls();that.showControls=function(){that.toggled=true;sets.visible=true;sticks.visible=true;_controls=true;sets.x=shape.x;sets.y=shape.y;sticks.x=shape.x;sticks.y=shape.y;that.addChildAt(shape,0);if(that.move&&!that.allowToggle)startDragging();if(that.stage)that.stage.update();return that;};that.toggle=function(state){if(state===true)that.showControls();else if(state===false)that.hideControls();else if(_controls)that.hideControls();else that.showControls();return that;};that.recordData=function(toJSON){if(zot(toJSON))toJSON=false;var obj={type:"Blob",index:that.parent?that.parent.getChildIndex(that):-1,x:that.x,y:that.y,points:that.recordPoints(),color:that.color,borderColor:that.borderColor,borderWidth:that.borderWidth,move:that.move,toggle:that.allowToggle,controlsVisible:_controls};if(toJSON)return JSON.stringify(obj);return obj;};that.setData=function(data,fromJSON){if(zot(data))return;if(fromJSON){try{data=JSON.parse(data);}catch(e){return;}}
var index=data.index;if(zot(index))index=-1;delete data.index;var pointData=data.points;if(!zot(pointData))that.setPoints(pointData);delete data.points;this.num=pointData.length;for(var d in data){that[d]=data[d];}
if(that.parent){that.parent.setChildIndex(that,index);}
return that;};that.recordPoints=function(popup){if(zot(popup))popup=false;var points=that.points;if(popup){if(!pane){var pane=that.pane=new zim.Pane({displayClose:false,container:that.stage,width:Math.min(500,that.stage.width-20),height:Math.min(500,that.stage.height-20),draggable:true,});var textArea=that.textArea=new zim.TextArea(Math.min(400,that.stage.width-70),Math.min(400,that.stage.height-70));textArea.centerReg(pane);}
pane.show();textArea.text=JSON.stringify(points);}
return points;};that.setPoints=function(points){var p;var p2;for(var i=0;i<points.length;i++){p=_points[i];p2=points[i];if(zot(p))continue;p[0].x=p2[0];p[0].y=p2[1];p[1].x=p2[2];p[1].y=p2[3];p[2].x=p2[4];p[2].y=p2[5];p[3].x=p2[6];p[3].y=p2[7];p[4]=p2[8];p[2].color=getBackgroundColor(p[4]);p[3].color=getBackgroundColor(p[4]);}
that.update();return that;};if(style!==false)zim.styleTransforms(that,DS);that.clone=function(exact,commands){var newShape=that.cloneProps(new zim.Blob(commands?that.colorCommand:((exact||!zim.isPick(oa[0]))?that.color:oa[0]),commands?that.borderColorCommand:((exact||!zim.isPick(oa[1]))?that.borderColor:oa[1]),that.borderWidth,that.recordPoints(),radius,controlLength,controlType,lockControlType,sets.visible,lockControls,handleSize,that.allowToggle,that.move,dashed,onTop,stickColor,selectColor,selectPoints,that.editPoints,interactive,strokeObj,style,that.group,inherit));if(that.linearGradientParams)newShape.linearGradient.apply(newShape,that.linearGradientParams);if(that.radialGradientParams)newShape.radialGradient.apply(newShape,that.radialGradientParams);return newShape;};that.shapeMousedownEvent=that.shape.on("mousedown",function(e){stage=e.target.stage;if(!that.editPoints)return;if(that.controlsVisible){that.pressX=e.stageX/zim.scaX;that.pressY=e.stageY/zim.scaY;}else{that.pressX=null;that.pressY=null;}});that.addPointFactor=10;that.addMinDistance=15;that.shapePressupEvent=that.shape.on("pressup",function(e){if(!that.editPoints)return;if(that.pressX&&Math.abs(that.pressX-e.stageX/zim.scaX)<min&&Math.abs(that.pressY-e.stageY/zim.scaY)<min){if(that.selectPoints)that.lastPoints=zim.copy(that.points);var points=that.points;var point=that.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);var pointBefore=zim.closestPointAlongCurve(point,that.segmentPoints);if(that.editPoints=="anywhere"){points.splice(pointBefore+1,0,[point.x,point.y,0,0,0,0,0,0]);that.points=points;that.changeControl({index:pointBefore+1,type:"mirror",update:true});}else{var p=that.pointsAdjusted;var cubic=that.getSegmentPoint(p[pointBefore],p[(pointBefore+1)%p.length]);var length=zim.distanceAlongCurve(cubic);var testNum=Math.round(length/that.addPointFactor);var testPoints=that.interpolate(testNum,pointBefore,false,points);var closest=10000;var closestPoint;var closestIndex;zim.loop(testPoints,function(p,k){if(k==0)return;var d=zim.dist(p,point);if(d<closest){closest=d;closestIndex=k;closestPoint=p;}});if(closest<that.addMinDistance){var ratios=that.segmentRatios;var currentRatio=ratios[pointBefore];var lastRatio=pointBefore>0?ratios[pointBefore-1]:0;that.addPoint(100*(lastRatio+(currentRatio-lastRatio)*(closestIndex/(testNum+1))));}}
that.lastSelectedIndex=pointBefore+1;that.lastSelected=that.controls.getChildAt(that.lastSelectedIndex);that.stage.update();}});that.controlsClickEvent=that.controls.on("click",function(e){that.lastSelected=e.target.parent;var index=that.lastSelectedIndex=that.controls.getChildIndex(e.target.parent);if(!that.editPoints)return;if(that.selectionManager.shiftKey){removeControl(e);}});function removeControl(e){if(e.target.type=="Circle"){var index=that.lastSelectedIndex=that.controls.getChildIndex(e.target.parent);if(that.controls.numChildren<=2)return;var points=that.points;if(that.selectPoints)that.lastPoints=zim.copy(points);points.splice(index,1);that.points=points;that.stage.update();that.lastSelected=that.lastSelectedIndex=null;}}
that.controls.hold(removeControl);if(!_controls)that.hideControls();that.dispatchEvent("update");}
function getCurrentSelected(){var answer=[];var currentSet=that.selectionManager.currentSet;if(currentSet&&currentSet.selections&&currentSet.selections.length>0){for(var i=0;i<currentSet.selections.length;i++){var point=that.pointObjects[currentSet.selections[i]];if(currentSet==that.selectedBalls){answer.push(point[1]);}else if(currentSet==that.selectedRect1s){answer.push(point[2]);}else if(currentSet==that.selectedRect2s){answer.push(point[3]);}else{continue;}}}
return answer;}
function replaceControls(target){if(!that.selectPoints)return;if(target.type!="Circle")return;var ball=target;var set=ball.mySet;var rect1=ball.rect1;var rect2=ball.rect2;rect1.x-=ball.x;rect1.y-=ball.y;rect2.x-=ball.x;rect2.y-=ball.y;set.x+=ball.x;set.y+=ball.y;ball.x=0;ball.y=0;}
that.selectionManager.on("keydown",function(e){if(!that.selectPoints)return;if(!that.keyFocus)return;if(e.keyCode>=37&&e.keyCode<=40){var currentSelected=getCurrentSelected();if(currentSelected.length>0){for(var i=0;i<currentSelected.length;i++){var pointObj=currentSelected[i];if(e.keyCode==37)pointObj.x-=that.selectionManager.shiftKey?10:1;else if(e.keyCode==39)pointObj.x+=that.selectionManager.shiftKey?10:1;else if(e.keyCode==38)pointObj.y-=that.selectionManager.shiftKey?10:1;else if(e.keyCode==40)pointObj.y+=that.selectionManager.shiftKey?10:1;mapMove(pointObj);}
that.drawShape();that.dispatchEvent("update");if(that.stage)that.stage.update();}}});that.selectionManager.on("keyup",function(e){if(!that.selectPoints)return;if(!that.keyFocus)return;if(e.keyCode>=37&&e.keyCode<=40){var currentSelected=getCurrentSelected();if(currentSelected.length>0){for(var i=0;i<currentSelected.length;i++){replaceControls(currentSelected[i]);}}}});that.selectionManager.on("undo",function(){if(!that.selectPoints)return;if(!that.keyFocus)return;if(that.lastPoints){var tempPoints=zim.copy(that.lastPoints);that.lastPoints=zim.copy(that.points);that.points=tempPoints;if(that.stage)that.stage.update();}});mapMove=function(target){if(that.lockControls)return;if(target.rect1){var ball=target;var diffX=ball.x-ball.startX;var diffY=ball.y-ball.startY;ball.rect1.x=ball.rect1.startX+diffX;ball.rect1.y=ball.rect1.startY+diffY;ball.rect2.x=ball.rect2.startX+diffX;ball.rect2.y=ball.rect2.startY+diffY;}else{var rect=target;var other=rect.other;var ball=rect.ball;var index=ball.index;var type=controlType;if(!zot(_points[index][4]))type=_points[index][4];if(type=="straight"||type=="mirror"){var dX=rect.x-ball.x;var dY=rect.y-ball.y;if(type=="mirror"){other.x=ball.x-dX;other.y=ball.y-dY;}else{var a=Math.atan2(dY,dX);var dNewX=-other.stickLength*Math.cos(a+Math.PI);var dNewY=-other.stickLength*Math.sin(a+Math.PI);other.x=ball.x-dNewX;other.y=ball.y-dNewY;}}}};Object.defineProperty(that,'move',{get:function(){return move;},set:function(value){if(move!=value){move=value;if(value){startDragging();}else{stopDragging();}}}});Object.defineProperty(that,'interactive',{get:function(){return interactive;},set:function(value){interactive=value;_controls=interactive;that.allowToggle=interactive;that.editPoints=interactive;that.lockControls=!interactive;that.selectPoints=interactive;that.move=interactive;that.points=that.points;}});Object.defineProperty(that,'allowToggle',{get:function(){return allowToggle;},set:function(value){if(allowToggle!=value){allowToggle=value;if(allowToggle){if(that.move)startDragging();}else{if(!_controls&&that.move)stopDragging();}}}});function startDragging(){if(that.move=="always")return;if(draggingCheck)return;draggingCheck=true;shape.drag({onTop:false});moveDownEvent=shape.on("mousedown",moveDownEvent);movePressEvent=shape.on("pressmove",movePressEvent);moveUpEvent=shape.on("pressup",moveUpEvent);}
function stopDragging(making){if(that.move=="always")return;if(!making&&!draggingCheck)return;draggingCheck=false;shape.noDrag();shape.off("mousedown",moveDownEvent);shape.off("pressmove",movePressEvent);shape.off("pressup",moveUpEvent);}
Object.defineProperty(that,'controlsVisible',{get:function(){return _controls;},set:function(value){_controls=value;if(value){that.showControls();}else{that.hideControls();}}});var _lockControls=lockControls;Object.defineProperty(that,'lockControls',{get:function(){return _lockControls;},set:function(value){_lockControls=value;if(value){that.controls.mouseChildren=false;that.controls.mouseEnabled=false;}else{that.controls.mouseChildren=true;that.controls.mouseEnabled=true;}}});that.lockControls=_lockControls;if(typeof KEYFOCUS!==typeof undefined)zim.KEYFOCUS=KEYFOCUS;Object.defineProperty(this,'keyFocus',{get:function(){return zim.KEYFOCUS==that;},set:function(value){zim.KEYFOCUS=that;}});if(that.selectPoints&&!zim.KEYFOCUS)setFocus();function setFocus(){that.keyFocus=true;var d=document.activeElement;if(d)d.blur();}
Object.defineProperty(that,'points',{get:function(){var points=[];var point;var p;for(var i=0;i<_points.length;i++){p=_points[i];point=[zim.decimals(p[0].x),zim.decimals(p[0].y),zim.decimals(p[1].x),zim.decimals(p[1].y),zim.decimals(p[2].x),zim.decimals(p[2].y),zim.decimals(p[3].x),zim.decimals(p[3].y)];if(p[4]&&p[4]!=="straight")point.push(p[4]);points.push(point);}
return points;},set:function(value){var x=that.x;var y=that.y;var v=that.visible;that.dispose(true);points=checkForShape(value);if(that.shape){that.shape.graphics.clear();that.sticks.graphics.clear();that.controls.noDrag();that.removeAllChildren();delete that.shape;delete that.sticks;delete that.controls;}
that.visible=false;init();that.lockControls=_lockControls;that.x=x;that.y=y;that.visible=v;}});Object.defineProperty(that,'pointsAdjusted',{get:function(){var points=[];var point;var p;var po;var pObjects=that.pointObjects;zim.loop(pObjects.length,function(i,t){po=pObjects[i];p=_points[i];if(po[0].rotation==0&&po[0].scaleX==0&&po[0].scaleY==0){point=[zim.decimals(p[0].x),zim.decimals(p[0].y),zim.decimals(p[1].x),zim.decimals(p[1].y),zim.decimals(p[2].x),zim.decimals(p[2].y),zim.decimals(p[3].x),zim.decimals(p[3].y)];}else{var lo1=po[0].localToLocal(po[2].x,po[2].y,po[0].parent);var lo2=po[0].localToLocal(po[3].x,po[3].y,po[0].parent);point=[zim.decimals(p[0].x),zim.decimals(p[0].y),zim.decimals(p[1].x),zim.decimals(p[1].y),zim.decimals(lo1.x-p[0].x),zim.decimals(lo1.y-p[0].y),zim.decimals(lo2.x-p[0].x),zim.decimals(lo2.y-p[0].y)];}
if(p[4]&&p[4]!=="mirror")point.push(p[4]);points.push(point);});return points;},set:function(value){if(zon)zogy("Blob() - pointsAdjusted is read only");}});Object.defineProperty(that,'pointObjects',{get:function(){return _points;},set:function(value){if(zon){zog("Blob() - pointObjects is read only - but its contents can be manipulated - use blob.update() after changes");}}});Object.defineProperty(that,'pointControls',{get:function(){return _pointControls;},set:function(value){if(zon){zog("Blob() - pointControls is read only - but its contents can be manipulated - use blob.update() after changes");}}});Object.defineProperty(that,'pointCircles',{get:function(){return _pointCircles;},set:function(value){if(zon){zog("Blob() - pointCircles is read only - but its contents can be manipulated - use blob.update() after changes");}}});Object.defineProperty(that,'segmentPoints',{get:function(){var p=that.pointsAdjusted;var array=[];zim.loop(p.length,function(i,t){var s=that.getSegmentPoint(p[i],p[i<t-1?i+1:0]);array.push(s);});return array;},set:function(value){if(zon){zog("Blob() - segmentPoints is read only");}}});Object.defineProperty(that,'segmentRatios',{get:function(){var distances=[];var total=0;zim.loop(that.segmentPoints,function(points){var d=zim.distanceAlongCurve(points);distances.push(d);total+=d;});var percents=[];var totalPercents=0;zim.loop(distances,function(d){var p=d/total;totalPercents+=p;percents.push(totalPercents);});return percents;},set:function(value){if(zon){zog("Blob() - segmentRatios is read only");}}});that.approximateBounds=function(num,showPoints){if(zot(num))num=80;num/=that.num;var points=that.interpolate(num,null,true,null,true);var bounds=zim.boundsAroundPoints(points);that.setBounds(bounds.x,bounds.y,bounds.width,bounds.height);if(showPoints){if(!that.parent){if(zon)zogy("approximateBounds() - add to stage to first to see points");return that;}
if(!that.hitPathPoints)that.hitPathPoints=new zim.Container().addTo();else that.hitPathPoints.removeAllChildren();that.hitPathPoints.top();for(var i=0;i<points.length;i++){var point=points[i];point=that.localToGlobal(point.x,point.y);new zim.Circle(3).loc(point.x,point.y,that.hitPathPoints);}}
return that;};that.getPointAngle=function(index){var p=that.pointObjects[index][0];var r1=that.pointObjects[index][2];var r2=that.pointObjects[index][3];if(p==that.stage){var globalR1=new zim.Point(r1.x,r1.y);var globalR2=new zim.Point(r2.x,r2.y);}else{var globalR1=p.localToGlobal(r1.x,r1.y);var globalR2=p.localToGlobal(r2.x,r2.y);}
return zim.angle(globalR1.x,globalR1.y,globalR2.x,globalR2.y);};that.getSegmentPoint=function(point1,point2){if(zot(point1)||zot(point2))return;if(point1[2]!=0||point1[3]!=0){point1[4]-=point1[2];point1[5]-=point1[3];point1[6]-=point1[2];point1[7]-=point1[3];point1[0]+=point1[2];point1[1]+=point1[3];point1[2]=0;point1[3]=0;}
if(point2[2]!=0||point2[3]!=0){point2[4]-=point2[2];point2[5]-=point2[3];point2[6]-=point2[2];point2[7]-=point2[3];point2[0]+=point2[2];point2[1]+=point2[3];point2[2]=0;point2[3]=0;}
var p1={x:point1[0],y:point1[1]};var p2={x:point1[0]+point1[6],y:point1[1]+point1[7]};var p3={x:point2[0]+point2[4],y:point2[1]+point2[5]};var p4={x:point2[0],y:point2[1]};if(sets.x!=0||sets.y!=0){p1.x+=sets.x;p2.x+=sets.x;p3.x+=sets.x;p4.x+=sets.x;p1.y+=sets.y;p2.y+=sets.y;p3.y+=sets.y;p4.y+=sets.y;}
return[p1,p2,p3,p4];};that.getAdjacentSegmentData=function(index){if(zot(index))index=0;var p=that.pointsAdjusted;if(that.num==2){return[[that.getSegmentPoint(p[0],p[1]),that.getSegmentPoint(p[1],p[0])],[0,1]];}
if(index==0){return[[that.getSegmentPoint(p[that.num-1],p[0]),that.getSegmentPoint(p[0],p[1]),that.getSegmentPoint(p[1],p[2])],[that.num-1,0,1]];}else if(index>=that.num-1){return[[that.getSegmentPoint(p[that.num-2],p[that.num-1]),that.getSegmentPoint(p[that.num-1],p[0]),that.getSegmentPoint(p[0],p[1])],[that.num-2,that.num-1,0]];}else{var lastIndex=(index+2>=that.num)?0:index+2;return[[that.getSegmentPoint(p[index-1],p[index]),that.getSegmentPoint(p[index],p[index+1]),that.getSegmentPoint(p[index+1],p[lastIndex])],[index-1,index,index+1]];}};that.getCurvePoint=function(ratio,segmentRatios,segmentPoints,getAngle){if(zot(segmentRatios))segmentRatios=that.segmentRatios;if(zot(segmentPoints))segmentPoints=that.segmentPoints;if(zot(getAngle))getAngle=false;var percents=segmentRatios;var segments=segmentPoints;var afterIndex=zim.loop(percents,function(p,i){if(p>=ratio)return i;});var earlierPercent=afterIndex>0?percents[afterIndex-1]:0;var localTotal=afterIndex>0?(percents[afterIndex]-percents[afterIndex-1]):percents[afterIndex];var localPercent=(ratio-earlierPercent)/localTotal;var finalPoint=zim.pointAlongCurve(segments[afterIndex],localPercent,getAngle,true);if(zot(finalPoint))return undefined;var finalFinalPoint=that.localToGlobal(finalPoint.x,finalPoint.y);finalFinalPoint.angle=finalPoint.angle;finalFinalPoint.z=afterIndex;return!zot(finalFinalPoint)?finalFinalPoint:undefined;};function proportion(p1,p2,ratio){return{x:p1.x+(p2.x-p1.x)*ratio,y:p1.y+(p2.y-p1.y)*ratio};}
function insertPointData(points,controls,ratios,percent,controlType,skipPoint,dataOnly,even){var index=points.length-1;var lastRatio=0;var currentRatio=0;if(percent==100&&that.type=="Squiggle")percent=99.99;percent=(percent+100000)%100;zim.loop(ratios,function(ratio,i){if(percent/100<ratio){index=i;currentRatio=ratio;return true;}
lastRatio=ratio;});var segment=that.segmentPoints[index];var r=currentRatio>0?(percent/100-lastRatio)/(currentRatio-lastRatio):0;var point=zim.pointAlongCurve(segment,r,null,even);var newPoint=[point.x,point.y,0,0];if(skipPoint)return;if(dataOnly){that.interpolatedPoints.push({x:point.x,y:point.y,r:percent/100});return;}
if(controlType!="none"){var startHandle=proportion(segment[0],segment[1],r);var midPoint=proportion(segment[1],segment[2],r);var endHandle=proportion(segment[2],segment[3],r);var newStartHandle=proportion(startHandle,midPoint,r);var newEndHandle=proportion(midPoint,endHandle,r);newPoint[4]=newStartHandle.x-point.x;newPoint[5]=newStartHandle.y-point.y;newPoint[6]=newEndHandle.x-point.x;newPoint[7]=newEndHandle.y-point.y;var start=that.localToLocal(startHandle.x,startHandle.y,controls[index]);points[index][6]=start.x;points[index][7]=start.y;var end=that.localToLocal(endHandle.x,endHandle.y,controls[(index+1)%points.length]);points[(index+1)%points.length][4]=end.x;points[(index+1)%points.length][5]=end.y;}
if(controlType)newPoint[8]=controlType;points.splice(index+1,0,newPoint);}
this.addPoint=function(percent,controlType){if(zot(percent))percent=100;var points=that.points;var ratios=that.segmentRatios;var controls=that.pointControls;controlType=controlType?controlType:originalControlType;insertPointData(points,controls,ratios,percent,controlType);that.points=points;that.num=points.length;return that;};this.addPoints=function(num,controlType,startPoint,spread,dataOnly,points,even){if(zot(points))points=zim.copy(that.points);var ratios=zim.copy(that.segmentRatios);var lastRatio=0;if(dataOnly)that.interpolatedPoints=[];if(spread)var totalPoints=ratios.length*num;zim.loop(ratios,function(ratio,j){if(dataOnly)insertPointData(points,that.pointControls,that.segmentRatios,lastRatio*100,controlType,!zot(startPoint)&&j!=startPoint,dataOnly,even);var numCount=spread?Math.round(totalPoints*(ratio-lastRatio)):num;var div=1/(numCount+1);zim.loop(numCount,function(i){var r=lastRatio+(ratio-lastRatio)*div*(i+1);insertPointData(points,that.pointControls,that.segmentRatios,r*100,controlType,!zot(startPoint)&&j!=startPoint,dataOnly,even);if(!dataOnly&&num>0)that.points=points;});lastRatio=ratio;});if(dataOnly&&that.type=="Squiggle")insertPointData(points,that.pointControls,that.segmentRatios,100,controlType,null,dataOnly,even);if(that.stage)that.stage.update();that.num=points.length;return that;};this.interpolate=function(num,startPoint,spread,points,even){if(zot(num))num=1;that.addPoints(num,"none",startPoint,spread,true,points,even);return that.interpolatedPoints;};this.dispose=function(temp,d,disposing){if(!that.shape)return;zim.gD(that);if(stage&&that.toggleStageEvent)stage.off("stagemousedown",that.toggleStageEvent);that.controls.noDrag();that.controls.removeAllEventListeners();if(that.selectPoints&&that.selectionManager)that.selectionManager.dispose();that.selectedBalls=null;that.selectedRect1s=null;that.selectedRect2s=null;that.selectionManager=null;that.off("mousedown",that.toggleEvent);that.off("click",that.clickEvent);if(temp){that.shape.dispose();that.shape=null;for(var i=0;i<that.points.length;i++){that.pointObjects[i][0].removeAllEventListeners();that.pointObjects[i][1].removeAllEventListeners();that.pointObjects[i][2].removeAllEventListeners();that.pointObjects[i][3].removeAllEventListeners();}
that.controls.removeFrom(that);that.sticks.dispose();_points=null;_pointCircles=null;}else{that.removeAllEventListeners();_points=null;_pointCircles=null;if(!disposing)this.zimCustomShape_dispose(true);}
return true;};};zim.extend(zim.Blob,zim.CustomShape,["clone","dispose"],"zimCustomShape",false);zim.Flare=function(color,borderColor,borderWidth,crossAngle,thickness,thicknessA,thicknessB,pin,startX,startY,lengths,angles,anglesA,anglesB,anglesEnd,cross,crossColors,close,dashed,strokeObj,spineColor,spineBorderWidth,spineBorderColor,spineDashed,spineStrokeObj,closeColor,closeBorderWidth,closeBorderColor,closeDashed,closeStrokeObj,style,group,inherit){var sig="color, borderColor, borderWidth, crossAngle, thickness, thicknessA, thicknessB, pin, startX, startY, lengths, angles, anglesA, anglesB, anglesEnd, cross, crossColors, close, dashed, strokeObj, spineColor, spineBorderWidth, spineBorderColor, spineDashed, spineStrokeObj, closeColor, closeBorderWidth, closeBorderColor, closeDashed, closeStrokeObj, style, group, inherit";var duo;if(duo=zob(zim.Flare,arguments,sig,this))return duo;z_d("53.6");this.zimContainer_constructor();this.type="Flare";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);var that=this;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:null;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(color))color=DS.color!=null?DS.color:(borderWidth>0?"rgba(0,0,0,0)":"black");if(zot(borderWidth)||borderWidth>0){if(!zot(borderColor)||!zot(borderWidth)){if(zot(borderColor))borderColor="black";}}
if(zot(crossAngle))crossAngle=DS.crossAngle!=null?DS.crossAngle:0;var crossAngleOriginal=crossAngle;crossAngle-=90;if(zot(thickness))thickness=DS.thickness!=null?DS.thickness:null;if(zot(thicknessA))thicknessA=DS.thicknessA!=null?DS.thicknessA:null;if(zot(thicknessB))thicknessB=DS.thicknessB!=null?DS.thicknessB:null;if(zot(thickness)){if(zot(thicknessB)&&!zot(thicknessA))thicknessB=thicknessA;else if(zot(thicknessA)&&!zot(thicknessB))thicknessA=thicknessB;else thicknessB=thicknessA=10;}else{if(zot(thicknessB)&&!zot(thicknessA))thicknessB=thickness-thicknessA;else if(zot(thicknessA)&&!zot(thicknessB))thicknessA=thickness-thicknessB;else thicknessB=thicknessA=thickness/2;}
that.thickness=thicknessA+thicknessB;if(zot(cross))cross=DS.cross!=null?DS.cross:true;if(zot(crossColors))crossColors=DS.crossColors!=null?DS.crossColors:null;if(!zot(crossColors)&&!Array.isArray(crossColors))crossColors=[crossColors];if(zot(close))close=DS.close!=null?DS.close:false;if(zot(startX))startX=DS.startX!=null?DS.startX:0;if(zot(startY))startY=DS.startY!=null?DS.startY:0;if(zot(lengths))lengths=DS.lengths!=null?DS.lengths:[200];if(!Array.isArray(lengths))lengths=[lengths];if(zot(angles))angles=DS.angles!=null?DS.angles:[0];if(!Array.isArray(angles))angles=[angles];if(zot(anglesA))anglesA=DS.anglesA!=null?DS.anglesA:[10];if(!Array.isArray(anglesA))anglesA=[anglesA];if(zot(anglesB))anglesB=DS.anglesB!=null?DS.anglesB:zim.copy(anglesA);if(!Array.isArray(anglesB))anglesB=[anglesB];if(zot(anglesEnd))anglesEnd=DS.anglesEnd!=null?DS.anglesEnd:[0];if(!Array.isArray(anglesEnd))anglesEnd=[anglesEnd];if(zot(strokeObj))strokeObj=DS.strokeObj!=null?DS.strokeObj:{miterLimit:2};if(zot(spineBorderColor))spineBorderColor=DS.spineBorderColor!=null?DS.spineBorderColor:null;if(zot(spineBorderWidth))spineBorderWidth=DS.spineBorderWidth!=null?DS.spineBorderWidth:null;if(spineBorderColor<0||spineBorderWidth<0)spineBorderColor=spineBorderWidth=null;else if(spineBorderColor!=null&&spineBorderWidth==null)spineBorderWidth=1;if(zot(spineColor))spineColor=DS.spineColor!=null?DS.spineColor:(spineBorderWidth>0?"rgba(0,0,0,0)":"black");if(zot(spineDashed))spineDashed=DS.spineDashed!=null?DS.spineDashed:null;if(zot(spineStrokeObj))spineStrokeObj=DS.spineStrokeObj!=null?DS.spineStrokeObj:{miterLimit:2};if(zot(spineBorderWidth)||spineBorderWidth>0){if(!zot(spineBorderColor)||!zot(spineBorderWidth)){if(zot(spineBorderColor))spineBorderColor=borderColor?borderColor:"black";}}
if(zot(closeBorderColor))closeBorderColor=DS.closeBorderColor!=null?DS.closeBorderColor:null;if(zot(closeBorderWidth))closeBorderWidth=DS.closeBorderWidth!=null?DS.closeBorderWidth:null;if(closeBorderColor<0||closeBorderWidth<0)closeBorderColor=closeBorderWidth=null;else if(closeBorderColor!=null&&closeBorderWidth==null)closeBorderWidth=1;if(zot(closeColor))closeColor=DS.closeColor!=null?DS.closeColor:(closeBorderWidth>0?"rgba(0,0,0,0)":null);if(zot(closeDashed))closeDashed=DS.closeDashed!=null?DS.closeDashed:null;if(zot(closeStrokeObj))closeStrokeObj=DS.closeStrokeObj!=null?DS.closeStrokeObj:{miterLimit:2};if(zot(closeBorderWidth)||closeBorderWidth>0){if(!zot(closeBorderColor)||!zot(closeBorderWidth)){if(zot(closeBorderColor))closeBorderColor=borderColor?borderColor:"black";}}
this.thicknessA=thicknessA;this.thicknessB=thicknessB;this.cross=cross;this.close=close;this.lengths=lengths;this.angles=angles;this.anglesA=anglesA;this.anglesB=anglesB;this.anglesEnd=anglesEnd;this.crossColors=crossColors;drawShape(lengths,angles,anglesA,anglesB,anglesEnd,cross,crossColors,close);function drawShape(lengths,angles,anglesA,anglesB,anglesEnd,cross,crossColors,close){that.removeAllChildren();var s=that.shape=new zim.Shape().addTo(that);that.colorCommand=s.c().f(color).command;if(color&&color.type)that.specialColor(that.colorCommand,color);if(zot(borderWidth)||borderWidth>0){if(!zot(borderColor)||!zot(borderWidth)){if(zot(borderColor))borderColor="black";that.borderColorCommand=s.s(borderColor).command;if(borderColor&&borderColor.type)that.specialColor(that.borderColorCommand,borderColor);that.borderWidthCommand=s.ss(borderWidth,strokeObj.caps,strokeObj.joints,strokeObj.miterLimit,strokeObj.ignoreScale).command;if(dashed)that.borderDashedCommand=s.sd([10,10],5).command;}}
s.mt(0,0);if(spineBorderWidth>0){var spineS=that.spineShape=new zim.Shape().addTo(that);that.spineColorCommand=spineS.c().f(spineColor).command;if(spineColor&&spineColor.type)that.specialColor(that.spineColorCommand,spineColor);if(zot(spineBorderWidth)||spineBorderWidth>0){if(!zot(spineBorderColor)||!zot(spineBorderWidth)){if(zot(spineBorderColor))spineBorderColor="black";that.spineBorderColorCommand=spineS.s(spineBorderColor).command;if(spineBorderColor&&spineBorderColor.type)that.specialColor(that.spineBorderColorCommand,spineBorderColor);that.spineBorderWidthCommand=spineS.ss(spineBorderWidth,spineStrokeObj.caps,spineStrokeObj.joints,spineStrokeObj.miterLimit,spineStrokeObj.ignoreScale).command;if(spineDashed)that.spineBorderDashedCommand=spineS.sd([10,10],5).command;}}}
if(!zot(closeColor)){var closeS=that.closeShape=new zim.Shape().addTo(that);that.closeColorCommand=closeS.c().f(closeColor).command;if(closeColor&&closeColor.type)that.specialColor(that.closeColorCommand,closeColor);if(zot(closeBorderWidth)||closeBorderWidth>0){if(!zot(closeBorderColor)||!zot(closeBorderWidth)){if(zot(closeBorderColor))closeBorderColor="black";that.closeBorderColorCommand=closeS.s(closeBorderColor).command;if(closeBorder&&closeBorder.type)that.specialColor(that.closeBorderCommand,closeBorderColor);that.closeBorderWidthCommand=closeS.ss(closeBorderWidth,closeStrokeObj.caps,closeStrokeObj.joints,closeStrokeObj.miterLimit,closeStrokeObj.ignoreScale).command;if(closeDashed)that.closeBorderDashedCommand=closeS.sd([10,10],5).command;}}
s.mt(0,0);}
var sX=startX;var sY=startY;var f2=crossAngle;var f=f2-180;var tA=thicknessA;var tB=thicknessB;var lastAngle=angles[0];var num=Math.max(lengths.length,angles.length,anglesA.length,anglesB.length,anglesEnd.length);var lastB,lastC;var lastAngle=f;var pointsA=[];var pointsB=[];var pointsC=[];var points=that.points=[];var spines=that.pinPoints=[];zim.loop(num,function(i,t){var data=getSegment(i);var cosine=Math.cos(data.a*zim.RAD);var sine=Math.sin(data.a*zim.RAD);var AA=new zim.Point(sX+data.A.x*cosine-data.A.y*sine,sY+data.A.x*sine+data.A.y*cosine);var BB=new zim.Point(sX+data.B.x*cosine-data.B.y*sine,sY+data.B.x*sine+data.B.y*cosine);var CC=new zim.Point(sX+data.C.x*cosine-data.C.y*sine,sY+data.C.x*sine+data.C.y*cosine);var DD=new zim.Point(sX+data.D.x*cosine-data.D.y*sine,sY+data.D.x*sine+data.D.y*cosine);pointsA.push(AA,BB);pointsB.unshift(CC,DD);pointsC.push([AA,BB,CC,DD]);var FF=new zim.Point(sX+data.F.x*cosine-data.F.y*sine,sY+data.F.x*sine+data.F.y*cosine);var EE=new zim.Point(sX+data.E.x*cosine-data.E.y*sine,sY+data.E.x*sine+data.E.y*cosine);if(i==0)that.pinPoints.push(FF);that.pinPoints.push(EE);sX=EE.x;sY=EE.y;tA=data.tA;tB=data.tB;});that.points=pointsA.concat(pointsB);if(!cross){zim.loop(pointsA,function(point,i){if(i==0)s.mt(point.x,point.y);else s.lt(point.x,point.y);});if(close){s.lt(pointsA[0].x,pointsA[0].y);s.cp();}
zim.loop(pointsB,function(point,i){if(i==0&&close)s.mt(point.x,point.y);else s.lt(point.x,point.y);});if(close){s.lt(pointsB[0].x,pointsB[0].y);}
s.cp();}else{zim.loop(pointsC,function(points,i){s.mt(points[0].x,points[0].y);if(!zot(crossColors)&&!zot(crossColors[i]))s.f(crossColors[i]).mt(points[0].x,points[0].y);s.lt(points[1].x,points[1].y).lt(points[2].x,points[2].y).lt(points[3].x,points[3].y).cp();});if(close){s.mt(pointsC[pointsC.length-1][1].x,pointsC[pointsC.length-1][1].y).lt(pointsC[pointsC.length-1][2].x,pointsC[pointsC.length-1][2].y).lt(pointsC[0][3].x,pointsC[0][3].y).lt(pointsC[0][0].x,pointsC[0][0].y).cp();}}
if(spineS){zim.loop(spines,function(spine,i){if(i==0)spineS.mt(spine.x,spine.y);else spineS.lt(spine.x,spine.y);});if(close){spineS.lt(spines[0].x,spines[0].y).cp();}}
if(!zot(closeColor)){zim.loop(pointsB,function(point,i){if(i==0)closeS.mt(point.x,point.y);else closeS.lt(point.x,point.y);});if(close){closeS.lt(pointsB[0].x,pointsB[0].y).cp();}}
function getSegment(num){var a=angles[num];var d=lengths[num];var aA=anglesA[num];var aB=anglesB[num];var e=anglesEnd[num];if(crossColors)var cc=crossColors[num];if(zot(a)){a=lastAngle;that.angles[num]=a;}
if(zot(d)){d=200;that.lengths[num]=d;}
if(zot(aA)){aA=0;that.anglesA[num]=aA;}
if(zot(aB)){aB=0;that.anglesB[num]=aB;}
if(zot(e)){e=0;that.anglesEnd[num]=e;}
if(crossColors&&zot(cc)){cc=color;that.crossColors[num]=cc;}
e=e+90;var e2=180-e;var cosine=Math.cos((lastAngle-a)*zim.RAD);var sine=Math.sin((lastAngle-a)*zim.RAD);var F=new zim.Point(0,0);var E=new zim.Point(d,0);if(zot(lastB)){var A=new zim.Point(Math.cos(f2*zim.RAD)*tA,Math.sin(f2*zim.RAD)*tA);}else{A=new zim.Point(lastB.x*cosine-lastB.y*sine,lastB.x*sine+lastB.y*cosine);}
var pA=getEnd(d,A.x,A.y,aA,e2);var B=new zim.Point(d-pA.x,-pA.y);if(zot(lastC)){var D=new zim.Point(Math.cos(f*zim.RAD)*tA,Math.sin(f*zim.RAD)*tB);}else{var D=new zim.Point(lastC.x*cosine-lastC.y*sine,lastC.x*sine+lastC.y*cosine);}
var pB=getEnd(d,D.x,D.y,aB,e);var C=new zim.Point(d-pB.x,pB.y);lastB=new zim.Point(B.x-d,B.y);lastC=new zim.Point(C.x-d,C.y);lastAngle=a;return{a:a,A:A,B:B,C:C,D:D,E:E,F:F,tA:pA.t,tB:pB.t};}
function getEnd(dist,frontX,frontY,flare,endAngle){var u=endAngle-90;var w=90-u;var v=180-flare-w;var n=Math.tan(u*zim.RAD)*frontY;var s=dist-frontX-n;var t1=s/Math.sin(v*zim.RAD)*Math.sin(flare*zim.RAD);var t2=Math.sqrt(Math.pow(frontY,2)+Math.pow(n,2));var t=t1+t2;var x=t*Math.sin(u*zim.RAD);var y=t*Math.cos(u*zim.RAD);return{x:x,y:y,t:t};}}
this.add=function(lengths,angles,anglesA,anglesB,anglesEnd,cross,crossColors,close){var sig="lengths, angles, anglesA, anglesB, anglesEnd, cross, crossColors, close";var duo;if(duo=zob(that.add,arguments,sig))return duo;if(!zot(cross))that.cross=cross;if(!zot(close))that.close=close;if(!zot(lengths)){if(!Array.isArray(lengths))lengths=[lengths];if(zot(that.lengths))that.lengths=lengths;else that.lengths=that.lengths.concat(lengths);}
if(!zot(angles)){if(!Array.isArray(angles))angles=[angles];if(zot(that.angles))that.angles=angles;else that.angles=that.angles.concat(angles);}
if(!zot(anglesA)){if(!Array.isArray(anglesA))anglesA=[anglesA];if(zot(that.anglesA))that.anglesA=anglesA;else that.anglesA=that.anglesA.concat(anglesA);}
if(!zot(anglesB)){if(!Array.isArray(anglesB))anglesB=[anglesB];if(zot(that.anglesB))that.anglesB=anglesB;else that.anglesB=that.anglesB.concat(anglesB);}
if(!zot(anglesEnd)){if(!Array.isArray(anglesEnd))anglesEnd=[anglesEnd];if(zot(that.anglesEnd))that.anglesEnd=anglesEnd;else that.anglesEnd=that.anglesEnd.concat(anglesEnd);}
if(!zot(crossColors)){if(zot(that.crossColors)){if(zon)zogy("Flare() - must set crossColor for original object parameters");}else{if(!Array.isArray(crossColors))crossColors=[crossColors];if(zot(that.crossColors))that.crossColors=crossColors;else that.crossColors=that.crossColors.concat(crossColors);}}
that.remake();return that;};this.remake=function(){thicknessA=this.thicknessA;thicknessB=this.thicknessB;drawShape(that.lengths,that.angles,that.anglesA,that.anglesB,that.anglesEnd,that.cross,that.crossColors,that.close);return that;};Object.defineProperty(that,'color',{get:function(){return color;},set:function(value){if(zot(value))value="black";color=value;if(value&&value.type)that.specialColor(that.colorCommand,value);else that.colorCommand.style=value;}});var startColor;var endColor;this.setColorRange=function(color1,color2){if(zot(color2)){startColor=that.color;endColor=color1;}else if(zot(color1)){startColor=that.color;endColor=color2;}else{startColor=color1;endColor=color2;}
return that;};var colorRange=0;Object.defineProperty(that,'colorRange',{get:function(){return colorRange;},set:function(value){colorRange=value;if(!zot(startColor)&&!zot(endColor)){that.color=zim.colorRange(startColor,endColor,value);}}});Object.defineProperty(that,'borderColor',{get:function(){return borderColor;},set:function(value){borderColor=value;if(!that.borderColorCommand)drawShape();else if(value&&value.type)that.specialColor(that.borderColorCommand,value);else that.borderColorCommand.style=value;}});Object.defineProperty(that,'borderWidth',{get:function(){return borderWidth;},set:function(value){if(!(value>0))value=0;borderWidth=value;if(!that.borderWidthCommand||borderWidth==0)drawShape();else{that.borderWidthCommand.width=borderWidth;if(dashed){that.borderDashedCommand.segments=[20,10];that.borderDashedCommand.offset=5;}}}});Object.defineProperty(that,'spineColor',{get:function(){return spineColor;},set:function(value){if(zot(value))value="black";spineColor=value;if(!that.spineColorCommand)drawShape();else if(value&&value.type)that.specialColor(that.spineColorCommand,value);else that.spineColorCommand.style=value;}});Object.defineProperty(that,'spineBorderColor',{get:function(){return spineBorderColor;},set:function(value){spineBorderColor=value;if(!that.spineBorderColorCommand)drawShape();else if(value&&value.type)that.specialColor(that.spineBorderColorCommand,value);else that.spineBorderColorCommand.style=value;}});Object.defineProperty(that,'spineBorderWidth',{get:function(){return spineBorderWidth;},set:function(value){if(!(value>0))value=0;spineBorderWidth=value;if(!that.spineBorderWidthCommand||spineBorderWidth==0)drawShape();else{that.spineBorderWidthCommand.width=spineBorderWidth;if(spineDashed){that.spineBorderDashedCommand.segments=[20,10];that.spineBorderDashedCommand.offset=5;}}}});Object.defineProperty(that,'closeColor',{get:function(){return closeColor;},set:function(value){if(zot(value))value="black";closeColor=value;if(!that.closeColorCommand)drawShape();else if(value&&value.type)that.specialColor(that.closeColorCommand,value);else that.closeColorCommand.style=value;}});Object.defineProperty(that,'closeBorderColor',{get:function(){return closeBorderColor;},set:function(value){closeBorderColor=value;if(!that.closeBorderColorCommand)drawShape();else if(value&&value.type)that.specialColor(that.closeBorderColorCommand,value);else that.closeBorderColorCommand.style=value;}});Object.defineProperty(that,'closeBorderWidth',{get:function(){return closeBorderWidth;},set:function(value){if(!(value>0))value=0;closeBorderWidth=value;if(!that.closeBorderWidthCommand||closeBorderWidth==0)drawShape();else{that.closeBorderWidthCommand.width=closeBorderWidth;if(closeDashed){that.closeBorderDashedCommand.segments=[20,10];that.closeBorderDashedCommand.offset=5;}}}});Object.defineProperty(that,'pin',{get:function(){return pin;},set:function(value){if(!(value>0))value=0;if(value>that.pinPoints.length-1)pin=0;pin=value;var point=that.pinPoints[pin];if(point){that.regX=point.x;that.regY=point.y;}}});var b=zim.boundsAroundPoints(that.points);this.setBounds(b.x,b.y,b.width,b.height);if(!zot(pin))that.pin=pin;this.mouseChildren=false;if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Flare(color,borderColor,borderWidth,crossAngleOriginal,zim.copy(thickness),zim.copy(thicknessA),zim.copy(thicknessB),pin,startX,startY,zim.copy(lengths),zim.copy(angles),zim.copy(anglesA),zim.copy(anglesB),zim.copy(anglesEnd),cross,zim.copy(crossColors),close,dashed,strokeObj,spineColor,spineBorderWidth,spineBorderColor,spineDashed,spineStrokeObj,closeColor,closeBorderWidth,closeBorderColor,closeDashed,closeStrokeObj,style,this.group,inherit));};};zim.extend(zim.Flare,zim.Container,["clone"],"zimContainer",false);zim.MultiFlare=function(flares,pins,angles,endToEnd,style,group,inherit){var sig="flares, pins, angles, endToEnd, style, group, inherit";var duo;if(duo=zob(zim.MultiFlare,arguments,sig,this))return duo;z_d("53.7");this.zimContainer_constructor();this.type="MultiFlare";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);var that=this;if(zot(flares))flares=DS.flares!=null?DS.flares:[];if(!Array.isArray(flares))flares=[flares];if(zot(pins))pins=DS.pins!=null?DS.pins:null;if(zot(angles))angles=DS.angles!=null?DS.angles:null;if(zot(endToEnd))endToEnd=DS.endToEnd!=null?DS.endToEnd:false;that.flares=flares;that.pins=pins;that.angles=angles;that.endToEnd=endToEnd;that.mouseChildren=false;that.add=function(f,clone){if(zot(f))return that;if(zot(clone))clone=true;if(!Array.isArray(f))f=[f];zim.loop(f,function(flare){if(clone)that.flares.push(flare.clone());else that.flares.push(flare);});that.remake();if(that.stage)that.stage.update();return that;};that.remove=function(f){if(zot(f))return that;if(!Array.isArray(f))f=[f];zim.loop(f,function(flare){var index=that.flares.indexOf(flare);if(index>=0)that.flares.splice(index,1);});that.remake();if(that.stage)that.stage.update();return that;};that.remake=function(){that.removeAllChildren();zim.loop(that.flares,function(flare,i){if(pins&&!zot(pins[i]))flare.pin=pins[i];if(angles&&!zot(angles[i]))flare.rotation=angles[i];flare.addTo(that);that.flares.push(flare);if(endToEnd){if(i>0){var last=flares[i-1];var lastPoint=last.pinPoints[last.pinPoints.length-1];var point1=last.localToLocal(lastPoint.x,lastPoint.y,that);var firstPoint=flare.pinPoints[0];var point2=flare.localToLocal(firstPoint.x,firstPoint.y,that);flare.mov(point1.x-point2.x,point1.y-point2.y);}}});};that.remake();if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.MultiFlare(zim.copy(flares,true),zim.copy(pins),zim.copy(angles),endToEnd,style,this.group,inherit));};};zim.extend(zim.MultiFlare,zim.Container,["clone"],"zimContainer",false);zim.FlareBox=function(width,height,color,borderColor,borderWidth,flares,corners,pins,style,group,inherit){var sig="width, height, color, borderColor, borderWidth, flares, corners, pins, style, group, inherit";var duo;if(duo=zob(zim.FlareBox,arguments,sig,this))return duo;z_d("53.8");this.group=group;var DS=style===false?{}:zim.getStyle("FlareBox",this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:220;if(zot(height))height=DS.height!=null?DS.height:80;this.zimContainer_constructor(width,height);this.type="FlareBox";var that=this;this.mouseChildren=false;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:null;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(color))color=DS.color!=null?DS.color:(borderWidth>0?"rgba(0,0,0,0)":"black");if(zot(borderWidth)||borderWidth>0){if(!zot(borderColor)||!zot(borderWidth)){if(zot(borderColor))borderColor="black";}}
if(zot(flares))flares=DS.flares!=null?DS.flares:null;if(zot(corners))corners=DS.corners!=null?DS.corners:null;if(zot(pins))pins=DS.pins!=null?DS.pins:null;that.backing=new zim.Rectangle(width,height,color,borderColor,borderWidth).addTo(this);if(zot(flares))return;if(flares.type!="MultiFlare"){if(!Array.isArray(flares)){if(flares.type!="Flare")return;flares=[flares];}
flares=new zim.MultiFlare(flares,pins);}
flares.addTo(that);that.multiFlare=flares;that.flares=that.multiFlare.flares;flares.loop(function(flare,i){if(pins&&!zot(pins[i]))flare.pin=pins[i];else if(zot(flare.pin))flare.pin=0;if(corners&&!zot(corners[i]))flare.corner=corners[i];else if(zot(flare.corner))flare.corner=0;if(flare.corner==1){flare.loc(width,0);}else if(flare.corner==2){flare.loc(width,height);}else if(flare.corner==3){flare.loc(0,height);}else{flare.loc(0,0);}
flare.rot((flare.corner-flare.pin)*90);});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.FlareBox(width,height,color,borderColor,borderWidth,zim.copy(flares,true),zim.copy(corners),zim.copy(pins),style,this.group,inherit));};};zim.extend(zim.FlareBox,zim.Container,["clone"],"zimContainer",false);zim.Label=function(text,size,font,color,rollColor,shadowColor,shadowBlur,align,valign,bold,italic,variant,lineWidth,lineHeight,backing,outlineColor,outlineWidth,backgroundColor,backgroundBorderColor,backgroundBorderWidth,corner,backgroundDashed,padding,paddingHorizontal,paddingVertical,shiftHorizontal,shiftVertical,rollPersist,labelWidth,labelHeight,maxSize,splitWords,style,group,inherit){var sig="text, size, font, color, rollColor, shadowColor, shadowBlur, align, valign, bold, italic, variant, lineWidth, lineHeight, backing, outlineColor, outlineWidth, backgroundColor, backgroundBorderColor, backgroundBorderWidth, corner, backgroundDashed, padding, paddingHorizontal, paddingVertical, shiftHorizontal, shiftVertical, rollPersist, labelWidth, labelHeight, maxSize, splitWords, style, group, inherit";var duo;if(duo=zob(zim.Label,arguments,sig,this))return duo;z_d("54");this.zimContainer_constructor(null,null,null,null,false);this.type="Label";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(text))text=DS.text!=null?DS.text:"LABEL";if(zot(size))size=DS.size!=null?DS.size:36;if(zot(font))font=DS.font!=null?DS.font:"arial";if(zot(color))color=DS.color!=null?DS.color:"black";if(zot(bold))bold=DS.bold!=null?DS.bold:false;if(zot(italic))italic=DS.italic!=null?DS.italic:false;var oa=remember(text,size,font,color,bold,italic);function remember(){return arguments;}
text=zim.Pick.choose(text);var emptyText=false;if(text===""){text=" ";emptyText=true;}
size=zim.Pick.choose(size);font=zim.Pick.choose(font);color=zim.Pick.choose(color);bold=zim.Pick.choose(bold);italic=zim.Pick.choose(italic);if(zot(rollColor))rollColor=DS.rollColor!=null?DS.rollColor:null;if(zot(shadowColor)||shadowColor=="ignore")shadowColor=(DS.shadowColor!=null&&shadowColor!="ignore")?DS.shadowColor:-1;if(zot(shadowBlur)||shadowBlur=="ignore")shadowBlur=(DS.shadowBlur!=null&&shadowBlur!="ignore")?DS.shadowBlur:14;if(zot(align))align=DS.align!=null?DS.align:"left";if(zot(valign))valign=DS.valign!=null?DS.valign:"top";if((!zot(outlineColor)||!zot(DS.outlineColor))&&zot(outlineWidth))outlineWidth=DS.outlineWidth!=null?DS.outlineWidth:Math.round(size*.2);if((!zot(outlineWidth)||!zot(DS.outlineWidth))&&zot(outlineColor))outlineColor=DS.outlineColor!=null?DS.outlineColor:"#000000";if(zot(outlineWidth))outlineWidth=DS.outlineWidth!=null?DS.outlineWidth:0;if(zot(backgroundColor)||backgroundColor=="ignore")backgroundColor=(DS.backgroundColor!=null&&backgroundColor!="ignore")?DS.backgroundColor:null;if(zot(padding)||padding=="ignore")padding=(DS.padding!=null&&padding!="ignore")?DS.padding:10;if(zot(paddingHorizontal))paddingHorizontal=DS.paddingHorizontal!=null?DS.paddingHorizontal:padding;if(zot(paddingVertical))paddingVertical=DS.paddingVertical!=null?DS.paddingVertical:padding;if(zot(shiftHorizontal))shiftHorizontal=DS.shiftHorizontal!=null?DS.shiftHorizontal:0;if(zot(shiftVertical))shiftVertical=DS.shiftVertical!=null?DS.shiftVertical:0;if(zot(variant))variant=DS.variant!=null?DS.variant:false;if(zot(lineWidth))lineWidth=DS.lineWidth!=null?DS.lineWidth:null;if(zot(lineHeight))lineHeight=DS.lineHeight!=null?DS.lineHeight:null;if(zot(backing)||backing=="ignore")backing=(DS.backing!=null&&backing!="ignore")?DS.backing.clone():null;if(zot(rollPersist))rollPersist=DS.rollPersist!=null?DS.rollPersist:false;if(DS.labelWidth!=null)lineWidth=DS.labelWidth;if(!zot(labelWidth))lineWidth=labelWidth;if(align=="middle")align="center";if(zot(labelHeight))labelHeight=DS.labelHeight!=null?DS.labelHeight:null;if(zot(maxSize))maxSize=DS.maxSize!=null?DS.maxSize:null;size=maxSize?Math.min(size,maxSize):size;if(zot(splitWords))splitWords=DS.splitWords!=null?DS.splitWords:false;var retina=(typeof zdf!="undefined"&&zdf.retina);var that=this;this.mouseChildren=false;this.paddingVertical=paddingVertical;this.paddingHorizontal=paddingHorizontal;var options=[];options[0]=italic?"italic":"normal";options[1]=variant?"small-caps":"normal";options[2]=bold?"bold":"normal";options[3]=size+"px";options[4]=font;var opt=options.join(" ");var text=String(text);var obj;function makeLabel(t){var o=new createjs.Text(t,opt,color);o.lineWidth=lineWidth;o.lineHeight=lineHeight;return o;}
obj=makeLabel(text);if(splitWords&&lineWidth>size*1.2){function testLine(l,w,line){var endIndex=Math.ceil(lineWidth/w*line.length);var start=line.substr(0,endIndex);var l2=makeLabel(start);var w2=l2.getMeasuredWidth();if(w2>lineWidth){while(w2>lineWidth){endIndex--;start=line.substr(0,endIndex)
l2=makeLabel(start);w2=l2.getMeasuredWidth();}}else if(w2<lineWidth){while(w2<lineWidth){endIndex++;start=line.substr(0,endIndex)
l2=makeLabel(start);w2=l2.getMeasuredWidth();}
endIndex--;start=line.substr(0,endIndex)}
var end=line.substr(endIndex,line.length);return{endIndex:endIndex,start:start,end:end};}
var metrics=obj.getMetrics();var wCount=0;while(metrics.width>lineWidth&&wCount<1000){wCount++;zim.loop(metrics.lines,function(line,i){line=line.replace(/^[\s\t]+/,"");var l=makeLabel(line);var w=l.getMeasuredWidth();if(w>lineWidth){var dat=testLine(l,w,line);metrics.lines[i]=dat.start;if(metrics.lines.length>i+1){dat.end.trim();metrics.lines[i+1]=dat.end+" "+metrics.lines[i+1];}else{metrics.lines.push(dat.end);}
obj=makeLabel(metrics.lines.join(" "));metrics=obj.getMetrics();return false;}});}}
this.label=obj;obj.textAlign=align;obj.textBaseline="alphabetic";if(outlineWidth>0){var obj2=this.outlineLabel=obj.clone();obj2.color=outlineColor;obj2.outline=outlineWidth;}
if(shadowColor!=-1&&shadowBlur>0)obj.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);this.addChild(obj);var backingPlaced=false;if(zot(backing)&&zot(backgroundColor)){var hitArea=new createjs.Shape();that.hitArea=hitArea;}
function setBackground(){that.removeChild(that.background);that.background=new zim.Rectangle(that.getBounds().width+paddingHorizontal*2,that.getBounds().height+paddingVertical*2,backgroundColor,backgroundBorderColor,backgroundBorderWidth,corner,backgroundDashed,null,false);zim.center(that.background,that,0);that.setBounds(that.background.x,that.background.y,that.background.width,that.background.height);}
function setSize(){var b=obj.getBounds();var yAdjust;if(valign=="baseline"){yAdjust=b.y;}else if(valign=="top"){obj.y=size-size/6;yAdjust=0;}else if(valign=="center"||valign=="middle"){yAdjust=-b.height/2;obj.y=size*.3;}else{yAdjust=-b.height;}
that.setBounds(b.x,yAdjust,DS.width?DS.width-padding*2:b.width,DS.height?DS.height-padding*2:b.height);if(that.hitArea)that.hitArea.graphics.c().f("black").r(that.getBounds().x,that.getBounds().y,that.getBounds().width,that.getBounds().height);if(valign=="center"||valign=="middle"){zim.pos(obj,null,0);zim.mov(obj,0,1);}
if(backing){if(backingPlaced)setBackBounds();}else if(!zot(backgroundColor)){setBackground();}
if(valign!="baseline"&&!retina)obj.y+=size/32;finalShift();}
setSize();if(!zot(backing)){if(backing.type=="Pattern"){that.backing=new zim.Container(that.width+paddingHorizontal*2,that.height+paddingVertical*2,null,null,false).centerReg(null,null,false);if(shadowColor!=-1&&shadowBlur>0){var shadowRect=new zim.Rectangle(that.width+paddingHorizontal*2-2,that.height+paddingVertical-2,"#666",null,null,corner,null,null,false).center(that.backing);shadowRect.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);}
var mask=new zim.Rectangle(that.width+paddingHorizontal*2,that.height+paddingVertical*2,backgroundColor,null,null,corner,null,null,false).addTo(that.backing);backing.centerReg(mask);backing.setMask(mask);that.backing.pattern=backing;}else{that.backing=backing;}
that.backing.center(that,0);backing=that.backing;setBackBounds();backingPlaced=true;}
function setBackBounds(){var bb=backing.boundsToGlobal();var bbb=that.boundsToGlobal(bb,true);that.setBounds(bbb.x,bbb.y,bbb.width,bbb.height);}
function finalShift(){zim.pos(obj,(align=="left"||align=="right")?(backing||that.background?paddingHorizontal:0):null,(valign=="top"||valign=="baseline"||valign=="bottom")?(backing||that.background?paddingVertical:0):null,align=="right",valign=="bottom");obj.x+=shiftHorizontal;obj.y+=shiftVertical;}
finalShift();function setOutline(){if(obj2){obj2.x=obj.x;obj2.y=obj.y;that.addChildAt(obj2,(that.background||that.backing)?1:0);}}
setOutline();Object.defineProperty(that,'text',{get:function(){var t=(obj.text==" "&&emptyText)?"":obj.text;return t;},set:function(value){emptyText=false;if(value===""){value=" ";emptyText=true;}
obj.text=String(value);if(obj2)obj2.text=String(value);setSize();if(!zot(lineWidth)&&!zot(labelHeight)){fitText();if(obj2)setOutline();}}});Object.defineProperty(that,'size',{get:function(){return size;},set:function(value){size=maxSize?Math.min(value,maxSize):value;options[3]=size+"px";this.label.font=options.join(" ");if(obj2)obj2.font=options.join(" ");setSize();}});Object.defineProperty(that,'bold',{get:function(){return Boolean(this.label.font.match("bold"));},set:function(value){options[2]=value?"bold":"normal";this.label.font=options.join(" ");if(obj2)obj2.font=options.join(" ");}});Object.defineProperty(that,'italic',{get:function(){return Boolean(this.label.font.match("italic"));},set:function(value){options[0]=value?"italic":"normal";this.label.font=options.join(" ");if(obj2)obj2.font=options.join(" ");}});Object.defineProperty(that,'variant',{get:function(){return Boolean(this.label.font.match("small-caps"));},set:function(value){options[1]=value?"small-caps":"normal";this.label.font=options.join(" ");if(obj2)obj2.font=options.join(" ");}});Object.defineProperty(that,'font',{get:function(){return options[4];},set:function(value){if(zot(value))return;options[4]=value;this.label.font=options.join(" ");if(obj2)obj2.font=options.join(" ");}});Object.defineProperty(that,'align',{get:function(){return align;},set:function(value){if(zot(value))return;align=value;this.label.textAlign=align;if(obj2)obj2.textAlign=align;setSize();}});Object.defineProperty(that,'valign',{get:function(){return valign;},set:function(value){if(zot(value))return;valign=value;setSize();}});Object.defineProperty(that,'color',{get:function(){return color;},set:function(value){if(rollColor==color)rollColor=value;color=value;obj.color=color;if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});var startColor;var endColor;this.setColorRange=function(color1,color2){if(zot(color2)){startColor=that.color;endColor=color1;}else if(zot(color1)){startColor=that.color;endColor=color2;}else{startColor=color1;endColor=color2;}
return that;};var _colorRange=0;Object.defineProperty(that,'colorRange',{get:function(){return _colorRange;},set:function(value){_colorRange=value;if(!zot(startColor)&&!zot(endColor)){that.color=zim.colorRange(startColor,endColor,value);}}});Object.defineProperty(that,'backgroundColor',{get:function(){return backgroundColor;},set:function(value){backgroundColor=value;if(that.background){that.background.color=value;}else if(that.backing){that.backing.color=value;}else{setBackground();}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});Object.defineProperty(that,'outlineColor',{get:function(){return outlineColor;},set:function(value){outlineColor=value;if(obj2)obj2.color=outlineColor;if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});Object.defineProperty(that,'rollColor',{get:function(){return rollColor;},set:function(value){if(!that.mouseoverEvent&&value)setRollColors();if(value==null&&that.mouseoverEvent)removeRollColors();rollColor=value;}});this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){zenable(that,value);obj.color=color;that.mouseChildren=false;if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});this.showRollColor=function(yes){if(zot(yes))yes=true;if(yes){obj.color=rollColor;}else{obj.color=color;}
if(that.stage)that.stage.update();return that;};function setRollColors(){that.mouseoverEvent=that.on("mouseover",function(e){if(that.showRollColor)that.showRollColor();});that.mouseoutEvent=that.on("mouseout",function(e){if(!that.rollPersist)that.showRollColor(false);});that.pressupEvent=that.on("pressup",function(e){if(that.rollPersist)that.showRollColor(false);});}
function removeRollColors(){that.off("mouseover",that.mouseoverEvent);that.off("mouseout",that.mouseoutEvent);that.off("pressup",that.pressupEvent);}
if(rollColor)setRollColors();Object.defineProperty(that,'labelWidth',{get:function(){return lineWidth;},set:function(value){if(value>0){lineWidth=value;that.label.lineWidth=value;if(obj2)obj2.lineWidth=value;}
if(labelHeight)fitText();if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});Object.defineProperty(that,'labelHeight',{get:function(){return labelHeight;},set:function(value){if(value>0)labelHeight=value;if(lineWidth)fitText();if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});if(!zot(lineWidth)&&!zot(labelHeight)){fitText();}
function fitText(){that.size=200;var count=0;while(lineHeight<labelHeight/2&&(that.height>labelHeight||that.width>lineWidth)){count++;that.size=that.size/2;if(count>50)break;}
count=0;while(that.height<=labelHeight&&that.width<=lineWidth){count++;that.size=Math.ceil(that.size+1);if(count>50)break;}
that.size=that.size-1;setOutline();}
zim.styleTransforms(this,DS);this.clone=function(exact){return that.cloneProps(new zim.Label((exact||!zim.isPick(oa[0]))?that.text:oa[0],(exact||!zim.isPick(oa[1]))?size:oa[1],(exact||!zim.isPick(oa[2]))?font:oa[2],(exact||!zim.isPick(oa[3]))?color:oa[3],rollColor,shadowColor,shadowBlur,align,valign,(exact||!zim.isPick(oa[4]))?bold:oa[4],(exact||!zim.isPick(oa[5]))?italic:oa[5],variant,lineWidth,lineHeight,!zot(backing)?backing.clone(exact):null,outlineColor,outlineWidth,backgroundColor,backgroundBorderColor,backgroundBorderWidth,corner,backgroundDashed,padding,paddingHorizontal,paddingVertical,shiftHorizontal,shiftVertical,rollPersist,labelWidth,labelHeight,maxSize,splitWords,style,this.group,inherit));};};zim.extend(zim.Label,zim.Container,"clone","zimContainer");zim.LabelOnPath=function(label,path,percentAngle,percents,showPath,allowToggle,interactive,onTop,style,group,inherit){var sig="label, path, percentAngle, percents, showPath, allowToggle, interactive, onTop, style, group, inherit";var duo;if(duo=zob(zim.LabelOnPath,arguments,sig,this))return duo;z_d("54.5");this.zimContainer_constructor(null,null,null,null,false);this.type="LabelOnPath";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(label))label=DS.label!=null?DS.label:new zim.Label("Label on Path");if(zot(path))path=DS.path!=null?DS.path:new zim.Squiggle({points:[[0,0,0,0,-86,57,86,-57],[300,150,0,0,-133,21,133,-21]]});if(zot(percentAngle))percentAngle=DS.percentAngle!=null?DS.percentAngle:100;if(zot(percents))percents=DS.percents!=null?DS.percents:null;if(zot(showPath))showPath=DS.showPath!=null?DS.showPath:true;if(zot(allowToggle))allowToggle=DS.allowToggle!=null?DS.allowToggle:true;if(zot(interactive))interactive=DS.interactive!=null?DS.interactive:true;if(zot(onTop))onTop=DS.onTop!=null?DS.onTop:false;var color=label.color;path.addTo(this);var that=this;this.path=path;this.allowToggle=allowToggle;path.interactive=interactive;if(typeof label=="string")label=new zim.Label(label);var lastAlpha=path.alpha;if(!showPath)path.alp(0);path.onTop=onTop;var letters=this.letters=new zim.Container().addTo(this);if(!percents){percents=[];for(var i=0;i<label.text.length;i++){percents.push(zim.decimals(1/(label.text.length-(path.type=="Blob"?0:1))*100*i));}}
this.percents=percents;function setText(){for(var i=letters.numChildren-1;i>=0;i--){letters.getChildAt(i).dispose();}
that.numLetters=label.text.length;for(var i=0;i<that.numLetters;i++){var letter=label.clone();letter.text=label.text[i];letter.centerReg(letters).reg(null,letter.height);if(letter.text!=""&&letter.text!=" ")letter.expand(0);if(that.allowToggle)letter.cursor="pointer";letter.on("mousedown",function(){if(!that.allowToggle)return;that.toggle();});}
that.resize();}
this.resize=function(){var segmentRatios=path.segmentRatios;var segmentPoints=path.segmentPoints;for(var i=0;i<this.numLetters;i++){var point=path.getCurvePoint(percents[i]/100,segmentRatios,segmentPoints,true);if(!point)continue;var locPoint=this.globalToLocal(point.x,point.y);if(!locPoint)continue;letters.getChildAt(i).loc(locPoint).rot((point.angle>180?(point.angle-360):point.angle)*percentAngle/100);}
return this;};setText();this.showPath=function(controls){this.toggle(true);path.toggle(controls);return this;};this.hidePath=function(){this.toggle(false);return this;};Object.defineProperty(that,'text',{get:function(){return label.text;},set:function(value){label.text=value;percents=[];for(var i=0;i<label.text.length;i++){percents.push(zim.decimals(1/(label.text.length-(path.type=="Blob"?0:1))*100*i));}
setText();}});Object.defineProperty(this,'color',{get:function(){return color;},set:function(value){color=value;for(var i=0;i<that.letters.numChildren;i++){that.letters.getChildAt(i).color=color;}
if(that.stage)that.stage.update();}});Object.defineProperty(that,'interactive',{get:function(){return interactive;},set:function(value){interactive=value;path.interactive=value;if(this.ticker)zim.Ticker.remove(this.ticker);if(interactive){this.ticker=zim.Ticker.add(function(){that.resize();});}}});if(this.interactive){this.ticker=zim.Ticker.add(function(){that.resize();});}
var _toggled=that.toggled=showPath;this.toggle=function(state){if(!this.allowToggle)return;if(zot(state))_toggled=!_toggled;else if(state)_toggled=true;else _toggled=false;if(_toggled){path.alp(lastAlpha);if(this.interactive){path.showControls();letters.mouseEnabled=false;letters.mouseChildren=false;letters.cursor="default";if(this.controlHideEvent)path.off("controlshide",this.controlHideEvent);this.controlHideEvent=path.on("controlshide",function(){letters.mouseEnabled=true;letters.mouseChildren=true;letters.cursor="pointer";lastAlpha=path.alpha;path.alp(0);_toggled=false;that.toggled=_toggled;if(that.stage)that.stage.update();},null,true);}}else{lastAlpha=path.alpha;path.alp(0);letters.mouseEnabled=true;letters.mouseChildren=true;letters.cursor="pointer";}
that.toggled=_toggled;if(that.stage)that.stage.update();return that;};that.toggle(true);zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.LabelOnPath(that.label.clone(),that.path.clone(),percentAngle,zim.copy(percents),showPath,allowToggle,interactive,onTop,style,this.group,inherit));};this.dispose=function(a,b,disposing){if(this.ticker)zim.Ticker.remove(this.ticker);if(!disposing)this.zimContainer_dispose(true);return true;};};zim.extend(zim.LabelOnPath,zim.Container,["clone","dispose"],"zimContainer",false);zim.LabelOnArc=function(label,size,font,color,radius,flip,spacing,letterSpacing,angles,showCircle,arcColor,arcBorderColor,arcBorderWidth,radiusSpread,style,group,inherit){var sig="label, size, font, color, radius, flip, spacing, letterSpacing, angles, showCircle, arcColor, arcBorderColor, arcBorderWidth, radiusSpread, style, group, inherit";var duo;if(duo=zob(zim.LabelOnArc,arguments,sig,this))return duo;z_d("54.55");this.group=group;var DS=style===false?{}:zim.getStyle("LabelOnArc",this.group,inherit);if(zot(size))size=DS.size!=null?DS.size:30;if(zot(label))label=DS.label!=null?DS.label:new zim.Label("Label on Arc",size);if(zot(font))font=DS.font!=null?DS.font:"verdana";if(zot(color))color=DS.color!=null?DS.color:"white";if(zot(radius))radius=DS.radius!=null?DS.radius:100;if(zot(flip))flip=DS.flip!=null?DS.flip:false;if(zot(spacing))spacing=DS.spacing!=null?DS.spacing:0;if(zot(letterSpacing))letterSpacing=DS.letterSpacing!=null?DS.letterSpacing:5;if(zot(angles))angles=DS.angles!=null?DS.angles:null;var anglesO=!zot(angles);if(zot(showCircle))showCircle=DS.showCircle!=null?DS.showCircle:false;if(zot(arcColor))arcColor=DS.arcColor!=null?DS.arcColor:null;if(zot(arcBorderColor))arcBorderColor=DS.arcBorderColor!=null?DS.arcBorderColor:null;if(zot(arcBorderWidth))arcBorderWidth=DS.arcBorderWidth!=null?DS.arcBorderWidth:null;if(zot(radiusSpread))radiusSpread=DS.radiusSpread!=null?DS.radiusSpread:false;var outerRadius=this.outerRadius=radius+spacing+label.height;this.innerRadius=radius+spacing;this.zimContainer_constructor(-outerRadius,-outerRadius,outerRadius*2,outerRadius*2,false);this.type="LabelOnArc";var that=this;if(label.type!="Label")label=new zim.Label(label,size,font,color);that.text=label.text;if(flip){var rev=label.text.split("").reverse().join("");label.text=rev;}
var letters=that.letters=new zim.Container(this.width,this.height).centerReg(this);var totalAngle;var rawAngles;that.numLetters=label.text.length;this.letterHeight=label.height;var labels=that.labels=[];for(var i=0;i<that.numLetters;i++){var letter=label.clone();labels.push(letter);letter.text=label.text[i];letter.letterHolder=new zim.Container(letter.width,letter.height);letter.centerReg(letter.letterHolder).rot(flip?180:0);}
var circle=this.circle=new zim.Circle(radius);if(showCircle)circle.addTo(this);var arc=this.arc=new zim.Shape().addTo(this);function makeArc(){totalAngle=0;rawAngles=[0];for(i=0;i<that.numLetters;i++){var letter=labels[i];var ang=Math.atan((letter.width+letterSpacing)/2/(radius+spacing))*180/Math.PI*2;rawAngles.push(ang);totalAngle+=ang;letter.letterHolder.centerReg(letters).reg(null,radius+spacing+letter.height+(flip?letter.height*.13:0));}
that.circle.radius=radius;if(arcColor||arcBorderColor||arcBorderWidth){if(arcBorderWidth>0&&zot(arcBorderColor))arcBorderColor="#000000";else if(zot(arcBorderWidth)&&!zot(arcBorderColor))arcBorderWidth=2;arc.graphics.c().f(null).s(arcBorderColor).ss(arcBorderWidth).arc(0,0,radius,(startAngle-90)*Math.PI/180,(startAngle-90+totalAngle)*Math.PI/180);}}
makeArc();if(angles){totalAngle=0;for(var i=0;i<angles.length;i++){totalAngle+=angles[i];}
totalAngle+=angles[angles.length-1]/2;}
function makeAngles(){if(!anglesO){angles=[];for(var i=0;i<rawAngles.length-1;i++){angles[i]=Math.round((rawAngles[i]+rawAngles[i+1])/2*100)/100;}}
that.angles=angles;var startAngle=that.startAngle=-totalAngle/2;var lastAngle=startAngle;for(var i=0;i<letters.numChildren;i++){var letter=letters.getChildAt(i);var amount=angles[i];lastAngle=letter.rotation=lastAngle+angles[i];}}
makeAngles();Object.defineProperty(this,'radius',{get:function(){return radius;},set:function(value){radius=value;makeArc();if(!anglesO&&!radiusSpread)makeAngles();}});Object.defineProperty(this,'color',{get:function(){return color;},set:function(value){color=value;for(var i=0;i<that.labels.length;i++){that.labels[i].color=color;}
if(that.stage)that.stage.update();}});zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.LabelOnArc(label,size,font,color,radius,flip,spacing,letterSpacing,angles,showCircle,arcColor,arcBorderColor,arcBorderWidth,radiusSpread,style,this.group,inherit));};};zim.extend(zim.LabelOnArc,zim.Container,"clone","zimContainer",false);zim.LabelLetters=function(label,align,valign,letterSpacing,letterSpacings,lineSpacing,lineSpacings,lineHeight,lineAlign,lineValign,cache,rtl,style,group,inherit){var sig="label, align, valign, letterSpacing, letterSpacings, lineSpacing, lineSpacings, lineHeight, lineAlign, lineValign, cache, rtl, style, group, inherit";var duo;if(duo=zob(zim.LabelLetters,arguments,sig,this))return duo;z_d("54.57");this.group=group;var DS=style===false?{}:zim.getStyle("LabelLetters",this.group,inherit);if(zot(label))label=DS.label!=null?DS.label:new zim.Label("Label Letters");if(zot(align))align=DS.align!=null?DS.align:"center";if(zot(valign))valign=DS.valign!=null?DS.valign:"center";if(zot(letterSpacing))letterSpacing=DS.letterSpacing!=null?DS.letterSpacing:5;if(zot(letterSpacings))letterSpacings=DS.letterSpacings!=null?DS.letterSpacings:null;if(zot(lineHeight))lineHeight=DS.lineHeight!=null?DS.lineHeight:null;if(zot(lineSpacing))lineSpacing=DS.lineSpacing!=null?DS.lineSpacing:5;if(zot(lineSpacings))lineSpacings=DS.lineSpacings!=null?DS.lineSpacings:null;if(zot(rtl))rtl=DS.rtl!=null?DS.rtl:false;if(zot(lineAlign))lineAlign=DS.lineAlign!=null?DS.lineAlign:rtl?"right":"left";if(zot(lineValign))lineValign=DS.lineValign!=null?DS.lineValign:"bottom";if(zot(cache))cache=DS.cache!=null?DS.cache:false;this.zimContainer_constructor(null,null,null,null,false);this.type="LabelLetters";var that=this;var letterData=that.letterData=[];var original;if(label.type!="Label"){data=parseHTML(label);letterData=data.data;label=new zim.Label(data.text);}else{data=parseHTML(label.text);letterData=data.data;label.text=data.text;}
that.text=data.original;that._color=label.color;function parseHTML(html){var data=[];if(rtl){count=-1;function insert(data){return data.split("").reverse().join("")}
html=html.replace(/[\u0591-\u07FF]+/ig,insert);html=html.replace(/([^\u0591-\u07FF ])([\u0591-\u07FF])/ig,"$1-!!-$2");html=html.replace(/([\u0591-\u07FF])([^\u0591-\u07FF ])/ig,"$1-!!-$2");html=html.replace(/([^\u0591-\u07FF]) ([\u0591-\u07FF])/ig,"$1-!!- -!!-$2");html=html.replace(/([\u0591-\u07FF]) ([^\u0591-\u07FF])/ig,"$1-!!- -!!-$2");var sp=html.split(/-!!-/g);loop(sp,function(ssp,i){if(ssp.match(/[\u0591-\u07FF]/i)){sp[i]=ssp.split(" ").reverse().join(" ");}});html=sp.join("");}
html=html.replace(/\n|\r/g,"<br>");html=html.replace(/<strong>|<strong \/>|<strong\/>/gi,"<b>");html=html.replace(/<\/strong>/gi,"</b>");html=html.replace(/<em>|<em \/>|<em\/>/gi,"<i>");html=html.replace(/<\/em>/gi,"</i>");html=html.replace(/\\n|\\r/g,"<br>");html=html.replace(/<br>|<br \/>|<br\/>(<\/br>)?/gi,"<br>");html=html.replace(/<b/gi,"<b");html=html.replace(/<i/gi,"<i");html=html.replace(/<u/gi,"<u");html=html.replace(/<br/gi,"<br");html=html.replace(/<a/gi,"<a");html=html.replace(/<font/gi,"<font");var regs=[/<(a|i|u|f|br|\/a|\/i|\/u|\/f|\/b)[^>]*>/g,/<(a|i|u|f|br|\/a|\/i|\/u|\/f|b)[^>]*>/g,/<(b|i|u|f|br|\/b|\/i|\/u|\/f|\/a)[^>]*>/g,/<(b|i|u|f|br|\/b|\/i|\/u|\/f|a)[^>]*>/g,/<(b|a|u|f|br|\/b|\/a|\/u|\/f|\/i)[^>]*>/g,/<(b|a|u|f|br|\/b|\/a|\/u|\/f|i)[^>]*>/g,/<(b|a|i|f|br|\/b|\/a|\/i|\/f|\/u)[^>]*>/g,/<(b|a|i|f|br|\/b|\/a|\/i|\/f|u)[^>]*>/g,/<(b|a|i|u|br|\/b|\/a|\/i|\/u|\/f)[^>]*>/g,/<(b|a|i|u|br|\/b|\/a|\/i|\/u|f)[^>]*>/g];var types=["b","a","i","u","font"];var p;zim.loop(types,function(type,i){p=html.replace(regs[i*2],"");if(type=="font"){var arr=p.split("<font ");}else if(type=="a"){var arr=p.split("<a ");}else{var arr=p.split("<"+type+">");}
process(arr,type,0);p=html.replace(regs[i*2+1],"");arr=p.split("</"+type+">");process(arr,type,1);});p=html.replace(/<br>/gi,"@^#");p=p.replace(/<(b|a|i|u|f|\/b|\/a|\/i|\/u|\/f)[^>]*>/g,"");arr=p.split("@^#");var original=arr.join("\n");p=arr.join("");process(arr,"br",0);function process(text,type,action){if(text.length>1){if((type=="font"||type=="a")&&action==0){var length=text[0].length;zim.loop(text,function(s,i){if(i==0)return;var d=data[length];if(!d)data[length]=[];d=data[length];var arr=s.split(">");if(d[action])d[action].push(type+" "+arr[0]);else d[action]=[type+" "+arr[0]];length+=arr[1].length;});}else{text.pop();var running=0;zim.loop(text,function(s){running+=s.length;var d=data[running];if(!d)data[running]=[];d=data[running];if(d[action])d[action].push(type);else d[action]=[type];});}}}
return{text:p,data:data,original:original};}
that.numLetters=label.text.length;var letterSpacingsOriginal=!zot(letterSpacings);if(letterSpacings&&!Array.isArray(letterSpacings))letterSpacings=null;if(!letterSpacings){letterSpacings=[];for(var i=0;i<that.numLetters;i++){letterSpacings.push(letterSpacing);}}else{for(var i=0;i<that.numLetters;i++){if(zot(letterSpacings[i]))letterSpacings[i]=letterSpacing;}}
that.letterSpacings=letterSpacings;if(lineSpacings&&!Array.isArray(lineSpacings))lineSpacings=null;if(!lineSpacings){lineSpacings=[];for(var i=0;i<that.numLetters-1;i++){lineSpacings.push(lineSpacing);}}else{for(var i=0;i<that.numLetters-1;i++){if(zot(lineSpacings[i]))lineSpacings[i]=lineSpacing;}}
that.lineSpacings=lineSpacings;that.labels=[];that.lines=[[]];var lineWidths=[];var lineHeights=[];var linePositionsY=[0];var lineY=0;var lineW=0;var lineH=0;var lineNum=0;var maxW=0;var d=letterData;var bCheck=false;var iCheck=false;var uCheck=false;var brCheck=false;var colorCheck=false;var sizeCheck=false;var groupCheck=false;var familyCheck=false;var originalGroup=label.group;var urlCheck=false;var targetCheck=false;var backgroundColorCheck=false;var rollBackgroundColorCheck=false;that.rolls=[[]];for(var i=0;i<that.numLetters;i++){brCheck=false;if(d[i]){if(d[i][1]){if(d[i][1].indexOf("b")>=0)bCheck=false;if(d[i][1].indexOf("i")>=0)iCheck=false;if(d[i][1].indexOf("u")>=0)uCheck=false;zim.loop(d[i][1],function(item){if(item.match(/^font/i)){colorCheck=false;backgroundColorCheck=false;if(rollBackgroundColorCheck)that.rolls.push([]);rollBackgroundColorCheck=false;sizeCheck=false;familyCheck=false;groupCheck=false;return;}
if(item.match(/^a/i)){urlCheck=false;targetCheck=false;return;}});}
if(d[i][0]){if(d[i][0].indexOf("b")>=0)bCheck=true;if(d[i][0].indexOf("i")>=0)iCheck=true;if(d[i][0].indexOf("u")>=0)uCheck=true;brCheck=0;zim.loop(d[i][0],function(item){if(item=="br")brCheck++;});zim.loop(d[i][0],function(item){if(item.match(/^font/i)){var r=item.match(/ color\s?=\s?(\S*)/i);if(r){colorCheck=r[1];var ind=zim.colors.indexOf(colorCheck);if(ind>=0)colorCheck=zim.colorsHex[ind];colorCheck=colorCheck.replace(/'/g,"");}
r=item.match(/size\s?=\s?(\S*)/i);if(r)sizeCheck=r[1];r=item.match(/backgroundColor\s?=\s?(\S*)/i);if(r){backgroundColorCheck=r[1];var ind=zim.colors.indexOf(backgroundColorCheck);if(ind>=0)backgroundColorCheck=zim.colorsHex[ind];backgroundColorCheck=backgroundColorCheck.replace(/'/g,"");}
r=item.match(/rollBackgroundColor\s?=\s?(\S*)/i);if(r){rollBackgroundColorCheck=r[1];var ind=zim.colors.indexOf(rollBackgroundColorCheck);if(ind>=0)rollBackgroundColorCheck=zim.colorsHex[ind];rollBackgroundColorCheck=rollBackgroundColorCheck.replace(/'/g,"");}
r=item.match(/group\s?=\s?(\S*)/i);if(r)groupCheck=r[1];r=item.match(/family\s?=\s?(.*)/i);if(r){familyCheck=r[1];familyCheck=familyCheck.split(/\ssize\s?=|\scolor\s?=|\sgroup\s?=/i)[0];}
return;}
if(item.match(/^a/i)){var r=item.match(/href\s?=\s?(\S*)/i);if(r)urlCheck=r[1];r=item.match(/target\s?=\s?(\S*)/i);if(r)targetCheck=r[1];return;}});}}
if(groupCheck){var letter=new Label({text:label.text[i],group:groupCheck})}else{var letter=label.clone();letter.text=label.text[i];}
that.labels.push(letter);if(bCheck)letter.bold=true;if(iCheck)letter.italic=true;if(colorCheck)letter.color=colorCheck;if(backgroundColorCheck)letter.backgroundColor=backgroundColorCheck;var s=letterSpacingsOriginal?letterSpacings[i]:zot(letter.backgroundColor)?letterSpacings[i]:-.5;if(rollBackgroundColorCheck){letter.rollIndex=that.rolls.length-1;letter.zrbc=rollBackgroundColorCheck;letter.zobc=letter.backgroundColor;that.rolls[letter.rollIndex].push(letter);letter.expand(0);letter.on("mouseover",rollOn);letter.on("mouseout",rollOff);}
if(urlCheck){letter.expand(s,0);letter.zurl=urlCheck;letter.ztar=targetCheck;letter.cur();letter.on("click",function(e){var letter=e.currentTarget;rollOff(e);if(!letter.ztar)letter.ztar="_self";zgo(letter.zurl,letter.ztar);});}
if(sizeCheck)letter.size=sizeCheck;if(familyCheck)letter.font=familyCheck;if(brCheck){lineY+=(zot(lineHeight)?lineH:lineHeight)+lineSpacings[lineNum];linePositionsY.push(lineY);lineHeights.push(zot(lineHeight)?lineH:lineHeight);lineWidths.push(lineW);maxW=Math.max(maxW,lineW);}
if(brCheck){if(brCheck>1){zim.loop(brCheck-1,function(bi){that.lines.push([]);lineY+=(zot(lineHeight)?lineH:lineHeight)+lineSpacings[lineNum];linePositionsY.push(lineY);lineHeights.push(zot(lineHeight)?lineH:lineHeight);lineWidths.push(0);lineNum++;});}
lineH=0;lineW=0;that.lines.push([]);lineNum++;}
lineW+=letter.width+s;lineH=Math.max(lineH,letter.height);if(i==that.numLetters-1){lineWidths.push(lineW);lineHeights.push(lineH);maxW=Math.max(maxW,lineW);}
that.lines[lineNum].push(letter);if(uCheck)letter.underline=new zim.Line(letter.width+s+1,1,letter.color).center(letter,this).mov(0,letter.height/2);}
function rollOn(e){var letter=e.currentTarget;var rolls=that.rolls[letter.rollIndex]
zim.loop(rolls,function(l){l.backgroundColor=letter.zrbc;})
if(letter.stage)letter.stage.update();}
function rollOff(e){var letter=e.currentTarget;var rolls=that.rolls[letter.rollIndex]
zim.loop(rolls,function(l){l.backgroundColor=letter.zobc;})
if(letter.stage)letter.stage.update();}
var count=0;for(var j=0;j<that.lines.length;j++){var ll=that.lines[j];var lineW=lineWidths[j];var lineH=lineHeights[j];var lineY=linePositionsY[j];var startX,startY;if(lineAlign=="left")startX=0;else if(lineAlign=="right")startX=maxW-lineW;else startX=(maxW-lineW)/2;startY=lineY;for(i=0;i<ll.length;i++){count++;if(cache)letter.cache();letter=ll[i];letter.regX=align=="left"?0:(align=="right"?letter.width:letter.width/2);letter.regY=valign=="top"?0:(valign=="bottom"?letter.height:letter.height/2);var sY=startY+(valign=="top"?0:valign=="bottom"?letter.height:letter.height/2);if(lineValign=="center"||lineValign=="middle"){sY+=(lineHeights[j]-letter.height)/2;}else if(lineValign=="bottom"){sY+=lineHeights[j]-letter.height;}
var s=letterSpacingsOriginal?letterSpacings[count-1]:zot(letter.backgroundColor)?letterSpacings[count-1]:-.5;if(align=="left"){letter.loc(startX,sY,this);startX=letter.x+letter.width+s;}else if(align=="right"){letter.loc(startX+letter.width,sY,this);startX=letter.x+s;}else{letter.loc(startX+letter.width/2,sY,this);startX=letter.x+letter.width/2+s;}}}
if(!this.getBounds())this.setBounds(0,0,0,0);this.regX=this.getBounds().x;this.regY=this.getBounds().y;Object.defineProperty(this,'color',{get:function(){return this._color;},set:function(value){this._color=value;for(var i=0;i<that.numChildren;i++){that.getChildAt(i).color=this._color;}
if(that.stage)that.stage.update();}});this.dispose=function(){zim.gD(this);zim.loop(that.labels,function(letter){letter.removeFrom();letter.dispose();});that.removeFrom();}
zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.LabelLetters(label,align,valign,letterSpacing,letterSpacings,lineSpacing,lineSpacings,lineHeight,lineAlign,lineValign,cache,rtl,style,this.group,inherit));};};zim.extend(zim.LabelLetters,zim.Container,"clone","zimContainer",false);zim.Button=function(width,height,label,backgroundColor,rollBackgroundColor,color,rollColor,borderColor,borderRollColor,borderWidth,corner,shadowColor,shadowBlur,hitPadding,gradient,gloss,dashed,backing,rollBacking,rollPersist,icon,rollIcon,toggle,toggleBackgroundColor,rollToggleBackgroundColor,toggleColor,rollToggleColor,toggleBacking,rollToggleBacking,toggleIcon,rollToggleIcon,toggleEvent,wait,waitTime,waitBackgroundColor,rollWaitBackgroundColor,waitColor,rollWaitColor,waitModal,waitEnabled,waitBacking,rollWaitBacking,waitIcon,rollWaitIcon,align,valign,indent,indentHorizontal,indentVertical,style,group,inherit){var sig="width, height, label, backgroundColor, rollBackgroundColor, color, rollColor, borderColor, borderRollColor, borderWidth, corner, shadowColor, shadowBlur, hitPadding, gradient, gloss, dashed, backing, rollBacking, rollPersist, icon, rollIcon, toggle, toggleBackgroundColor, rollToggleBackgroundColor, toggleColor, rollToggleColor, toggleBacking, rollToggleBacking, toggleIcon, rollToggleIcon, toggleEvent, wait, waitTime, waitBackgroundColor, rollWaitBackgroundColor, waitColor, rollWaitColor, waitModal, waitEnabled, waitBacking, rollWaitBacking, waitIcon, rollWaitIcon, align, valign, indent, indentHorizontal, indentVertical, style, group, inherit";var duo;if(duo=zob(zim.Button,arguments,sig,this))return duo;z_d("55");this.group=group;var DS=style===false?{}:zim.getStyle("Button",group,inherit);if(zot(width))width=DS.width!=null?DS.width:200;if(zot(height))height=DS.height!=null?DS.height:60;this.zimContainer_constructor(width,height,null,null,false);this.type="Button";if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#C60";if(zot(rollBackgroundColor))rollBackgroundColor=DS.rollBackgroundColor!=null?DS.rollBackgroundColor:"#F93";var oColor=color;var oRollColor=rollColor;if(zot(color))color=DS.color!=null?DS.color:"white";if(zot(rollColor))rollColor=DS.rollColor!=null?DS.rollColor:"white";var oa=remember(backgroundColor,rollBackgroundColor,color,rollColor);function remember(){return arguments;}
backgroundColor=zik(backgroundColor);rollBackgroundColor=zik(rollBackgroundColor);color=zik(color);rollColor=zik(rollColor);var originalBorderColor=borderColor;var originalBorderWidth=borderWidth;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:null;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(borderRollColor))borderRollColor=DS.borderRollColor!=null?DS.borderRollColor:borderColor;if(zot(corner))corner=DS.corner!=null?DS.corner:20;if(zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.3)";if(zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:14;if(zot(hitPadding))hitPadding=DS.hitPadding!=null?DS.hitPadding:0;if(zot(align))align=DS.align!=null?DS.align:"center";if(zot(valign))valign=DS.valign!=null?DS.valign:"center";if(zot(indent))indent=DS.indent!=null?DS.indent:10;if(zot(indentHorizontal))indentHorizontal=DS.indentHorizontal!=null?DS.indentHorizontal:indent;if(zot(indentVertical))indentVertical=DS.indentVertical!=null?DS.indentVertical:indent;if(zot(gradient))gradient=DS.gradient!=null?DS.gradient:0;if(zot(gloss))gloss=DS.gloss!=null?DS.gloss:0;if(zot(label)){if(zot(icon)){label=DS.label!=null?DS.label:"PRESS";}else{label="";}}
var toggleOkay=(!zot(toggle)||!zot(toggleBacking)||!zot(rollToggleBacking)||!zot(toggleIcon)||!zot(rollToggleIcon))&&zot(wait)&&zot(waitBacking)&&zot(rollWaitBacking);if(toggleOkay&&zot(toggleEvent))toggleEvent=zim.mobile()?"mousedown":"click";if(typeof label==="string"||typeof label==="number")label=new zim.Label({text:label,size:DS.size!=null?DS.size:36,font:DS.font!=null?DS.font:"arial",color:DS.color!=null&&oColor==null?DS.color:color,rollColor:DS.rollColor&&oRollColor==null!=null?DS.rollColor:rollColor,align:align,valign:valign,rollPersist:DS.rollPersist!=null?DS.rollPersist:false,backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",padding:"ignore",backgroundColor:"ignore",shiftVertical:DS.shiftVertical!=null?DS.shiftVertical:0,shiftHorizontal:DS.shiftHorizontal!=null?DS.shiftHorizontal:0,style:false,group:this.group});if(zot(rollPersist))rollPersist=DS.rollPersist!=null?DS.rollPersist:false;this.rollPersist=rollPersist;if(zot(dashed))dashed=DS.dashed!=null?DS.dashed:false;if(!zot(toggle)&&toggle.type=="Label"){if(zon)zogy("Button() - do not pass Label to toggle parameter - just pass a String");}
if(zot(toggleBackgroundColor))toggleBackgroundColor=DS.toggleBackgroundColor!=null?DS.toggleBackgroundColor:backgroundColor;if(zot(rollToggleBackgroundColor))rollToggleBackgroundColor=DS.rollToggleBackgroundColor!=null?DS.rollToggleBackgroundColor:rollBackgroundColor;if(zot(toggleColor))toggleColor=DS.toggleColor!=null?DS.toggleColor:label.color;if(zot(rollToggleColor))rollToggleColor=DS.rollToggleColor!=null?DS.rollToggleColor:label.rollColor;if(zot(waitBackgroundColor))waitBackgroundColor=DS.waitBackgroundColor!=null?DS.waitBackgroundColor:backgroundColor;if(zot(rollWaitBackgroundColor))rollWaitBackgroundColor=DS.rollWaitBackgroundColor!=null?DS.rollWaitBackgroundColor:rollBackgroundColor;if(zot(waitColor))waitColor=DS.waitColor!=null?DS.waitColor:label.color;if(zot(rollWaitColor))rollWaitColor=DS.rollWaitColor!=null?DS.rollWaitColor:label.rollColor;var that=this;this.mouseChildren=false;this.cursor="pointer";that.focus=false;that.rolled=false;var stage;var timeType=getTIME(waitTime);if(zot(backing))backing=DS.backing!=null?DS.backing.clone():null;if(zot(backing))that.backing=new zim.Rectangle(width,height,backgroundColor,null,null,corner,dashed,null,false).centerReg(null,null,false);else that.backing=backing;that.rollBacking=zot(rollBacking)?(DS.rollBacking!=null?DS.rollBacking.clone():null):rollBacking;that.waitBacking=zot(waitBacking)?(DS.waitBacking!=null?DS.waitBacking.clone():null):waitBacking;that.rollWaitBacking=zot(rollWaitBacking)?(DS.rollWaitBacking!=null?DS.rollWaitBacking.clone():null):rollWaitBacking;that.toggleBacking=zot(toggleBacking)?(DS.toggleBacking!=null?DS.toggleBacking.clone():null):toggleBacking;that.rollToggleBacking=zot(rollToggleBacking)?(DS.rollToggleBacking!=null?DS.rollToggleBacking.clone():null):rollToggleBacking;var backingTypes=["backing","rollBacking","toggleBacking","rollToggleBacking","waitBacking","rollWaitBacking"];var t;var b;for(var i=0;i<backingTypes.length;i++){t=backingTypes[i];b=that[t];if(b){if(b.type=="Pattern"){b=setPattern(t,b);}else if(shadowColor!=-1&&shadowBlur>0){b.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);}
b.x=width/2;b.y=height/2;}}
that.addChild(that.backing);if(borderWidth){that.border=new zim.Rectangle(width,height,"rgba(0,0,0,0)",borderColor,borderWidth,corner,dashed,null,false);that.addChild(that.border);}
function setPattern(type,pattern){that[type]=new zim.Container(width,height,null,null,false).centerReg(null,null,false);if(shadowColor!=-1&&shadowBlur>0){var shadowRect=new zim.Rectangle(width-2,height-2,"#666",null,null,corner,null,null,false).center(that[type]);shadowRect.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);}
var mask=that[type].mask=new zim.Rectangle(width,height,type.indexOf("roll")>=0?rollBackgroundColor:backgroundColor,null,null,corner,null,null,false).addTo(that[type]);pattern.centerReg(mask);pattern.setMask(mask.shape);that[type].pattern=pattern;return that[type];}
that.icon=zot(icon)?(DS.icon!=null?DS.icon.clone():null):icon;that.rollIcon=zot(rollIcon)?(DS.rollIcon!=null?DS.rollIcon.clone():null):rollIcon;that.waitIcon=zot(waitIcon)?(DS.waitIcon!=null?DS.waitIcon.clone():null):waitIcon;that.rollWaitIcon=zot(rollWaitIcon)?(DS.rollWaitIcon!=null?DS.rollWaitIcon.clone():null):rollWaitIcon;that.toggleIcon=zot(toggleIcon)?(DS.toggleIcon!=null?DS.toggleIcon.clone():null):toggleIcon;that.rollToggleIcon=zot(rollToggleIcon)?(DS.rollToggleIcon!=null?DS.rollToggleIcon.clone():null):rollToggleIcon;var iconTypes=["icon","rollIcon","toggleIcon","rollToggleIcon","waitIcon","rollWaitIcon"];for(var i=0;i<iconTypes.length;i++){var ty=iconTypes[i];var ic=that[ty];if(ic){ic.x=width/2;ic.y=height/2;}}
if(that.icon)that.addChild(that.icon);if(!Array.isArray(corner))corner=[corner,corner,corner,corner];if(gradient>0){var gr=new createjs.Shape();gr.graphics.lf(["rgba(255,255,255,"+gradient+")","rgba(0,0,0,"+gradient+")"],[0,1],0,0,0,height-borderWidth);gr.graphics.rc(borderWidth/2,borderWidth/2,width-borderWidth,height-borderWidth,corner[0],corner[1],corner[2],corner[3]);this.addChild(gr);}
if(gloss>0){var gl=new createjs.Shape();gl.graphics.f("rgba(255,255,255,"+gloss+")");gl.graphics.rc(borderWidth/2,borderWidth/2,width-borderWidth,(height-borderWidth)/2,corner[0],corner[1],0,0);gl.graphics.f("rgba(0,0,0,"+gloss+")");gl.graphics.rc(borderWidth/2,height/2,width-borderWidth,(height-borderWidth)/2,0,0,corner[2],corner[3]);this.addChild(gl);}
var hitArea;var rect;if(hitPadding>0)makeHitArea();function makeHitArea(){rect=new createjs.Shape();rect.graphics.f("#000").r(-hitPadding,-hitPadding,width+hitPadding*2,height+hitPadding*2);that.hitArea=hitArea=rect;}
this.addChild(label);label.center(this);label.y+=1;this.label=label;zim.pos(label,(align=="left"||align=="right")?indentHorizontal:null,(valign=="top"||valign=="bottom")?indentVertical:null,align=="right",valign=="bottom");this.toggled=false;if(toggleOkay){var originalText=label.text;var originalColor=label.color;var originalRollColor=label.rollColor;this.on(toggleEvent,function(){that.toggled=!that.toggled;setToggled();});}
function setToggled(){if(that.toggled){if(!zot(toggle))that.label.text=toggle===true?originalText:toggle;if(!zot(toggleColor))that.label.color=toggleColor;if(!zot(rollToggleColor))that.label.rollColor=rollToggleColor;if(that.rolled){if(that.rollToggleBacking)changeObject("rollToggleBacking",that.rollToggleBacking);else if(that.toggleBacking)changeObject("toggleBacking",that.toggleBacking);if(that.rollToggleIcon)changeObject("rollToggleIcon",that.rollToggleIcon);else if(that.toggleIcon)changeObject("toggleIcon",that.toggleIcon);if(zot(backing)&&zot(that.rollToggleBacking))that.backing.color=rollToggleBackgroundColor;}else{if(that.toggleBacking)changeObject("toggleBacking",that.toggleBacking);if(that.toggleIcon)changeObject("toggleIcon",that.toggleIcon);if(zot(backing))that.backing.color=toggleBackgroundColor;}}else{that.label.color=originalColor;that.label.rollColor=originalRollColor;that.label.text=originalText;setOriginalObjects();}
if(that.stage)that.stage.update();}
function setOriginalObjects(){if(that.rolled){if(zot(backing)&&!that.rollBacking)that.backing.color=rollBackgroundColor;if(that.rollBacking)changeObject("rollBacking",that.rollBacking);else if(that.backing)changeObject("backing",that.backing);if(that.rollIcon)changeObject("rollIcon",that.rollIcon);else if(that.icon)changeObject("icon",that.icon);else changeObject("icon",null);}else{if(zot(backing))that.backing.color=backgroundColor;if(that.backing)changeObject("backing",that.backing);if(that.icon)changeObject("icon",that.icon);else changeObject("icon",null);}}
this.toggle=function(state){if(!toggleOkay){if(zon)zogy("Button() - can't toggle with wait parameters provided");return that;}
if(zot(state)){that.toggled=!that.toggled;}else{that.toggled=state;}
setToggled();return that;};var pressCheck=false;that.waiting=false;var willBeWaiting=false;var waitTimeout;var waitStartText;var waitStartTextBackgroundColor=that.label.color;var waitStartRollTextBackgroundColor=that.label.rollColor;var waitStartEnabled;var waitModalEvent;var waitEvent=this.on("mousedown",function(){pressCheck=true;doWait();});function doWait(){if((!zot(wait)||!zot(waitBacking)||!zot(rollWaitBacking))&&!that.waiting){willBeWaiting=true;if(zot(waitEnabled))waitEnabled=true;if(waitModal)waitModalEvent=that.stage.on("stagemousedown",function(e){if(!that.hitTestPoint(e.stageX/zim.scaX,e.stageY/zim.scaY))that.clearWait();},null,true);setTimeout(function(){that.waiting=true;},50);waitStartText=label.text;if(!zot(waitColor))that.label.color=waitColor;if(!zot(rollWaitColor))that.label.rollColor=rollWaitColor;waitStartEnabled=that.enabled;if(!waitEnabled&&that.enabled)that.enabled=false;if(!zot(wait))that.label.text=wait;if(that.rolled){if(zot(backing)&&!that.rollWaitBacking)that.backing.color=rollWaitBackgroundColor;if(that.rollWaitBacking)changeObject("rollWaitBacking",that.rollWaitBacking);else if(that.waitBacking)changeObject("waitBacking",that.waitBacking);if(that.rollWaitIcon)changeObject("rollWaitIcon",that.rollWaitIcon);else if(that.waitIcon)changeObject("waitIcon",that.waitIcon);}else{if(zot(backing)&&!that.waitBacking)that.backing.color=waitBackgroundColor;if(that.waitBacking)changeObject("waitBacking",that.waitBacking);if(that.waitIcon)changeObject("waitIcon",that.waitIcon);}
if(zot(waitTime))waitTime=timeType=="s"?5:5000;if(waitTimeout)waitTimeout.clear();waitTimeout=zim.timeout(waitTime,function(){if(!that.enabled)that.enabled=waitStartEnabled;that.clearWait();that.dispatchEvent("waited");});if(that.stage)that.stage.update();}}
this.wait=function(){doWait();};this.clearWait=function(){if(!waitTimeout)return that;if(waitModalEvent)that.stage.off("stagemousedown",waitModalEvent);waitTimeout.clear();that.label.text=waitStartText;setOriginalObjects();that.label.color=waitStartTextBackgroundColor;that.label.rollColor=waitStartRollTextBackgroundColor;setTimeout(function(){that.waiting=false;},55);willBeWaiting=false;if(that.stage)that.stage.update();return that;};this.removeWait=function(){that.clearWait();wait=null;that.waitBacking=null;that.rollWaitBacking=null;that.off("mousedown",waitEvent);return that;};this.on("pressup",function(){pressCheck=false;if(that.rollPersist&&!reallyOn)removeRoll();});function changeObject(type,newObject){if(type.indexOf("con")>=0){for(var i=0;i<iconTypes.length;i++){var ty=iconTypes[i];var ic=that[ty];that.removeChild(ic);}
if(that[type])that.addChildAt(that[type],1);}else{if(!that[type])return;for(var i=0;i<backingTypes.length;i++){var t=backingTypes[i];var b=that[t];that.removeChild(b);}
if(that[type])that.addChildAt(that[type],0);}}
var reallyOn=false;this.on("mouseover",function(e){if(that.stage&&that.stage.frame.leftMouseDown&&!onCheck)return;buttonOn(e);});function buttonOn(e){that.rolled=true;reallyOn=true;if(willBeWaiting){if(zot(backing)&&zot(that.rollWaitBacking))that.backing.color=zot(rollWaitBackgroundColor)?rollBackgroundColor:rollWaitBackgroundColor;changeObject("rollWaitBacking",that.rollWaitBacking);if(that.rollWaitIcon)changeObject("rollWaitIcon",that.rollWaitIcon);}else if(toggleOkay&&that.toggled){if(zot(backing)&&zot(that.rollToggleBacking))that.backing.color=rollToggleBackgroundColor;changeObject("rollToggleBacking",that.rollToggleBacking);if(that.rollToggleIcon)changeObject("rollToggleIcon",that.rollToggleIcon);}else{if(zot(backing))that.backing.color=rollBackgroundColor;else if(!zot(backing.mask))that.backing.mask.color=rollBackgroundColor;changeObject("rollBacking",that.rollBacking);if(that.rollIcon)changeObject("rollIcon",that.rollIcon);}
if(that.border)that.border.borderColor=borderRollColor;if(that.label.showRollColor)that.label.showRollColor();if(that.stage)that.stage.update();}
var onCheck=false;var touchCheck=false;this.on("mousedown",function(e){onCheck=true;if(that.rolled)return;touchCheck=true;buttonOn(e);});this.on("pressup",function(e){onCheck=false;if(touchCheck){touchCheck=false;buttonOff(e);}});this.on("pressmove",function(e){var frame=that.stage?that.stage.frame:zdf;var hitting=that.hitTestPoint(frame.mouseX,frame.mouseY);if(onCheck&&!hitting){buttonOff(e);onCheck=false;}else if(!onCheck&&hitting){buttonOn(e);onCheck=true;}});this.on("mouseout",buttonOff);function buttonOff(e){reallyOn=false;that.off("mouseout",buttonOff);if(that.rollPersist){if(!pressCheck)removeRoll();}else{removeRoll();}}
function removeRoll(){that.rolled=false;if(willBeWaiting||that.waiting){if(zot(backing)&&zot(that.waitBacking))that.backing.color=zot(waitBackgroundColor)?backgroundColor:waitBackgroundColor;if(that.waitBacking)changeObject("waitBacking",that.waitBacking);else changeObject("backing",that.backing);if(that.waitIcon)changeObject("waitIcon",that.waitIcon);else if(that.icon)changeObject("icon",that.icon);else changeObject("icon",null);}else if(that.toggled&&toggleOkay){if(zot(backing)&&zot(that.toggleBacking))that.backing.color=toggleBackgroundColor;if(that.toggleBacking)changeObject("toggleBacking",that.toggleBacking);else changeObject("backing",that.backing);if(that.toggleIcon)changeObject("toggleIcon",that.toggleIcon);else if(that.icon)changeObject("icon",that.icon);else changeObject("icon",null);}else{if(zot(backing))that.backing.color=backgroundColor;else if(!zot(backing.mask))that.backing.mask.color=backgroundColor;changeObject("backing",that.backing);if(that.icon)changeObject("icon",that.icon);else changeObject("icon",null);}
if(that.border)that.border.borderColor=borderColor;if(that.label.showRollColor)that.label.showRollColor(false);if(that.stage)that.stage.update();}
Object.defineProperty(that,'text',{get:function(){var t=(label.text==" ")?"":label.text;return t;},set:function(value){label.text=value;if(originalText)originalText=value;label.center(this);label.y+=1;zim.pos(label,(align=="left"||align=="right")?indentHorizontal:null,(valign=="top"||valign=="bottom")?indentVertical:null,align=="right",valign=="bottom");}});Object.defineProperty(that,'color',{get:function(){return color;},set:function(value){color=value;if(originalColor)originalColor=color;if(that.label&&!zot(that.label.color)){that.label.color=color;}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});Object.defineProperty(that,'rollColor',{get:function(){return rollColor;},set:function(value){rollColor=value;if(originalRollColor)originalRollColor=rollColor;if(that.label){that.label.rollColor=rollColor;}}});Object.defineProperty(that,'backgroundColor',{get:function(){return backgroundColor;},set:function(value){backgroundColor=value;if(that.backing.color){that.backing.color=backgroundColor;}else if(that.backing.mask){that.backing.mask.color=backgroundColor;}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});Object.defineProperty(that,'rollBackgroundColor',{get:function(){return rollBackgroundColor;},set:function(value){rollBackgroundColor=value;if(that.rollBacking&&that.rollBacking.color){that.rollBacking.color=rollBackgroundColor;}else if(that.rollBacking&&that.rollBacking.mask){that.rollBacking.mask.color=rollBackgroundColor;}}});Object.defineProperty(that,'borderColor',{get:function(){return borderColor;},set:function(value){borderColor=value;if(!that.rolled){if(that.backing&&that.backing.borderColor)that.backing.borderColor=value;if(that.border)that.border.borderColor=value;}}});Object.defineProperty(that,'borderRollColor',{get:function(){return borderRollColor;},set:function(value){borderRollColor=value;if(that.rolled){if(that.backing&&that.backing.borderColor)that.backing.borderColor=value;if(that.border)that.border.borderColor=value;}}});Object.defineProperty(that,'hitPadding',{get:function(){return hitPadding;},set:function(value){hitPadding=value;if(hitPadding==0){if(hitArea){this.hitArea=null;}}else{makeHitArea();}}});this._enabled=true;this.startMouseChildren=this.mouseChildren;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){if(that._enabled)that.startMouseChildren=that.mouseChildren;if(value){zenable(that,value);that.mouseChildren=that.startMouseChildren;}else{removeRoll();zenable(that,value);}
label.color=label.color;if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});this.setBacking=function(type,newBacking){setObject(type,newBacking);};this.setIcon=function(type,newIcon){setObject(type,newIcon);};function setObject(type,newObject){if(zot(type))return that;if(that.contains(that[type])){that.removeChild(that[type]);if(newObject)that.addChildAt(newObject,type.indexOf("con")>=0?that.numChildren-1:0);if(that.stage)that.stage.update();}
if(newObject){if(zot(backing)&&type=="backing")backing=newObject;if(newObject.type=="Pattern")newObject=setPattern(type,newObject);that[type]=newObject;that[type].x=width/2;that[type].y=height/2;}else{that[type]=null;}
return that;}
if(style!==false)zim.styleTransforms(this,DS);this.clone=function(exact){var but=new zim.Button(width,height,label.clone(),(exact||!zim.isPick(oa[0]))?backgroundColor:oa[0],(exact||!zim.isPick(oa[1]))?rollBackgroundColor:oa[1],(exact||!zim.isPick(oa[2]))?color:oa[2],(exact||!zim.isPick(oa[3]))?rollColor:oa[3],originalBorderColor,borderRollColor,originalBorderWidth,corner,shadowColor,shadowBlur,hitPadding,gradient,gloss,dashed,!zot(backing)?that.backing.clone():null,!zot(rollBacking)?that.rollBacking.clone():null,rollPersist,!zot(icon)?icon.clone():null,!zot(rollIcon)?rollIcon.clone():null,toggle,toggleBackgroundColor,rollToggleBackgroundColor,toggleColor,rollToggleColor,!zot(toggleBacking)?toggleBacking.clone():null,!zot(rollToggleBacking)?rollToggleBacking.clone():null,!zot(toggleIcon)?toggleIcon.clone():null,!zot(rollToggleIcon)?rollToggleIcon.clone():null,toggleEvent,wait,waitTime,waitBackgroundColor,rollWaitBackgroundColor,waitColor,rollWaitColor,waitModal,waitEnabled,!zot(waitBacking)?waitBacking.clone():null,!zot(rollWaitBacking)?rollWaitBacking.clone():null,!zot(waitIcon)?waitIcon.clone():null,!zot(rollWaitIcon)?rollWaitIcon.clone():null,align,valign,indent,indentHorizontal,indentVertical,style,this.group,inherit);return that.cloneProps(but);};this.doDispose=function(a,b,disposing){if(that.icon)that.icon.dispose();if(that.rollIcon)that.rollIcon.dispose();if(that.waitIcon)that.waitIcon.dispose();if(that.rollWaitIcon)that.rollWaitIcon.dispose();if(that.toggleIcon)that.toggleIcon.dispose();if(that.rollToggleIcon)that.rollToggleIcon.dispose();that.icon=that.rollIcon=that.waitIcon=that.rollWaitIcon=that.toggleIcon=that.rollToggleIcon=null;if(!disposing)this.zimContainer_dispose(true);return true;}};zim.extend(zim.Button,zim.Container,["clone","dispose"],"zimContainer",false);zim.Button.prototype.dispose=function(disposing){return this.doDispose(null,null,disposing);};zim.CheckBox=function(size,label,startChecked,color,backgroundColor,borderColor,borderWidth,corner,margin,indicatorType,indicatorColor,tap,style,group,inherit){var sig="size, label, startChecked, color, backgroundColor, borderColor, borderWidth, corner, margin, indicatorType, indicatorColor, tap, style, group, inherit";var duo;if(duo=zob(zim.CheckBox,arguments,sig,this))return duo;z_d("56");this.zimContainer_constructor(null,null,null,null,false);this.type="CheckBox";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(size))size=DS.size!=null?DS.size:60;if(zot(label))label=DS.label!=null?DS.label:null;if(zot(startChecked))startChecked=DS.startChecked!=null?DS.startChecked:false;var myChecked=startChecked;if(zot(color))color=DS.color!=null?DS.color:"#111";if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"rgba(255,255,255,.8)";if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:"#111";if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:size/10;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=size/10;if(zot(corner))corner=DS.corner!=null?DS.corner:0;if(typeof label==="string"||typeof label==="number")label=new zim.Label({text:label,size:size*5/6,color:color,valign:"center",backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",padding:"ignore",backgroundColor:"ignore",style:style,group:this.group});if(zot(margin))margin=DS.margin!=null?DS.margin:size/5;if(indicatorType!="box"&&indicatorType!="square"&&indicatorType!="x")indicatorType=DS.indicatorType!=null?DS.indicatorType:"check";if(zot(indicatorColor))indicatorColor=DS.indicatorColor!=null?DS.indicatorColor:borderWidth>0?borderColor:"black";this.setBounds(-margin,-margin,size+margin*2,size+margin*2);if(zot(tap))tap=DS.tap!=null?DS.tap:false;var that=this;this.cursor="pointer";var box=this.box=new zim.Rectangle(size,size,backgroundColor,null,null,corner);var box2=this.box2=new zim.Rectangle(size*5/7,size*5/7,"rgba(0,0,0,0)",borderColor,borderWidth,corner);box2.x=size/7;box2.y=size/7;this.addChild(box,box2);var fullWidth=size;if(label){label.center(that);label.x=that.getBounds().width;this.label=label;this.setBounds(-margin,-margin,size+margin*3+label.getBounds().width,Math.max(size+margin*2,label.getBounds().height));fullWidth=label.x+label.width;}
var backing=new zim.Shape({style:false});var g=backing.graphics;g.f("rgba(0,0,0,.01)").r(this.getBounds().x,this.getBounds().y,fullWidth+(margin*2),this.getBounds().height);this.hitArea=backing;var check=new zim.Shape({style:false});var g2=check.graphics;if(indicatorType=="check"){g2.f(indicatorColor).p("AnQAdICBiaIEEDZIF8nfICfB4In/KPg");}else if(indicatorType=="box"||indicatorType=="square"){g2.f(indicatorColor).dr(-35,-35,70,70);}else{g2.f(indicatorColor).p("AmJEVIEUkTIkXkWIB4h5IEWEYIETkTIB4B3IkTESIEQERIh4B4IkRkRIkSEVg");}
var cW=95;check.setBounds(-cW/2,-cW/2,cW,cW);var scale=size/(cW+66);check.scaleX=check.scaleY=scale;check.alpha=.9;check.x=size/2;check.y=size/2;if(myChecked)this.addChild(check);if(tap){this.tap(toggleCheck);}else{this.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",toggleCheck);}
Object.defineProperty(that,'checked',{get:function(){return myChecked;},set:function(value){that.setChecked(value);}});this.toggle=function(type){if(zot(type))type=!myChecked;that.setChecked(type);};Object.defineProperty(that,'toggled',{get:function(){return myChecked;},set:function(value){that.setChecked(value);}});Object.defineProperty(that,'text',{get:function(){if(label)return label.text;return null;},set:function(value){if(label){label.text=value;if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}}});Object.defineProperty(check,'indicatorColor',{get:function(){return indicatorColor;},set:function(value){if(myChecked){that.removeChild(check);}
check=new createjs.Shape();g2=check.graphics;indicatorColor=value;g2.f(indicatorColor).p("AnQAdICBiaIEEDZIF8nfICfB4In/KPg");check.scaleX=check.scaleY=scale;check.alpha=.9;check.x=size/2;check.y=size/2;if(myChecked)that.addChild(check);if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});Object.defineProperty(that,'indicator',{get:function(){return check;},set:function(value){zog("ZIM CheckBox - check is read only");}});this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){zenable(that,value);}});function toggleCheck(e){myChecked=!myChecked;that.setChecked(myChecked);that.dispatchEvent("change");}
this.setChecked=function(value){if(zot(value))value=true;myChecked=value;if(myChecked){that.addChild(check);}else{that.removeChild(check);}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();return that;};if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.CheckBox(size,label?label.clone():"",startChecked,color,backgroundColor,borderColor,borderWidth,corner,margin,indicatorType,indicatorColor,tap,style,this.group,inherit));};};zim.extend(zim.CheckBox,zim.Container,"clone","zimContainer",false);zim.RadioButtons=function(size,buttons,vertical,color,backgroundColor,borderColor,borderWidth,spacing,margin,always,indicatorColor,selectedIndex,style,group,inherit){var sig="size, buttons, vertical, color, backgroundColor, borderColor, borderWidth, spacing, margin, always, indicatorColor, selectedIndex, style, group, inherit";var duo;if(duo=zob(zim.RadioButtons,arguments,sig,this))return duo;z_d("57");this.zimContainer_constructor(null,null,null,null,false);this.type="RadioButtons";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(size))size=DS.size!=null?DS.size:60;size=Math.max(5,size);if(zot(buttons))buttons=DS.buttons!=null?DS.buttons:["A","B","C"];if(zot(vertical))vertical=DS.vertical!=null?DS.vertical:true;if(zot(color))color=DS.color!=null?DS.color:"#111";if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"rgba(255,255,255,.8)";if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:"#111";if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:size/9;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=size/10;if(zot(spacing))spacing=(vertical)?DS.spacing!=null?DS.spacing:size*.2:DS.spacing!=null?DS.spacing:size;if(zot(margin))margin=DS.margin!=null?DS.margin:size/5;if(zot(always))always=DS.always!=null?DS.always:false;if(zot(indicatorColor))indicatorColor=DS.indicatorColor!=null?DS.indicatorColor:borderWidth>0?borderColor:"black";var that=this;this.cursor="pointer";this.labels=[];this.indicators=[];var currentObject;if(typeof buttons=="string"){var bString=buttons;buttons=[];for(var i=0;i<bString.length;i++){buttons.push({label:bString[i]});}}
var buttonContainer=new zim.Container({style:false});this.addChild(buttonContainer);function pressBut(e){var index=buttonContainer.getChildIndex(e.target);if(always){if(that.selectedIndex==index)return;}
that.setSelected(index);that.dispatchEvent("change");}
makeButtons();var currentK;for(var k=0;k<buttonContainer.numChildren;k++){currentK=buttonContainer.getChildAt(k);currentK.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",pressBut);}
var lastBut;function makeButtons(){var data;var selectedCheck=false;for(var i=buttons.length-1;i>=0;i--){data=buttons[i];if(data.selected&&data.selected===true){if(!selectedCheck){selectedCheck=true;that.id=data.id;}else{data.selected="false";}}}
buttonContainer.removeAllChildren();that.buttons=[];var but;var currentLocation=0;for(var i=0;i<buttons.length;i++){data=buttons[i];if(typeof data==="string"||typeof data==="number"){var d={selected:false,label:new zim.Label({text:data,size:size*5/6,color:DS.color!=null?DS.color:color,valign:"center",backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",padding:"ignore",backgroundColor:"ignore",style:style,group:that.group})};data=d;}
if(data.label&&typeof data.label==="string"||typeof data.label==="number"){data.label=new zim.Label({text:data.label,size:DS.size!=null?DS.size:size*5/6,color:DS.color!=null?DS.color:color,valign:"center",style:style});}
that.labels.push(data.label);data.index=i;buttons[i]=data;but=makeButton(data.selected,data.label);but.type="RadioButton";but.obj=data;if(data.selected)currentObject=but.obj;buttonContainer.addChild(but);if(vertical){but.y=currentLocation;currentLocation+=but.getBounds().height+spacing;}else{but.x=currentLocation;currentLocation+=but.getBounds().width+spacing;}}}
function makeButton(mySelected,label){var but=new zim.Container({style:false});that.buttons.push(but);but.mouseChildren=false;but.setBounds(-margin,-margin,size+margin*2,size+margin*2);var box=new zim.Shape({style:false});var g=box.graphics;g.f(backgroundColor).dc(size/2,size/2,size/1.85);g.s(borderColor).ss(borderWidth).dc(size/2,size/2,size/2-size/2/5);but.addChild(box);var check=but.check=new zim.Circle(size/5.2,indicatorColor,null,null,null,null,null,null,false);that.indicators.push(check);check.mouseEnabled=false;check.alpha=.95;check.regX=check.regY=-size/2;var fullWidth=size;if(label){but.addChild(label);label.x=but.getBounds().width;label.y=size/2;but.setBounds(-margin,-margin,size+margin*2+label.getBounds().width,Math.max(size+margin*2,label.getBounds().height));fullWidth=label.x+label.width;but.text=label.text;}
if(mySelected){but.addChild(check);that.label=label;if(that.label)that.text=label.text;}
var backing=new zim.Shape({style:false});g=backing.graphics;g.f("rgba(0,0,0,.01)").r(but.getBounds().x,but.getBounds().y,fullWidth+(margin*2),but.getBounds().height);but.hitArea=backing;return(but);}
if(!this.getBounds())this.setBounds(0,0,size,size);this.setBounds(-margin,-margin,this.getBounds().width+margin*2,this.getBounds().height);this.setSelected=function(value){if(zot(value))value=-1;if(value!=-1&&!buttonContainer.getChildAt(value))return;var but;for(var i=0;i<buttonContainer.numChildren;i++){but=buttonContainer.getChildAt(i);but.removeChild(but.check);}
if(value>=0){but=buttonContainer.getChildAt(value);var lastIndex=-2;if(currentObject)lastIndex=currentObject.index;currentObject=but.obj;}
if(value==-1||lastIndex==currentObject.index){currentObject=null;that.id=null;that.label=null;that.text="";}else{but.addChild(but.check);that.id=currentObject.id;that.label=currentObject.label;if(that.label)that.text=that.label.text;}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();return that;};Object.defineProperty(that,'selected',{get:function(){return currentObject;},set:function(value){zog("ZIM RadioButton - selected is read only");}});Object.defineProperty(that,'selectedIndex',{get:function(){return(currentObject)?currentObject.index:-1;},set:function(value){var index=value;if(always){if(that.selectedIndex==index)return;}
that.setSelected(index);}});this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){zenable(that,value);}});if(zot(selectedIndex))selectedIndex=DS.selectedIndex!=null?DS.selectedIndex:0;that.selectedIndex=selectedIndex;zim.styleTransforms(this,DS);this.clone=function(){var buttonsCopy=zim.copy(buttons);for(var i=0;i<buttonsCopy.length;i++){buttonsCopy[i].label=buttonsCopy[i].label.clone();}
return that.cloneProps(new zim.RadioButtons(size,buttonsCopy,vertical,color,backgroundColor,borderColor,borderWidth,spacing,margin,always,indicatorColor,selectedIndex,style,this.group,inherit));};};zim.extend(zim.RadioButtons,zim.Container,"clone","zimContainer",false);zim.Toggle=function(width,height,label,startToggled,backgroundColor,margin,indicatorType,indicatorColor,tap,toggleBackgroundColor,color,borderColor,borderWidth,corner,indicatorCorner,shadowColor,shadowBlur,time,labelLeft,style,group,inherit){var sig="width, height, label, startToggled, backgroundColor, margin, indicatorType, indicatorColor, tap, toggleBackgroundColor, color, borderColor, borderWidth, corner, indicatorCorner, shadowColor, shadowBlur, time, labelLeft, style, group, inherit";var duo;if(duo=zob(zim.Toggle,arguments,sig,this))return duo;z_d("57.5");this.group=group;var DS=style===false?{}:zim.getStyle("Toggle",this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:80;if(zot(height))height=DS.height!=null?DS.height:50;this.zimContainer_constructor(width,height,null,null,false);this.type="Toggle";if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#C60";if(zot(margin))margin=DS.margin!=null?DS.margin:10;if(zot(indicatorType))indicatorType=DS.indicatorType!=null?DS.indicatorType:"circle";if(zot(indicatorColor))indicatorColor=DS.indicatorColor!=null?DS.indicatorColor:"#fff";if(zot(toggleBackgroundColor))toggleBackgroundColor=DS.toggleBackgroundColor!=null?DS.toggleBackgroundColor:"#F93";if(zot(color))color=DS.color!=null?DS.color:"#111";if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:null;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(corner))corner=DS.corner!=null?DS.corner:indicatorType!="circle"?0:25;if(zot(indicatorCorner))indicatorCorner=DS.indicatorCorner!=null?DS.indicatorCorner:0;if(zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.3)";if(zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:14;if(zot(startToggled))startToggled=DS.startToggled!=null?DS.startToggled:false;var timeType=getTIME(time);if(zot(time))time=DS.time!=null?DS.time:timeType=="s"?.1:100;if(zot(label))label=DS.label!=null?DS.label:null;if(zot(labelLeft))labelLeft=DS.labelLeft!=null?DS.labelLeft:null;var that=this;that.cursor="pointer";if(typeof label==="string"||typeof label==="number")label=this.label=new zim.Label({text:label,size:DS.size||height*5/6,color:color,valign:"center",backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",padding:"ignore",backgroundColor:"ignore",group:this.group});if(typeof labelLeft==="string"||typeof labelLeft==="number")labelLeft=this.labelLeft=new zim.Label({text:labelLeft,size:DS.size||height*5/6,color:color,valign:"center",backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",padding:"ignore",backgroundColor:"ignore",group:this.group});this.background=new zim.Rectangle(width,height,backgroundColor,borderColor,borderWidth,corner).addTo(this);if(indicatorType=="rectangle"||indicatorType=="square")this.indicator=new zim.Rectangle(height*.65,height*.65,indicatorColor,null,null,indicatorCorner).center(this.background).pos(height*.2,null,startToggled);else this.indicator=new zim.Circle(height*.35,indicatorColor).center(this.background).pos(height*.175,null,startToggled);var _toggled=startToggled;that.background.color=_toggled?toggleBackgroundColor:backgroundColor;if(shadowColor!=-1&&shadowBlur>0){this.background.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);}
if(label){this.addChild(label);label.x=width+2+margin+borderWidth;label.y=height/2;this.label=label;this.setBounds(-margin,-margin,width+margin*3+borderWidth+label.getBounds().width,Math.max(height+margin*2,label.getBounds().height));}
if(labelLeft){this.addChild(labelLeft);labelLeft.x=0;that.background.x+=labelLeft.width+3+margin+borderWidth;that.label.x+=labelLeft.width+3+margin+borderWidth;labelLeft.y=height/2;this.labelLeft=labelLeft;this.setBounds(-margin,-margin,that.getBounds().width+labelLeft.width+3+margin+borderWidth,that.getBounds().height);}
this.expand(zim.mobile()?20:10);this.tap(function(e){if(labelLeft){var point=that.localToGlobal(labelLeft.width+3+margin+borderWidth+width/2,0);if((e.stageX/zim.scaX<(point.x-width/2)&&!_toggled)||(e.stageX/zim.scaX>=(point.x+width/2)&&_toggled))return;}
_toggled=!_toggled;setToggle();that.dispatchEvent("change");},zim.mobile()?20:10);var swipe=new zim.Swipe(this,20,timeType=="s"?.2:200);swipe.on("swipe",function(e){if(e.swipeX==0){return;}else if(e.swipeX==1&&_toggled){return;}else if(e.swipeX==-1&&!_toggled){return;}
_toggled=!_toggled;setToggle();that.dispatchEvent("change");});function setToggle(immediate){var oldX=that.indicator.x;var t=time;if(immediate===true)t=0;if(indicatorType=="rectangle"||indicatorType=="square"){that.indicator.pos(height*.2,null,_toggled);if(time>0)that.indicator.animate({props:{x:oldX},from:true,time:t});}else{that.indicator.pos(height*.175,null,_toggled);if(time>0)that.indicator.animate({props:{x:oldX},from:true,time:t});}
that.background.color=_toggled?toggleBackgroundColor:backgroundColor;that.text=_toggled?(that.label?that.label.text:"on"):(that.labelLeft?that.labelLeft.text:"off");if(that.zimAccessibility){var string="Toggle set to "+(_toggled?(that.label?that.label.text+".":"on."):(that.labelLeft?that.labelLeft.text+".":"off."));setTimeout(function(){that.zimAccessibility.talk(string);},50);}}
Object.defineProperty(that,'textLeft',{get:function(){if(labelLeft)return labelLeft.text;return null;},set:function(value){if(labelLeft){labelLeft.text=value;if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}}});that.toggle=function(state,immediate){var lastToggle=_toggled;if(zot(state))state=true;_toggled=state;if(lastToggle!=_toggled)setToggle(immediate);return that;};that.text=_toggled?(that.label?that.label.text:"on"):(that.labelLeft?that.labelLeft.text:"off");Object.defineProperty(that,'toggled',{get:function(){return _toggled;},set:function(value){that.toggle(value);}});this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){zenable(that,value);}});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Toggle(width,height,label?label.clone():"",startToggled,backgroundColor,margin,indicatorType,indicatorColor,tap,toggleBackgroundColor,color,borderColor,borderWidth,corner,indicatorCorner,shadowColor,shadowBlur,time,labelLeft?labelLeft.clone():"",style,this.group,inherit));};};zim.extend(zim.Toggle,zim.Container,"clone","zimContainer",false);zim.Tip=function(text,align,valign,margin,marginH,marginV,outside,target,size,font,color,rollColor,shadowColor,shadowBlur,textAlign,textValign,lineWidth,lineHeight,backing,outlineColor,outlineWidth,backgroundColor,backgroundBorderColor,backgroundBorderWidth,corner,backgroundDashed,padding,paddingHorizontal,paddingVertical,shiftHorizontal,shiftVertical,rollPersist,labelWidth,labelHeight,maxSize,bold,italic,variant,splitWords,style,group,inherit){var sig="text, align, valign, margin, marginH, marginV, outside, target, size, font, color, rollColor, shadowColor, shadowBlur, textAlign, textValign, lineWidth, lineHeight, backing, outlineColor, outlineWidth, backgroundColor, backgroundBorderColor, backgroundBorderWidth, corner, backgroundDashed, padding, paddingHorizontal, paddingVertical, shiftHorizontal, shiftVertical, rollPersist, labelWidth, labelHeight, maxSize, bold, italic, variant, splitWords, style, group, inherit";var duo;if(duo=zob(zim.Tip,arguments,sig,this))return duo;z_d("57.6");this.group=group;var DS=style===false?{}:zim.getStyle("Tip",this.group,inherit);if(zot(text))text=DS.text!=null?DS.text:"Here's a tip!";if(zot(margin))margin=DS.margin!=null?DS.margin:40;if(zot(marginH))marginH=DS.marginH!=null?DS.marginH:margin;if(zot(marginV))marginV=DS.marginV!=null?DS.marginV:margin;if(zot(align))align=DS.align!=null?DS.align:"right";if(zot(valign))valign=DS.valign!=null?DS.valign:"bottom";if(zot(outside))outside=DS.outside!=null?DS.outside:false;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:zim.blue;if(zot(color))color=DS.color!=null?DS.color:zim.white;if(zot(corner))corner=DS.corner!=null?DS.corner:25;if(zot(corner))corner=DS.corner!=null?DS.corner:25;if(zot(corner))corner=DS.corner!=null?DS.corner:25;if(zot(paddingHorizontal))paddingHorizontal=DS.paddingHorizontal!=null?DS.paddingHorizontal:14+(Array.isArray(corner)?corner[0]:corner);if(zot(shadowColor)||shadowColor=="ignore")shadowColor=(DS.shadowColor!=null&&shadowColor!="ignore")?DS.shadowColor:"rgba(0,0,0,.3)";if(zot(shadowBlur)||shadowBlur=="ignore")shadowBlur=(DS.shadowBlur!=null&&shadowBlur!="ignore")?DS.shadowBlur:1;this.zimLabel_constructor(text,size,font,color,rollColor,null,null,textAlign,textValign,bold,italic,variant,lineWidth,lineHeight,backing,outlineColor,outlineWidth,backgroundColor,backgroundBorderColor,backgroundBorderWidth,corner,backgroundDashed,padding,paddingHorizontal,paddingVertical,shiftHorizontal,shiftVertical,rollPersist,labelWidth,labelHeight,maxSize,splitWords,style,group,zim.copy(DS));this.type="Tip";if(outside){marginH=-marginH;marginV=-marginV;}
var that=this;that.align=align;that.valign=valign;this.background.sha(shadowColor,3,5,shadowBlur);this.show=function(delay,time){var timeType=getTIME(time);if(zot(delay))delay=DS.delay!=null?DS.delay:0;if(zot(time))time=DS.time!=null?DS.time:timeType=="s"?2:2000;var mess="zim Tip(): Please pass in a reference to a container with bounds set as parameter to Tip";if(zot(target)){if(zdf){target=zdf.stage;}else{return that;}}else if(!target.getBounds){return that;}else if(zot(target.stage)){zog("zim display - Waiter(): The container must have a stage property");return that;}
if(delay>0){that.showID=zim.timeout(delay,doShow);}else{doShow();}
function doShow(){if(target.boundsToGlobal)var b=target.boundsToGlobal();else var b=target.getBounds();var container=new zim.Container(b.x,b.y,b.width,b.height);container.zimTemp=true;container.loc(0,0,target.stage);if(that.align=="center"||that.align=="middle"||that.valign=="center"||that.valign=="middle"){that.center(container);}
that.pos((that.align=="center"||that.align=="middle")?null:marginH,(that.valign=="center"||that.valign=="middle")?null:marginV,(that.align=="right"),(that.valign=="bottom"),container);if(outside){if(that.align=="right")that.x+=that.width;else if(that.align=="left")that.x-=that.width;if(that.valign=="bottom")that.y+=that.height;else if(that.valign=="top")that.y-=that.height;}
that.addTo(container.stage);if(container.zimTemp&&container.removeFrom){container.removeFrom();container=null;}
container=that.stage;if(that.timeoutID)that.timeoutID.clear();that.timeoutID=zim.timeout(time,function(){that.hide();container.stage.update();});if(that.upID)container.stage.off("stagemouseup",that.upID);that.upID=container.stage.on("stagemouseup",function(){that.hide();if(container.stage)container.stage.update();});if(container.stage)container.stage.update();}
return that;};this.hide=function(){this.removeFrom();if(this.timeoutID)this.timeoutID.clear();if(this.upID&&target.stage)target.stage.off("stagemouseup",this.downID);return that;};this.clear=function(){if(that.showID)that.showID.clear();that.hide();};if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Tip(text,align,valign,margin,marginH,marginV,outside,target,size,font,color,rollColor,shadowColor,shadowBlur,textAlign,textValign,lineWidth,lineHeight,backing,outlineColor,outlineWidth,backgroundColor,backgroundBorderColor,backgroundBorderWidth,corner,backgroundDashed,padding,paddingHorizontal,paddingVertical,shiftHorizontal,shiftVertical,rollPersist,labelWidth,labelHeight,maxSize,splitWords,style,this.group,inherit));};};zim.extend(zim.Tip,zim.Label,"clone","zimLabel",false);zim.Panel=function(width,height,titleBar,titleBarColor,titleBarBackgroundColor,titleBarHeight,backgroundColor,borderColor,borderWidth,corner,close,closeColor,arrow,align,shadowColor,shadowBlur,draggable,boundary,extraButton,collapse,collapsed,style,group,inherit){var sig="width, height, titleBar, titleBarColor, titleBarBackgroundColor, titleBarHeight, backgroundColor, borderColor, borderWidth, corner, close, closeColor, arrow, align, shadowColor, shadowBlur, draggable, boundary, extraButton, collapse, collapsed, style, group, inherit";var duo;if(duo=zob(zim.Panel,arguments,sig,this))return duo;z_d("57.7");this.group=group;var DS=style===false?{}:zim.getStyle("Panel",this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:250;if(zot(height))height=DS.height!=null?DS.height:300;this.zimContainer_constructor(width,height,null,null,false);this.type="Panel";if(zot(titleBar))titleBar=DS.titleBar!=null?DS.titleBar:"PANEL";if(zot(titleBarColor))titleBarColor=DS.titleBarColor!=null?DS.titleBarColor:"#fff";if(zot(titleBarBackgroundColor))titleBarBackgroundColor=DS.titleBarBackgroundColor!=null?DS.titleBarBackgroundColor:"#555";if(zot(titleBarHeight))titleBarHeight=DS.titleBarHeight!=null?DS.titleBarHeight:30;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#eee";if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:"#888";if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(corner))corner=DS.corner!=null?DS.corner:5;if(zot(align))align=DS.align!=null?DS.align:"left";if(zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.3)";if(zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:14;if(zot(draggable))draggable=DS.draggable!=null?DS.draggable:false;if(zot(boundary))boundary=DS.boundary!=null?DS.boundary:null;if(zot(close))close=DS.close!=null?DS.close:false;if(zot(closeColor))closeColor=DS.closeColor!=null?DS.closeColor:!zot(titleBarColor)?titleBarColor:"#555";if(zot(arrow))arrow=DS.arrow!=null?DS.arrow:zim.vee(titleBar);if(!Array.isArray(corner))corner=[corner,corner,corner,corner];if(zot(collapse))collapse=DS.collapse!=null?DS.collapse:false;if(zot(collapsed))collapsed=DS.collapsed!=null?DS.collapsed:false;var that=this;var background=this.background=new zim.Rectangle(width,height,backgroundColor,borderColor,borderWidth,corner).addTo(this);if(shadowColor!=-1&&shadowBlur>0){this.background.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);}
var titleBarValue=titleBar;var t=zim.Pick.choose(titleBarValue);var tBarColor=zim.Pick.choose(titleBarColor);var tBarBackgroundColor=zim.Pick.choose(titleBarBackgroundColor);var pBackgroundColor=zim.Pick.choose(backgroundColor);var pBorderColor=zim.Pick.choose(borderColor);if(typeof t=="string")t=new zim.Label({text:t,color:tBarColor,size:DS.size!=null?DS.size:20,bold:DS.bold!=null?DS.bold:false,backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",padding:"ignore",backgroundColor:"ignore",group:this.group});var titleBarLabel=that.titleBarLabel=t;if(zot(tBarBackgroundColor))tBarBackgroundColor="rgba(0,0,0,.2)";that.titleBar=titleBar=new zim.Container(width,titleBarHeight,null,null,false).loc(0,0,that);var titleBarRect=that.titleBar.backing=new zim.Rectangle(width+borderWidth,titleBarHeight,tBarBackgroundColor,null,null,[corner[0]*.95,corner[1]*.95,0,0],true,null,false).center(titleBar);if(titleBar)positionBar();that.label=t;that.text=t.text;if(close){var close=that.close=new zim.Shape(-40,-40,80,80,null,false);close.graphics.f(closeColor).p("AmJEVIEUkTIkXkWIB4h5IEWEYIETkTIB4B3IkTESIEQERIh4B4IkRkRIkSEVg");if(titleBar){close.centerReg(titleBar).scaleTo(titleBar,null,50);if(align=="right")close.pos(Math.max(corner[1]/2,15));else close.pos(Math.max(corner[1]/2,15),null,true);}else{close.addTo(that).sca(.3).mov(width/2-close.width-3,-height/2+close.height);}
close.expand(40);close.cursor="pointer";close.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",function(){var s=that.stage;that.removeFrom();that.dispatchEvent("close");s.update();});}
if(collapse){if(collapsed)that.collapsed=true;that.collapseEvent=that.titleBar.on("dblclick",function(){collapsed=!collapsed;that.collapsed=collapsed;});}
this.nextPanel=function(index,event){var t=zot(index)||zot(titleBarValue.array)?zim.Pick.choose(titleBarValue):titleBarValue.array[index];var tBarColor=zot(index)||zot(titleBarColor.array)?zim.Pick.choose(titleBarColor):titleBarColor.array[index];var tBarBackgroundColor=zot(index)||zot(titleBarBackgroundColor.array)?zim.Pick.choose(titleBarBackgroundColor):titleBarBackgroundColor.array[index];var pBackgroundColor=zot(index)||zot(backgroundColor.array)?zim.Pick.choose(backgroundColor):backgroundColor.array[index];var pBorderColor=zot(index)||zot(borderColor.array)?zim.Pick.choose(borderColor):borderColor.array[index];if(typeof t=="string")t=new zim.Label({text:t,color:tBarColor,size:DS.size!=null?DS.size:20,backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",padding:"ignore",backgroundColor:"ignore",group:this.group});that.label=t;that.text=t.text;titleBarLabel.removeFrom();titleBarLabel=that.titleBarLabel=t;positionBar();titleBarRect.color=tBarBackgroundColor;that.background.color=pBackgroundColor;that.background.borderColor=pBorderColor;if(event)that.dispatchEvent("change");if(!OPTIMIZE&&that.stage)that.stage.update();};function positionBar(){if(align=="right")titleBarLabel.center(titleBar).pos(Math.max(corner[0]/2,10),null,true);else if(align=="center"||align=="middle")titleBarLabel.center(titleBar);else titleBarLabel.center(titleBar).loc(Math.max(corner[0]/2,10));titleBarLabel.mov(0,2);}
if(draggable){titleBar.cursor="pointer";titleBar.on("mousedown",function(){that.drag({rect:boundary,currentTarget:true});});titleBar.on("pressup",function(){that.noDrag(false);});}
if(arrow>0){var added=close?close.width+15:0;var next=that.arrow=new zim.Shape(-20,-20,40,40,null,false);next.graphics.f(titleBarColor).p("AiJieIETCeIkTCfg");next.centerReg(titleBar).scaleTo(titleBar,null,70).alp(.8).hov(1).expand();if(align=="right")next.pos(Math.max(corner[1]/2,10)+added);else next.pos(Math.max(corner[1]/2,10)+added,null,true);next.cursor="pointer";next.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",function(){that.nextPanel();that.dispatchEvent("change");});}
if(!zot(extraButton)){var extraButton=that.extraButton=new zim.Button({label:"R",width:50,height:50,corner:5,group:"PanelExtra"}).scaleTo(titleBar,null,70).centerReg(titleBar).expand();if(align=="left"){extraButton.pos(arrow>0?next.x-next.width-25:Math.max(corner[1]/2,10));}else{extraButton.pos((arrow>0&&align!="center")?next.x+next.width:Math.max(corner[1]/2,10));}}
var overlay=that.overlay=new zim.Rectangle(width,height,null,null,null,corner).alp(.3);Object.defineProperty(that,'panelHeight',{get:function(){return that.background.height;},set:function(value){background.removeFrom();background=this.background=new zim.Rectangle(width,value,backgroundColor,borderColor,borderWidth,corner).addTo(this).bot();if(shadowColor!=-1&&shadowBlur>0){this.background.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);}
that.setBounds(width,value);if(!OPTIMIZE&&that.stage)that.stage.update();}});Object.defineProperty(that,'collapsed',{get:function(){return collapsed;},set:function(value){collapsed=value;if(collapsed)that.setMask(that.titleBar.backing,true);else that.setMask(null);if(that.stage)that.stage.update();}});this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){zenable(that,value);if(!value)that.overlay.addTo(that);else that.overlay.removeFrom();if(!OPTIMIZE&&that.stage)that.stage.update();}});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Toggle(width,height,titleBar?titleBar.clone():"",titleBarColor,titleBarBackgroundColor,titleBarHeight,backgroundColor,borderColor,borderWidth,corner,close,closeColor,arrow,align,shadowColor,shadowBlur,draggable,boundary,extraButton,collapse,collapsed,style,this.group,inherit));};this.doDispose=function(a,b,disposing){if(collapse)this.titleBar.off("dblclick",this.collapseEvent);if(!disposing)this.zimContainer_dispose(true);return true;}};zim.extend(zim.Panel,zim.Container,["clone","dispose"],"zimContainer",false);zim.Panel.prototype.dispose=function(disposing){return this.doDispose(null,null,disposing);};zim.Pane=function(width,height,label,backgroundColor,color,draggable,resets,modal,corner,backdropColor,shadowColor,shadowBlur,center,displayClose,backdropClose,backing,fadeTime,container,titleBar,titleBarColor,titleBarBackgroundColor,titleBarHeight,close,closeColor,style,group,inherit){var sig="width, height, label, backgroundColor, color, draggable, resets, modal, corner, backdropColor, shadowColor, shadowBlur, center, displayClose, backdropClose, backing, fadeTime, container, titleBar, titleBarColor, titleBarBackgroundColor, titleBarHeight, close, closeColor, style, group, inherit";var duo;if(duo=zob(zim.Pane,arguments,sig,this))return duo;z_d("58");this.zimContainer_constructor(null,null,null,null,false);this.type="Pane";var mess="zim display - Pane(): Please pass in a reference to a container with bounds set as first parameter";if(zot(container)){if(zdf){container=zdf.stage;}else{zog(mess);return;}}else if(!container.getBounds){zog(mess);return;}else if(zot(container.getStage)){zog("zim display - Pane(): The container must have a stage property");return;}
this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:200;if(zot(height))height=DS.height!=null?DS.height:200;if(zot(label))label=DS.label!=null?DS.label:null;if(typeof label==="string"||typeof label==="number")label=new zim.Label({text:label,size:DS.size!=null?DS.size:40,align:DS.align!=null?DS.align:"center",valign:DS.valign!=null?DS.valign:"center",color:DS.color!=null?DS.color:color,backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",padding:"ignore",backgroundColor:"ignore",group:this.group});if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"white";if(zot(draggable))draggable=DS.draggable!=null?DS.draggable:false;if(zot(resets))resets=DS.resets!=null?DS.resets:true;if(zot(modal))modal=DS.modal!=null?DS.modal:true;if(zot(corner))corner=DS.corner!=null?DS.corner:20;if(zot(titleBar))titleBar=DS.titleBar!=null?DS.titleBar:null;if(zot(titleBarColor))titleBarColor=DS.titleBarColor!=null?DS.titleBarColor:null;if(zot(titleBarBackgroundColor))titleBarBackgroundColor=DS.titleBarBackgroundColor!=null?DS.titleBarBackgroundColor:null;if(zot(titleBarHeight))titleBarHeight=DS.titleBarHeight!=null?DS.titleBarHeight:null;if(zot(backdropColor))backdropColor=DS.backdropColor!=null?DS.backdropColor:"rgba(0,0,0,.2)";if(zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.3)";if(zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:20;if(zot(center))center=DS.center!=null?DS.center:true;if(zot(displayClose))displayClose=DS.displayClose!=null?DS.displayClose:true;if(draggable)displayClose=false;if(zot(backdropClose))backdropClose=DS.backdropClose!=null?DS.backdropClose:true;if(zot(fadeTime))fadeTime=DS.fadeTime!=null?DS.fadeTime:0;if(zot(close))close=DS.close!=null?DS.close:false;if(zot(closeColor))closeColor=DS.closeColor!=null?DS.closeColor:"#555";var backdrop=this.backdrop=new zim.Shape({style:false});backdrop.type="CreateJS_Shape";var g=backdrop.graphics;g.f(backdropColor);g.drawRect(-5000,-5000,10000,10000);this.setBounds(-width/2,-height/2,width,height);var that=this;that.container=container;backdrop.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",backdropClose?closePane:function(e){e.stopImmediatePropagation();});var htmlList=new zim.Dictionary(true);function closePane(e){removePane();that.container.stage.update();that.dispatchEvent("close");e.stopImmediatePropagation();}
backdrop.on("mousedown",function(e){e.stopImmediatePropagation();});if(modal)this.addChild(backdrop);var display;if(zot(backing)){display=this.backing=this.display=new zim.Rectangle({width:width,height:height,color:backgroundColor,corner:corner,style:false});}else{if(backing.type=="Pattern"){var pattern=backing;display=new zim.Rectangle(width,height,backgroundColor,null,null,corner,null,null,false);pattern.centerReg(display);pattern.setMask(display.shape);}else{display=backing;}
that.display=that.backing=display;}
if(displayClose){display.cursor="pointer";display.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",closePane);}
if(shadowColor!=-1&&shadowBlur>0)display.shadow=new createjs.Shadow(shadowColor,8,8,shadowBlur);display.on("click",function(e){e.stopImmediatePropagation();});this.resetX;this.resetY;if(draggable){display.cursor="pointer";var diffX,diffY;var stage;display.on("mousedown",function(e){stage=e.target.stage;if(isNaN(that.resetX))that.resetX=that.x;if(isNaN(that.resetY))that.resetY=that.y;diffX=e.stageX/zim.scaX-that.x;diffY=e.stageY/zim.scaY-that.y;display.cursor="pointer";});display.on("pressmove",function(e){var p=checkBounds(e.stageX/zim.scaX-diffX,e.stageY/zim.scaY-diffY);that.x=p.x;that.y=p.y;var ch;for(var i=0;i<that.numChildren;i++){ch=that.getChildAt(i);if(ch.type=="TextArea"||ch.type=="Loader"||ch.type=="Tag"){ch.resize();}}
that.stage.update();});this.on("pressup",function(e){display.cursor="pointer";if(that.stage)that.stage.update();});}
display.centerReg(this);if(label){this.addChild(label);zim.center(label,this);this.label=label;this.text=label.text;label.mouseEnabled=false;}
if(!zot(titleBar)){if(typeof titleBar=="string")titleBar=new zim.Label(titleBar,null,null,titleBarColor);var titleBarLabel=that.titleBarLabel=titleBar;if(zot(titleBarHeight))titleBarHeight=titleBarLabel.height*1.5;if(zot(titleBarColor))titleBarColor="black";if(zot(titleBarBackgroundColor))titleBarBackgroundColor="rgba(0,0,0,.2)";that.titleBar=titleBar=new zim.Container(width,titleBarHeight,null,null,false).centerReg(that).mov(0,-height/2+titleBarHeight/2);titleBar.mouseEnabled=false;titleBar.mouseChildren=false;var titleBarRect=that.titleBar.backing=new zim.Rectangle(width,titleBarHeight,titleBarBackgroundColor,null,null,[corner*.95,corner*.95,0,0],null,null,false).addTo(titleBar);titleBarLabel.center(titleBar).pos({x:Math.max(corner/2,10),reg:true});}
if(close){var close=that.close=new zim.Shape(-40,-40,80,80,null,false);close.graphics.f(closeColor).p("AmJEVIEUkTIkXkWIB4h5IEWEYIETkTIB4B3IkTESIEQERIh4B4IkRkRIkSEVg");if(titleBar)close.addTo(that).scaleTo(titleBar,null,50).mov(width/2-Math.max(corner/2,10)-close.width/2,-height/2+titleBarHeight/2).expand(40);else close.addTo(that).sca(.3).mov(width/2-close.width-3,-height/2+close.height).expand(40);close.cursor="pointer";close.expand();close.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",closePane);}
Object.defineProperty(that,'text',{get:function(){var t=(label.text==" ")?"":label.text;return t;},set:function(value){label.text=value;}});this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){zenable(that,value);}});this.hide=function(callEvent){removePane();that.toggled=false;if(callEvent)that.dispatchEvent("close");return that;};function removePane(){if(fadeTime>0){that.animate({obj:{alpha:0},time:fadeTime,call:function(){end();that.dispatchEvent("fadedout");}});}else{end();}
function end(){that.container.removeChild(that);var ch;for(var i=0;i<that.numChildren;i++){ch=that.getChildAt(i);if(ch.type=="TextArea"||ch.type=="Loader"||ch.type=="Tag"){var obj={obj:ch,depth:that.getChildIndex(ch)};htmlList.add(ch,obj);}}
for(var i=that.numChildren-1;i>=0;i--){ch=that.getChildAt(i);if(ch.type=="TextArea"||ch.type=="Loader"||ch.type=="Tag"){that.removeChild(ch);}}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE)))that.container.stage.update();if(resets){if(!isNaN(that.resetX))that.x=that.resetX;if(!isNaN(that.resetY))that.y=that.resetY;}
if(that.zimAccessibility){var a=that.zimAccessibility;a.resize(that);if(accessibilityClicker)accessibilityClicker.focus();else that.zimTabTag.nextSibling.focus();setTimeout(function(){a.talk("Pane has been closed.");},50);}}}
var accessibilityClicker;this.show=function(){if(center){if(isNaN(that.resetX)){that.x=(that.container.getBounds().width)/2;that.y=(that.container.getBounds().height)/2;}}
that.container.addChild(that);for(var i=0;i<htmlList.length;i++){that.addChildAt(htmlList.values[i].obj,htmlList.values[i].depth);}
if(fadeTime>0){that.alpha=0;that.animate({props:{alpha:1},time:fadeTime,call:function(){that.dispatchEvent("fadedin");}});}else{if(that.container.stage)that.container.stage.update();}
if(that.zimAccessibility){var a=that.zimAccessibility;setTimeout(function(){if(a.activatedObject)accessibilityClicker=a.activatedObject.zimTabTag;},50);a.resize(that);a.tabIndex=that.zimTabIndex;}
that.toggled=true;return that;};function checkBounds(x,y){x=Math.max(width/2,Math.min(that.container.getBounds().width-width/2,x));y=Math.max(height/2,Math.min(that.container.getBounds().height-height/2,y));return{x:x,y:y};}
this.toggle=function(state){if(state===true)that.show();else if(state===false)that.hide();else if(that.container.contains(that))that.hide();else that.show();return that;};if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){var lX=label.x;var lY=label.y;var p2=that.cloneProps(new zim.Pane(width,height,label.clone(),backgroundColor,color,draggable,resets,modal,corner,backdropColor,shadowColor,shadowBlur,center,displayClose,backdropClose,zot(backing)?backing.clone():null,fadeTime,that.container,titleBar,titleBarColor,titleBarBackgroundColor,titleBarHeight,close,closeColor,style,this.group,inherit));p2.label.x=lX;p2.label.y=lY;return p2;};};zim.extend(zim.Pane,zim.Container,"clone","zimContainer",false);zim.Window=function(width,height,backgroundColor,borderColor,borderWidth,padding,corner,swipe,scrollBarActive,scrollBarDrag,scrollBarColor,scrollBarAlpha,scrollBarFade,scrollBarH,scrollBarV,slide,slideDamp,slideSnap,interactive,shadowColor,shadowBlur,paddingHorizontal,paddingVertical,scrollWheel,damp,titleBar,titleBarColor,titleBarBackgroundColor,titleBarHeight,draggable,boundary,onTop,close,closeColor,cancelCurrentDrag,fullSize,fullSizeColor,resizeHandle,style,group,inherit){var sig="width, height, backgroundColor, borderColor, borderWidth, padding, corner, swipe, scrollBarActive, scrollBarDrag, scrollBarColor, scrollBarAlpha, scrollBarFade, scrollBarH, scrollBarV, slide, slideDamp, slideSnap, interactive, shadowColor, shadowBlur, paddingHorizontal, paddingVertical, scrollWheel, damp, titleBar, titleBarColor, titleBarBackgroundColor, titleBarHeight, draggable, boundary, onTop, close, closeColor, cancelCurrentDrag, fullSize, fullSizeColor, resizeHandle, style, group, inherit";var duo;if(duo=zob(zim.Window,arguments,sig,this))return duo;z_d("58.1");this.zimContainer_constructor(null,null,null,null,false);this.type="Window";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:300;if(zot(height))height=DS.height!=null?DS.height:200;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#333";var originalBorderColor=borderColor;var originalBorderWidth=borderWidth;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:"#999";if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:1;if(zot(padding))padding=DS.padding!=null?DS.padding:0;if(zot(corner))corner=DS.corner!=null?DS.corner:0;if(zot(swipe))swipe=DS.swipe!=null?DS.swipe:true;if(zot(scrollBarActive))scrollBarActive=DS.scrollBarActive!=null?DS.scrollBarActive:true;if(zot(scrollBarDrag))scrollBarDrag=DS.scrollBarDrag!=null?DS.scrollBarDrag:false;if(zot(scrollBarColor))scrollBarColor=DS.scrollBarColor!=null?DS.scrollBarColor:borderColor;if(zot(scrollBarAlpha))scrollBarAlpha=DS.scrollBarAlpha!=null?DS.scrollBarAlpha:.3;if(zot(scrollBarFade))scrollBarFade=DS.scrollBarFade!=null?DS.scrollBarFade:true;if(zot(scrollBarH))scrollBarH=DS.scrollBarH!=null?DS.scrollBarH:true;if(zot(scrollBarV))scrollBarV=DS.scrollBarV!=null?DS.scrollBarV:true;if(scrollBarDrag)scrollBarFade=DS.scrollBarFade!=null?DS.scrollBarFade:false;if(zot(slide))slide=DS.slide!=null?DS.slide:true;if(zot(slideDamp))slideDamp=DS.slideDamp!=null?DS.slideDamp:.6;if(zot(slideSnap))slideSnap=DS.slideSnap!=null?DS.slideSnap:"vertical";if(zot(interactive))interactive=DS.interactive!=null?DS.interactive:true;if(zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.3)";if(zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:20;if(zot(paddingVertical))paddingVertical=DS.paddingVertical!=null?DS.paddingVertical:padding;if(zot(paddingHorizontal))paddingHorizontal=DS.paddingHorizontal!=null?DS.paddingHorizontal:padding;if(zot(scrollWheel))scrollWheel=DS.scrollWheel!=null?DS.scrollWheel:true;if(zot(titleBar))titleBar=DS.titleBar!=null?DS.titleBar:null;if(zot(titleBarColor))titleBarColor=DS.titleBarColor!=null?DS.titleBarColor:null;if(zot(titleBarBackgroundColor))titleBarBackgroundColor=DS.titleBarBackgroundColor!=null?DS.titleBarBackgroundColor:null;if(zot(titleBarHeight))titleBarHeight=DS.titleBarHeight!=null?DS.titleBarHeight:null;if(zot(draggable))draggable=DS.draggable!=null?DS.draggable:null;if(zot(boundary))boundary=DS.boundary!=null?DS.boundary:null;if(zot(onTop))onTop=DS.onTop!=null?DS.onTop:null;if(zot(close))close=DS.close!=null?DS.close:null;if(zot(closeColor))closeColor=DS.closeColor!=null?DS.closeColor:null;if(zot(cancelCurrentDrag))cancelCurrentDrag=DS.cancelCurrentDrag!=null?DS.cancelCurrentDrag:false;if(zot(fullSize))fullSize=DS.fullSize!=null?DS.fullSize:null;if(zot(fullSizeColor))fullSizeColor=DS.fullSizeColor!=null?DS.fullSizeColor:null;if(zot(resizeHandle))resizeHandle=DS.resizeHandle!=null?DS.resizeHandle:null;if(titleBar===false)titleBar=null;if(!zot(titleBar)){if(zot(titleBarHeight))titleBarHeight=30;height=height-titleBarHeight;}
var that=this;this.scrollX=this.scrollY=this.scrollXMax=this.scrollYMax=0;var backing=this.backing=new zim.Shape({style:false});this.addChild(backing);var mask=new createjs.Shape();mask.type="WindowBacking";var mg=mask.graphics;this.addChild(mask);var content=this.content=new zim.Container({style:false});this.addChild(content);content.mask=mask;var stage;if(!interactive){var hitArea=new createjs.Shape();}
if(borderWidth>0){var border=new createjs.Shape();this.addChild(border);}
var titleBarCorner=titleBar?0:corner;function sizeWindow(){that.setBounds(0,0,width,height);backing.graphics.c().f(backgroundColor).rc(0,0,width,height,titleBarCorner,titleBarCorner,corner,corner);if(shadowColor!=-1&&shadowBlur>0)backing.shadow=new createjs.Shadow(shadowColor,4,4,shadowBlur);if(borderWidth>0){if(corner){border.graphics.c().s(borderColor).ss(borderWidth,"square","miter").rc(0,0,width,height,titleBarCorner,titleBarCorner,corner,corner);}else{border.graphics.c().s(borderColor).ss(borderWidth,"square","miter").dr(0,0,width,height);}}
if(!zot(titleBarRect)){titleBarRect=titleBar.backing.widthOnly=that.width;that.setBounds(0,-titleBarHeight,that.width,height+titleBarHeight);}
if(that.close){if(titleBar)close.pos({x:width-Math.max(corner/2,10)-close.width/2,y:titleBarHeight/2,reg:true});else close.pos((Math.max(corner/2,10))/2,close.height/2,true,false,that);}
if(that.fullSize){fullSize.pos({x:width-Math.max(corner/2,10)-fullSize.width/2,y:titleBarHeight/2,reg:true});if(that.close)fullSize.mov(-close.width-10);}}
sizeWindow();var scrollBar=this.scrollBar={};scrollBar.color=scrollBarColor;scrollBar.size=6;scrollBar.minSize=scrollBar.size*2;scrollBar.spacing=3.5+borderWidth/2;scrollBar.margin=0;scrollBar.corner=scrollBar.size/2;scrollBar.showTime=.5;scrollBar.fadeTime=3;if(scrollBarActive){var hscrollBar=scrollBar.horizontal=new zim.Shape({style:false});var hg=hscrollBar.graphics;hscrollBar.alpha=scrollBarAlpha;this.addChild(hscrollBar);if(scrollBarDrag)hscrollBar.drag({localBounds:true});var vscrollBar=scrollBar.vertical=new zim.Shape({style:false});var vg=vscrollBar.graphics;vscrollBar.alpha=scrollBarAlpha;this.addChild(vscrollBar);if(scrollBarDrag)vscrollBar.drag({localBounds:true});}
var hProportion;var vProportion;var hCheck;var vCheck;var gap;var contentWidth;var contentHeight;var hEvent;var vEvent;var dTimeout;this.update=function(){if(scrollBarActive){hg.clear();vg.clear();}
gap=(scrollBarActive)?scrollBar.size+scrollBar.spacing*2:0;contentWidth=content.getBounds()?content.getBounds().width:0;contentHeight=content.getBounds()?content.getBounds().height:0;hCheck=(scrollBarH&&contentWidth>width-paddingHorizontal&&(scrollBarActive||swipe===true||swipe=="auto"||swipe=="horizontal"));vCheck=(scrollBarV&&contentHeight>height-paddingVertical&&(scrollBarActive||swipe===true||swipe=="auto"||swipe=="vertical"));that.scrollXMax=contentWidth+paddingHorizontal*2-width+(vCheck?gap+scrollBar.margin:0);that.scrollYMax=contentHeight+paddingVertical*2-height+(hCheck?gap+scrollBar.margin:0);mg.clear();var xx=borderWidth/2;var yy=borderWidth/2;var ww=width-((vCheck&&scrollBarActive)?scrollBar.size+scrollBar.spacing*2:0)-(vCheck?0:borderWidth);var hh=height-((hCheck&&scrollBarActive)?scrollBar.size+scrollBar.spacing*2:0)-(hCheck?0:borderWidth);mg.f("rgba(0,0,0,0)").rc(xx,yy,ww,hh,titleBarCorner,titleBarCorner,vCheck&&scrollBarActive?0:corner,hCheck&&scrollBarActive?0:corner);mask.setBounds(that.getBounds().x,that.getBounds().y,that.getBounds().width,that.getBounds().height);zim.expand(mask,0);if(!interactive){hitArea.graphics.c().f("red").dr(xx,yy,ww,hh);content.hitArea=hitArea;}
var edgeAdjust=Math.max(corner,Math.min(scrollBar.corner,scrollBar.spacing));var edgeLeft=edgeAdjust+borderWidth/2;var edgeRight=edgeAdjust+(vCheck?gap:0)+borderWidth/2;var edgeTop=edgeAdjust+borderWidth/2;var edgeBottom=edgeAdjust+(hCheck?gap:0)+borderWidth/2;var scrollBarLength;if(hCheck&&scrollBarActive){scrollBarLength=Math.max(scrollBar.minSize,(width-edgeLeft-edgeRight)*(width-edgeLeft-edgeRight)/(contentWidth+paddingHorizontal+scrollBar.margin));hg.f(scrollBar.color).rr(0,0,scrollBarLength,scrollBar.size,scrollBar.corner);hscrollBar.x=edgeLeft;hscrollBar.y=height-scrollBar.size-scrollBar.spacing;hProportion=new zim.Proportion(-that.scrollXMax,0,edgeLeft,width-scrollBarLength-edgeRight,-1);if(scrollBarDrag){hscrollBar.setBounds(0,0,scrollBarLength,scrollBar.size);var rect=new createjs.Rectangle(edgeLeft,hscrollBar.y,width-scrollBarLength-edgeLeft-edgeRight,0);hscrollBar.dragBoundary(rect);hscrollBar.proportion=new zim.Proportion(rect.x,rect.x+rect.width,0,-that.scrollXMax);hscrollBar.off("pressmove",hEvent);hEvent=hscrollBar.on("pressmove",function(){that.dispatchEvent("scrolling");if(hitArea){hitArea.x=-content.x;hitArea.y=-content.y;}
content.x=hscrollBar.proportion.convert(hscrollBar.x);});}}
if(vCheck&&scrollBarActive){scrollBarLength=Math.max(scrollBar.minSize,(height-edgeTop-edgeBottom)*(height-edgeTop-edgeBottom)/(contentHeight+paddingVertical+scrollBar.margin));vg.f(scrollBar.color).rr(0,0,scrollBar.size,scrollBarLength,scrollBar.corner);vscrollBar.x=width-scrollBar.size-scrollBar.spacing;vscrollBar.y=edgeTop;vProportion=new zim.Proportion(-that.scrollYMax,0,edgeTop,height-scrollBarLength-edgeBottom,-1);if(scrollBarDrag){vscrollBar.setBounds(0,0,scrollBar.size,scrollBarLength);var rect=new createjs.Rectangle(vscrollBar.x,edgeTop,0,height-scrollBarLength-edgeTop-edgeBottom);vscrollBar.dragBoundary(rect);vscrollBar.proportion=new zim.Proportion(rect.y,rect.y+rect.height,0,-that.scrollYMax);vscrollBar.off("pressmove",vEvent);vEvent=vscrollBar.on("pressmove",function(){that.dispatchEvent("scrolling");if(hitArea){hitArea.x=-content.x;hitArea.y=-content.y;}
desiredY=content.y=vscrollBar.proportion.convert(vscrollBar.y);});}}
movescrollBars();clearTimeout(that.d2Timeout);that.d2Timeout=setTimeout(function(){if(hscrollBar&&hscrollBar.proportion)content.x=hscrollBar.proportion.convert(hscrollBar.x);if(vscrollBar&&vscrollBar.proportion)content.y=vscrollBar.proportion.convert(vscrollBar.y);},50);clearTimeout(that.dTimeout);that.dTimeout=setTimeout(function(){setdragBoundary();},300);setdragBoundary();};this.resize=function(w,h){if(zot(w))w=width;if(zot(h))h=height;var min=20;if(titleBar)min=titleBarLabel.x+titleBarLabel.width+10;if(w<min)w=min;if(h<20)h=20;width=w;height=h;sizeWindow();for(var i=0;i<content.numChildren;i++){var cont=content.getChildAt(i);if(cont.type=="Wrapper")resizeWrapper(cont);}
that.update();desiredY=content.y;if(damp)dampY.immediate(desiredY);return that;};if(!zot(titleBar)){if(zot(draggable))draggable=true;if(typeof titleBar=="string")titleBar=new zim.Label({text:titleBar,color:titleBarColor,size:DS.size!=null?DS.size:20,backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",padding:"ignore",backgroundColor:"ignore",group:this.group});var titleBarLabel=that.titleBarLabel=titleBar;if(zot(titleBarBackgroundColor))titleBarBackgroundColor="rgba(0,0,0,.2)";that.titleBar=titleBar=new zim.Container(width,titleBarHeight,null,null,false).centerReg(that).mov(0,-height/2-titleBarHeight/2);var titleBarRect=that.titleBar.backing=new zim.Rectangle(width+borderWidth,titleBarHeight,titleBarBackgroundColor,null,null,[corner*.95,corner*.95,0,0],true,null,false).center(titleBar);titleBarLabel.center(titleBar).pos({x:Math.max(corner/2,Math.max(10,padding)),reg:true});that.regX=0;that.regY=-titleBarHeight;that.setBounds(0,-titleBarHeight,width,height+titleBarHeight);if(draggable){titleBar.cursor="pointer";titleBar.on("mousedown",function(){that.drag({rect:boundary,currentTarget:true,onTop:onTop});});titleBar.on("pressup",function(){that.noDrag(false);});}else{titleBar.on("mousedown",function(){});}}
if(close){if(zot(closeColor))closeColor="#555";var close=that.close=new zim.Shape(-40,-40,80,80,null,false);close.graphics.f(closeColor).p("AmJEVIEUkTIkXkWIB4h5IEWEYIETkTIB4B3IkTESIEQERIh4B4IkRkRIkSEVg");if(titleBar)close.centerReg(that).scaleTo(titleBar,null,50).pos({x:width-Math.max(corner/2,10)-close.width/2,y:titleBarHeight/2,reg:true}).expand(40);else{close.sca(.3).pos((Math.max(corner/2,10))/2,close.height/2,true,false,that).expand(40);}
close.cursor="pointer";close.expand();close.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",function(){var ss=that.stage;that.removeFrom();that.dispatchEvent("close");if(ss)ss.update();});}
if(!zot(titleBar)){if(fullSize){if(zot(fullSizeColor))fullSizeColor="#555";var fullSize=that.fullSize=new zim.Rectangle(80,80,zim.faint,fullSizeColor,16);var reduceSize=new zim.Shape().s(fullSizeColor).ss(16).mt(-19.6,-20.6).lt(-19.6,-40).lt(40,-40).lt(40,20.7).lt(19.6,20.7).lt(19.6,40).lt(-40,40).lt(-40,-20.6).lt(-19.6,-20.6).lt(19.6,-20.6).lt(19.6,20.7).addTo(that.fullSize).mov(40,40).alp(0);fullSize.centerReg(that).scaleTo(titleBar,null,42).pos({x:width-Math.max(corner/2,10)-fullSize.width/2,y:titleBarHeight/2,reg:true}).expand(40);if(that.close)fullSize.mov(-close.width-10);fullSize.cursor="pointer";fullSize.expand();that.fullCheck=false;var lastWidth=width;var lastHeight=height;var lastX=that.x;var lastY=that.y;fullSize.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",function(){if(that.fullCheck){that.resize(lastWidth,lastHeight-titleBar.height);that.x=lastX;that.y=lastY;that.fullCheck=false;reduceSize.alpha=0;that.fullSize.getChildAt(0).alpha=1;}else{lastWidth=that.width;lastHeight=that.height;lastX=that.x;lastY=that.y;that.resize(that.parent.width,that.parent.height);that.x=0;that.y=0;that.fullCheck=true;reduceSize.alpha=1;that.fullSize.getChildAt(0).alpha=.01;}
if(that.stage)that.stage.update();});}}
if(resizeHandle){var handle=that.resizeHandle=new zim.Rectangle(25,25,zim.grey,zim.white).alp(.01).centerReg().rot(45).hov(.5).loc(0,0,that).mov(that.width,that.height-(that.titleBar?that.titleBar.height:0)).drag();handle.on("pressmove",function(){that.resize(handle.x,handle.y);});handle.on("pressup",placeHandle);if(that.titleBar)that.titleBar.on("pressup",placeHandle);function placeHandle(){handle.loc(0,0,that).top().alp(.01).mov(that.width,that.height-(that.titleBar?that.titleBar.height:0));}}
function resizeWrapper(cont){if(cont.align=="right"){cont.x=paddingHorizontal;cont.resize(that.width-(vCheck?scrollBar.size+scrollBar.spacing*2:paddingHorizontal)-paddingHorizontal*2);}else if(cont.align=="center"||cont.align=="middle"){cont.resize(that.width-(vCheck?scrollBar.size+scrollBar.spacing*2:0)-paddingHorizontal*2);}else{cont.resize(that.width-(vCheck?scrollBar.size+scrollBar.spacing*2:0)-paddingHorizontal*2);}
cont.alpha=cont.wrapperLastAlpha;}
this.add=function(c,replace){makeDamp(c);if(!c.getBounds()){zog("SwipeBox.add() - please add content with bounds set");return;}
if(replace)that.removeAll();content.addChild(c);if(c.type=="Wrapper"){vscrollBar.alpha=0;scrollBarH=false;c.wrapperLastAlpha=c.alpha;c.alpha=0;this.added(function(){resizeWrapper(c);that.resize();hscrollBar.alpha=1;vscrollBar.alpha=1;});}
if(c.x==0)c.x=paddingHorizontal;if(c.y==0)c.y=paddingVertical;that.update();return that;};this.remove=function(c){content.removeChild(c);that.update();return that;};this.removeAll=function(){content.removeAllChildren();that.update();return that;};function setdragBoundary(on){if(zot(stage))stage=that.stage||zimDefaultFrame.stage;if(zot(on))on=true;if(on)zim.dragBoundary(content,new createjs.Rectangle(0,0,hCheck?-that.scrollXMax:0,vCheck?-that.scrollYMax:0));else zim.dragBoundary(content,new createjs.Rectangle(-1000,-1000,stage.width+2000,stage.height+2000));}
var swipeCheck=false;if(swipe){content.on("mousedown",function(){if(!swipeCheck)zim.Ticker.add(swipeMovescrollBars,content.stage);swipeCheck=true;if(hCheck&&scrollBarActive)if(scrollBarFade)zim.animate(hscrollBar,{alpha:scrollBarAlpha},scrollBar.showTime);if(vCheck&&scrollBarActive)if(scrollBarFade)zim.animate(vscrollBar,{alpha:scrollBarAlpha},scrollBar.showTime);});}
function swipeMovescrollBars(){desiredY=content.y;if(damp)dampY.immediate(desiredY);if(scrollBarActive)movescrollBars();}
function movescrollBars(){that.dispatchEvent("scrolling");if(hitArea){hitArea.x=-content.x;hitArea.y=-content.y;}
if(hCheck&&scrollBarActive)hscrollBar.x=hProportion.convert(content.x);if(vCheck&&scrollBarActive)vscrollBar.y=vProportion.convert(content.y);}
this.on("added",function(){setDrag(50);},null,true);function setDrag(delay){if(zot(delay))delay=100;makeDamp(that);if(!swipe)return;setTimeout(function(){if(content){zim.drag({obj:content,currentTarget:true,localBounds:true,slide:slide,slideDamp:slideDamp,slideSnap:(scrollBarH&&(swipe===true||swipe=="auto"||swipe=="horizontal"))||(scrollBarV&&(swipe===true||swipe=="auto"||swipe=="vertical"))?slideSnap:false});content.removeAllEventListeners("slidestart");content.on("slidestart",function(){that.dispatchEvent("slidestart");});content.removeAllEventListeners("slidestop");content.on("slidestop",function(e){if(slide)stageUp(e);that.dispatchEvent("slidestop");});if(content.getBounds()&&content.getBounds().width>0){setdragBoundary();}}},delay);}
this.cancelCurrentDrag=function(){if(that.content)that.content.noDrag(false);setTimeout(function(){if(content){zim.drag({obj:content,currentTarget:true,localBounds:true,slide:slide,slideDamp:slideDamp,slideSnap:(scrollBarH&&(swipe===true||swipe=="auto"||swipe=="horizontal"))||(scrollBarV&&(swipe===true||swipe=="auto"||swipe=="vertical"))?slideSnap:false});if(content.getBounds()&&content.getBounds().width>0){setdragBoundary();}}},300);};var stage,stageEvent;this.added(function(_stage){stage=_stage;stageEvent=stage.on("stagemousemove",function(e){that.windowMouseX=e.stageX/zim.scaX;that.windowMouseY=e.stageY/zim.scaY;});});if(slide){content.on("slidestop",stageUp);}else{content.on("mousedown",function(){content.stage.on("stagemouseup",stageUp,null,true);});}
if(cancelCurrentDrag){that.blurEvent=function(){that.cancelCurrentDrag();stageUp();};document.window.addEventListener("blur",that.blurEvent);}
function stageUp(e){zim.Ticker.remove(swipeMovescrollBars);swipeCheck=false;if(hCheck)if(scrollBarFade&&scrollBarActive)zim.animate(hscrollBar,{alpha:0},scrollBar.fadeTime);if(vCheck)if(scrollBarFade&&scrollBarActive)zim.animate(vscrollBar,{alpha:0},scrollBar.fadeTime);}
if(interactive){var downLoc;var downTime;content.on("mousedown",function(e){stage=e.target.stage;downLoc=e.stageX/zim.scaX;downTime=Date.now();});content.on("click",function(e){if(Date.now()-downTime<600&&Math.abs(e.stageX/zim.scaX-downLoc)<5){that.contentMouse=content.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);that.dispatchEvent("select");}});content.on("mouseover",moveOn);content.on("mouseout",moveOff);var startTime;function moveOn(){startTime=Date.now();zim.Ticker.add(timeMouse,content.stage);}
function moveOff(){if(!hoverOutCalled){that.dispatchEvent("hoverout");hoverOutCalled=true;}
zim.Ticker.remove(timeMouse);}
var lastMouseX=0;var lastMouseY=0;var lastReportX=0;var lastReportY=0;var pauseTime=300;var thresh=2;var hoverOutCalled=false;function timeMouse(){if(!content.stage){if(!hoverOutCalled){that.dispatchEvent("hoverout");hoverOutCalled=true;}
zim.Ticker.remove(timeMouse);return;}
if(Math.abs(lastMouseX-that.windowMouseX)>thresh||Math.abs(lastMouseY-that.windowMouseY)>thresh){if(!hoverOutCalled){that.dispatchEvent("hoverout");hoverOutCalled=true;}
startTime=Date.now();lastMouseX=that.windowMouseX;lastMouseY=that.windowMouseY;}else{if(Date.now()-startTime>pauseTime){if(Math.abs(lastReportX-that.windowMouseX)>thresh||Math.abs(lastReportY-that.windowMouseY)>thresh){that.contentMouse=content.globalToLocal(that.windowMouseX,that.windowMouseY);that.dispatchEvent("hoverover");lastReportX=that.windowMouseX;lastReportY=that.windowMouseY;hoverOutCalled=false;}
startTime=Date.now();}}}}
var scrollEvent1;var scrollEvent2;var scrollEvent3;var desiredY=that.scrollY;that.scrollWindow=function scrollWindow(e){if(vCheck&&that.stage&&that.hitTestPoint(that.windowMouseX,that.windowMouseY)&&that.contains(that.stage.getObjectUnderPoint(that.windowMouseX*zim.scaX,that.windowMouseY*zim.scaY))){if(zot(e))e=event;var delta=e.detail?e.detail*(-19):e.wheelDelta;if(zot(delta))delta=e.deltaY*(-19);desiredY+=delta;desiredY=Math.max(-that.scrollYMax,Math.min(0,desiredY));if(!damp){that.scrollY=desiredY;content.stage.update();}}}
if(scrollWheel){window.addEventListener("mousewheel",that.scrollWindow);window.addEventListener("wheel",that.scrollWindow);window.addEventListener("DOMMouseScroll",that.scrollWindow);}
var dampCheck=false;var dampY;function makeDamp(obj){if(damp&&!dampCheck&&obj.stage){dampCheck=true;dampY=new zim.Damp(that.scrollY,damp);that.dampTicker=zim.Ticker.add(function(){if(swipeCheck)return;if(!zot(desiredY))that.scrollY=dampY.convert(desiredY);},obj.stage);}}
this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){if(!value){clearTimeout(that.dTimeout);zim.noDrag(content);}else{setDrag();}
zenable(that,value);}});this._scrollEnabled=true;Object.defineProperty(that,'scrollEnabled',{get:function(){return that._scrollEnabled;},set:function(value){if(!value){clearTimeout(that.dTimeout);zim.noDrag(content);if(scrollBarDrag){if(hEvent)hscrollBar.mouseEnabled=false;if(vEvent)vscrollBar.mouseEnabled=false;}
window.removeEventListener("mousewheel",that.scrollWindow);window.removeEventListener("wheel",that.scrollWindow);window.removeEventListener("DOMMouseScroll",that.scrollWindow);}else{setDrag();if(scrollBarDrag){if(hEvent)hscrollBar.mouseEnabled=true;if(vEvent)vscrollBar.mouseEnabled=true;}
window.addEventListener("mousewheel",that.scrollWindow);window.addEventListener("wheel",that.scrollWindow);window.addEventListener("DOMMouseScroll",that.scrollWindow);}
that._scrollEnabled=value;}});Object.defineProperty(that,'scrollX',{get:function(){return content.x;},set:function(value){content.x=value;clearTimeout(that.d2Timeout);if(content.zimDragImmediate)content.zimDragImmediate(content.x,content.y);movescrollBars();}});Object.defineProperty(that,'scrollY',{get:function(){return content.y;},set:function(value){content.y=value;clearTimeout(that.d2Timeout);if(content.zimDragImmediate)content.zimDragImmediate(content.x,content.y);movescrollBars();}});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(recursive){if(zot(recursive))recursive=true;var w=that.cloneProps(new zim.Window(width,height,backgroundColor,originalBorderColor,originalBorderWidth,padding,corner,swipe,scrollBarActive,scrollBarDrag,scrollBar.color,scrollBarAlpha,scrollBarFade,scrollBarH,scrollBarV,slide,slideDamp,slideSnap,interactive,shadowColor,shadowBlur,paddingHorizontal,paddingVertical,titleBar,titleBarColor,titleBarBackgroundColor,titleBarHeight,draggable,boundary,onTop,close,closeColor,cancelCurrentDrag,fullSize,fullSizeColor,resizeHandle,style,group,inherit));if(recursive){that.content.cloneChildren(w.content);w.update();}
return w;};this.doDispose=function(a,b,disposing){if(scrollWheel){window.removeEventListener("mousewheel",that.scrollWindow);window.removeEventListener("wheel",that.scrollWindow);window.removeEventListener("DOMMouseScroll",that.scrollWindow);}
if(stageEvent&&stage)stage.off("stagemousemove",stageEvent);if(that.resizeHandle)that.resizeHandle.removeAllEventListeners();if(that.blurEvent)document.window.removeEventListener("blur",that.blurEvent);if(typeof timeMouse!="undefined")zim.Ticker.remove(timeMouse);if(!zot(swipeMovescrollBars))zim.Ticker.remove(swipeMovescrollBars);if(!disposing)this.zimContainer_dispose(true);content=that.content=null;return true;};};zim.extend(zim.Window,zim.Container,["clone","dispose"],"zimContainer",false);zim.Window.prototype.dispose=function(disposing){return this.doDispose(null,null,disposing);};zim.Page=function(width,height,color,color2,vertical,pattern,scalePattern,cache,style,group,inherit){var sig="width, height, color, color2, vertical, pattern, scalePattern, cache, style, group, inherit";var duo;if(duo=zob(zim.Page,arguments,sig,this))return duo;z_d("58.3");this.group=group;var DS=style===false?{}:zim.getStyle("Page",this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:zdf.width;if(zot(height))height=DS.height!=null?DS.height:zdf.height;this.zimContainer_constructor(0,0,width,height,false);this.type="Page";var that=this;if(zot(vertical))vertical=DS.vertical!=null?DS.vertical:true;if(zot(color))color=DS.color!=null?DS.color:zim.light;if(zot(color2))color2=DS.color2!=null?DS.color2:null;if(zot(pattern))pattern=DS.pattern!=null?DS.pattern:null;if(zot(scalePattern))scalePattern=DS.scalePattern!=null?DS.scalePattern:"fill";if(zot(cache))cache=DS.cache!=null?DS.cache:false;if(!zot(color2)){color=new zim.GradientColor([color,color2],[0,1],0,0,vertical?0:width,vertical?height:0);color2=null;}
var backing=this.backing=new zim.Rectangle({width:width,height:height,color:color,style:false}).addTo(this);if(zot(cache)&&(!zot(color2)||!zot(pattern)))cache=true;if(cache)backing.cache();if(!zot(pattern)){this.pattern=pattern.addTo(this);if(scalePattern)pattern.scaleTo(this,100,100,scalePattern).center(this);if(cache)pattern.cache();}
Object.defineProperty(that,'color',{get:function(){return color;},set:function(value){if(zot(value))value="black";color=value;that.backing.color=value;}});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(recursive){if(zot(recursive))recursive=false;if(color.type)color2=null;var w=that.cloneProps(new zim.Page(width,height,color,color2,vertical,pattern,scalePattern,cache,style,group,inherit));if(recursive){that.cloneChildren(w);}
return w;};};zim.extend(zim.Page,zim.Container,["clone"],"zimContainer",false);zim.Layer=function(width,height,titleBar,titleBarContainer,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,color,rollColor,selectedColor,selectedRollColor,borderWidth,borderColor,dashed,transformObject,titleBarWidth,titleBarHeight,titleBarX,titleBarY,titleBarDraggable,close,closeColor,closeBackgroundColor,closeIndicatorColor,anchor,style,group,inherit){var sig="width, height, titleBar, titleBarContainer, backgroundColor, rollBackgroundColor, selectedBackgroundColor, selectedRollBackgroundColor, color, rollColor, selectedColor, selectedRollColor, borderWidth, borderColor, dashed, transformObject, titleBarWidth, titleBarHeight, titleBarX, titleBarY, titleBarDraggable, close, closeColor, closeBackgroundColor, closeIndicatorColor, anchor, style, group, inherit";var duo;if(duo=zob(zim.Layer,arguments,sig,this))return duo;z_d("58.5");this.group=group;var DS=style===false?{}:zim.getStyle("Layer",this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:500;if(zot(height))height=DS.height!=null?DS.height:500;this.zimContainer_constructor(0,0,width,height,false);this.type="Layer";var that=this;that.distX=40;that.distY=0;if(zot(titleBar))titleBar=DS.titleBar!=null?DS.titleBar:"LAYER";var titleBarOriginal=titleBar;var titleBarText=titleBar;var titleBarDefault=true;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#eee";if(zot(rollBackgroundColor))rollBackgroundColor=DS.rollBackgroundColor!=null?DS.rollBackgroundColor:"#fff";if(zot(selectedBackgroundColor))selectedBackgroundColor=DS.selectedBackgroundColor!=null?DS.selectedBackgroundColor:"#666";if(zot(color))color=DS.color!=null?DS.color:"#666";if(zot(rollColor))rollColor=DS.rollColor!=null?DS.rollColor:"#666";if(zot(selectedColor))selectedColor=DS.selectedColor!=null?DS.selectedColor:"#ddd";if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:1;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:backgroundColor;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;if(zot(dashed))dashed=DS.dashed!=null?DS.dashed:true;if(zot(transformObject))transformObject=DS.titleBar!=null?DS.titleBar:null;if(zot(titleBarWidth))titleBarWidth=DS.titleBarWidth!=null?DS.titleBarWidth:100;var originalTitleBarWidth=titleBarWidth;if(zot(titleBarHeight))titleBarHeight=DS.titleBarHeight!=null?DS.titleBarHeight:40;if(zot(titleBarX))titleBarX=DS.titleBarX!=null?DS.titleBarX:null;if(zot(titleBarY))titleBarY=DS.titleBarY!=null?DS.titleBarY:null;if(zot(titleBarDraggable))titleBarDraggable=DS.titleBarDraggable!=null?DS.titleBarDraggable:true;if(zot(close))close=DS.close!=null?DS.close:true;if(zot(closeColor))closeColor=DS.closeColor!=null?DS.closeColor:selectedBackgroundColor;if(zot(closeBackgroundColor))closeBackgroundColor=DS.closeBackgroundColor!=null?DS.closeBackgroundColor:selectedBackgroundColor;if(zot(closeIndicatorColor))closeIndicatorColor=DS.closeIndicatorColor!=null?DS.closeIndicatorColor:selectedColor;if(zot(anchor))anchor=DS.anchor!=null?DS.anchor:true;if(!titleBarDraggable)anchor=false;that.anchor=anchor;if(close)titleBarWidth+=30;transformObject=zim.merge({borderColor:selectedBackgroundColor},transformObject,{events:true,visible:false,ghostColor:borderColor,ghostWidth:borderWidth,ghostDashed:dashed,ghostHidden:true});if(zot(titleBarContainer))titleBarContainer=DS.titleBarContainer!=null?DS.titleBarContainer:null;if(zot(titleBarContainer)){if(zdf){titleBarContainer=zdf.stage;}else{zog("zim Layer(): Please pass in a reference to a container with bounds set.");return;}}
var downCheck=false;that.active=false;that.turnOff=function(noHide,noShow){that.active=false;if(close)that.checkBox.visible=false;that.transformControls.remove();that.mouseChildren=true;that.button.backgroundColor=backgroundColor;that.button.rollBackgroundColor=rollBackgroundColor;that.button.color=color;that.button.rollColor=color;that.transformControls.allowToggleOff();if(that.resizeChildren)that.resizeChildren();};that.turnOn=function(){that.active=true;if(close){that.checkBox.visible=true;that.checkBox.checked=true;}
that.button.backgroundColor=selectedBackgroundColor;that.button.rollBackgroundColor=selectedBackgroundColor;that.button.color=selectedColor;that.button.rollColor=selectedColor;that.mouseChildren=false;that.transformControls.add();that.transformControls.allowToggleOn();};var stage;that.titleBarPos=function(x,y){if(!that.titleBar)return;if(that.titleBar.pos){that.titleBar.pos(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9]);stage.update();}else{that.distX=x;that.distY=y;}
titleBarDefault=false;return that;};var lastVisible=that.visible;that.visible=false;var firstControl;var timeType=getTIME();this.added(function(theStage){stage=theStage;that.transform(transformObject);if(borderWidth>=0)that.transformControls.hideGhost();setTimeout(function(){function firstPoint(){return that.localToLocal(0,0,titleBarContainer);}
that.visible=lastVisible;if(borderWidth>=0){setTimeout(function(){that.transformControls.showGhost();if(that.stage)that.stage.update();},100);}
stage=theStage;var titleBar=that.titleBar=new zim.Container(titleBarWidth,titleBarHeight).reg(0,titleBarHeight).loc(that,null,titleBarContainer).mov(that.distX,that.distY);if(titleBarDraggable)titleBar.drag({all:true,boundary:new zim.Boundary(0,titleBarHeight,titleBarContainer.width-titleBarWidth,titleBarContainer.height-titleBarHeight),localBounds:true});if(that.distX!=40||that.distY!=0){titleBar.pos(that.distX,that.distY);}
if(close){that.checkBox=new zim.CheckBox({borderColor:closeColor,backgroundColor:closeBackgroundColor,indicatorColor:closeIndicatorColor,size:20,startChecked:true}).center(titleBar).pos(0,null,true).change(function(){that.turnOff(true,true);});that.checkBox.visible=false;}
titleBar.mouseChildren=true;titleBar.layer=that;that.resetTitleBar=function(){that.distX=40;that.distY=0;titleBarDefault=true;that.move(true);if(that.stage)that.stage.update();};if(typeof titleBarText==="string"||typeof titleBarText==="number")titleBarText=new zim.Label({text:titleBarText,color:color,rollColor:rollColor,size:DS.size!=null?DS.size:18,group:this.group});that.label=titleBarText;that.label.center(titleBar);that.button=new zim.Button({shadowBlur:-1,width:originalTitleBarWidth,height:titleBarHeight-1,label:that.label,color:color,rollColor:rollColor,backgroundColor:backgroundColor,rollBackgroundColor:rollBackgroundColor,corner:(DS.corner!=null?DS.corner:0),inherit:zim.copy(DS)}).addTo(titleBar);that.button.on("mousedown",function(){downCheck=true;titleBarContainer.loop(function(bar){if(bar&&bar!=titleBar&&bar.layer&&bar.layer.turnOff&&bar.layer.active)bar.layer.turnOff(true,true);});if(!that.active)that.turnOn();titleBar.top();});that.button.on("pressmove",function(){matchLocation();});that.button.on("pressup",function(){matchLocation(true);var point=that.localToLocal(0,0,titleBarContainer);that.distX=titleBar.x-point.x;that.distY=titleBar.y-point.y;titleBar.top();downCheck=false;if(!edgeCheck()&&titleBarDraggable){var point=that.localToGlobal(0,0);if(that.button.hitTestPoint(point.x,point.y))that.resetTitleBar();}});function matchLocation(dispatch){if(titleBarDefault&&titleBarDraggable){var desiredTopLeft=titleBarContainer.localToLocal(titleBar.x-that.distX,titleBar.y-that.distY,that.parent);var regPoint=that.localToLocal(that.regX,that.regY,that.parent);var topLeft=that.localToLocal(0,0,that.parent);that.x=desiredTopLeft.x+(regPoint.x-topLeft.x);that.y=desiredTopLeft.y+(regPoint.y-topLeft.y);that.transformControls.resize(dispatch);recursiveLocation(that);}}
function recursiveLocation(obj){obj.loop(function(o){if(o.type=="Layer"){if(that.titleBarDraggable)o.move();if(o.transformControls.ghost)o.transformControls.resize();recursiveLocation(o);}});}
that.button.on("dblclick",function(){if(titleBarDraggable)that.resetTitleBar();});that.turnOff();that.on("transformed",function(e){if(e.transformType=="move"||e.transformType=="size"||e.transformType=="stretch"||e.transformType=="rotate"){if(titleBarDraggable)that.move();recursiveLocation(that);}});function edgeCheck(){if(titleBar.x==0)return true;if(titleBar.y==titleBar.height)return true;if(titleBar.x==titleBarContainer.width-titleBar.width)return true;if(titleBar.y==titleBarContainer.height)return true;}
that.move=function(override){if(!override&&!titleBarDefault&&that.anchor){if(edgeCheck())return;}
titleBar.loc(firstPoint()).mov(that.distX,that.distY);if(titleBar.x<0){titleBarDefault=false;titleBar.x=0;}
if(titleBar.y<titleBar.height){titleBarDefault=false;titleBar.y=titleBar.height;}
if(titleBar.x>titleBarContainer.width-titleBar.width){titleBarDefault=false;titleBar.x=titleBarContainer.width-titleBar.width;}
if(titleBar.y>titleBarContainer.height){titleBarDefault=false;titleBar.y=titleBarContainer.height;}
if(!that.anchor)titleBarDefault=true;};that.on("transformhide",function(){that.turnOff(true,true);titleBarContainer.loop(function(bar){if(bar&&bar!=titleBar&&bar.layer&&bar.layer.turnOff&&bar.layer.active)bar.layer.turnOff();});});that.resizeChildren=function(dispatch){that.transformControls.resize(dispatch);that.loop(function(obj){if(obj.transformControls){if(obj.transformControls.visible)obj.transformControls.hide();if(obj.type=="Layer"){obj.resizeChildren();}else{obj.transformControls.resize();}}});};that.resize=function(dispatch){that.move();that.resizeChildren(dispatch);return that;};that.toggled=false;function setToggled(){if(that.toggled){titleBarContainer.loop(function(bar){if(bar&&bar!=titleBar&&bar.layer&&bar.layer.turnOff&&bar.layer.active)bar.layer.turnOff();});that.turnOn();}else{titleBar.top();that.turnOff();titleBarContainer.loop(function(bar){if(bar&&bar!=titleBar&&bar.layer&&bar.layer.turnOff&&bar.layer.active)bar.layer.turnOff();});}
if(that.stage)that.stage.update();}
that.toggle=function(state){if(zot(state)){that.toggled=!that.toggled;}else{that.toggled=state;}
setToggled();return that;};Object.defineProperty(that,'titleBarDraggable',{get:function(){return titleBarDraggable;},set:function(value){titleBarDraggable=value;if(titleBarDraggable)titleBar.drag({all:true,boundary:zim.Boundary(0,40,titleBarContainer.width-titleBarWidth,titleBarContainer.height-titleBarHeight),localBounds:true});else titleBar.noDrag(false);}});that.stageUpEvent=stage.on("stagemouseup",function(){if(that.transformControls.visible)titleBar.top();});if(!zot(titleBarX)||!zot(titleBarY)){titleBarDefault=false;var x=!zot(titleBarX)?titleBarX:titleBar.x;var y=!zot(titleBarY)?titleBarY:titleBar.y-titleBarHeight;that.titleBarStartX=titleBarX;that.titleBarStartY=titleBarY;that.titleBarPos(x,y);var point=that.parent.localToLocal(that.x,that.y,titleBarContainer);that.distX=titleBar.x-point.x;that.distY=titleBar.y-point.y;}});},timeType=="s"?.05:50);if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Layer(width,height,titleBarOriginal,titleBarContainer,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,color,rollColor,selectedColor,selectedRollColor,borderWidth,borderColor,dashed,transformObject,originalTitleBarWidth,titleBarHeight,titleBarX,titleBarY,titleBarDraggable,close,closeColor,closeBackgroundColor,closeIndicatorColor,anchor,style,this.group,inherit));};this.dispose=function(a,b,disposing){if(that.stageUpEvent)stage.off("stagemouseup",that.stageUpEvent);if(titleBarContainer){titleBarContainer.loop(function(bar){bar.layer=null;});}
that.transformControls.dispose();that.transformControls=null;if(!disposing)this.zimContainer_dispose(true);that.titleBar.layer=null;that.titleBar.dispose();that.checkBox=that.button=null;titleBar=that.titleBar=transformObject=null;return true;};};zim.extend(zim.Layer,zim.Container,["clone","dispose"],"zimContainer",false);zim.Waiter=function(container,speed,foregroundColor,backgroundColor,corner,shadowColor,shadowBlur,fadeTime,style,group,inherit){var sig="container, speed, foregroundColor, backgroundColor, corner, shadowColor, shadowBlur, fadeTime, style, group, inherit";var duo;if(duo=zob(zim.Waiter,arguments,sig,this))return duo;z_d("59");this.zimContainer_constructor(null,null,null,null,false);this.type="Waiter";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);var timeType=getTIME(speed);if(zot(speed))speed=DS.speed!=null?DS.speed:timeType=="s"?.6:600;if(zot(foregroundColor))foregroundColor=DS.foregroundColor!=null?DS.foregroundColor:"white";if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"orange";if(zot(corner))corner=DS.corner!=null?DS.corner:16;if(zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.3)";if(zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:14;if(zot(fadeTime))fadeTime=DS.fadeTime!=null?DS.fadeTime:0;var height=40;var numDots=3;var r=height*.6/2;var s=(height-r*2)/2;var width=numDots*(r*2+s)+s;this.setBounds(-width/2,-height/2,width,height);var that=this;var stage;var display=this.display=new zim.Shape({style:false});this.addChild(display);display.setBounds(0,0,width,height);display.regX=width/2;display.regY=height/2;var g=display.graphics;g.f(backgroundColor);var cc=corner;if(!Array.isArray(cc))cc=[corner,corner,corner,corner];g.rc(0,0,width,height,cc[0],cc[1],cc[2],cc[3]);if(shadowColor!=-1&&shadowBlur>0)display.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);display.on("click",function(e){e.stopImmediatePropagation();});var circles=new zim.Container({style:false});this.addChild(circles);var dot;for(var i=0;i<numDots;i++){dot=new createjs.Shape();dot.graphics.f(foregroundColor).dc(0,0,r);dot.x=(i-(numDots-1)/2)*(r*2+s);circles.addChild(dot);dot.cache(-r,-r,r*2,r*2);dot.alpha=0;}
this.hide=function(){if(fadeTime>0){that.animate({obj:{alpha:0},time:fadeTime,call:end});}else{end();}
function end(){if(that.parent)that.parent.removeChild(that);stage=that.stage;if(stage)stage.update();if(that.zimAccessibility){var a=that.zimAccessibility;a.resize(that);if(accessibilityClicker)accessibilityClicker.focus();else that.zimTabTag.nextSibling.focus();setTimeout(function(){a.talk("Waiter has finished.");},50);}}
that.toggled=false;return that;};var accessibilityClicker;var timeouts=[];this.show=function(){var mess="zim display - Waiter(): Please pass in a reference to a container with bounds set as first parameter to Waiter";if(zot(container)){if(zdf){container=zdf.stage;}else{zog(mess);return;}}else if(!container.getBounds){zog(mess);return;}else if(zot(container.stage)){zog("zim display - Waiter(): The container must have a stage property");return;}
var dot;var counter=0;var s=speed*(timeType=="s"?1000:1);for(var i=0;i<circles.numChildren;i++){if(circles){timeouts.push(setTimeout(function(){dot=circles.getChildAt(counter);createjs.Tween.get(dot,{loop:true}).to({alpha:1},s/numDots/2).wait(s/numDots).to({alpha:0},s/numDots).wait(s-s/numDots-s/numDots/2);counter++;},i*s/numDots));}}
that.ticker=createjs.Ticker.on("tick",function(){container.stage.update();});that.x=(container.getBounds().width)/2;that.y=(container.getBounds().height)/2;container.addChild(that);if(fadeTime>0){that.alpha=0;that.animate({alpha:1},fadeTime);}
if(that.zimAccessibility){var a=that.zimAccessibility;setTimeout(function(){if(a.activatedObject)accessibilityClicker=a.activatedObject.zimTabTag;},50);a.resize(that);a.talk(that.zimTabTag.getAttribute("aria-label"));}
that.toggled=true;return that;};that.toggle=function(state){if(state===true)that.show();else if(state===false)that.hide();else if(that.parent)that.hide();else that.show();return that;};if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Waiter(container,speed,foregroundColor,backgroundColor,corner,shadowColor,shadowBlur,fadeTime,style,this.group,inherit));};this.dispose=function(a,b,disposing){if(that.ticker)createjs.Ticker.off("tick",that.ticker);createjs.Tween.removeTweens(that);that.removeFrom();for(var i=0;i<circles.numChildren;i++){var circle=circles.getChildAt(i);clearInterval(timeouts[i]);createjs.Tween.removeTweens(circle);}
if(!disposing)this.zimContainer_dispose(true);return true;};};zim.extend(zim.Waiter,zim.Container,["clone","dispose"],"zimContainer",false);zim.ProgressBar=function(barType,foregroundColor,backgroundColor,borderColor,borderWidth,padding,label,color,labelPosition,percentage,corner,shadowColor,shadowBlur,backing,delay,fastClose,container,autoHide,style,group,inherit){var sig="barType, foregroundColor, backgroundColor, borderColor, borderWidth, padding, label, color, labelPosition, percentage, corner, shadowColor, shadowBlur, backing, delay, fastClose, container, autoHide, style, group, inherit";var duo;if(duo=zob(zim.ProgressBar,arguments,sig,this))return duo;z_d("59.5");this.zimContainer_constructor(null,null,null,null,false);this.type="ProgressBar";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(foregroundColor))foregroundColor=DS.foregroundColor!=null?DS.foregroundColor:"#acd241";if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#444";if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:backgroundColor;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(zot(labelPosition))labelPosition=DS.labelPosition!=null?DS.labelPosition:"bottom";if(zot(barType))barType=DS.barType!=null?DS.barType:"circle";if(zot(padding))padding=DS.padding!=null?DS.padding:(barType=="circle"?2:-.5);if(zot(corner))corner=DS.corner!=null?DS.corner:15;if(zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.3)";if(zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:14;if(zot(backing))backing=DS.backing!=null?DS.backing.clone():null;if(zot(fastClose))fastClose=DS.fastClose!=null?DS.fastClose:true;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null){if(barType=="circle")borderWidth=10;else borderWidth=2;}
var timeType=getTIME(delay);if(zot(delay))delay=DS.delay!=null?DS.delay:timeType=="s"?.1:100;if(zot(autoHide))autoHide=DS.autoHide!=null?DS.autoHide:true;if(zot(label))label=DS.label!=null?DS.label:null;if(zot(color))color=DS.color!=null?DS.color:foregroundColor;if(typeof label==="string"||typeof label==="number")label=new zim.Label({text:label,color:color,backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",padding:"ignore",backgroundColor:"ignore",group:this.group});var emptyLabel=false;if(label&&label.text=="")emptyLabel=true;if(!zot(percentage)&&zot(label))label=new zim.Label("");this.label=label;var height=30;var that=this;var _percent=0;that.visible=false;setTimeout(function(){that.visible=true;if(that.stage)that.stage.update();},delay);if(barType=="circle"){var width=20;var backing=this.backing=new zim.Circle(width,"rgba(0,0,0,0)",backgroundColor,borderWidth,null,null,null,null,false).addTo(that);var bar=this.bar=new zim.Shape({style:false}).addTo(that).loc(backing.x,backing.y).rot(-90);}else{var width=200;if(shadowColor!=-1&&shadowBlur>0){var shadowRect=new zim.Rectangle(width-2,height-2,backgroundColor,null,null,corner,null,null,false).addTo(this);shadowRect.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);}
var backing=doBacking(backing);var cc=corner;if(!Array.isArray(cc))cc=[corner,corner,corner,corner];var cAdjust=(padding+borderWidth/2)*1.2;var bar=this.bar=new zim.Rectangle(width-(padding+borderWidth/2)*1.8,height-(padding+borderWidth/2)*1.8,foregroundColor,null,null,[cc[0]-cAdjust,cc[1]-cAdjust,cc[2]-cAdjust,cc[3]-cAdjust],null,null,false).center(this);var mask=this.mask=new zim.Rectangle(width-(padding+borderWidth/2)*1.8,height-(padding+borderWidth/2)*1.8,null,null,null,null,null,null,false).center(this).alp(0).sca(0,1);bar.setMask(mask);}
function doBacking(newBacking){if(that.backing){var index=that.getChildIndex(that.backing);that.removeChild(that.backing);}else{var index=that.numChildren;}
if(that.border)that.removeChild(that.border);if(!zot(newBacking)&&newBacking.type=="Pattern"){var pattern=newBacking;var newBacking=that.backing=new zim.Rectangle(width,height,backgroundColor,null,null,corner,null,null,false).addTo(that,index);newBacking.pattern=pattern;pattern.center(newBacking);var bounds=newBacking.getBounds();pattern.setMask(newBacking.shape);if(borderWidth)var border=that.border=new zim.Rectangle(width,height,"rgba(0,0,0,0)",borderColor,borderWidth,corner,null,null,false).addTo(that,index+1);}else{var newBacking=that.backing=zot(newBacking)?new zim.Rectangle(width,height,backgroundColor,borderColor,borderWidth,corner,null,null,false).addTo(that,index):backing.addTo(that,index);}
return newBacking;}
that.setBacking=function(backing){doBacking(backing);if(that.stage)that.stage.update();};backing.on("click",function(e){e.stopImmediatePropagation();});if(!zot(label)){label.scaleX=label.scaleY=.8;label.startText=label.text;if(!zot(percentage))label.text=label.startText+"  0%";label.center(that);if(labelPosition=="above"){label.y-=60;}else{label.y+=60;}
label.alpha=.8;}
this.hide=function(){var stage=that.stage;if(that.parent)that.parent.removeChild(that);if(that.backing.type=="Pattern"&&that.backing.pauseInterval)that.backing.pauseInterval();if(stage)stage.update();if(that.zimAccessibility){var a=that.zimAccessibility;a.resize(that);if(accessibilityClicker)accessibilityClicker.focus();else that.zimTabTag.nextSibling.focus();setTimeout(function(){a.talk("Progress Bar has finished.");},50);}
that.toggled=false;return that;};var accessibilityClicker;var waiterTimeout;this.show=function(){var mess="zim display - ProgressBar(): Please pass in a reference to a container with bounds set as first parameter of the ProgressBar";if(zot(container)){if(zdf){container=zdf.stage;}else{zog(mess);return;}}else if(!container.getBounds){zog(mess);return;}else if(zot(container.stage)){zog("zim display - Waiter(): The container must have a stage property");return;}
if(that.timeOut)clearTimeout(that.timeOut);changePercent(0);if(that.zimActiveLoader){that.zimActiveLoader.on("progress",function(e){_percent=e.progress*100;changePercent(_percent);});}
that.center(container);if(that.backing.type=="Pattern"&&that.backing.pauseInterval)that.backing.pauseInterval(false);if(that.zimAccessibility){var a=that.zimAccessibility;setTimeout(function(){if(a.activatedObject)accessibilityClicker=a.activatedObject.zimTabTag;},50);a.resize(that);a.talk(that.zimTabTag.getAttribute("aria-label"));}
that.toggled=true;return that;};that.toggle=function(state){if(state===true)that.show();else if(state===false)that.hide();else if(that.parent)that.hide();else that.show();return that;};that.run=function(time,close){if(!zot(close))autoHide=close;if(zot(time))time=timeType=="s"?3:3000;checkTIME(time,timeType);var t=time*(timeType=="s"?1000:1);that.toggle(true);if(that.runInterval)clearInterval(that.runInterval);that.percent=0;var startTime=Date.now();that.runInterval=setInterval(function(){that.percent=(Date.now()-startTime)/t*100;if(that.percent>=100){that.percent=100;clearInterval(that.runInterval);}},30);return that;};that.dispatched=false;function changePercent(amount){if(barType=="circle"){bar.graphics.c().mt(0,0).s(foregroundColor).ss(borderWidth-padding*2+.5).a(0,0,width,0,360*amount/100*Math.PI/180);}else{mask.sca(amount/100,1);bar.setMask(mask);}
if(!zot(percentage))label.text=label.startText+" "+Math.min(Math.round(amount),100)+"%";if(autoHide&&fastClose&&Math.round(amount)>=100)that.timeOut=setTimeout(function(){that.hide();},200);if(!that.dispatched&&Math.round(amount)>=100){that.dispatchEvent("complete");that.dispatched=true;setTimeout(function(){if(that)that.dispatched=false;},100);}
if(that.stage)that.stage.update();}
Object.defineProperty(that,'percent',{get:function(){return _percent;},set:function(value){_percent=value;changePercent(value);}});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.ProgressBar(barType,foregroundColor,backgroundColor,borderColor,borderWidth,padding,label,color,labelPosition,percentage,corner,shadowColor,shadowBlur,backing,delay,fastClose,container,autoHide,style,this.group,inherit));};this.dispose=function(a,b,disposing){if(that.backing.type=="Pattern"&&that.backing.clearInterval)that.backing.clearInterval();if(that.runInterval)clearInterval(that.runInterval);if(!disposing)this.zimContainer_dispose(true);return true;};};zim.extend(zim.ProgressBar,zim.Container,["clone","dispose"],"zimContainer",false);zim.Indicator=function(width,height,num,foregroundColor,backgroundColor,borderColor,borderWidth,backdropColor,corner,indicatorType,fill,scale,lightScale,interactive,shadowColor,shadowBlur,selectedIndex,style,group,inherit){var sig="width, height, num, foregroundColor, backgroundColor, borderColor, borderWidth, backdropColor, corner, indicatorType, fill, scale, lightScale, interactive, shadowColor, shadowBlur, selectedIndex, style, group, inherit";var duo;if(duo=zob(zim.Indicator,arguments,sig,this))return duo;z_d("60");this.zimContainer_constructor(null,null,null,null,false);this.type="Indicator";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:300;if(zot(height))height=DS.height!=null?DS.height:50;if(zot(num))num=DS.num!=null?DS.num:6;if(zot(foregroundColor))foregroundColor=DS.foregroundColor!=null?DS.foregroundColor:"#f58e25";if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#666";if(backgroundColor<0)backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"rgba(0,0,0,.01)";if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:null;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(backdropColor))backdropColor=DS.backdropColor!=null?DS.backdropColor:-1;if(zot(corner))corner=DS.corner!=null?DS.corner:0;if(zot(indicatorType))indicatorType=DS.indicatorType!=null?DS.indicatorType:"dot";if(zot(fill))fill=DS.fill!=null?DS.fill:false;if(zot(scale))scale=DS.scale!=null?DS.scale:1;if(zot(lightScale))lightScale=DS.lightScale!=null?DS.lightScale:1;if(zot(interactive))interactive=DS.interactive!=null?DS.interactive:false;if(zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.3)";if(zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:5;var eventType=(!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click";var that=this;this.lights=[];var myValue;var indicator=new zim.Container({style:false});if(backdropColor!=-1){var backing=that.backdrop=new zim.Rectangle(width,height,backdropColor,borderColor,borderWidth,corner,null,null,false);this.addChild(backing);}
var lights=this.lightsContainer=new zim.Container({style:false});this.addChild(lights);var light;var size=height*.5;var space=width/(num+1);var hitArea=new createjs.Shape();if(indicatorType=="square"||indicatorType=="box"){hitArea.graphics.f("black").dr(-space/2/lightScale+size/2,-height/2+size/2,space/lightScale,height);}else{hitArea.graphics.f("black").dr(-space/2/lightScale,-height/2,space/lightScale,height);}
for(var i=0;i<num;i++){if(indicatorType=="square"||indicatorType=="box"){light=new zim.Rectangle(size,size,backgroundColor,borderColor,borderWidth,null,null,null,false);light.regX=light.width/2;light.regY=light.height/2;}else{light=new zim.Circle(size/2,backgroundColor,borderColor,borderWidth,null,null,null,null,false);}
this.lights.push(light);light.znum=i;light.scaleX=light.scaleY=lightScale;light.hitArea=hitArea;light.x=space+space*i;light.y=height/2;lights.addChild(light);}
lights.setBounds(0,0,width,height);lights.regX=lights.x=width/2;lights.regY=lights.y=height/2;this.addChild(lights);if(shadowColor!=-1&&shadowBlur>0)lights.shadow=new createjs.Shadow(shadowColor,2,2,shadowBlur);if(interactive){lights.cursor="pointer";var lightsEvent=lights.on(eventType,function(e){if(myValue==e.target.znum)return;myValue=e.target.znum;setLights(myValue);that.dispatchEvent("change");});}
lights.scaleX=lights.scaleY=scale;function setLights(v){if(v>=num)v=-1;var c;for(var i=0;i<num;i++){if(fill){if(i<v)c=foregroundColor;else c=backgroundColor;}else{c=backgroundColor;}
if(i==v)c=foregroundColor;lights.getChildAt(i).color=c;}
if(that.zimAccessibility)that.zimAccessibility.changeTitle(that);if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}
Object.defineProperty(this,'selectedIndex',{get:function(){return myValue;},set:function(value){myValue=Math.floor(value);myValue=zim.constrain(myValue,-1,num-1);setLights(myValue);}});Object.defineProperty(this,'num',{get:function(){return num;},set:function(value){if(zon)zogy("Indicator() - num is read only");}});this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){zenable(that,value);}});if(zot(selectedIndex))selectedIndex=DS.selectedIndex!=null?DS.selectedIndex:0;that.selectedIndex=selectedIndex;if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Indicator(width,height,num,foregroundColor,backgroundColor,borderColor,borderWidth,backdropColor,corner,indicatorType,fill,scale,lightScale,interactive,shadowColor,shadowBlur,selectedIndex,style,this.group,inherit));};};zim.extend(zim.Indicator,zim.Container,"clone","zimContainer",false);zim.List=function(width,height,list,viewNum,vertical,currentSelected,align,valign,labelAlign,labelValign,labelIndent,labelIndentHorizontal,labelIndentVertical,indent,spacing,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,backdropColor,color,rollColor,selectedColor,selectedRollColor,borderColor,borderWidth,padding,corner,swipe,scrollBarActive,scrollBarDrag,scrollBarColor,scrollBarAlpha,scrollBarFade,scrollBarH,scrollBarV,scrollBarOverlay,slide,slideDamp,slideSnap,shadowColor,shadowBlur,paddingHorizontal,paddingVertical,scrollWheel,damp,titleBar,titleBarColor,titleBarBackgroundColor,titleBarHeight,draggable,boundary,onTop,close,closeColor,excludeCustomTap,organizer,checkBox,pulldown,clone,cancelCurrentDrag,selectedIndex,noScale,style,group,inherit){var sig="width, height, list, viewNum, vertical, currentSelected, align, valign, labelAlign, labelValign, labelIndent, labelIndentHorizontal, labelIndentVertical, indent, spacing, backgroundColor, rollBackgroundColor, selectedBackgroundColor, selectedRollBackgroundColor, backdropColor, color, rollColor, selectedColor, selectedRollColor, borderColor, borderWidth, padding, corner, swipe, scrollBarActive, scrollBarDrag, scrollBarColor, scrollBarAlpha, scrollBarFade, scrollBarH, scrollBarV, scrollBarOverlay, slide, slideDamp, slideSnap, shadowColor, shadowBlur, paddingHorizontal, paddingVertical, scrollWheel, damp, titleBar, titleBarColor, titleBarBackgroundColor, titleBarHeight, draggable, boundary, onTop, close, closeColor, excludeCustomTap, organizer, checkBox, pulldown, clone, cancelCurrentDrag, selectedIndex, noScale, style, group, inherit";var duo;if(duo=zob(zim.List,arguments,sig,this))return duo;z_d("60.5");this.group=group;var DS=style===false?{}:zim.getStyle("List",this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:300;if(zot(height))height=DS.height!=null?DS.height:!zot(organizer)?200+organizer.height:200;if(zot(list))list=list=DS.list!=null?DS.list:["Option 1","Option 2","Option 3","Option 4","Option 5","Option 6","Option 7","Option 8","Option 9","Option 10"];if(list.length==0)list=["%-&"];this.originalList=list;if(zot(viewNum))viewNum=DS.viewNum!=null?DS.viewNum:5;if(zot(vertical))vertical=DS.vertical!=null?DS.vertical:true;if(zot(currentSelected))currentSelected=DS.currentSelected!=null?DS.currentSelected:true;var originalAlign=!zot(align)||!zot(labelAlign);if(zot(checkBox))checkBox=DS.checkBox!=null?DS.checkBox:false;if(zot(align))align=DS.align!=null?DS.align:(checkBox?"left":"center");if(zot(valign))valign=DS.valign!=null?DS.valign:"center";if(zot(labelAlign))labelAlign=DS.labelAlign!=null?DS.labelAlign:align;if(zot(labelValign))labelValign=DS.labelValign!=null?DS.labelValign:valign;if(zot(indent))indent=DS.indent!=null?DS.indent:(checkBox?0:10);if(zot(labelIndent))labelIndent=DS.labelIndent!=null?DS.labelIndent:indent;if(zot(labelIndentHorizontal))labelIndentHorizontal=DS.labelIndentHorizontal!=null?DS.labelIndentHorizontal:labelIndent;if(zot(labelIndentVertical))labelIndentVertical=DS.labelIndentVertical!=null?DS.labelIndentVertical:labelIndent;if(zot(spacing))spacing=DS.spacing!=null?DS.spacing:2;if(zot(backdropColor))backdropColor=DS.backdropColor!=null?DS.backdropColor:"#333";if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#777";if(zot(rollBackgroundColor))rollBackgroundColor=DS.rollBackgroundColor!=null?DS.rollBackgroundColor:"#555";if(zot(selectedBackgroundColor))selectedBackgroundColor=DS.selectedBackgroundColor!=null?DS.selectedBackgroundColor:"#444";if(zot(selectedRollBackgroundColor))selectedRollBackgroundColor=DS.selectedRollBackgroundColor!=null?DS.selectedRollBackgroundColor:"#555";if(zot(color))color=DS.color!=null?DS.color:"white";if(zot(rollColor))rollColor=DS.rollColor!=null?DS.rollColor:color;if(zot(selectedColor))selectedColor=DS.selectedColor!=null?DS.selectedColor:color;if(zot(selectedRollColor))selectedRollColor=DS.selectedRollColor!=null?DS.selectedRollColor:rollColor;if(zot(backdropColor))backdropColor=DS.backdropColor!=null?DS.backdropColor:backdropColor;var originalBorderColor=borderColor;var originalBorderWidth=borderWidth;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:"#999";if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:1;if(zot(padding))padding=DS.padding!=null?DS.padding:spacing;if(zot(corner))corner=DS.corner!=null?DS.corner:0;if(zot(swipe))swipe=DS.swipe!=null?DS.swipe:true;if(zot(scrollBarActive))scrollBarActive=DS.scrollBarActive!=null?DS.scrollBarActive:true;if(zot(scrollBarDrag))scrollBarDrag=DS.scrollBarDrag!=null?DS.scrollBarDrag:true;if(zot(scrollBarColor))scrollBarColor=DS.scrollBarColor!=null?DS.scrollBarColor:borderColor;if(zot(scrollBarAlpha))scrollBarAlpha=DS.scrollBarAlpha!=null?DS.scrollBarAlpha:.3;if(zot(scrollBarFade))scrollBarFade=DS.scrollBarFade!=null?DS.scrollBarFade:true;if(zot(scrollBarH))scrollBarH=DS.scrollBarH!=null?DS.scrollBarH:!vertical;if(zot(scrollBarV))scrollBarV=DS.scrollBarV!=null?DS.scrollBarV:vertical;if(scrollBarDrag)scrollBarFade=DS.scrollBarFade!=null?DS.scrollBarFade:false;if(zot(scrollBarOverlay))scrollBarOverlay=DS.scrollBarOverlay!=null?DS.scrollBarOverlay:true;if(zot(slide))slide=DS.slide!=null?DS.slide:true;if(zot(slideDamp))slideDamp=DS.slideDamp!=null?DS.slideDamp:.6;if(zot(slideSnap))slideSnap=DS.slideSnap!=null?DS.slideSnap:vertical?"vertical":"horizontal";if(zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.3)";if(zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:20;if(zot(paddingVertical))paddingVertical=DS.paddingVertical!=null?DS.paddingVertical:padding;if(zot(paddingHorizontal))paddingHorizontal=DS.paddingHorizontal!=null?DS.paddingHorizontal:padding;if(zot(scrollWheel))scrollWheel=DS.scrollWheel!=null?DS.scrollWheel:true;if(zot(titleBar))titleBar=DS.titleBar!=null?DS.titleBar:null;if(zot(titleBarColor))titleBarColor=DS.titleBarColor!=null?DS.titleBarColor:null;if(zot(titleBarBackgroundColor))titleBarBackgroundColor=DS.titleBarBackgroundColor!=null?DS.titleBarBackgroundColor:null;if(zot(titleBarHeight))titleBarHeight=DS.titleBarHeight!=null?DS.titleBarHeight:35;if(zot(draggable))draggable=DS.draggable!=null?DS.draggable:null;if(zot(boundary))boundary=DS.boundary!=null?DS.boundary:null;if(zot(onTop))onTop=DS.onTop!=null?DS.onTop:null;if(zot(close))close=DS.close!=null?DS.close:null;if(zot(closeColor))closeColor=DS.closeColor!=null?DS.closeColor:null;if(zot(excludeCustomTap))excludeCustomTap=DS.excludeCustomTap!=null?DS.excludeCustomTap:false;if(zot(checkBox))checkBox=DS.checkBox!=null?DS.checkBox:false;if(zot(pulldown))pulldown=DS.pulldown!=null?DS.pulldown:false;if(zot(noScale))noScale=DS.noScale!=null?DS.noScale:false;if(zot(clone))clone=DS.clone!=null?DS.clone:false;if(titleBar===false)titleBar=null;this.vertical=vertical;var that=this;var originalHeight=height;if(checkBox){zim.loop(list,function(item,i){list[i]=zim.List.checkItem(item,null,width,"left",10,10,spacing,color,rollColor,selectedColor,selectedRollColor,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor);});}
var timeType=getTIME();var tree;if(list.constructor=={}.constructor){var shade=!zot(list.shade)?list.shade:!zot(DS.shade)?DS.shade:.2;var dim=!zot(list.dim)?list.dim:!zot(DS.dim)?DS.dim:.1;var shift=!zot(list.shift)?list.shift:!zot(DS.shift)?DS.shift:15;var bloom=!zot(list.bloom)?list.bloom:!zot(DS.bloom)?DS.bloom:false;var whither=!zot(list.whither)?list.whither:!zot(DS.whither)?DS.whither:false;var open=!zot(list.open)?list.open:!zot(DS.open)?DS.open:false;var expander=!zot(list.expander)?list.expander:!zot(DS.expander)?DS.expander:"plus";expender=expander.toLowerCase();if(expander=="arrows")expander="arrow";if(expander!="none"&&expander!="arrow")expander="plus";if(bloom===true)bloom=timeType=="s"?.01:10;if(whither===true)whither=timeType=="s"?.01:10;checkTIME(bloom);checkTIME(whither);if(shift===true)shift=15;if(shade===true)shade=.2;if(dim===true)dim=.1;var subStyles=!zot(list.subStyles)?list.subStyles:!zot(DS.subStyles)?DS.subStyles:{};if(!zot(list.menu)){list=list.menu;}
tree=new zim.Hierarchy(list,open);if(open&&tree.data&&tree.data.id0)tree.data.id0.open=false;list=tree.getLinearList();if(!originalAlign)align=labelAlign="left";}
if(pulldown){viewNum=(!zot(tree)?tree.length:list.length);height=viewNum*width/620*100+(viewNum+1)*spacing+(zot(titleBar)?0:titleBarHeight);borderWidth=0;selectedBackgroundColor=backgroundColor;backdropColor=zim.clear;swipe=false;}
var customWidth=0;var customHeight=0;zim.loop(list,function(element){if(element.type=="ListItem")element.width=width-spacing*2;if(noScale){if(element.width)customWidth+=element.width;if(element.height)customHeight+=element.height;}});if(customWidth)customWidth+=spacing*(list.length-1);if(customHeight)customHeight+=spacing*(list.length-1);this.align=align;this.valign=valign;this.indent=indent;if(!zot(organizer)){height=height-organizer.height;organizer.list=that;that.organizer=organizer;organizer.setButtons();titleBarHeight+=organizer.height;}
this.zimWindow_constructor(width,height,backdropColor,borderColor,borderWidth,padding,corner,swipe,scrollBarActive,scrollBarDrag,scrollBarColor,scrollBarAlpha,scrollBarFade,scrollBarH,scrollBarV,slide,slideDamp,slideSnap,true,shadowColor,shadowBlur,paddingHorizontal,paddingVertical,scrollWheel,damp,titleBar,titleBarColor,titleBarBackgroundColor,titleBarHeight,draggable,boundary,onTop,close,closeColor,cancelCurrentDrag,false,null,false,style,group,zim.copy(DS));this.type="List";if(!zot(titleBar)){this.titleBarLabel.pos(null,titleBarHeight-30,null,true);if(zot(titleBarHeight))titleBarHeight=30;height=height-titleBarHeight;}
if(!zot(organizer)){organizer.addTo(that).loc(0,-organizer.height);}
if(customWidth&&noScale){that.itemWidth=vertical?(width-paddingHorizontal*2-(scrollBarActive?(scrollBarOverlay?0:6):0)):customWidth/list.length;that.itemHeight=vertical?(height-paddingVertical*2)/viewNum:(height-paddingVertical*2-(scrollBarActive?(scrollBarOverlay?0:6):0));}else{that.itemWidth=vertical?(width-paddingHorizontal*2-(scrollBarActive?(scrollBarOverlay?0:6):0)):(width-paddingHorizontal*2)/viewNum;that.itemHeight=vertical?(height-paddingVertical*2)/viewNum:(height-paddingVertical*2-(scrollBarActive?(scrollBarOverlay?0:6):0));}
var tabs;var inheritedStyles=zim.copy(DS);delete inheritedStyles.borderWidth;delete inheritedStyles.borderColor;function makeTabs(tabList){tabs=that.tabs=new zim.Tabs({width:vertical?that.itemWidth:(that.itemWidth*list.length),height:vertical?that.itemHeight*list.length:that.itemHeight,tabs:tabList,spacing:spacing,vertical:vertical,backgroundColor:backgroundColor,rollBackgroundColor:rollBackgroundColor,selectedBackgroundColor:selectedBackgroundColor,selectedRollBackgroundColor:selectedRollBackgroundColor,color:color,rollColor:rollColor,selectedColor:selectedColor,selectedRollColor:selectedRollColor,backdropColor:backdropColor,currentEnabled:true,currentSelected:currentSelected,align:align,valign:valign,labelAlign:labelAlign,labelValign:labelValign,labelIndent:labelIndent,labelIndentHorizontal:labelIndentHorizontal,labelIndentVertical:labelIndentVertical,indent:indent,useTap:true,excludeCustomTap:excludeCustomTap,keyWrap:false,style:style,group:group,inherit:inheritedStyles}).mov(vertical?0:paddingHorizontal,vertical?paddingVertical:0);that.add(tabs);zim.loop(tabs.labels,function(label){if(label)label.backgroundColor=zim.clear;})}
makeTabs(zim.copy(list,clone));if(tree){var ids=tree.getLinearIDs();zim.loop(ids,function(id,i){that.tabs.buttons[i].listZID=id;});zim.loop(that.tabs.buttons,function(item){var data=tree.getData(item.listZID);if(!zim.isEmpty(data.list))item.expander=new zim.Label({size:expander=="arrow"?22:36,text:expander=="arrow"?"   ":"+",align:"center",color:zim.convertColor(color,"rgba",.6)}).center(item).alp(expander=="none"?0:.7).pos(15,null,that.align!="right");});function applyAccordion(item,id,data){item.listZID=id;if(item.label){if(shade)new zim.Rectangle(shift*(data.level+1),item.height).alp(shade).pos(0,0,that.align=="right",false,item);if(dim)new zim.Rectangle(item.width,item.height).alp((data.level+1)*dim).addTo(item).bot().ord(1);if(shift&&that.align!="center")item.label.x+=(that.align=="right"?-1:1)*shift*(data.level+1);}
var newData=tree.getData(id);newData.obj=item;if(newData.list&&!zim.isEmpty(newData.list)){item.expander=new zim.Label({size:expander=="arrow"?22:36,text:(newData.open?(expander=="arrow"?"   ":"-"):(expander=="arrow"?"   ":"+")),align:"center",color:zim.convertColor(color,"rgba",.6)}).center(item).alp(expander=="none"?0:.7).pos(15,null,that.align!="right").mov(0,(newData.open?-3:0));}}
var _toggled=open;that.toggle=function(state){if(zot(state))state=!_toggled;else if(state==_toggled)return;that.selectedIndex=0;_toggled=state;tapList();}
Object.defineProperty(that,'toggled',{get:function(){return _toggled;},set:function(value){if(_toggled==value)return;else that.toggle();}});that.tap(tapList);function tapList(){if(!that.selected.expander)return;var data=tree.getData(that.selected.listZID);if(data.open){if(that.selected.expander){that.selected.expander.text=expander=="arrow"?"   ":"+";that.selected.expander.mov(0,3);}
data.open=false;var nextSibling=tree.getNextSibling(that.selected.listZID);if(zot(nextSibling))var finalIndex=that.items.length-1;else{var finalIndex=zim.loop(that.items,function(item,i){if(item.listZID==nextSibling)return i-1;});}
if(whither){var count=0;that.enabled=false;zim.interval(whither,function(obj){that.removeAt(1,that.selectedIndex+finalIndex-that.selectedIndex-count);count++;if(obj.total==obj.count+1)that.enabled=true;},finalIndex-that.selectedIndex,true);}else{that.removeAt(finalIndex-that.selectedIndex,that.selectedIndex+1);}}else{data.open=true;if(that.selected.expander){that.selected.expander.text=expander=="arrow"?"   ":"-";that.selected.expander.mov(0,-3);}
var outer=tree.getLinearList(data.list);var ids=tree.getLinearIDs(data.list);if(!data.opened){data.opened=true;var newStyles=subStyles[data.level];if(zot(newStyles))newStyles={};if(Array.isArray(outer)){if(bloom){var count=0;that.enabled=false;zim.interval(bloom,function(obj){that.addAt(outer[count],that.selectedIndex+1+count,{backgroundColor:newStyles.backgroundColor,color:newStyles.color,rollBackgroundColor:newStyles.rollBackgroundColor,rollColor:newStyles.rollColor,selectedBackgroundColor:newStyles.selectedBackgroundColor,selectedColor:newStyles.selectedColor,selectedRollBackgroundColor:newStyles.selectedRollBackgroundColor,selectedRollColor:newStyles.selectedRollColor});var id=ids[count];var item=that.items[that.selectedIndex+1+count];applyAccordion(item,id,data);item.label.backgroundColor=zim.clear;if(obj.total==obj.count+1)that.enabled=true;count++;if(that.stage)that.stage.update();},outer.length,true);}else{that.addAt(outer,that.selectedIndex+1,{backgroundColor:newStyles.backgroundColor,color:newStyles.color,rollBackgroundColor:newStyles.rollBackgroundColor,rollColor:newStyles.rollColor,selectedBackgroundColor:newStyles.selectedBackgroundColor,selectedColor:newStyles.selectedColor,selectedRollBackgroundColor:newStyles.selectedRollBackgroundColor,selectedRollColor:newStyles.selectedRollColor});zim.loop(ids,function(id,i){var item=that.items[that.selectedIndex+1+i];applyAccordion(item,id,data);item.label.backgroundColor=zim.clear;});}}}else{if(Array.isArray(outer)){if(bloom){var count=0;that.enabled=false;zim.interval(bloom,function(obj){that.addAt(outer[count],that.selectedIndex+1+count);if(obj.total==obj.count+1)that.enabled=true;count++;},outer.length,true);}else{that.addAt(outer,that.selectedIndex+1);}}}}}}
var _selectedIndex;tabs.tap(function(e){if(e.target.selectedIndex==that.selectedIndex)return;that.selectedIndex=tabs.selectedIndex;that.dispatchEvent("change");e.preventDefault();});tabs.on("keychange",function(e){if(e.target.selectedIndex==that.selectedIndex)return;that.selectedIndex=tabs.selectedIndex;setTimeout(function(){if(vertical){var position=that.selected.y+that.scrollY;if(position<0||position>that.height-that.selected.height)that.animateTo(that.selectedIndex,timeType=="ms"?100:.1);}else{var position=that.selected.x+that.scrollX;if(position<0||position>that.width-that.selected.width)that.animateTo(that.selectedIndex,timeType=="ms"?100:.1);}},100);that.dispatchEvent("change");})
this.getItemIndex=function(item){return that.items.indexOf(item);};this.animateTo=function(index,timePerItem){if(zot(index))index=0;if(zot(timePerItem))timePerItem=.05;var timeType=getTIME(timePerItem);that.selectedIndex=index;var newPos=getScrollPosition(index);if(vertical){var itemsToTravel=Math.abs(that.scrollY-newPos)/that.itemHeight;that.animate({scrollY:newPos},itemsToTravel*timePerItem/(timeType=="s"?1:1000));}else{var itemsToTravel=Math.abs(that.scrollX-newPos)/that.itemWidth;that.animate({scrollX:newPos},itemsToTravel*timePerItem/(timeType=="s"?1:1000));}
return that;};this.addAt=function(items,index,style,clone){if(zot(items))return that;if(items.type=="ListItem"){items.width=width-spacing*2;}else{if(Array.isArray(items)){zim.loop(items,function(item){if(item.type=="ListItem")item.width=width-spacing*2;});}}
if(items.clone){that.tabs.addAt(clone?items.clone():items,index,style);}else{that.tabs.addAt(zim.copy(items,clone),index,style);}
that.update();return that;};this.removeAt=function(num,index){that.tabs.removeAt(num,index);_selectedIndex=that.tabs.selectedIndex;var b=tabs.getBounds();tabs.setBounds(0,0,b.width,b.height);that.update();return that;};if(list[0]=="%-&"&&list.length==1)that.removeAt(1,0);this.clear=function(){that.tabs.removeAt(that.length,0);that.content.x=0;that.content.y=0;that.update();return that;};this.setCheck=function(index,type){if(zot(index))index=0;if(zot(type))type=true;that.items[index].checkBox.checked=type;that.items[index].content.zimOut();};this.getCheck=function(index){if(zot(index))index=0;return that.items[index].checkBox.checked;};this.setChecks=function(type){zim.loop(that.items,function(item){item.checkBox.checked=type;item.content.zimOut();});return that;};Object.defineProperty(that,'items',{get:function(){return that.tabs.buttons;},set:function(value){if(zon)zogy("List() - items is read only - use addAt() and removeAt() to change");}});Object.defineProperty(that,'list',{get:function(){return that.tabs.buttons;},set:function(value){if(zon)zogy("List() - list is read only - use addAt() and removeAt() to change");}});Object.defineProperty(that,'length',{get:function(){return that.tabs.buttons.length;},set:function(value){if(zon)zogy("List() - length is read only");}});Object.defineProperty(that,'selectedIndex',{get:function(){return _selectedIndex;},set:function(value){tabs.selectedIndex=value;that.label=tabs.label;that.selected=tabs.selected;_selectedIndex=value;if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});if(currentSelected)that.selectedIndex=0;Object.defineProperty(that,'selectedIndexPlusPosition',{get:function(){return _selectedIndex;},set:function(value){that.selectedIndex=value;_selectedIndex=value;if(vertical)that.scrollY=getScrollPosition(value)-2;else that.scrollX=getScrollPosition(value);if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});function getScrollPosition(index){if(vertical){var newY=-(that.itemHeight+spacing)*index+height/2-that.itemHeight/2;if((that.itemHeight+spacing)*that.length<height)newY=0;if(newY>0)newY=0;if((that.itemHeight+spacing)*that.length>height&&newY<-that.tabs.height+height-paddingVertical*2)newY=-that.tabs.height+height-paddingVertical*2;return newY;}else{var newX=-(that.itemWidth+spacing)*index+width/2-that.itemWidth/2;if((that.itemWidth+spacing)*that.length<width)newX=0;if(newX>0)newX=0;if((that.itemWidth+spacing)*that.length>width&&newX<-that.tabs.width+width-paddingHorizontal*2)newX=-that.tabs.width+width-paddingHorizontal*2;return newX;}}
Object.defineProperty(that,'text',{get:function(){if(that.label)return that.label.text;return null;},set:function(value){if(that.label)that.label.text=value;}});Object.defineProperty(that,'currentValue',{get:function(){if(that.label)return that.label.text;return null;},set:function(value){var answer=zim.loop(that.list,function(l,i){var ll;if(l.label)ll=l.label.text;if(l.type=="Label")ll=l.text;var re=new RegExp(value,"i");if(ll&&ll.match(re))return i;});if(answer!==true)that.selectedIndexPlusPosition=answer;}});Object.defineProperty(that,'itemDown',{get:function(){return that.tabs.buttonDown;},set:function(value){}});Object.defineProperty(that,'itemsText',{get:function(){var a=[];for(var i=0;i<that.tabs.buttons.length;i++){var aa=that.tabs.buttons[i].label;if(aa&&!zot(aa.text)){a.push(aa.text);}else{a.push(null);}}
return a;},set:function(value){if(zon)zogy("List() - itemsText is read only");}});if(currentSelected)that.selectedIndex=0;Object.defineProperty(that,'checkBoxes',{get:function(){var a=[];for(var i=0;i<that.tabs.buttons.length;i++){var aa=that.tabs.buttons[i].checkBox;a.push(aa);}
return a;},set:function(value){if(zon)zogy("List() - checkBoxes is read only");}});Object.defineProperty(that,'accordionIndex',{get:function(){var id=that.selected.listZID;if(id)return Number(id.split("id")[1]);return null;},set:function(value){if(zon)zogy("List() - accordionIndex is read only");}});this.last=function(){this.selectedIndexPlusPosition=this.length-1;return this;};this.first=function(){this.selectedIndexPlusPosition=0;return this;};if(open&&tapList){that.selected=that.items[0];tapList();}
if(zot(selectedIndex))selectedIndex=DS.selectedIndex!=null?DS.selectedIndex:0;that.selectedIndex=selectedIndex;if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.List(width,originalHeight,zim.copy(that.originalList,true),viewNum,vertical,currentSelected,align,valign,labelAlign,labelValign,labelIndent,labelIndentHorizontal,labelIndentVertical,indent,spacing,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,backdropColor,color,rollColor,selectedColor,selectedRollColor,originalBorderColor,originalBorderWidth,padding,zim.copy(corner),swipe,scrollBarActive,scrollBarDrag,scrollBarColor,scrollBarAlpha,scrollBarFade,scrollBarH,scrollBarV,scrollBarOverlay,slide,slideDamp,slideSnap,shadowColor,shadowBlur,paddingHorizontal,paddingVertical,scrollWheel,damp,titleBar,titleBarColor,titleBarBackgroundColor,titleBarHeight,draggable,boundary,onTop,close,closeColor,excludeCustomTap,organizer,checkBox,pulldown,clone,cancelCurrentDrag,selectedIndex,noScale,style,this.group,inherit));};this.dispose=function(a,b,disposing){if(!disposing){if(that.organizer)that.organizer.dispose();this.zimWindow_dispose();}
return true;};};zim.extend(zim.List,zim.Window,["clone","dispose"],"zimWindow",false);zim.List.makeBase=function(c,label,paddingLeft,backgroundColor){if(zot(backgroundColor))backgroundColor=zim.dark;c.backing=new zim.Rectangle(c.width,c.height,backgroundColor).center(c);if(label.type=="Label")c.label=label;else c.label=new zim.Label(label,null,null,zim.white);c.text=c.label.text;c.label.center(c).loc(paddingLeft);};zim.List.slider=function(label,min,max,val,call,step,obj,property,paddingLeft,paddingRight,factor,offset,backgroundColor){var sig="label, min, max, val, call, step, obj, property, paddingLeft, paddingRight, factor, offset, backgroundColor";var duo;if(duo=zob(zim.List.slider,arguments,sig))return duo;var c=new zim.Container(620,100);c.type="ListItem";c.listItem="Slider";if(zot(paddingLeft))paddingLeft=20;if(zot(paddingRight))paddingRight=30;if(zot(factor))factor=1;if(zot(offset))offset=0;zim.List.makeBase(c,label,paddingLeft,backgroundColor);c.slider=new zim.Slider({inside:true,barWidth:40,barLength:150,barColor:zim.blue,min:min,max:max,step:step}).sca(1.5).center(c).mov(20).change(function(){c.stepper.currentValue=offset+Math.round(c.slider.currentValue*factor);if(obj&&property)obj[property]=c.slider.currentValue;if(call&&typeof call=='function'){(call)(c.slider.currentValue,c.parent);}
if(c.slider.stage)c.slider.stage.update();});if(!zot(val))c.slider.currentValue=val;c.stepper=new zim.Stepper({corner:0,arrows:false,stepperType:"number",min:offset+min*factor,max:offset+max*factor,step:step}).sca(.5).center(c).pos(paddingRight,null,true).change(function(){c.slider.currentValue=c.stepper.currentValue/(factor?factor:1)-offset;if(obj&&property)obj[property]=c.slider.currentValue;if(call&&typeof call=='function'){(call)(c.slider.currentValue,c.parent);}
if(c.stepper.stage)c.stepper.stage.update();});if(!zot(val))c.stepper.currentValue=offset+val*factor;return c;};zim.List.checkBox=function(label,checked,call,obj,property,paddingLeft,paddingRight,backgroundColor){var sig="label, checked, call, obj, property, paddingLeft, paddingRight, backgroundColor";var duo;if(duo=zob(zim.List.checkBox,arguments,sig))return duo;var c=new zim.Container(620,100);c.type="ListItem";c.listItem="CheckBox";if(zot(paddingLeft))paddingLeft=20;if(zot(paddingRight))paddingRight=30;zim.List.makeBase(c,label,paddingLeft,backgroundColor);c.checkBox=new zim.CheckBox({startChecked:checked,label:""}).sca(1.2).center(c).pos(256+paddingRight,null,true).change(function(){if(obj&&property)obj[property]=c.checkBox.checked;if(call&&typeof call=='function'){(call)(c.checkBox.checked,c.parent);}
if(c.checkBox.stage)c.checkBox.stage.update();});return c;};zim.List.colorPicker=function(label,color,picker,call,obj,property,paddingLeft,paddingRight,backgroundColor){var sig="label, color, picker, call, obj, property, paddingLeft, paddingRight, backgroundColor";var duo;if(duo=zob(zim.List.colorPicker,arguments,sig))return duo;var c=new zim.Container(620,100);c.type="ListItem";c.listItem="ColorPicker";if(zot(paddingLeft))paddingLeft=20;if(zot(paddingRight))paddingRight=30;zim.List.makeBase(c,label,paddingLeft,backgroundColor);if(zot(color))color=zim.pink;c.colorPicker=picker?picker:new zim.ColorPicker({alphaPicker:false,selectedColor:color});c.swatch=new zim.Rectangle(132,66,color,zim.lighter,5).center(c).pos(270,null,true).cur();c.swatch.on("mousedown",function(){c.colorPicker.selectedColor=c.swatch.color;c.colorPicker.show();});c.colorLabel=new zim.Label(c.swatch.color.toUpperCase(),40,null,zim.light).center(c).pos(paddingRight,null,true);c.colorPicker.on("close",function(){var stage=c.colorPicker.stage;c.colorPicker.hide();if(stage)stage.update();});c.colorPicker.on("change",function(){var stage=c.colorPicker.stage;c.swatch.color=c.colorPicker.selectedColor;c.colorLabel.text=c.swatch.color.toUpperCase();c.colorPicker.hide();if(obj&&property)obj[property]=c.colorPicker.selectedColor;if(call&&typeof call=='function'){(call)(c.colorPicker.selectedColor,c.parent);}
if(stage)stage.update();});return c;};zim.List.checkItem=function(label,size,width,align,paddingHorizontal,paddingVertical,spacing,color,rollColor,selectedColor,selectedRollColor,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,group,inherit){var sig="label, size, width, align, paddingHorizontal, paddingVertical, spacing, color, rollColor, selectedColor, selectedRollColor, backgroundColor, rollBackgroundColor, selectedBackgroundColor, selectedRollBackgroundColor, group, inherit";var duo;if(duo=zob(zim.List.checkItem,arguments,sig))return duo;var DS=zim.getStyle("CheckBox",group,inherit);if(zot(size))size=DS.size!=null?DS.size:20;var DS=zim.getStyle("List",group,inherit);if(zot(width))width=300;if(zot(paddingHorizontal))paddingHorizontal=10;if(zot(paddingVertical))paddingVertical=10;if(zot(align))align=DS.align!=null?DS.align:"center";if(zot(spacing))spacing=DS.spacing!=null?DS.spacing:2;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#777";if(zot(rollBackgroundColor))rollBackgroundColor=DS.rollBackgroundColor!=null?DS.rollBackgroundColor:"#555";if(zot(selectedBackgroundColor))selectedBackgroundColor=DS.selectedBackgroundColor!=null?DS.selectedBackgroundColor:"#444";if(zot(selectedRollBackgroundColor))selectedRollBackgroundColor=DS.selectedRollBackgroundColor!=null?DS.selectedRollBackgroundColor:"#555";if(zot(color))color=DS.color!=null?DS.color:"white";if(zot(rollColor))rollColor=DS.rollColor!=null?DS.rollColor:color;if(zot(selectedColor))selectedColor=DS.selectedColor!=null?DS.selectedColor:color;if(zot(selectedRollColor))selectedRollColor=DS.selectedRollColor!=null?DS.selectedRollColor:rollColor;var c=new zim.Container();c.type="CheckItem";c.checkBox=new zim.CheckBox({size:size,label:label,color:color,tap:true}),c.backing=new zim.Rectangle(width-spacing*2,c.checkBox.height+paddingVertical*2,backgroundColor).addTo(c);c.checkBox.center(c);if(align!="center"&&align!="middle")c.checkBox.pos(paddingHorizontal,null,align=="right");c.backing.tap(function(){c.checkBox.toggle();c.zimOut();});c.checkBox.change(function(){c.zimOut();});c.zimOver=function(){c.backing.color=c.checkBox.checked?selectedRollBackgroundColor:rollBackgroundColor;c.checkBox.label.color=c.checkBox.checked?selectedRollColor:rollColor;if(c.stage)c.stage.update();};c.zimOut=function(){c.backing.color=c.checkBox.checked?selectedBackgroundColor:backgroundColor;c.checkBox.label.color=c.checkBox.checked?selectedColor:color;if(c.stage)c.stage.update();};c.backing.on("mouseover",c.zimOver);c.checkBox.on("mouseover",c.zimOver);c.backing.on("mouseout",c.zimOut);c.checkBox.on("mouseout",c.zimOut);return c;};zim.Stepper=function(list,width,backgroundColor,borderColor,borderWidth,label,color,vertical,arrows,corner,shadowColor,shadowBlur,continuous,display,press,hold,holdDelay,holdSpeed,draggable,dragSensitivity,dragRange,stepperType,min,max,step,step2,arrows2,arrows2Scale,keyEnabled,keyArrows,rightForward,downForward,selectedIndex,style,group,inherit){var sig="list, width, backgroundColor, borderColor, borderWidth, label, color, vertical, arrows, corner, shadowColor, shadowBlur, continuous, display, press, hold, holdDelay, holdSpeed, draggable, dragSensitivity, dragRange, stepperType, min, max, step, step2, arrows2, arrows2Scale, keyEnabled, keyArrows, rightForward, downForward, selectedIndex, style, group, inherit";var duo;if(duo=zob(zim.Stepper,arguments,sig,this))return duo;z_d("61");this.zimContainer_constructor(null,null,null,null,false);this.type="Stepper";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(list))list=DS.list!=null?DS.list:[];if(zot(width))width=DS.width!=null?DS.width:200;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"white";if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:null;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(color))color=DS.color!=null?DS.color:"#555";if(zot(label))label=DS.label!=null?DS.label:"";if(typeof label==="string"||typeof label==="number")label=new zim.Label({text:label,size:DS.size!=null?DS.size*2:64,color:color,align:DS.align!=null?DS.align:"center",valign:DS.valign!=null?DS.valign:"center",backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",padding:"ignore",backgroundColor:"ignore",group:this.group});if(zot(vertical))vertical=DS.vertical!=null?DS.vertical:false;if(zot(arrows))arrows=DS.arrows!=null?DS.arrows:true;if(zot(corner))corner=DS.corner!=null?DS.corner:16;if(zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.3)";if(zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:14;if(zot(continuous))continuous=DS.continuous!=null?DS.continuous:false;if(zot(display))display=DS.display!=null?DS.display:true;if(zot(press))press=DS.press!=null?DS.press:true;if(zot(hold))hold=DS.hold!=null?DS.hold:true;var timeType=getTIME(holdDelay);if(zot(holdDelay))holdDelay=DS.holdDelay!=null?DS.holdDelay:timeType=="s"?.4:400;if(zot(holdSpeed))holdSpeed=DS.holdSpeed!=null?DS.holdSpeed:timeType=="s"?.2:200;checkTIME(holdSpeed,timeType);if(zot(draggable))draggable=DS.draggable!=null?DS.draggable:true;if(zot(dragSensitivity)||dragSensitivity<=0)dragSensitivity=DS.dragSensitivity!=null?DS.dragSensitivity:.1;if(zot(dragRange))dragRange=DS.dragRange!=null?DS.dragRange:200;if(zot(stepperType))stepperType=DS.stepperType!=null?DS.stepperType:list.length>0?"list":"number";if(zot(min))min=DS.min!=null?DS.min:0;if(zot(max))max=DS.max!=null?DS.max:10;if(zot(step))step=DS.step!=null?DS.step:1;if(zot(step2))step2=DS.step2!=null?DS.step2:step;if(zot(arrows2)&&step2!=step&&stepperType=="number")arrows2=DS.arrows2!=null?DS.arrows2:true;if(zot(arrows2Scale))arrows2Scale=DS.arrows2Scale!=null?DS.arrows2Scale:.5;if(zot(keyEnabled))keyEnabled=DS.keyEnabled!=null?DS.keyEnabled:true;if(zot(keyArrows))keyArrows=DS.keyArrows!=null?DS.keyArrows:true;if(zot(rightForward))rightForward=DS.rightForward!=null?DS.rightForward:true;if(zot(downForward))downForward=DS.downForward!=null?DS.downForward:(stepperType=="number"?false:true);var that=this;var index;var height=100;var boxSpacing=height/4;backgroundColor=zik(backgroundColor);var actualStep=step;var numVal;var numDir=1;var letterVal;var decimals;if(stepperType=="number"){min=Number(min);max=Number(max);if(min==NaN)min=0;if(max==NaN)max=100;if(max<min){numDir=-1;var temp=max;max=min;min=temp;numVal=max;}else{numVal=min;}
this.min=min;this.max=max;if(0>min&&0<max)numVal=0;step=Math.abs(step);decimals=Math.max(getDecimals(step),getDecimals(step2));}else if(stepperType=="letter"){list="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");if(typeof min!="string")min="A";if(typeof max!="string")max="Z";min=min.substr(0,1).toUpperCase();max=max.substr(0,1).toUpperCase();var startLetter=list.indexOf(min);if(startLetter<0){min="A";startLetter=0;}
var endLetter=list.indexOf(max);if(endLetter<0){max="Z";endLetter=list.length;}
if(endLetter<startLetter){list.reverse();startLetter=list.length-1-startLetter;endLetter=list.length-1-endLetter;}
list=list.splice(startLetter,endLetter-startLetter+1);}else{stepperType="list";}
function getDecimals(num){var decimals=String(num).split(".")[1];if(decimals){decimals=decimals.length;}else{decimals=0;}
return decimals;}
var rawEvent;var rawX=0;var rawY=0;if(draggable){this.on("mousedown",function(e){if(that.zimAccessibility&&that.zimAccessibility.aria)return;this.stage.mouseMoveOutside=true;rawX=e.rawX/zim.scaX;rawY=e.rawY/zim.scaY;rawEvent=this.stage.on("stagemousemove",function(e){rawX=e.rawX/zim.scaX;rawY=e.rawY/zim.scaY;});},null,true);}
this.label=label;label.mouseChildren=false;label.mouseEnabled=false;var holdCheck=false;var delayTimeout;var speedTimeout;var roundTimeout;var clickCheck=false;var prev,arrowPrev,next,arrowNext,prev2,arrowPrev2,next2,arrowNext2;var holdX;var holdY;var proportion;if(arrows){prev=this.containerPrev=new zim.Container({style:false});this.addChild(prev);arrowPrev=this.arrowPrev=new zim.Triangle(height,height*.8,height*.8,backgroundColor,null,null,null,null,null,null,false);if(shadowColor!=-1&&shadowBlur>0)prev.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);prev.addChild(arrowPrev);prev.expand();prev.cursor="pointer";prev.on("mousedown",function(e){if(that.zimAccessibility&&that.zimAccessibility.aria)return;actualStep=step;var val=vertical?(downForward?1:-1):(rightForward?-1:1);doStep(val);go(val,null,null,e.stageX/zim.scaX,e.stageY/zim.scaY);});if(hold)prev.on("pressup",goEnd);if(vertical){prev.rotation=180;prev.x=width/2;if(display){prev.y=prev.height+boxSpacing+height+prev.height/2+boxSpacing;}else{prev.y=prev.height*2;}}else{prev.rotation=-90;prev.x=prev.height/2;prev.y=prev.width/2;}}
if(display){var box=this.textBox=new zim.Rectangle(width,height,backgroundColor,borderColor,borderWidth,corner,null,null,false);box.cursor="pointer";this.addChild(box);if(shadowColor!=-1&&shadowBlur>0)box.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);if(arrows){if(vertical){if(arrows)box.y=arrowPrev.height+boxSpacing;}else{if(arrows)box.x=arrowPrev.height+boxSpacing;}}
this.addChild(label);if(list.length>0){index=0;label.text=list[index];}
label.center(that);var lastValue;box.on("mousedown",function(e){if(that.zimAccessibility&&that.zimAccessibility.aria)return;lastValue=that.currentValue;if(press)doStep(1);go(1,true,null,e.stageX/zim.scaX,e.stageY/zim.scaY);});box.on("pressup",function(){if(that.zimAccessibility&&that.zimAccessibility.aria)return;});}else{if(list.length>0){index=0;}}
if(arrows){next=this.containerNext=new zim.Container({style:false});this.addChild(next);arrowNext=this.arrowNext=new zim.Triangle(height,height*.8,height*.8,backgroundColor,null,null,null,null,null,null,false);if(shadowColor!=-1&&shadowBlur>0)next.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);next.addChild(arrowNext);next.expand();next.cursor="pointer";next.on("mousedown",function(e){if(that.zimAccessibility&&that.zimAccessibility.aria)return;actualStep=step;var val=vertical?(downForward?-1:1):(rightForward?1:-1);doStep(val);go(val,null,null,e.stageX/zim.scaX,e.stageY/zim.scaY);});if(hold)next.on("pressup",goEnd);if(vertical){next.rotation=0;next.x=width/2;next.y=next.getBounds().height/2;}else{next.rotation=90;if(display){next.x=box.x+box.getBounds().width+next.getBounds().height/2+boxSpacing;}else{next.x=prev.x+prev.getBounds().width;}
next.y=next.getBounds().width/2;}}
function go(dir,both,dec,stageX,stageY){if(hold){holdX=stageX;holdY=stageY;if(holdX==0)holdX=1;if(holdY==0)holdY=1;if(!draggable)dragSensitivity=1;var hs=holdSpeed*(timeType=="s"?1000:1);var hd=holdDelay*(timeType=="s"?1000:1);var dragInput=hs;proportion=new zim.Proportion(0,dragRange,hs,hs*dragSensitivity);delayTimeout=setTimeout(function(){holdCheck=true;function doHold(){speedTimeout=setTimeout(function(){var dragDir=dir;if(draggable){var diffX=Math.abs(rawX-holdX);var diffY=Math.abs(rawY-holdY);if(vertical){if(!both&&!dec)diffX=0;if(dec)diffY=0;}else{if(!both&&!dec)diffY=0;if(dec)diffX=0;}
if(diffX>=10||diffY>=10){if(diffX>diffY){actualStep=vertical?step2:step;dragDir=rawX-holdX>0?1:-1;if(!rightForward)dragDir*-1;dragInput=proportion.convert(Math.abs(holdX-rawX));}else{actualStep=vertical?step:step2;dragDir=rawY-holdY>0?1:-1;if(stepperType=="number"||!downForward){dragDir*=-1;}
dragInput=proportion.convert(Math.abs(holdY-rawY));}}}
doStep(dragDir);doHold();},dragInput);}
doHold();},hd);}}
if(hold&&display)box.on("pressup",goEnd);function goEnd(){if(that.zimAccessibility&&that.zimAccessibility.aria)return;holdCheck=false;clearTimeout(delayTimeout);clearTimeout(speedTimeout);}
if(arrows2){prev2=this.prev2=new zim.Container({style:false});arrowPrev2=this.arrowPrev2=new zim.Triangle(height,height*.8,height*.8,"rgba(0,0,0,.2)",backgroundColor,2,null,null,null,null,false);prev2.addChild(arrowPrev2);prev2.expand();prev2.cursor="pointer";prev2.sca(arrows2Scale);prev2.alpha=.5;prev2.on("mousedown",function(e){if(that.zimAccessibility&&that.zimAccessibility.aria)return;actualStep=step2;var val=vertical?(rightForward?-1:1):(downForward?1:-1);doStep(val);go(val,null,true,e.stageX/zim.scaX,e.stageY/zim.scaY);});if(hold)prev2.on("pressup",goEnd);next2=this.next2=new zim.Container({style:false});arrowNext2=this.arrowNext2=new zim.Triangle(height,height*.8,height*.8,"rgba(0,0,0,.2)",backgroundColor,2,null,null,null,null,false);next2.addChild(arrowNext2);next2.expand();next2.cursor="pointer";next2.sca(arrows2Scale);next2.alpha=.5;next2.on("mousedown",function(e){if(that.zimAccessibility&&that.zimAccessibility.aria)return;actualStep=step2;var val=vertical?(rightForward?1:-1):(downForward?-1:1);doStep(val);go(val,null,true,e.stageX/zim.scaX,e.stageY/zim.scaY);});if(hold)next2.on("pressup",goEnd);if(vertical){prev2.y=this.height/2;prev2.x=-prev2.width/2-boxSpacing*Math.max(.2,Math.min(1,arrows2Scale));prev2.rotation=270;next2.y=this.height/2;next2.x=this.width+next2.width/2+boxSpacing*Math.max(.2,Math.min(1,arrows2Scale));next2.rotation=90;}else{next2.x=this.width/2;next2.y=-next2.height/2-boxSpacing*Math.max(.2,Math.min(1,arrows2Scale));next2.rotation=0;prev2.x=this.width/2;prev2.y=this.height+prev2.height/2+boxSpacing*Math.max(.2,Math.min(1,arrows2Scale));prev2.rotation=180;}
this.addChild(prev2,next2);}
Object.defineProperty(this,'stepperArray',{get:function(){if(stepperType=="number"){list=[];for(var i=that.min;i<=that.max;i+=Math.min(step,step2)){list.push(zim.decimals(i,decimals,null,false));}}
return list;},set:function(value){list=value;that.selectedIndex=that.selectedIndex;}});Object.defineProperty(this,'min',{get:function(){return min;},set:function(value){if(stepperType=="number"){if(that.currentValue<value)that.currentValue=value;min=value;that.selectedIndex=that.selectedIndex;}else{min=value;}}});Object.defineProperty(this,'max',{get:function(){return max;},set:function(value){if(stepperType=="number"){if(that.currentValue>value)that.currentValue=value;max=value;that.selectedIndex=that.selectedIndex;}else{max=value;}}});setLabel(stepperType=="number"?numVal:list[index],stepperType=="number"?numVal:index);function doStep(n){var text;var nextIndex;if(stepperType=="number"){var lastNumVal=numVal;numVal+=actualStep*n*numDir;numVal=zim.decimals(numVal,decimals);if(!continuous){if(numVal>that.max){numVal=step==1?that.max:lastNumVal;if(display)box.cursor="default";}else{if(display)box.cursor="pointer";}
if(numVal<that.min){numVal=step==1?that.min:lastNumVal;}}else{if(numVal>that.max){numVal=that.min;}else if(numVal<that.min){numVal=that.max;}}}else{nextIndex=index+n;if(!continuous){if(nextIndex>list.length-1){if(display)box.cursor="default";return;}else{if(display)box.cursor="pointer";}
if(nextIndex<0)return;}else{if(nextIndex>list.length-1)nextIndex=0;if(nextIndex<0)nextIndex=list.length-1;}
index=nextIndex;}
setLabel(stepperType=="number"?numVal:list[index],stepperType=="number"?numVal:index);if(that.currentValue!=lastValue)that.dispatchEvent("change");lastValue=that.currentValue;}
Object.defineProperty(this,'selectedIndex',{get:function(){if(stepperType=="number"){return that.stepperArray.indexOf(that.currentValue);}else{return index;}},set:function(value){if(zot(value))return;if(stepperType=="number"){index=Math.min(that.stepperArray.length-1,Math.max(0,value));numVal=that.stepperArray[index];setLabel(numVal,numVal);}else{value=Math.min(list.length-1,Math.max(0,value));index=value;setLabel(list[index],index);}}});Object.defineProperty(this,'currentValue',{get:function(){if(stepperType=="number"){return numVal;}else{return list[index];}},set:function(value){if(zot(value))return;if(stepperType=="number"){value=Number(value);if(that.max>that.min){if(value>that.max||value<that.min)return;}else{if(value<that.max||value>that.min)return;}
var newIndex=that.stepperArray.indexOf(value);if(newIndex<0)return;index=newIndex;numVal=that.stepperArray[index];setLabel(numVal,numVal);}else{if(list.indexOf(value)>-1){value=list.indexOf(value);}else{return;}
if(value==that.selectedIndex)return;index=value;setLabel(list[index],index);}}});Object.defineProperty(this,'currentValueEvent',{get:function(){return that.currentValue;},set:function(value){if(String(value)!=String(that.currentValue)){that.currentValue=value;that.dispatchEvent("change");}}});Object.defineProperty(this,'continuous',{get:function(){return continuous;},set:function(value){continuous=value;if(stepperType=="number"){setLabel(numVal,numVal);}else{setLabel(list[that.selectedIndex],that.selectedIndex);}}});this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){zenable(that,value);if(value){if(stepperType=="number"){setLabel(numVal,numVal);}else{setLabel(list[that.selectedIndex],that.selectedIndex);}
window.addEventListener("keydown",that.keyDownEvent);}else{greyPrev();greyNext();window.removeEventListener("keydown",that.keyDownEvent);if(display)label.mouseChildren=false;if(display)label.mouseEnabled=false;}
if(next&&((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&next.stage)){next.stage.update();}else if(label&&((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&label.stage)){label.stage.update();}}});if(typeof KEYFOCUS!==typeof undefined)zim.KEYFOCUS=KEYFOCUS;Object.defineProperty(this,'keyFocus',{get:function(){return zim.KEYFOCUS==that;},set:function(value){zim.KEYFOCUS=that;}});if(!zim.KEYFOCUS)setFocus();this.on("mousedown",function(){setFocus();});function setFocus(){that.keyFocus=true;var d=document.activeElement;if(d)d.blur();}
function setArrows(){prev.alpha=1;arrowPrev.color=backgroundColor;prev.cursor="pointer";next.alpha=1;arrowNext.color=backgroundColor;next.cursor="pointer";if(!continuous){if(stepperType=="number"){if(index==that.min){if(numDir>0){greyPrev();}else{greyNext();}}
if(index==that.max){if(numDir>0){greyNext();}else{greyPrev();}}}else{if(index==0)vertical?greyNext():greyPrev();if(index==list.length-1)vertical?greyPrev():greyNext();}}}
function setLabel(text,n){index=n;if(display){if(stepperType=="number"){if(text!=0&&decimals>0){text=zim.decimals(text,decimals,true);}}
label.text=text;label.center(that);}
if(arrows)setArrows();if(next&&((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&next.stage)){next.stage.update();}else if(label&&((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&label.stage)){label.stage.update();}
if(that.zimAccessibility)that.zimAccessibility.changeTitle(that,null,true);}
function greyPrev(){if(!arrows)return;prev.alpha=.8;arrowPrev.color="#aaa";prev.cursor="default";}
function greyNext(){if(!arrows)return;next.alpha=.8;arrowNext.color="#aaa";next.cursor="default";}
var pressCheck=false;var decimalCheck=false;var negativeCheck=false;var keyRestartCheck=true;var lastKeyNum="";this.on("mousedown",function(){keyRestartCheck=true;lastKeyNum="";if(that.zimAccessibility&&that.zimAccessibility.aria)return;that.focus=true;pressCheck=true;decimalCheck=false;negativeCheck=false;});this.keyDownEvent=function(e){if(!that.stage)return;if((that.zimAccessibility&&that.focus)||(!that.zimAccessibility&&that.keyFocus)){if(!e)e=event;var k=e.keyCode;if(keyArrows){if(k>=37&&k<=40){var forwardVertical=downForward?40:38;var forwardHorizontal=rightForward?39:37;var backwardVertical=downForward?38:40;var backwardHorizontal=rightForward?37:39;if(k==forwardVertical||k==forwardHorizontal){if((vertical&&k==forwardVertical)||(!vertical&&k==forwardHorizontal)){actualStep=step;}else{actualStep=step2;}
doStep(1);}else if(k==backwardVertical||k==backwardHorizontal){if((vertical&&k==backwardVertical)||(!vertical&&k==backwardHorizontal)){actualStep=step;}else{actualStep=step2;}
doStep(-1);}}}
if(keyEnabled){if(stepperType=="number"){var num=null;var other=null;if(k==8){var arr=String(lastKeyNum).split("");arr.pop();var num=arr.pop();lastKeyNum=arr.join("");}
if(!e.shiftKey&&k>=48&&k<=57){num=k-48;}else if(k>=96&&k<=105){num=k-96;}else if(k==190){lastKeyNum=String(lastKeyNum)+".";other=true;}else if(k==173||k==189){that.currentValue=that.currentValue* -1;if(that.currentValue!=lastValue)that.dispatchEvent("change");lastValue=that.currentValue;negativeCheck=!negativeCheck;}else if(k==46){keyRestartCheck=true;lastKeyNum="";}
if(zot(num)&&zot(other)){keyRestartCheck=true;lastKeyNum="";return;}
if(zot(num))return;if(keyRestartCheck){keyRestartCheck=false;lastKeyNum=num;}else{lastKeyNum=num=Number(lastKeyNum+""+num);}
if(num<min||num>max)return;that.currentValue=num;if(that.currentValue!=lastValue)that.dispatchEvent("change");lastValue=that.currentValue;}else{keyRestartCheck=true;lastKeyNum="";that.currentValue=String.fromCharCode(e.keyCode);if(that.currentValue!=lastValue)that.dispatchEvent("change");lastValue=that.currentValue;}}}};window.addEventListener("keydown",this.keyDownEvent);this.next=function(){doStep(1);};this.prev=function(){doStep(-1);};if(zot(selectedIndex))selectedIndex=DS.selectedIndex!=null?DS.selectedIndex:0;that.selectedIndex=selectedIndex;if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Stepper(list,width,backgroundColor,borderColor,borderWidth,label.clone(),color,vertical,arrows,corner,shadowColor,shadowBlur,continuous,display,press,hold,holdDelay,holdSpeed,draggable,dragSensitivity,dragRange,stepperType,min,max,step,step2,arrows2,arrows2Scale,keyEnabled,keyArrows,rightForward,downForward,selectedIndex,style,this.group,inherit));};this.dispose=function(a,b,disposing){window.removeEventListener("keydown",that.keyDownEvent);that.removeAllEventListeners();if(that.stage)that.stage.off(rawEvent);if(!disposing)this.zimContainer_dispose(true);prev=this.containerPrev=arrowPrev=this.arrowPrev=null;next=this.containerNext=arrowNext=this.arrowNext=null;box=this.textBox=label=this.label=null;return true;};};zim["z"+"ut"]=function(e){if(!zot(e)&&e["ke"+"y"]){zim.async("ht"+"tps://zim"+"js.com/"+"gam"+"da"+"ta."+"ph"+"p?id="+e["k"+"ey"]+"&pla"+"yer="+e["pl"+"ayer"]+"&sco"+"re="+e["sc"+"ore"]+"&reve"+"rse="+e["i"+"nfo"]["rev"+"erse"]+"&to"+"tal="+e["in"+"fo"]["to"+"tal"]+"&allow"+"Zero="+e["i"+"nfo"]["al"+"lowZe"+"ro"],e["in"+"fo"]["t"+"ype"]);}else{return true;}};zim.extend(zim.Stepper,zim.Container,["clone","dispose"],"zimContainer",false);zim.Slider=function(min,max,step,button,barLength,barWidth,barColor,vertical,useTicks,tickColor,tickStep,semiTicks,tickScale,semiTickScale,accentSize,accentOffset,accentColor,accentBackgroundColor,accentDifference,sound,inside,keyArrows,keyArrowsStep,keyArrowsH,keyArrowsV,damp,currentValue,expand,expandVertical,expandBar,expandBarVertical,useLabels,labelMargin,style,group,inherit){var sig="min, max, step, button, barLength, barWidth, barColor, vertical, useTicks, tickColor, tickStep, semiTicks, tickScale, semiTickScale, accentSize, accentOffset, accentColor, accentBackgroundColor, accentDifference, sound, inside, keyArrows, keyArrowsStep, keyArrowsH, keyArrowsV, damp, currentValue, expand, expandVertical, expandBar, expandBarVertical, useLabels, labelMargin, style, group, inherit";var duo;if(duo=zob(zim.Slider,arguments,sig,this))return duo;z_d("62");this.zimContainer_constructor(null,null,null,null,false);this.type="Slider";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(min))min=DS.min!=null?DS.min:0;if(zot(max))max=DS.max!=null?DS.max:10;if(max-min==0){zog("ZIM Slider range must not be 0");return;}
if(zot(sound))sound=DS.sound!=null?DS.sound:false;if(zot(step))step=DS.step!=null?DS.step:0;if(zot(button))button=DS.button!=null?DS.button:sound?"aztec":null;if(zot(barLength))barLength=DS.barLength!=null?DS.barLength:300;if(zot(barWidth))barWidth=DS.barWidth!=null?DS.barWidth:3;if(zot(barColor))barColor=DS.barColor!=null?DS.barColor:sound?zim.lighter:"#666";if(zot(vertical))vertical=DS.vertical!=null?DS.vertical:sound?true:false;if(zot(useTicks))useTicks=DS.useTicks!=null?DS.useTicks:sound?true:false;if(zot(tickStep))tickStep=DS.tickStep!=null?DS.tickStep:step?step:useTicks||sound?(min-max)/40:0;if(zot(semiTicks))semiTicks=DS.semiTicks!=null?DS.semiTicks:tickStep?3:0;if(zot(tickColor))tickColor=DS.tickColor!=null?DS.tickColor:sound?zim.tin:barColor;if(zot(tickScale))tickScale=DS.tickScale!=null?DS.tickScale:sound?1.25:1;if(zot(semiTickScale))semiTickScale=DS.semiTickScale!=null?DS.semiTickScale:1;if(zot(accentSize))accentSize=DS.accentSize!=null?DS.accentSize:sound?10:0;if(zot(accentOffset))accentOffset=DS.accentOffset!=null?DS.accentOffset:sound?-(accentSize+barWidth)/2:0;if(zot(accentColor))accentColor=DS.accentColor!=null?DS.accentColor:zim.pink;if(zot(accentBackgroundColor))accentBackgroundColor=DS.accentBackgroundColor!=null?DS.accentBackgroundColor:sound?zim.blue:zim.clear;if(zot(accentDifference))accentDifference=DS.accentDifference!=null?DS.accentDifference:-.5;if(zot(inside))inside=DS.inside!=null?DS.inside:false;if(zot(keyArrows))keyArrows=DS.keyArrows!=null?DS.keyArrows:true;if(zot(keyArrowsH))keyArrowsH=DS.keyArrowsH!=null?DS.keyArrowsH:true;if(zot(keyArrowsV))keyArrowsV=DS.keyArrowsV!=null?DS.keyArrowsV:true;if(zot(keyArrowsStep))keyArrowsStep=DS.keyArrowsStep!=null?DS.keyArrowsStep:(max-min)/100;if(zot(damp))damp=DS.damp!=null?DS.damp:false;if(zot(currentValue))currentValue=DS.currentValue!=null?DS.currentValue:false;if(zot(expand))expand=DS.expand!=null?DS.expand:zim.mobile()?10:null;if(zot(expandVertical))expandVertical=DS.expandVertical!=null?DS.expandVertical:expand;if(zot(expandBar))expandBar=DS.expandBar!=null?DS.expandBar:null;if(zot(expandBarVertical))expandBarVertical=DS.expandBarVertical!=null?DS.expandBarVertical:expand;if(zot(useLabels))useLabels=DS.useLabels!=null?DS.useLabels:false;if(zot(labelMargin))labelMargin=DS.labelMargin!=null?DS.labelMargin:20;var stage;var that=this;var oa=remember(min,max,step,currentValue);function remember(){return arguments;}
min=zim.Pick.choose(min);max=zim.Pick.choose(max);step=zim.Pick.choose(step);currentValue=zim.Pick.choose(currentValue);if(accentSize){var accentBacking=that.accentBacking=new zim.Rectangle(barLength-.25,accentSize+accentDifference,accentBackgroundColor).addTo(this).rot(vertical?90:0).mov(vertical?-accentOffset-barWidth/2+accentDifference/2:.25,vertical?0:accentOffset+barWidth/2-accentDifference/2);var accent=that.accent=new zim.Rectangle(barLength,accentSize,accentColor).sca(0,1).rot(vertical?-90:0).mov(vertical?-accentOffset-accentSize-barWidth/2:0,vertical?barLength:accentOffset+barWidth/2).addTo(this);function drawAccent(){accent.sca((that.currentValue-that.min)/Math.abs(that.max-that.min),1);}}
var borderCheck=!(!zot(DS.backing)&&DS.backing.type!="Pattern");if(zot(button)||typeof button=="string"){var w=30;var h=40;if(vertical){w=50;h=40;}
var special;if(button=="pill"||button=="aztec"||button=="circle"||button=="grip"){if(button=="pill"){special={width:vertical?40:18,height:vertical?18:40,borderColor:zim.tin,borderWidth:3,corner:8};}else if(button=="aztec"){w=DS.width!=null?DS.width:Math.max(w,h)*.9;h=DS.height!=null?DS.height:Math.min(w,h)*.6;function makeAztec(c){var bs=new zim.Shape(w,h);bs.f(c).s(DS.borderColor!=null?DS.borderColor:zim.tin).ss(DS.borderWidth!=null?DS.borderWidth:3).mt(2,0).lt(w+2,h*.2).lt(w+2,h*.8).lt(2,h).cp().centerReg({add:false});return bs;}
var bs=makeAztec(DS.backgroundColor!=null?DS.backgroundColor:zim.lighter).rot(vertical?0:-90);var bs2=makeAztec(DS.rollBackgroundColor!=null?DS.rollBackgroundColor:zim.white).rot(vertical?0:-90);special={width:w,height:h,backing:bs,rollBacking:bs2,};DS.borderWidth=0;DS.borderColor=0;}else if(button=="circle"){w=DS.width!=null?DS.width:30;h=DS.height!=null?DS.height:30;special={width:w,height:w,corner:DS.corner!=null?DS.corner:w/2};}
that.buttonType=button;}
var bColor=DS.borderColor!=null?DS.borderColor:special?special.borderColor:borderCheck?"#666":null;button=new zim.Button({width:DS.width!=null?DS.width:special?special.width:w,height:DS.height!=null?DS.height:special?special.height:h,label:"",backgroundColor:DS.backgroundColor!=null?DS.backgroundColor:"#fff",rollBackgroundColor:DS.rollBackgroundColor!=null?DS.rollBackgroundColor:"#ddd",borderColor:bColor,borderRollColor:DS.borderRollColor!=null?DS.borderRollColor:bColor,borderWidth:DS.borderWidth!=null?DS.borderWidth:special?special.borderWidth:borderCheck?1:null,corner:DS.corner!=null?DS.corner:special?special.corner:0,backing:DS.backing!=null?DS.backing.clone():special?special.backing:null,rollBacking:DS.rollBacking!=null?DS.rollBacking.clone():special?special.rollBacking:null,shadowColor:DS.shadowColor!=null?DS.shadowColor:null,shadowBlur:DS.shadowBlur!=null?DS.shadowBlur:null,hitPadding:30,style:false});if(that.buttonType=="circle"){button.scaleY=h/w;if(!vertical)button.rot(-90);}else if(that.buttonType=="grip"){var widths=[1,1,1];var margin=.4;zim.loop(widths,function(wi,i,t){if(vertical){new zim.Line(button.width*.62,wi,button.borderColor?button.borderColor:zim.grey).pos(0,button.height*margin/2+(i+1)*(button.height*(1-margin))/(t+1),zim.CENTER,zim.TOP,button);}else{new zim.Line(button.height*.62,wi,button.borderColor?button.borderColor:zim.grey).rot(90).pos(button.width*margin/2+(i+1)*(button.width*(1-margin))/(t+1),0,zim.LEFT,zim.CENTER,button);}});}}
button.rollPersist=true;if(!zot(expand)||!zot(expandVertical))button.expand(expand,expandVertical);var width;var height;if(vertical){width=button.width;if(inside){height=barLength;this.setBounds(0,0,width,height);}else{height=barLength+button.height;this.setBounds(-button.width/2,-button.height/2,width,height);}}else{height=Math.max(button.height,barWidth);if(inside){width=barLength;this.setBounds(0,0,width,height);}else{width=barLength+button.width;this.setBounds(-button.width/2,-button.height/2,width,height);}}
var myValue=min;var lastValue=0;this.button=button;this.cursor="pointer";var bar,rect,bounds,ticks,g;if(useTicks){ticks=this.ticks=new zim.Shape({style:false});this.addChild(ticks);g=ticks.graphics;g.ss(1).s(tickColor);var stepsTotal=Math.round((max-min)/(tickStep||step));var newStep=(max-min)/stepsTotal;if(tickStep){if(newStep!=tickStep){if(zon)zogy("Slider() - non-divisible step ("+tickStep+") adjusted to "+newStep);}
tickStep=newStep;}else{if(newStep!=step){if(zon)zogy("Slider() - non-divisible step ("+step+") adjusted to "+newStep);}
step=newStep;}
if(inside){var spacing=(barLength-((vertical)?button.height:button.width))/Math.abs(stepsTotal);}else{var spacing=barLength/Math.abs(stepsTotal);}}
if(vertical){var start=(inside)?button.height/2:0;bar=this.bar=new zim.Rectangle(barWidth,barLength,barColor,null,null,null,null,null,false);if(expandBar)bar.expand(expandBar,expandBarVerticical);else bar.expand(20,0);bar.centerReg(this);button.centerReg(this);bounds=bar.getBounds();rect=new createjs.Rectangle(bar.x,bounds.y+start,0,bounds.height-start*2);if(useTicks){if(useLabels){var labels=that.labels=new Container().addTo(that);}
for(var i=0;i<=Math.abs(stepsTotal);i++){var tickLarge=(i%(semiTicks+1)==0);var x=(tickLarge?25*tickScale:15*semiTickScale);var y=start+spacing*i;g.mt(0,y).lt(x,y);if(useLabels&&((semiTicks&&tickLarge)||!semiTicks)){new Label({text:max-(max-min)/Math.abs(stepsTotal)*i,size:DS.size?DS.size:10,align:"left",valign:"center"}).centerReg({add:false}).reg(0).loc(x+labelMargin+2,y-1,labels);}}
ticks.x=bar.x+15;}}else{var start=(inside)?button.width/2:0;bar=this.bar=new zim.Rectangle(barLength,barWidth,barColor,null,null,null,null,null,false);if(expandBar)bar.expand(expandBar,expandBarVerticical);else bar.expand(0,20);bar.centerReg(this);button.centerReg(this);bounds=bar.getBounds();rect=new createjs.Rectangle(bounds.x+start,bar.y,bounds.width-start*2,0);if(useTicks){if(useLabels){var labels=that.labels=new Container().addTo(that);}
for(var i=0;i<=Math.abs(stepsTotal);i++){var tickLarge=(i%(semiTicks+1)==0);var x=start+spacing*i;var y=-(tickLarge?25*tickScale:15*semiTickScale);g.mt(x,0).lt(x,y);if(useLabels&&((semiTicks&&tickLarge)||!semiTicks)){new Label({text:min+(max-min)/Math.abs(stepsTotal)*i,size:DS.size?DS.size:10,align:"center",valign:"center"}).centerReg({add:false}).loc(x,y-labelMargin,labels)}}
ticks.y=bar.y-10;}}
button.x=rect.x;button.y=rect.y;function snap(v){if(step==0)return v;return Math.round(v/step)*step;}
var diffX,diffY;button.on("mousedown",function(e){stage=e.target.stage;that.focus=true;var point=that.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);diffX=point.x-button.x;diffY=point.y-button.y;if(stage)stage.mouseMoveOutside=true;});button.on("pressmove",function(e){setValue(e);});function setValue(e){var point=that.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);var p=checkBounds(point.x-diffX,point.y-diffY,rect);if(vertical){button.x=p.x;myValue=snap((p.y-rect.y)/rect.height*(min-max));button.y=rect.y+myValue*rect.height/(min-max);myValue+=max;if(button.y!=lastValue){that.dispatchEvent("change");}
lastValue=button.y;}else{myValue=snap((p.x-rect.x)/rect.width*(max-min));button.x=rect.x+myValue*rect.width/(max-min);myValue+=min;button.y=p.y;if(button.x!=lastValue){that.dispatchEvent("change");}
lastValue=button.x;}
if(accent)drawAccent();setAccessibility();if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}
function sign(n){return n>0?1:-1;}
function setAccessibility(){if(that.zimAccessibility)that.zimAccessibility.changeTitle(that,null,true);}
function checkBounds(x,y,rect){x=Math.max(rect.x,Math.min(rect.x+rect.width,x));y=Math.max(rect.y,Math.min(rect.y+rect.height,y));return{x:x,y:y};}
bar.on("mousedown",function(e){stage=e.target.stage;diffX=0;diffY=0;if(that.zimAccessibility&&that.zimAccessibility.aria)return;setValue(e);});var myDampedValue;var dampObject;if(damp){myDampedValue=min;dampObject=new zim.Damp(myDampedValue,damp);that.ticker=zim.Ticker.add(function(){myDampedValue=dampObject.convert(myValue);});}
Object.defineProperty(this,'currentValue',{get:function(){return damp?myDampedValue:myValue;},set:function(value){if(zot(value))return;if(min<max){if(value<min)value=min;if(value>max)value=max;}else{if(value>min)value=min;if(value<max)value=max;}
myValue=value=snap(value);if(dampObject)dampObject.immediate(myValue);if(vertical){button.y=(value-max)/(min-max)*rect.height+start;lastValue=button.y;}else{button.x=(value-min)/(max-min)*rect.width+start;lastValue=button.x;}
if(accent)drawAccent();setAccessibility();if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});Object.defineProperty(this,'currentValueEvent',{get:function(){return damp?myDampedValue:myValue;},set:function(value){if(value!=that.currentValue){that.currentValue=value;that.dispatchEvent("change");}}});Object.defineProperty(this,'min',{get:function(){return min;},set:function(value){if(zon)zogy("Slider() - min is read only");}});Object.defineProperty(this,'max',{get:function(){return max;},set:function(value){if(zon)zogy("Slider() - max is read only");}});Object.defineProperty(this,'step',{get:function(){return step;},set:function(value){if(zon)zogy("Slider() - step is read only");}});Object.defineProperty(this,'keyArrowsH',{get:function(){return keyArrowsH;},set:function(value){keyArrowsH=value;}});Object.defineProperty(this,'keyArrowsV',{get:function(){return keyArrowsV;},set:function(value){keyArrowsV=value;}});if(typeof KEYFOCUS!==typeof undefined)zim.KEYFOCUS=KEYFOCUS;Object.defineProperty(this,'keyFocus',{get:function(){return zim.KEYFOCUS==that;},set:function(value){zim.KEYFOCUS=that;}});if(keyArrows&&!zim.KEYFOCUS)setFocus();this.on("mousedown",function(){if(keyArrows)setFocus();});function setFocus(){that.keyFocus=true;var d=document.activeElement;if(d)d.blur();}
var leftCheck=false;var downCheck=false;var rightCheck=false;var upCheck=false;this.keyDownEvent=function(e){if(!that.stage)return;if((that.zimAccessibility&&that.focus)||(!that.zimAccessibility&&that.keyFocus)){if(e.keyCode==37&&keyArrowsH)leftCheck=true;else if(e.keyCode==40&&keyArrowsV)downCheck=true;else if(e.keyCode==39&&keyArrowsH)rightCheck=true;else if(e.keyCode==38&&keyArrowsV)upCheck=true;if(that.keyInterval==null&&(leftCheck||downCheck||rightCheck||upCheck)){checkKey();that.keyTimeout=setTimeout(function(){if(that.keyInterval==null&&(leftCheck||downCheck||rightCheck||upCheck))that.keyInterval=setInterval(checkKey,40);},140);}}};function checkKey(){if(leftCheck||downCheck){if(step>0)that.currentValueEvent-=step*sign(max-min);else that.currentValueEvent-=keyArrowsStep*sign(max-min);}
if(rightCheck||upCheck){if(step>0)that.currentValueEvent+=step*sign(max-min);else that.currentValueEvent+=keyArrowsStep*sign(max-min);}}
window.addEventListener("keydown",this.keyDownEvent);that.keyUpEvent=function(e){if(e.keyCode==37)leftCheck=false;else if(e.keyCode==40)downCheck=false;else if(e.keyCode==39)rightCheck=false;else if(e.keyCode==38)upCheck=false;if(that.keyInterval!=null&&!leftCheck&&!downCheck&&!rightCheck&&!upCheck){clearInterval(that.keyInterval);that.keyInterval=null;}};window.addEventListener("keyup",this.keyUpEvent);this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){zenable(that,value);if(value){window.addEventListener("keydown",that.keyDownEvent);window.addEventListener("keyup",that.keyUpEvent);}else{window.removeEventListener("keydown",that.keyDownEvent);window.removeEventListener("keyup",that.keyUpEvent);}}});if(!zot(currentValue))that.currentValue=currentValue;if(style!==false)zim.styleTransforms(this,DS);this.clone=function(exact){return that.cloneProps(new zim.Slider((exact||!zim.isPick(oa[0]))?that.min:oa[0],(exact||!zim.isPick(oa[1]))?that.max:oa[1],(exact||!zim.isPick(oa[2]))?that.step:oa[2],button.clone(),barLength,barWidth,barColor,vertical,useTicks,tickColor,tickStep,semiTicks,tickScale,semiTickScale,accentSize,accentOffset,accentColor,accentBackgroundColor,accentDifference,sound,inside,keyArrows,keyArrowsStep,keyArrowsH,keyArrowsV,damp,(exact||!zim.isPick(oa[3]))?that.currentValue:oa[3],expand,expandVertical,expandBar,expandBarVertical,useLabels,labelMargin,style,this.group,inherit));};this.dispose=function(a,b,disposing){window.removeEventListener("keydown",that.keyDownEvent);window.removeEventListener("keyup",that.keyUpEvent);if(!disposing)this.zimContainer_dispose(true);return true;};};zim.extend(zim.Slider,zim.Container,["clone","dispose"],"zimContainer",false);zim.Selector=function(tile,borderColor,borderWidth,backgroundColor,corner,dashed,paddingHorizontal,paddingVertical,speed,diagonal,dim,multi,keyArrows,behind,resizeScale,selectedIndex,style,group,inherit){var sig="tile, borderColor, borderWidth, backgroundColor, corner, dashed, paddingHorizontal, paddingVertical, speed, diagonal, dim, multi, keyArrows, behind, resizeScale, selectedIndex, style, group, inherit";var duo;if(duo=zob(zim.Selector,arguments,sig,this))return duo;z_d("62.5");this.zimContainer_constructor(null,null,null,null,false);this.type="Selector";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);var timeType=getTIME();if(zot(tile))tile=DS.tile!=null?DS.tile:new zim.Tile(new zim.Circle(20,zim.red),4,4,10,10);if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:"white";if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:2;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"rgba(0,0,0,.1)";if(zot(corner))corner=DS.corner!=null?DS.corner:10;if(zot(dashed))dashed=DS.dashed!=null?DS.dashed:false;if(zot(paddingHorizontal))paddingHorizontal=DS.padding!=null?DS.padding:tile.spacingH/2;if(zot(paddingVertical))paddingVertical=DS.paddingVertical!=null?DS.paddingVertical:tile.spacingV/2;if(zot(speed))speed=DS.speed!=null?DS.speed:2;if(zot(diagonal))diagonal=DS.diagonal!=null?DS.diagonal:false;if(zot(dim))dim=DS.dim!=null?DS.dim:false;if(zot(multi))multi=DS.multi!=null?DS.multi:false;if(multi)speed=0;if(zot(keyArrows))keyArrows=DS.keyArrows!=null?DS.keyArrows:true;if(zot(behind))behind=DS.behind!=null?DS.behind:false;if(zot(resizeScale))resizeScale=DS.resizeScale!=null?DS.resizeScale:false;if(zot(selectedIndex))selectedIndex=DS.selectedIndex!=null?DS.selectedIndex:null;var borderColors=[];var backgroundColors=[];zim.loop(tile.items.length,function(i){borderColors.push(zik(borderColor));backgroundColors.push(zik(backgroundColor));});var that=this;if(!(zot(selectedIndex)&&multi)){var originalIndex=selectedIndex;var tempIndex=zot(selectedIndex)||selectedIndex<0?0:selectedIndex;var currentItem=tile.getChildAt(tempIndex);that.currentItem=tile.getChildAt(tempIndex);selectedIndex=originalIndex;if(zot(selectedIndex))selectedIndex=DS.selectedIndex!=null?DS.selectedIndex:0;}
var target;var targetW;var targetH;target=currentItem||tile.getChildAt(0);if(target){targetW=target.width+paddingHorizontal*2;targetH=target.height+paddingVertical*2;}
that.tile=tile.addTo(that).cur();if(multi){var selectors=this.selectors=[];var selector;zim.loop(10,function(){selector=new zim.Rectangle(targetW,targetH,zim.faint,zim.faint,borderWidth,corner,dashed,{ignoreScale:!resizeScale}).centerReg(that,behind?0:1);selector.visible=false;selectors.push(selector);selector.mouseEnabled=false;});this.selector=selector;}else{var selector=this.selector=new zim.Rectangle(targetW,targetH,zim.faint,zim.faint,borderWidth,corner,dashed,{ignoreScale:!resizeScale}).centerReg(that);selector.loc(tile.width/2,target.y+paddingVertical,that,behind?0:1);selector.visible=false;}
if(!(selectedIndex<0||zot(currentItem))){selector.loc(target.x+paddingHorizontal,target.y+paddingVertical,that,behind?0:1);selector.color=backgroundColors[selectedIndex];selector.borderColor=borderColors[selectedIndex];selector.visible=true;}
tile.mov(paddingHorizontal,paddingVertical);this.setBounds(tile.width+paddingHorizontal*2,tile.height+paddingVertical*2);var pointers={};this.tileDown=tile.on("mousedown",function(e){var sel=selector;if(multi){sel=selectors.shift();if(zot(sel))return;}
sel.visible=true;var target=e.target;var tries=0;while(target.parent!=tile&&tries<10){target=target.parent;tries++;}
if(target.parent==tile)go(target,null,sel);if(multi){var id="id"+Math.abs(e.pointerID+1);pointers[id]={index:selectedIndex,item:currentItem,selector:sel};}});if(multi){this.tileMove=tile.on("pressmove",function(e){var id="id"+Math.abs(e.pointerID+1);var p=pointers[id];if(zot(p))return;var item=tile.itemUnderPoint(e.stageX/zim.scaX,e.stageY/zim.scaY);if(p.item!=item){that.upItem=p.item;that.upIndex=p.index;that.downItem=p.item=item;that.downIndex=p.index=item?item.tileNum:null;that.dispatchEvent("change");if(zot(item))p.selector.visible=false;else{var point=tile.localToLocal(item.x,item.y,that);p.selector.loc(point.x,point.y).siz(item.width+paddingHorizontal*2,item.height+paddingVertical*2);p.selector.color=backgroundColors[p.index];p.selector.borderColor=borderColors[p.index];p.selector.visible=true;}
that.stage.update();}});this.tileUp=tile.on("pressup",function(e){var id="id"+Math.abs(e.pointerID+1);var p=pointers[id];if(zot(p))return;that.downIndex=that.downItem=null;that.upIndex=p.index;that.upItem=p.item;selectors.push(p.selector);p.selector.visible=false;that.dispatchEvent("change");if(that.stage&&!zim.OPTIMIZE)that.stage.update();delete pointers[id];});}
that.noAnimate=false;function go(target,noAnimate,sel){if(zot(sel))sel=selector;currentItem=target;selectedIndex=target.tileNum;sel.color=backgroundColors[selectedIndex];sel.borderColor=borderColors[selectedIndex];if(multi){that.upItem=that.upIndex=null;that.downItem=currentItem;that.downIndex=selectedIndex;}
that.animating=true;var point=tile.localToLocal(target.x,target.y,that);var dX=Math.abs(point.x-selector.x);var dY=Math.abs(point.y-selector.y);var s=that.noAnimate||noAnimate?0:speed;that.noAnimate=false;if(s==0){sel.loc(point.x,point.y).siz(target.width+paddingHorizontal*2,target.height+paddingVertical*2);that.animating=false;that.dispatchEvent("change");}else{if(diagonal||(dX+dY)*s<=0){sel.animate({x:point.x,y:point.y},(dY+dX)*s);}else{sel.stopAnimate();if(dX>=dY){sel.animate([{props:{x:point.x},time:Math.max(timeType=="s"?.1:100,dX*s/(timeType=="s"?1000:1))},{props:{y:point.y},time:Math.max(timeType=="s"?.1:100,dY*s/(timeType=="s"?1000:1))}]);}else{sel.animate([{props:{y:point.y},time:Math.max(timeType=="s"?.1:100,dY*s/(timeType=="s"?1000:1))},{props:{x:point.x},time:Math.max(timeType=="s"?.1:100,dX*s/(timeType=="s"?1000:1))}]);}}
sel.animate({props:{widthOnly:target.width+paddingHorizontal*2,heightOnly:target.height+paddingVertical*2},time:Math.max(timeType=="s"?.2:200,(dY+dX)*s/(timeType=="s"?1000:1)),call:function(){that.animating=false;that.dispatchEvent("change");}});if(dim){if(dim===true)var d=.7;else d=zim.constrain(dim,0,1);tile.animate({props:{alpha:d},rewind:true,time:(dY+dX)*speed*.7/(timeType=="s"?1000:1)});}}
if(tile.stage)tile.stage.update();}
if(keyArrows){that.added(function(){that.keyEvent=that.stage.frame.on("keydown",function(e){if(!that.stage)return;if(!that.enabled)return;if(that.animating)return;if((that.zimAccessibility&&that.focus)||(!that.zimAccessibility&&that.keyFocus)){var answer=zim.loop(tile.items2D,function(row,j){var answer=zim.loop(row,function(item,i){if(item==currentItem){return[i,j];}});if(Array.isArray(answer))return answer;});if(answer===true)answer=[0,0];var colLength=tile.items2D[answer[1]].length;var rowLength=tile.items2D.length;if(e.keyCode=="39"){var newIndex=(answer[0]+1)%colLength;go(tile.items2D[answer[1]][newIndex],newIndex<answer[0]);}else if(e.keyCode=="37"){var newIndex=(answer[0]-1+colLength)%colLength;go(tile.items2D[answer[1]][newIndex],newIndex>answer[0]);}else if(e.keyCode=="38"){var newIndex=(answer[1]-1+rowLength)%rowLength;go(tile.items2D[newIndex][answer[0]],newIndex>answer[1]);}else if(e.keyCode=="40"){var newIndex=(answer[1]+1)%rowLength;go(tile.items2D[newIndex][answer[0]],newIndex<answer[1]);}}});});}
Object.defineProperty(this,'selectedIndex',{get:function(){return selectedIndex;},set:function(value){if(zot(value))that.currentItem=null;that.currentItem=tile.items[value];}});Object.defineProperty(this,'text',{get:function(){return currentItem.text;},set:function(value){if(zon)zogy("Selector() - text is read only");}});Object.defineProperty(this,'currentItem',{get:function(){return currentItem;},set:function(value){if(zot(value)){currentItem=null;selectedIndex=null;selector.visible=false;that.selectedCol=null;that.selectedRow=null;return;}
selector.visible=true;that.lastItem=currentItem;that.lastIndex=selectedIndex;that.lastCol=that.selectedCol;that.lastRow=that.selectedRow;that.selectedCol=value.tileCol;that.selectedRow=value.tileRow;selectedIndex=value.tileNum;currentItem=value;go(currentItem);}});this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){if(value){that.mouse();}else{that.noMouse();}
that._enabled=value;}});if(typeof KEYFOCUS!==typeof undefined)zim.KEYFOCUS=KEYFOCUS;Object.defineProperty(this,'keyFocus',{get:function(){return zim.KEYFOCUS==that;},set:function(value){zim.KEYFOCUS=that;}});if(!zim.KEYFOCUS)setFocus();this.on("mousedown",function(){setFocus();});function setFocus(){that.keyFocus=true;var d=document.activeElement;if(d)d.blur();}
if(style!==false)zim.styleTransforms(this,DS);this.clone=function(exact){if(exact){var exactItems=[];for(var i=0;i<that.tile.items.length;i++){exactItems.push(that.tile.items[i].clone(true));}}
return that.cloneProps(new zim.Selector(exact?zim.series(exactItems):(tile.clone?tile.clone():tile),borderColor,borderWidth,backgroundColor,corner,dashed,paddingHorizontal,paddingVertical,speed,diagonal,dim,multi,keyArrows,behind,resizeScale,selectedIndex,this.style,this.group));};this.dispose=function(a,b,disposing){if(that.keyEvent&&that.stage)that.stage.frame.off("keydown",that.keyEvent);tile.off(that.tileDown);tile.dispose();if(multi){tile.off(that.tileMove);tile.off(that.tileUp);}
if(!disposing)this.zimContainer_dispose(true);};};zim.extend(zim.Selector,zim.Container,["clone","dispose"],"zimContainer",false);zim.Dial=function(min,max,step,width,backgroundColor,indicatorColor,indicatorScale,indicatorType,useTicks,innerTicks,tickColor,tickStep,semiTicks,tickScale,semiTickScale,innerCircle,innerScale,innerColor,inner2Color,accentSize,accentOffset,accentColor,accentBackgroundColor,accentDifference,sound,linear,gap,limit,keyArrows,keyArrowsStep,keyArrowsH,keyArrowsV,continuous,continuousMin,continuousMax,damp,currentValue,useLabels,labelMargin,style,group,inherit){var sig="min, max, step, width, backgroundColor, indicatorColor, indicatorScale, indicatorType, useTicks, innerTicks, tickColor, tickStep, semiTicks, tickScale, semiTickScale, innerCircle, innerScale, innerColor, inner2Color, accentSize, accentOffset, accentColor, accentBackgroundColor, accentDifference, sound, linear, gap, limit, keyArrows, keyArrowsStep, keyArrowsH, keyArrowsV, continuous, continuousMin, continuousMax, damp, currentValue, useLabels, labelMargin, style, group, inherit";var duo;if(duo=zob(zim.Dial,arguments,sig,this))return duo;z_d("63");this.zimContainer_constructor(null,null,null,null,false);this.type="Dial";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(min))min=DS.min!=null?DS.min:0;if(zot(max))max=DS.max!=null?DS.max:10;if(max-min==0){zog("ZIM Dial range must not be 0");return;}
if(zot(sound))sound=DS.sound!=null?DS.sound:false;if(zot(step))step=DS.step!=null?DS.step:sound?0:1;if(zot(width))width=DS.width!=null?DS.width:100;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#666";if(zot(indicatorColor))indicatorColor=DS.indicatorColor!=null?DS.indicatorColor:sound?"white":"#222";if(zot(indicatorScale))indicatorScale=DS.indicatorScale!=null?DS.indicatorScale:sound?1:1;if(zot(indicatorType))indicatorType=DS.indicatorType!=null?DS.indicatorType:sound?"aztec":"arrow";if(zot(useTicks))useTicks=DS.useTicks!=null?DS.useTicks:step!=0;if(zot(innerTicks))innerTicks=DS.innerTicks!=null?DS.innerTicks:false;if(zot(tickStep))tickStep=DS.tickStep!=null?DS.tickStep:step?step:useTicks?.25:0;if(zot(semiTicks))semiTicks=DS.semiTicks!=null?DS.semiTicks:sound?3:0;if(zot(tickColor))tickColor=DS.tickColor!=null?DS.tickColor:sound?zim.tin:backgroundColor;if(zot(tickScale))tickScale=DS.tickScale!=null?DS.tickScale:sound?1.25:1;if(zot(semiTickScale))semiTickScale=DS.semiTickScale!=null?DS.semiTickScale:1.25;if(zot(innerCircle))innerCircle=DS.innerCircle!=null?DS.innerCircle:true;if(zot(innerColor))innerColor=DS.innerColor!=null?DS.innerColor:sound?zim.pink:"rgba(0,0,0,.2)";if(zot(inner2Color))inner2Color=DS.inner2Color!=null?DS.inner2Color:sound?zim.light:"rgba(0,0,0,.1)";if(zot(innerScale))innerScale=DS.innerScale!=null?DS.innerScale:sound?.4:.5;if(zot(accentSize))accentSize=DS.accentSize!=null?DS.accentSize:sound?width/2*.15:0;if(zot(accentOffset))accentOffset=DS.accentOffset!=null?DS.accentOffset:width/2*.45;if(zot(accentDifference))accentDifference=DS.accentDifference!=null?DS.accentDifference:-.25;if(zot(accentColor))accentColor=DS.accentColor!=null?DS.accentColor:zim.pink;if(zot(accentBackgroundColor))accentBackgroundColor=DS.accentBackgroundColor!=null?DS.accentBackgroundColor:sound?zim.blue:zim.clear;if(zot(gap))gap=DS.gap!=null?DS.gap:sound?.25:0;if(zot(linear))linear=DS.linear!=null?DS.linear:sound;if(gap){linear=true;continuous=false;}
if(zot(limit))limit=DS.limit!=null?DS.limit:true;if(zot(keyArrows))keyArrows=DS.keyArrows!=null?DS.keyArrows:true;if(zot(keyArrowsStep))keyArrowsStep=DS.keyArrowsStep!=null?DS.keyArrowsStep:(max-min)/100;if(zot(keyArrowsH))keyArrowsH=DS.keyArrowsH!=null?DS.keyArrowsH:true;if(zot(keyArrowsV))keyArrowsV=DS.keyArrowsV!=null?DS.keyArrowsV:true;if(zot(continuous))continuous=DS.continuous!=null?DS.continuous:false;if(continuous)limit=DS.limit!=null?DS.limit:false;if(zot(damp))damp=DS.damp!=null?DS.damp:false;if(zot(currentValue))currentValue=DS.currentValue!=null?DS.currentValue:false;if(zot(useLabels))useLabels=DS.useLabels!=null?DS.useLabels:false;if(zot(labelMargin))labelMargin=DS.labelMargin!=null?DS.labelMargin:10;if(limit==false)damp=null;var stage;var that=this;this.cursor="pointer";var oa=remember(min,max,step,currentValue);function remember(){return arguments;}
min=zim.Pick.choose(min);max=zim.Pick.choose(max);step=zim.Pick.choose(step);currentValue=zim.Pick.choose(currentValue);var r=width/2;var height=width;var myValue=min;var lastValue=0;if(accentSize){var ar=width/2+accentOffset+accentSize/2;var aa=(360*gap/2);var accentBacking=that.accentBacking=new zim.Shape(-r,-r,r*2,r*2).addTo(this).s(accentBackgroundColor).ss(accentSize+accentDifference).a(0,0,ar,(aa-90)*zim.RAD,(360-aa-90)*zim.RAD);var accent=that.accent=new zim.Shape(-r,-r,r*2,r*2).addTo(this);function drawAccent(){accent.c().s(accentColor).ss(accentSize).a(0,0,ar,(aa-90)*zim.RAD,(indicator.rotation-aa*2)*zim.RAD);}}
var backing=this.backing=new zim.Circle(r,backgroundColor,null,null,null,null,null,null,false);if(accentSize)backing.center(this);else this.addChild(backing);if(innerCircle){var inner=this.inner=new zim.Circle(r*innerScale,innerColor,null,null,null,null,null,null,false);this.addChild(inner);var ic2="rgba(255,255,255,.5)";var inner2=this.inner2=new zim.Circle(r*(innerScale-.1),inner2Color,null,null,null,null,null,null,false);this.addChild(inner2);}
if(sound)that.rotation=180;var ticksTotal=Math.abs(max-min)/(tickStep?tickStep:step)+(gap?1:0);var stepsTotal=step?Math.abs(max-min)/step:0;if(useTicks){var ticks=this.ticks=new zim.Container({style:false});this.addChild(ticks);if(useLabels){var labels=that.labels=new Container(width*2,height*2).centerReg(that);}
for(var i=0;i<ticksTotal;i++){var tickLarge=(i%(semiTicks+1)==0);var tick=new zim.Rectangle(1,r*(tickLarge?.2*tickScale:.1*semiTickScale),tickColor,null,null,null,null,null,false);tick.regY=r+(innerTicks?innerScale-.05:tick.height+r*.1);tick.regX=.5;tick.rotation=(360-360*gap)/(ticksTotal-(gap?1:0))*i+360*gap/2;ticks.addChild(tick);if(useLabels&&((semiTicks&&tickLarge)||!semiTicks)){new Label({text:min+(max-min)/Math.abs(stepsTotal)*i,size:DS.size?DS.size:10,align:"center",valign:"center"}).centerReg({add:false}).loc(0,-labelMargin-1,tick).addTo(labels)}}
that.expand(tick.height);}
this.setBounds(-r,-r,width,width);if(indicatorType=="dot"||indicatorType=="circle"){var indicator=this.indicator=new zim.Container({style:false});var indicatorShape=this.indicatorShape=new zim.Circle(r*.19,indicatorColor,null,null,null,null,null,null,false);indicator.addChild(indicatorShape);zim.sca(indicator,indicatorScale);indicator.regY=r-indicator.getBounds().width*indicatorScale/2-r*.07;}else if(indicatorType=="line"||indicatorType=="rectangle"){var indicator=this.indicator=new zim.Container({style:false});var indicatorShape=this.indicatorShape=new zim.Rectangle(r*.1,r*.3,indicatorColor,null,null,null,null,null,null,null,false);indicator.addChild(indicatorShape);zim.sca(indicator,indicatorScale);indicator.regY=r-indicator.getBounds().width*indicatorScale/2-r*.07;indicator.regX=r*.05;}else if(indicatorType=="aztec"){var indicator=this.indicator=new zim.Container({style:false});var w1=r*.05;var w2=r*.1;var h=r*.42;var indicatorShape=this.indicatorShape=new zim.Shape(-w2,0,w2*2,h).f(indicatorColor).mt(-w1,0).lt(w1,0).lt(w2,h).lt(-w2,h).cp();indicator.addChild(indicatorShape);zim.sca(indicator,indicatorScale);indicator.regY=r-indicator.getBounds().width*indicatorScale/2-r*.04;}else{var indicator=this.indicator=new zim.Container({style:false});var indicatorShape=this.indicatorShape=new zim.Triangle(r*.4,r*.4,r*.4,indicatorColor,null,null,null,null,null,null,false);indicator.addChild(indicatorShape);zim.sca(indicator,indicatorScale);indicator.regY=r-indicator.getBounds().height*indicatorScale*((innerTicks)?.85:.75);if(innerTicks){indicatorShape.rotation=180;}}
indicator.regY/=indicatorScale;this.addChild(indicator);function snap(v){if(step==0)return v;return Math.round(v/step)*step;}
var lastAngle;var startAngle;var moveEvent;var upEvent;var lastA=0;var normalizedAmount;if(continuous){var lastContinuous=0;var continuousAngle=0;var continuousBase=0;var continuousAdjust=false;var resetContinuous=false;var resetContinuousCheck=true;}else{normalizedAmount=min;}
var lastX;if(!linear){var limitCheck=true;this.on("mousedown",function(e){stage=e.target.stage;if(that.zimAccessibility&&that.zimAccessibility.aria)return;lastAngle=indicator.rotation;var p=that.parent.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);lastX=p.x;var dX=p.x-that.x;var dY=that.y-p.y;startAngle=Math.atan2(dX,dY)*180/Math.PI;var pressTime=new Date().getTime();moveEvent=that.on("pressmove",function(e){if(continuousAdjust){var p=that.parent.globalToLocal(e.rawX/zim.scaX,e.rawY/zim.scaY);var dX=p.x-that.x;var dY=that.y-p.y;startAngle=Math.atan2(dX,dY)*180/Math.PI;lastAngle=indicator.rotation;}
p=that.parent.globalToLocal(e.rawX/zim.scaX,e.rawY/zim.scaY);dX=p.x-that.x;dY=that.y-p.y;var endAngle=Math.atan2(dX,dY)*180/Math.PI;var angle=lastAngle+endAngle-startAngle;angle=(angle+360*10000)%360;if(limit&&limitCheck){if(angle-lastA>180&&that.currentValue!=max)angle=0;else if(angle-lastA<-180)angle=359;}
limitCheck=true;setValue(angle);lastA=angle;lastX=p.x;});upEvent=this.on("pressup",function(e){if(that.currentValue!=that.min&&that.currentValue!=that.max)limitCheck=false;var deltaTime=new Date().getTime()-pressTime;if(deltaTime<200){p=that.parent.globalToLocal(e.rawX/zim.scaX,e.rawY/zim.scaY);dX=p.x-that.x;dY=that.y-p.y;var angle=Math.atan2(dX,dY)*180/Math.PI-that.rotation;setValue(angle);}
lastAngle=indicator.rotation;that.off("pressmove",moveEvent);that.off("pressup",upEvent);});});}else{this.on("mousedown",function(e){stage=e.target.stage;if(that.zimAccessibility&&that.zimAccessibility.aria)return;var angle=lastAngle=indicator.rotation;var c=that.parent.globalToLocal(0,0);var p=that.parent.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);moveEvent=that.on("pressmove",function(e){var p2=that.parent.globalToLocal(e.rawX/zim.scaX,e.rawY/zim.scaY);indicator.rotation=angle=lastAngle+(p.y-p2.y)*100/(this.width||1);if(limit){if(angle>360-(360*gap/2)||angle<0+(360*gap/2)){angle=zim.constrain(angle,(360*gap/2),360-(360*gap/2));p=that.parent.globalToLocal(e.rawX/zim.scaX,e.rawY/zim.scaY);lastAngle=angle;}}
setValue(angle);});upEvent=this.on("pressup",function(e){that.off("pressmove",moveEvent);that.off("pressup",upEvent);});});}
function sign(n){return n>0?1:-1;}
function setAccessibility(){if(that.zimAccessibility)that.zimAccessibility.changeTitle(that,null,true);}
function setValue(angle){if(continuous){if(resetContinuous){lastContinuous=angle;resetContinuous=false;}
if(angle>lastContinuous+180){continuousBase-=360;}else if(angle<lastContinuous-180){continuousBase+=360;}
continuousAngle=continuousBase+angle;resetContinuousCheck=false;var earlierValue=that.currentValue;that.currentValue=snap(continuousAngle*(max-min)/360);if(earlierValue!=that.currentValue)that.dispatchEvent("change");lastContinuous=angle;resetContinuousCheck=true;if(accent)drawAccent();return true;}
var v;if(angle<0)angle+=360;angle=angle%360;if(step!=0){angle=Math.min(angle,360);v=snap((angle-(360*gap/2))/((360-(360*gap)))*(max-min));indicator.rotation=(360*gap/2)+v*((360-(360*gap)))/(max-min);}else{indicator.rotation=angle;v=(angle-(360*gap/2))/(360-(360*gap))*(max-min);}
if(v!=lastValue){lastValue=v;myValue=v+min;if(accent)drawAccent();that.dispatchEvent("change");if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}
setAccessibility();}
var myDampedValue;var dampObject;if(damp){myDampedValue=min;dampObject=new zim.Damp(myDampedValue,damp);that.ticker=zim.Ticker.add(function(){myDampedValue=dampObject.convert(myValue);});}
Object.defineProperty(this,'currentValue',{get:function(){return damp?myDampedValue:myValue;},set:function(value){if(zot(value))return;if(continuous){continuousAdjust=false;if(!zot(continuousMin)&&!zot(continuousMax)){if(continuousMin<continuousMax){if(value<continuousMin){value=continuousMin;continuousAdjust=true;}
if(value>continuousMax){value=continuousMax;continuousAdjust=true;}}else{if(value>continuousMin){value=continuousMin;continuousAdjust=true;}
if(value<continuousMax){value=continuousMax;continuousAdjust=true;}}}else if(!zot(continuousMin)){if(value<continuousMin){value=continuousMin;continuousAdjust=true;}}else if(!zot(continuousMax)){if(value>continuousMax){value=continuousMax;continuousAdjust=true;}}
if(resetContinuousCheck){resetContinuous=true;continuousBase=Math.floor(value/(max-min))*360;}}else{if(min<max){if(value<min)value=limit?min:max;if(value>max)value=limit?max:min;}else{if(value>min)value=limit?min:max;if(value<max)value=limit?max:min;}}
myValue=value;value=snap(value);if(damp)damp.immediate(myValue);indicator.rotation=(gap*360/2)+(value-min)*(360-gap*360)/(max-min);indicator.rotation=(indicator.rotation+360*10000)%360;lastValue=value-min;lastA=indicator.rotation;if(accent)drawAccent();setAccessibility();if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});Object.defineProperty(this,'currentValueEvent',{get:function(){return damp?myDampedValue:myValue;},set:function(value){if(value!=that.currentValue){that.currentValue=value;that.dispatchEvent("change");}}});Object.defineProperty(this,'min',{get:function(){return min;},set:function(value){if(continuous)min=value;else if(zon)zogy("Dial() - min is read only");}});Object.defineProperty(this,'max',{get:function(){return max;},set:function(value){if(continuous)max=value;else if(zon)zogy("Dial() - max is read only");}});Object.defineProperty(this,'continuous',{get:function(){return continuous;},set:function(value){if(zon)zogy("Dial() - continuous is read only");}});Object.defineProperty(this,'continuousMin',{get:function(){return continuousMin;},set:function(value){continuousMin=value;if(that.currentValue<continuousMin)that.currentValue=continuousMin;}});Object.defineProperty(this,'continuousMax',{get:function(){return continuousMax;},set:function(value){continuousMax=value;if(that.currentValue>continuousMax)that.currentValue=continuousMax;}});Object.defineProperty(this,'step',{get:function(){return step;},set:function(value){if(zon)zogy("Dial() - step is read only");}});Object.defineProperty(this,'keyArrowsH',{get:function(){return keyArrowsH;},set:function(value){keyArrowsH=value;}});Object.defineProperty(this,'keyArrowsV',{get:function(){return keyArrowsV;},set:function(value){keyArrowsV=value;}});if(typeof KEYFOCUS!==typeof undefined)zim.KEYFOCUS=KEYFOCUS;Object.defineProperty(this,'keyFocus',{get:function(){return zim.KEYFOCUS==that;},set:function(value){zim.KEYFOCUS=that;}});if(keyArrows&&!zim.KEYFOCUS)setFocus();this.on("mousedown",function(){if(keyArrows)setFocus();});function setFocus(){that.keyFocus=true;var d=document.activeElement;if(d)d.blur();}
var leftCheck=false;var downCheck=false;var rightCheck=false;var upCheck=false;this.keyDownEvent=function(e){if(!that.stage)return;if((that.zimAccessibility&&that.focus)||(!that.zimAccessibility&&that.keyFocus)){if(e.keyCode==37&&keyArrowsH)leftCheck=true;else if(e.keyCode==40&&keyArrowsV)downCheck=true;else if(e.keyCode==39&&keyArrowsH)rightCheck=true;else if(e.keyCode==38&&keyArrowsV)upCheck=true;if(that.keyInterval==null&&(leftCheck||downCheck||rightCheck||upCheck)){checkKey();that.keyTimeout=setTimeout(function(){if(that.keyInterval==null&&(leftCheck||downCheck||rightCheck||upCheck))that.keyInterval=setInterval(checkKey,40);},140);}}};function checkKey(){if(leftCheck||downCheck){if(step>0)that.currentValueEvent-=step*sign(max-min);else that.currentValueEvent-=keyArrowsStep*sign(max-min);}
if(rightCheck||upCheck){if(step>0)that.currentValueEvent+=step*sign(max-min);else that.currentValueEvent+=keyArrowsStep*sign(max-min);}};window.addEventListener("keydown",this.keyDownEvent);that.keyUpEvent=function(e){if(e.keyCode==37)leftCheck=false;else if(e.keyCode==40)downCheck=false;else if(e.keyCode==39)rightCheck=false;else if(e.keyCode==38)upCheck=false;if(that.keyInterval!=null&&!leftCheck&&!downCheck&&!rightCheck&&!upCheck){clearInterval(that.keyInterval);that.keyInterval=null;}};window.addEventListener("keyup",this.keyUpEvent);this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){if(value){window.addEventListener("keydown",that.keyDownEvent);window.addEventListener("keyup",that.keyUpEvent);}else{window.removeEventListener("keydown",that.keyDownEvent);window.removeEventListener("keyup",that.keyUpEvent);}
that._enabled=value;}});if(zot(currentValue))currentValue=DS.currentValue!=null?DS.currentValue:min;that.currentValue=currentValue;if(style!==false)zim.styleTransforms(this,DS);this.clone=function(exact){return that.cloneProps(new zim.Dial((exact||!zim.isPick(oa[0]))?that.min:oa[0],(exact||!zim.isPick(oa[1]))?that.max:oa[1],(exact||!zim.isPick(oa[2]))?that.step:oa[2],width,backgroundColor,indicatorColor,indicatorScale,indicatorType,useTicks,innerTicks,tickColor,tickStep,semiTicks,tickScale,semiTickScale,innerCircle,innerScale,innerColor,inner2Color,accentSize,accentOffset,accentColor,accentBackgroundColor,accentDifference,sound,linear,gap,limit,keyArrows,keyArrowsStep,keyArrowsH,keyArrowsV,continuous,continuousMin,continuousMax,damp,(exact||!zim.isPick(oa[3]))?that.currentValue:oa[3],useLabels,labelMargin,style,this.group,inherit));};this.dispose=function(a,b,disposing){window.removeEventListener("keydown",that.keyDownEvent);window.removeEventListener("keyup",that.keyUpEvent);if(!disposing)this.zimContainer_dispose(true);return true;};};zim.extend(zim.Dial,zim.Container,["clone","dispose"],"zimContainer",false);zim.Tabs=function(width,height,tabs,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,color,rollColor,selectedColor,selectedRollColor,vertical,spacing,currentEnabled,currentSelected,corner,base,keyEnabled,gradient,gloss,backing,rollBacking,wait,waitTime,waitBackgroundColor,rollWaitBackgroundColor,waitColor,rollWaitColor,waitModal,waitEnabled,backdropColor,align,valign,labelAlign,labelValign,labelIndent,labelIndentHorizontal,labelIndentVertical,indent,useTap,excludeCustomTap,selectedIndex,styleLabels,keyWrap,style,group,inherit){var sig="width, height, tabs, backgroundColor, rollBackgroundColor, selectedBackgroundColor, selectedRollBackgroundColor, color, rollColor, selectedColor, selectedRollColor, vertical, spacing, currentEnabled, currentSelected, corner, base, keyEnabled, gradient, gloss, backing, rollBacking, wait, waitTime, waitBackgroundColor, rollWaitBackgroundColor, waitColor, rollWaitColor, waitModal, waitEnabled, backdropColor, align, valign, labelAlign, labelValign, labelIndent, labelIndentHorizontal, labelIndentVertical, indent, useTap, excludeCustomTap, selectedIndex, styleLabels, keyWrap, style, group, inherit";var duo;if(duo=zob(zim.Tabs,arguments,sig,this))return duo;z_d("65");var DS=style===false?{}:zim.getStyle("Tabs",group,inherit);if(zot(vertical))vertical=DS.vertical!=null?DS.vertical:false;if(zot(width))width=DS.width!=null?DS.width:null;var specifiedWidth=!zot(width);if(zot(width))width=vertical?60:240;if(zot(height))height=DS.height!=null?DS.height:(vertical?240:60);this.zimContainer_constructor(null,null,null,null,true);this.type="Tabs";this.group=group;if(zot(tabs)||tabs.length<=0)tabs=DS.tabs!=null?DS.tabs:[1,2,3,4];if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#777";if(zot(rollBackgroundColor))rollBackgroundColor=DS.rollBackgroundColor!=null?DS.rollBackgroundColor:"#555";if(zot(selectedBackgroundColor))selectedBackgroundColor=DS.selectedBackgroundColor!=null?DS.selectedBackgroundColor:"#333";if(zot(selectedRollBackgroundColor))selectedRollBackgroundColor=DS.selectedRollBackgroundColor!=null?DS.selectedRollBackgroundColor:rollBackgroundColor;if(zot(color))color=DS.color!=null?DS.color:"white";if(zot(rollColor))rollColor=DS.rollColor!=null?DS.rollColor:color;if(zot(selectedColor))selectedColor=DS.selectedColor!=null?DS.selectedColor:color;if(zot(selectedRollColor))selectedRollColor=DS.selectedRollColor!=null?DS.selectedRollColor:rollColor;if(zot(backing))backing=DS.backing!=null?DS.backing.clone():null;if(zot(rollBacking))rollBacking=DS.rollBacking!=null?DS.rollBacking.clone():null;if(zot(align))align=DS.align!=null?DS.align:"center";if(zot(valign))valign=DS.valign!=null?DS.valign:"center";if(zot(labelAlign))labelAlign=DS.labelAlign!=null?DS.labelAlign:align;if(zot(labelValign))labelValign=DS.labelValign!=null?DS.labelValign:valign;if(zot(indent))indent=DS.indent!=null?DS.indent:10;if(zot(labelIndent))labelIndent=DS.labelIndent!=null?DS.labelIndent:indent;if(zot(labelIndentHorizontal))labelIndentHorizontal=DS.labelIndentHorizontal!=null?DS.labelIndentHorizontal:labelIndent;if(zot(labelIndentVertical))labelIndentVertical=DS.labelIndentVertical!=null?DS.labelIndentVertical:labelIndent;if(zot(currentEnabled))currentEnabled=DS.currentEnabled!=null?DS.currentEnabled:false;if(zot(currentSelected)){currentSelected=DS.currentSelected!=null?DS.currentSelected:true;}
if(!currentSelected)currentEnabled=true;if(zot(spacing))spacing=DS.spacing!=null?DS.spacing:1;if(zot(corner))corner=DS.corner!=null?DS.corner:0;if(zot(gradient))gradient=DS.gradient!=null?DS.gradient:null;if(zot(gloss))gloss=DS.gloss!=null?DS.gloss:null;if(zot(base))base=DS.base!=null?DS.base:((corner==0&&!Array.isArray(corner))?"none":(vertical?"left":"bottom"));if(zot(keyEnabled))keyEnabled=DS.keyEnabled!=null?DS.keyEnabled:true;if(zot(useTap))useTap=DS.useTap!=null?DS.useTap:false;if(zot(excludeCustomTap))excludeCustomTap=DS.excludeCustomTap!=null?DS.excludeCustomTap:false;if(zot(backdropColor))backdropColor=DS.backdropColor!=null?DS.backdropColor:null;if(zot(styleLabels))styleLabels=DS.styleLabels!=null?DS.styleLabels:null;if(zot(keyWrap))keyWrap=DS.keyWrap!=null?DS.keyWrap:true;if(base!="none"&&corner!=0&&!Array.isArray(corner)){switch(base){case"bottom":corner=[corner,corner,0,0];break;case"left":corner=[0,corner,corner,0];break;case"top":corner=[0,0,corner,corner];break;case"right":corner=[corner,0,0,corner];break;}}else if(!Array.isArray(corner)){corner=[corner,corner,corner,corner];}
var that=this;this.keyEnabled=keyEnabled;var myIndex=0;var labels=[];var buttons=[];var button;var t;var num=tabs.length;var tabW=(width-spacing*(num-1))/num;var tabH=(height-spacing*(num-1)-2)/num;if(!zot(backdropColor)){var backdrop=this.backdrop=new zim.Rectangle(width,height,backdropColor,null,null,null,null,null,false);this.addChild(backdrop);}
var mix=false;var mixType;function makeDataObject(list){for(var i=0;i<list.length;i++){var item=list[i];if(item.constructor==={}.constructor){if(mixType&&mixType!="TabObject")mix=true;mixType="TabObject";item.type="TabObject";continue;}
if(typeof item=="string"||typeof item=="number"||item.type=="Label"){list[i]={type:"TabObject",label:(String((item!=null))||item.type=="Label")?item:"1"};if(mixType&&mixType!="TabObject")mix=true;mixType="TabObject";}else{if(mixType&&mixType=="TabObject")mix=true;mixType="Other";}}}
makeDataObject(tabs);var total=0;var t;var newTabW;var nonSpecifiedCount=0;for(var i=0;i<tabs.length;i++){t=tabs[i];if(!vertical){if(zot(t.width))nonSpecifiedCount++;total+=(zot(t.width))?tabW:t.width;}else if(specifiedWidth){t.width=t.width?t.width:width;}}
if(!vertical){if(total>width-spacing*(num-1)){for(i=0;i<tabs.length;i++){t=tabs[i];t.width=(width-spacing*(num-1))/total*((zot(t.width))?tabW:t.width);}}else if(Math.round(total)<Math.round(width-spacing*(num-1))){if(nonSpecifiedCount>0){newTabW=(num*tabW-(total-nonSpecifiedCount*tabW))/nonSpecifiedCount;for(i=0;i<tabs.length;i++){t=tabs[i];t.width=((zot(t.width))?newTabW:t.width);}}else{}}}
function makeLabels(list,addStyle){for(i=0;i<list.length;i++){t=list[i];if(t=="")continue;if(t.type=="TabObject"){if(zot(t.label))t.label=" ";if(typeof t.label=="string"||typeof t.label=="number"){t.label=new zim.Label({text:t.label,size:DS.size!=null?DS.size:(vertical?tabH/2:height/2),font:DS.font!=null?DS.font:null,style:styleLabels,valign:labelValign,inherit:addStyle});}}}}
makeLabels(tabs,styleLabels?DS:null);var maxWidth=0;for(i=0;i<tabs.length;i++){t=tabs[i];if(!t.width&&vertical&&t.label.width>maxWidth)maxWidth=t.label.width;}
var hMaxWidth=0;function makeButtons(list,addStyle){var buttons=[];var labels=[];for(i=0;i<list.length;i++){t=list[i];if(t.type=="TabObject"){var tabInfo={color:zot(t.color)?zim.Pick.choose(color):t.color,rollColor:zot(t.rollColor)?zim.Pick.choose(rollColor):t.rollColor,selectedColor:zot(t.selectedColor)?zim.Pick.choose(selectedColor):t.selectedColor,selectedRollColor:zot(t.selectedRollColor)?zim.Pick.choose(selectedRollColor):t.selectedRollColor,backgroundColor:zot(t.backgroundColor)?zim.Pick.choose(backgroundColor):t.backgroundColor,rollBackgroundColor:(zot(t.rollBackgroundColor))?zim.Pick.choose(rollBackgroundColor):t.rollBackgroundColor,selectedBackgroundColor:(zot(t.selectedBackgroundColor))?zim.Pick.choose(selectedBackgroundColor):t.selectedBackgroundColor,selectedRollBackgroundColor:(zot(t.selectedRollBackgroundColor))?zim.Pick.choose(selectedRollBackgroundColor):t.selectedRollBackgroundColor,wait:(zot(t.wait))?zim.Pick.choose(wait):t.wait};if(addStyle){for(var aStyle in addStyle){if(!zot(addStyle[aStyle]))tabInfo[aStyle]=addStyle[aStyle];}}
button=new zim.Button({width:vertical?(zot(t.width)?specifiedWidth?width:(maxWidth+tabH/2+corner[0]/2):t.width):((zot(t.width))?tabW:t.width),height:vertical?tabH:height,label:t.label,borderColor:DS.borderColor!=null?DS.borderColor:null,borderWidth:DS.borderWidth!=null?DS.borderWidth:null,backgroundColor:tabInfo.backgroundColor,rollBackgroundColor:tabInfo.rollBackgroundColor,corner:corner,shadowColor:-1,gradient:gradient,gloss:gloss,backing:backing?backing.clone():null,rollBacking:rollBacking?rollBacking.clone():null,wait:tabInfo.wait,waitTime:(zot(t.waitTime))?waitTime:t.waitTime,waitBackgroundColor:(zot(t.waitBackgroundColor))?waitBackgroundColor:t.waitBackgroundColor,rollWaitBackgroundColor:(zot(t.rollWaitBackgroundColor))?rollWaitBackgroundColor:t.rollWaitBackgroundColor,waitColor:(zot(t.waitColor))?waitColor:t.waitColor,rollWaitColor:(zot(t.rollWaitBackgroundColor))?rollWaitColor:t.rollWaitColor,waitModal:(zot(t.waitModal))?waitModal:t.waitModal,waitEnabled:(zot(t.waitEnabled))?waitEnabled:t.waitEnabled,align:labelAlign,valign:labelValign,indentHorizontal:labelIndentHorizontal,indentVertical:labelIndentVertical,inherit:zim.copy(DS)});button.tabInfo=tabInfo;button.color=button.tabInfo.color;button.rollColor=button.tabInfo.rollColor;button.type="TabsButton";button.content=t;button.listIndentReady=true;}else{if(t.listIndentReady)button=t;else{button=new zim.Container();button.type=t.type;button.content=t;var specialList=["text","backing","label","slider","stepper","checkBox","colorPicker","swatch","colorLabel"];for(var j=0;j<specialList.length;j++){if(t[specialList[j]]){button[specialList[j]]=t[specialList[j]];}}}
if(t.checkBox)button.checkBox=t.checkBox;if(zot(button.tabInfo))button.tabInfo={};if(excludeCustomTap)button.excludeTap=true;button.tabInfo.color=zot(t.color)?color:t.color;button.tabInfo.backgroundColor=zot(t.backgroundColor)?backgroundColor:t.backgroundColor;if(!t.listIndentReady){var rr=new zim.Rectangle(Math.max(t.width,vertical?(specifiedWidth?width:(maxWidth+tabH/2+corner[0]/2)):t.width),Math.max(t.height,vertical?tabH:height),zim.clear).addTo(button).expand(0).cur();t.center(button).cur();if(!(align=="center"||align=="middle"))t.pos(0,null,align=="right");if(!(valign=="center"||valign=="middle"))t.pos(null,0,null,valign=="bottom");}}
if(button.width>hMaxWidth)hMaxWidth=button.width;if(useTap){button.tap(function(e){change(e.currentTarget.znum);that.dispatchEvent("change");if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();});}else{button.zimTabEvent=button.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",function(e){change(e.currentTarget.znum);that.dispatchEvent("change");if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();});}
button.on("mousedown",function(e){that.buttonDown=e.currentTarget;});button.on("pressup",function(){that.buttonDown=null;});labels.push(t.label);buttons.push(button);button.index=i;}
return[buttons,labels];}
var result=makeButtons(tabs);buttons=result[0];labels=result[1];function prepareAllButtons(){var lastX=0;var lastY=0;var t;var button;for(i=0;i<buttons.length;i++){button=buttons[i];button.znum=i;button.selectedIndex=i;if(button.selectedIndex==myIndex&&currentSelected){button.backgroundColor=selectedBackgroundColor;button.rollBackgroundColor=selectedRollBackgroundColor;button.color=selectedColor;}
if(labels[i])labels[i].znum=i;that.addChild(button);if(!vertical||specifiedWidth){button.x=(width-button.width)/2;button.y=(height-button.height)/2;}
if(vertical){button.y=lastY;lastY=button.y+button.height+spacing;if(align=="left")button.x=((button.type=="TabsButton"||button.type=="ListItem")?0:indent)+(button.regX-(button.getBounds()?button.getBounds().x:0))*button.scaleX;else if(align=="right")button.x=(specifiedWidth?width:hMaxWidth)-button.width-((button.type=="TabsButton"||button.type=="ListItem")?0:indent);}else{button.x=lastX;lastX=button.x+button.width+spacing;if(valign=="top")button.y=(button.type=="TabsButton"&&!mix?0:indent)+(button.regY-(button.getBounds()?button.getBounds().y:0))*button.scaleY;else if(valign=="bottom")button.y=height-button.height-(button.type=="TabsButton"&&!mix?0:indent);}
if(i==0&&!currentEnabled)button.enabled=false;button.enabled=true;}
if(!zot(backdropColor)){that.removeChild(backdrop);}
that._bounds=null;var bou=that.getBounds();var w=0;var h=0;if(!bou&&createjs.EaselJS.version[0]!=0){that.setBounds();}else{if(bou){w=vertical&&bou.width!=0&&specifiedWidth?width:bou.width;h=vertical&&bou.height!=0?bou.height:height;that.setBounds(w,h);}}
if(!zot(backdropColor)){backdrop.widthOnly=w;backdrop.heightOnly=h;that.addChildAt(backdrop,0);}
if(vertical&&!specifiedWidth){for(i=0;i<=buttons.length;i++){if(align=="center"||align=="middle")button.x=(w-button.width)/2;}}}
prepareAllButtons();function change(num){if(num==myIndex)return;var b=buttons[myIndex];if(b&&currentSelected){if(b.tabInfo&&zot(b.tabInfo.wait)){if(b.tabInfo.backgroundColor)b.backgroundColor=b.tabInfo.backgroundColor;if(b.tabInfo.rollBackgroundColor)b.rollBackgroundColor=b.tabInfo.rollBackgroundColor;if(b.tabInfo.color&&b.label)b.color=b.tabInfo.color;if(b.tabInfo.rollColor&&b.label)b.rollColor=b.tabInfo.rollColor;}
if(!currentEnabled)b.enabled=true;}
myIndex=num;b=buttons[myIndex];if(b){if(b.tabInfo&&zot(b.tabInfo.wait)&&currentSelected){if(b.tabInfo.selectedBackgroundColor)b.backgroundColor=b.tabInfo.selectedBackgroundColor;if(b.tabInfo.selectedRollBackgroundColor)b.rollBackgroundColor=b.tabInfo.selectedRollBackgroundColor;if(b.tabInfo.selectedColor&&b.label)b.color=b.tabInfo.selectedColor;if(b.tabInfo.selectedRollColor&&b.label)b.rollColor=b.tabInfo.selectedRollColor;}
if(!currentEnabled)b.enabled=false;}}
this.addAt=function(items,index,addStyle){if(zot(index))index=buttons.length;index=zim.constrain(index,0,buttons.length);if(!Array.isArray(items))items=[items];makeDataObject(items);makeLabels(items,addStyle);var result=makeButtons(items,addStyle);var buts=result[0];var labs=result[1];if(index<=myIndex)myIndex+=buts.length;var args=[index,0].concat(buts);Array.prototype.splice.apply(buttons,args);args=[index,0].concat(labs);Array.prototype.splice.apply(labels,args);prepareAllButtons();return that;};this.removeAt=function(num,index){if(buttons.length==0)return that;if(zot(num))num=1;if(zot(index))index=buttons.length-num;index=zim.constrain(index,0,buttons.length-num);if(myIndex>=index&&myIndex<=index+num)myIndex=-1;if(myIndex>index+num)myIndex-=num;for(i=index;i<index+num;i++){if(buttons[i].tabInfo){if(buttons[i].tabInfo.backgroundColor)buttons[i].backgroundColor=buttons[i].tabInfo.backgroundColor;if(buttons[i].tabInfo.color&&buttons[i].label)buttons[i].color=buttons[i].tabInfo.color;}
if(useTap)buttons[i].noTap();else buttons[i].off((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",buttons[i].zimTabEvent);buttons[i].removeFrom();}
buttons.splice(index,num);labels.splice(index,num);prepareAllButtons();return that;};that.keyEvent=function(e){if(!that.keyEnabled||!that.keyFocus||that.zimAccessibility)return;if(e.keyCode==9){var next=myIndex;if(e.shiftKey){change((--next<0)?(keyWrap?tabs.length-1:0):next);}else{change((++next>tabs.length-1)?(keyWrap?0:tabs.length-1):next);}
that.dispatchEvent("change");that.dispatchEvent("keychange");if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();e.preventDefault();}};window.addEventListener("keydown",that.keyEvent);Object.defineProperty(this,'selected',{get:function(){return buttons[myIndex];},set:function(value){if(zon)zogy("Tabs() - selected is read only - try selectedIndex");}});Object.defineProperty(this,'selectedIndex',{get:function(){return myIndex;},set:function(value){change(value);if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});this.last=function(){this.selectedIndex=this.buttons.length-1;return this;};this.first=function(){this.selectedIndex=0;return this;};Object.defineProperty(this,'tabs',{get:function(){return myIndex;},set:function(value){change(Math.min(Math.max(value,0),tabs.length-1));if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});Object.defineProperty(this,'color',{get:function(){if(that.buttons[0].tabItems)return that.buttons[0].tabItems.color;else return color;},set:function(value){color=value;if(that.buttons[0].tabInfo){for(var i=0;i<that.buttons.length;i++){if(that.buttons[i].tabInfo){that.buttons[i].tabInfo.color=value;}
if(i!=myIndex||!currentSelected)that.buttons[i].color=color;}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}}});Object.defineProperty(this,'rollColor',{get:function(){if(that.buttons[0].tabItems)return that.buttons[0].tabItems.rollColor;else return rollColor;},set:function(value){rollColor=value;if(that.buttons[0].tabInfo){for(var i=0;i<that.buttons.length;i++){if(that.buttons[i].tabInfo){that.buttons[i].tabInfo.rollColor=value;}
that.buttons[i].rollColor=rollColor;if(i!=myIndex&&that.buttons[i].rolled)that.buttons[i].color=rollColor;}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}}});Object.defineProperty(this,'selectedColor',{get:function(){if(that.buttons[0].tabItems)return that.buttons[0].tabItems.selectedColor;else return selectedColor;},set:function(value){selectedColor=value;if(that.buttons[0].tabInfo){for(var i=0;i<that.buttons.length;i++){if(that.buttons[i].tabInfo){that.buttons[i].tabInfo.selectedColor=value;}
if((i==myIndex&&currentSelected))that.buttons[i].color=selectedColor;}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}}});Object.defineProperty(this,'selectedRollColor',{get:function(){if(that.buttons[0].tabItems)return that.buttons[0].tabItems.selectedRollColor;else return selectedRollColor;},set:function(value){selectedRollColor=value;if(that.buttons[0].tabInfo){for(var i=0;i<that.buttons.length;i++){if(that.buttons[i].tabInfo){that.buttons[i].tabInfo.selectedRollColor=value;}
if((i==myIndex&&currentSelected)&&that.buttons[i].rolled)that.buttons[i].color=selectedRollColor;}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}}});Object.defineProperty(this,'backgroundColor',{get:function(){if(that.buttons[0].tabItems)return that.buttons[0].tabItems.backgroundColor;else return backgroundColor;},set:function(value){backgroundColor=value;if(that.buttons[0].tabInfo){for(var i=0;i<that.buttons.length;i++){if(that.buttons[i].tabInfo){that.buttons[i].tabInfo.backgroundColor=value;}
if(i!=myIndex||!currentSelected)that.buttons[i].backgroundColor=backgroundColor;}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}}});Object.defineProperty(this,'rollBackgroundColor',{get:function(){if(that.buttons[0].tabItems)return that.buttons[0].tabItems.rollBackgroundColor;else return rollBackgroundColor;},set:function(value){rollBackgroundColor=value;if(that.buttons[0].tabInfo){for(var i=0;i<that.buttons.length;i++){if(that.buttons[i].tabInfo){that.buttons[i].tabInfo.rollBackgroundColor=value;}
that.buttons[i].rollBackgroundColor=rollBackgroundColor;if(i!=myIndex&&that.buttons[i].rolled)that.buttons[i].backgroundColor=rollBackgroundColor;}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}}});Object.defineProperty(this,'selectedBackgroundColor',{get:function(){if(that.buttons[0].tabItems)return that.buttons[0].tabItems.selectedBackgroundColor;else return selectedBackgroundColor;},set:function(value){selectedBackgroundColor=value;if(that.buttons[0].tabInfo){for(var i=0;i<that.buttons.length;i++){if(that.buttons[i].tabInfo){that.buttons[i].tabInfo.selectedBackgroundColor=value;}
if((i==myIndex&&currentSelected))that.buttons[i].backgroundColor=selectedBackgroundColor;}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}}});Object.defineProperty(this,'selectedRollBackgroundColor',{get:function(){if(that.buttons[0].tabItems)return that.buttons[0].tabItems.selectedRollBackgroundColor;else return selectedRollBackgroundColor;},set:function(value){selectedRollBackgroundColor=value;if(that.buttons[0].tabInfo){for(var i=0;i<that.buttons.length;i++){if(that.buttons[i].tabInfo){that.buttons[i].tabInfo.selectedRollBackgroundColor=value;}
if((i==myIndex&&currentSelected)&&that.buttons[i].rolled)that.buttons[i].backgroundColor=selectedRollBackgroundColor;}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}}});Object.defineProperty(this,'label',{get:function(){return labels[myIndex];},set:function(value){if(zon)zogy("Tabs() - selected is read only - try selectedIndex");}});Object.defineProperty(this,'text',{get:function(){return(labels[myIndex]!=null)?labels[myIndex].text:undefined;},set:function(value){if(zon)zogy("Tabs() - selected is read only - try selectedIndex");}});Object.defineProperty(this,'buttons',{get:function(){return buttons;},set:function(value){if(zon)zogy("Tabs() - buttons is read only");}});Object.defineProperty(this,'labels',{get:function(){return labels;},set:function(value){if(zon)zogy("Tabs() - labels is read only");}});this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){zenable(that,value);}});if(typeof KEYFOCUS!==typeof undefined)zim.KEYFOCUS=KEYFOCUS;Object.defineProperty(this,'keyFocus',{get:function(){return zim.KEYFOCUS==that;},set:function(value){zim.KEYFOCUS=that;}});if(keyEnabled&&zim.KEYFOCUS)setFocus();this.on("mousedown",function(){if(keyEnabled)setFocus();});function setFocus(){that.keyFocus=true;var d=document.activeElement;if(d)d.blur();}
var bou=that.getBounds();if(zot(bou)||bou.width==0)that.setBounds(0,0,width,height);else that.width=width;if(zot(selectedIndex))selectedIndex=DS.selectedIndex!=null?DS.selectedIndex:0;that.selectedIndex=selectedIndex;if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){var tabsCopy=zim.copy(tabs,true);for(var i=0;i<tabsCopy.length;i++){tabsCopy[i].label=tabsCopy[i].label.clone();}
return that.cloneProps(new zim.Tabs(width,height,tabsCopy,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,color,rollColor,selectedColor,selectedRollColor,vertical,spacing,currentEnabled,currentSelected,corner,base,keyEnabled,gradient,gloss,backing,rollBacking,wait,waitTime,waitBackgroundColor,rollWaitBackgroundColor,waitColor,rollWaitColor,waitModal,waitEnabled,backdropColor,align,valign,labelAlign,labelValign,labelIndent,labelIndentHorizontal,labelIndentVertical,indent,useTap,excludeCustomTap,selectedIndex,styleLabels,keyWrap,style,this.group,inherit));};this.doDispose=function(a,b,disposing){if(that.keyEvent)window.removeEventListener("keydown",that.keyEvent);zim.loop(that.buttons,function(b){b.dispose();});that.keyEvent=null;if(!disposing)this.zimContainer_dispose(true);currentSelected=t=selected=tabs=labels=label=button=buttons=result=null;};};zim.extend(zim.Tabs,zim.Container,["clone","dispose"],"zimContainer",false);zim.Tabs.prototype.dispose=function(disposing){return this.doDispose(null,null,disposing);};zim.Pad=function(width,cols,rows,keys,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,color,rollColor,selectedColor,selectedRollColor,spacing,currentEnabled,corner,labelColor,gradient,gloss,backing,rollBacking,wait,waitTime,waitBackgroundColor,rollWaitBackgroundColor,waitColor,rollWaitColor,waitModal,waitEnabled,selectedIndex,style,group,inherit){var sig="width, cols, rows, keys, backgroundColor, rollBackgroundColor, selectedBackgroundColor, selectedRollBackgroundColor, color, rollColor, selectedColor, selectedRollColor, spacing, currentEnabled, corner, labelColor, gradient, gloss, backing, rollBacking, wait, waitTime, waitBackgroundColor, rollWaitBackgroundColor, waitColor, rollWaitColor, waitModal, waitEnabled, selectedIndex, style, group, inherit";var duo;if(duo=zob(zim.Pad,arguments,sig,this))return duo;z_d("66");this.zimContainer_constructor(null,null,null,null,false);this.type="Pad";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:150;if(zot(cols))cols=DS.cols!=null?DS.cols:3;if(zot(rows))rows=DS.rows!=null?DS.rows:cols;if(zot(keys)){if(DS.keys!=null){keys=DS.keys;}
else{keys=[];for(var i=1;i<=rows*cols;i++){keys.push(i);}}}
if(zot(currentEnabled))currentEnabled=DS.currentEnabled!=null?DS.currentEnabled:true;if(zot(spacing))spacing=DS.spacing!=null?DS.spacing:1;var that=this;var myIndex;this.cols=cols;this.rows=rows;var height=width/cols-spacing;var rowTabs=[];var count=0;var r;this.labels=[];this.buttons=[];for(var i=0;i<rows;i++){var rowKeys=[];for(var j=0;j<cols;j++){rowKeys.push((keys[count]!=null)?keys[count]:"");count++;}
var corn=DS.corner!=null?DS.corner:corner;if(corn&&!Array.isArray(corn))corn=[corn,corn,corn,corn];r=rowTabs[i]=new zim.Tabs({width:width,height:height,tabs:rowKeys,backgroundColor:DS.backgroundColor!=null?DS.backgroundColor:backgroundColor,rollBackgroundColor:DS.rollBackgroundColor!=null?DS.rollBackgroundColor:rollBackgroundColor,selectedBackgroundColor:DS.selectedBackgroundColor!=null?DS.selectedBackgroundColor:selectedBackgroundColor,color:DS.color!=null?DS.color:color,rollColor:DS.rollColor!=null?DS.rollColor:rollColor,selectedColor:DS.selectedColor!=null?DS.selectedColor:selectedColor,spacing:DS.spacing!=null?DS.spacing:spacing,currentEnabled:DS.currentEnabled!=null?DS.currentEnabled:currentEnabled,corner:corn,backing:DS.backing!=null?DS.backing.clone():backing,rollBacking:DS.rollBacking!=null?DS.rollBacking.clone():rollBacking,base:null,keyEnabled:false,gradient:DS.gradient!=null?DS.gradient:gradient,gloss:DS.gloss!=null?DS.gloss:gloss,wait:DS.wait!=null?DS.wait:wait,waitTime:DS.waitTime!=null?DS.waitTime:waitTime,waitBackgroundColor:DS.waitBackgroundColor!=null?DS.waitBackgroundColor:waitBackgroundColor,rollWaitBackgroundColor:DS.rollWaitBackgroundColor!=null?DS.rollWaitBackgroundColor:rollWaitBackgroundColor,waitColor:DS.waitColor!=null?DS.waitColor:waitColor,rollWaitColor:DS.rollWaitColor!=null?DS.rollWaitColor:rollWaitColor,waitModal:DS.waitModal!=null?DS.waitModal:waitModal,waitEnabled:DS.waitEnabled!=null?DS.waitEnabled:waitEnabled,group:group,style:false});this.labels=this.labels.concat(r.labels);this.buttons=this.buttons.concat(r.buttons);this.addChild(r);r.selectedIndex=-1;r.y=(height+spacing)*i;r.znum=i;r.on("change",pressKey);}
this.tabs=rowTabs;function pressKey(e){var r=e.target;that.selected=r.selected;that.text=r.text;that.label=r.label;var s=r.selectedIndex;for(var i=0;i<rowTabs.length;i++){rowTabs[i].selectedIndex=-1;}
r.selectedIndex=s;myIndex=r.znum*cols+s;that.dispatchEvent("change");if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}
Object.defineProperty(this,'selectedIndex',{get:function(){return myIndex;},set:function(value){myIndex=value;for(var i=0;i<rowTabs.length;i++){rowTabs[i].selectedIndex=-1;}
var tabNum=Math.floor(myIndex/cols);if(tabNum>=0&&tabNum<that.tabs.length){that.tabs[tabNum].selectedIndex=myIndex%cols;}}});this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){zenable(that,value);}});if(zot(selectedIndex))selectedIndex=DS.selectedIndex!=null?DS.selectedIndex:0;that.selectedIndex=selectedIndex;if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Pad(width,cols,rows,keys,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,color,rollColor,selectedColor,selectedRollColor,spacing,currentEnabled,corner,labelColor,gradient,gloss,backing,rollBacking,wait,waitTime,waitBackgroundColor,rollWaitBackgroundColor,waitColor,rollWaitColor,waitModal,waitEnabled,selectedIndex,style,this.group,inherit));};this.dispose=function(a,b,disposing){zim.loop(rowTabs,function(t){t.dispose();});this.labels=this.buttons=tabs=this.tabs=null;r=rowTabs=that.rowTabs=null;if(!disposing)this.zimContainer_dispose(true);};};zim.extend(zim.Pad,zim.Container,["clone","dispose"],"zimContainer",false);zim.DPad=function(axis,width,backgroundColor,borderWidth,borderColor,indicatorColor,indicatorPressColor,indicatorScale,indicatorRadius,innerCircle,innerScale,activeRadius,clamp,logo,style,group,inherit){var sig="axis, width, backgroundColor, borderWidth, borderColor, indicatorColor, indicatorPressColor, indicatorScale, indicatorRadius, innerCircle, innerScale, activeRadius, clamp, logo, style, group, inherit";var duo;if(duo=zob(zim.DPad,arguments,sig,this))return duo;z_d("66.2");this.zimContainer_constructor(null,null,null,null,false);this.type="DPad";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(axis))axis=DS.axis!=null?DS.axis:"all";if(zot(width))width=DS.width!=null?DS.width:100;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#666666";if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:null;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(indicatorColor))indicatorColor=DS.indicatorColor!=null?DS.indicatorColor:"#dddddd";if(zot(indicatorPressColor))indicatorPressColor=DS.indicatorPressColor!=null?DS.indicatorPressColor:"#eeeeee";if(zot(indicatorScale))indicatorScale=DS.indicatorScale!=null?DS.indicatorScale:1;if(zot(indicatorRadius))indicatorRadius=DS.indicatorRadius!=null?DS.indicatorRadius:null;if(zot(innerCircle))innerCircle=DS.innerCircle!=null?DS.innerCircle:true;if(zot(innerScale))innerScale=DS.innerScale!=null?DS.innerScale:.5;if(zot(activeRadius))activeRadius=DS.activeRadius!=null?DS.activeRadius:width;if(zot(clamp))clamp=DS.clamp!=null?DS.clamp:true;if(zot(logo))logo=DS.logo!=null?DS.logo:false;var that=this;this.axis=axis;var outer=this.outer=new zim.Circle(width/2,backgroundColor,borderColor,borderWidth).addTo(this);var inner=this.inner=new zim.Circle(width*innerScale/2,"rgba(0,0,0,.2)").center(this);if(logo)this.logo=new zim.Label({text:"D",bold:true}).center(inner).mov(1,2).alp(.3);var arrows=new zim.Container().addTo(this);var arrowSize=(width-borderWidth)*.2*indicatorScale;var numArrows=8;if(axis=="vertical"){numArrows=2;}else if(axis=="horizontal"){numArrows=2;arrows.rotation=90;}else if(axis=="both"){numArrows=4;}
zim.loop(numArrows,function(i,total){new zim.Triangle(arrowSize,arrowSize,arrowSize,indicatorColor).addTo(arrows).reg(null,zot(indicatorRadius)?(width-borderWidth)*.475:indicatorRadius).rot(i*360/total);});var startX=0;var startY=0;var stage;var p;var currentEvent;var firstTime=true;this.on("mousedown",function(e){stage=e.target.stage;currentEvent=e;arrows.loop(function(arrow){arrow.color=indicatorPressColor;});if(firstTime){that.ticker=zim.Ticker.add(function(){calculatePos();});}else{zim.Ticker.add(that.ticker);}});this.on("pressmove",function(e){currentEvent=e;});this.on("pressup",function(e){zim.Ticker.remove(that.ticker);that.dirX=that.dirY=0;arrows.loop(function(arrow){arrow.color=indicatorColor;});if(that.stage)that.stage.update();});function calculatePos(){var e=currentEvent;startX=e.stageX/zim.scaX;startY=e.stageY/zim.scaY;p=that.globalToLocal(startX,startY);e=new createjs.Event("change");e.dirX=((p.x+activeRadius)/(activeRadius*2)-.5)*2;e.dirY=((p.y+activeRadius)/(activeRadius*2)-.5)*2;if(clamp){e.dirX=zim.constrain(e.dirX,-1,1);e.dirY=zim.constrain(e.dirY,-1,1);}
that.dirX=e.dirX;that.dirY=e.dirY;that.dispatchEvent(e);}
this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){zenable(that,value);}});zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.DPad(axis,width,backgroundColor,borderWidth,borderColor,indicatorColor,indicatorPressColor,indicatorScale,indicatorRadius,innerCircle,innerScale,activeRadius,clamp,logo,style,this.group,inherit));};this.dispose=function(a,b,disposing){if(this.ticker)zim.Ticker.remove(this.ticker);if(!disposing)this.zimContainer_dispose(true);return true;};};zim.extend(zim.DPad,zim.Container,["clone","dispose"],"zimContainer",false);zim.Radial=function(labels,size,font,height,coreRadius,coreColor,startAngle,totalAngle,angles,flip,shiftRadial,icons,rollIcons,rotateIcons,iconsShiftRadial,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,backdropColor,color,rollColor,selectedColor,selectedRollColor,borderColor,borderWidth,gradient,gap,gapAsAngle,spacing,spacingInner,spacingOuter,currentEnabled,currentSelected,selectedIndex,style,group,inherit){var sig="labels, size, font, height, coreRadius, coreColor, startAngle, totalAngle, angles, flip, shiftRadial, icons, rollIcons, rotateIcons, iconsShiftRadial, backgroundColor, rollBackgroundColor, selectedBackgroundColor, selectedRollBackgroundColor, backdropColor, color, rollColor, selectedColor, selectedRollColor, borderColor, borderWidth, gradient, gap, gapAsAngle, spacing, spacingInner, spacingOuter, currentEnabled, currentSelected, selectedIndex, style, group, inherit";var duo;if(duo=zob(zim.Radial,arguments,sig,this))return duo;z_d("66.4");this.zimContainer_constructor(null,null,null,null,false);this.type="Radial";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(labels))labels=DS.labels!=null?DS.labels:["A","B","C","D","E"];if(zot(size))size=DS.size!=null?DS.size:30;if(zot(font))font=DS.font!=null?DS.font:"verdana";if(zot(startAngle))startAngle=DS.startAngle!=null?DS.startAngle:null;if(zot(totalAngle))totalAngle=DS.totalAngle!=null?DS.totalAngle:360;if(zot(angles))angles=DS.angles!=null?DS.angles:null;if(zot(flip))flip=DS.flip!=null?DS.flip:true;if(zot(shiftRadial))shiftRadial=DS.shiftRadial!=null?DS.shiftRadial:0;if(zot(icons))icons=DS.icons!=null?DS.icons:null;if(zot(rollIcons))rollIcons=DS.rollIcons!=null?DS.rollIcons:null;if(zot(rotateIcons))rotateIcons=DS.rotateIcons!=null?DS.rotateIcons:false;if(zot(iconsShiftRadial))iconsShiftRadial=DS.iconsShiftRadial!=null?DS.iconsShiftRadial:0;if(zot(height))height=DS.height!=null?DS.height:60;if(zot(coreRadius))coreRadius=DS.coreRadius!=null?DS.coreRadius:100;if(zot(coreColor))coreColor=DS.coreColor!=null?DS.coreColor:"#333";if(zot(backdropColor))backdropColor=DS.backdropColor!=null?DS.backdropColor:zim.clear;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#666";if(zot(rollBackgroundColor))rollBackgroundColor=DS.rollBackgroundColor!=null?DS.rollBackgroundColor:"#777";if(zot(selectedBackgroundColor))selectedBackgroundColor=DS.selectedBackgroundColor!=null?DS.selectedBackgroundColor:"#444";if(zot(selectedRollBackgroundColor))selectedRollBackgroundColor=DS.selectedRollBackgroundColor!=null?DS.selectedRollBackgroundColor:selectedBackgroundColor;if(zot(color))color=DS.color!=null?DS.color:"white";if(zot(rollColor))rollColor=DS.rollColor!=null?DS.rollColor:color;if(zot(selectedColor))selectedColor=DS.selectedColor!=null?DS.selectedColor:color;if(zot(selectedRollColor))selectedRollColor=DS.selectedRollColor!=null?DS.selectedRollColor:rollColor;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:"#333";if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:2;if(zot(gapAsAngle))gapAsAngle=DS.gapAsAngle!=null?DS.gapAsAngle:false;if(zot(gap))gap=DS.gap!=null?DS.gap:(gapAsAngle?3:6);if(zot(gradient))gradient=DS.gradient!=null?DS.gradient:null;if(gradient===true)gradient=.1;if(zot(spacing))spacing=DS.spacing!=null?DS.spacing:6;if(zot(spacingInner))spacingInner=DS.spacingInner!=null?DS.spacingInner:spacing;if(zot(spacingOuter))spacingOuter=DS.spacingOuter!=null?DS.spacingOuter:spacing;if(zot(currentEnabled))currentEnabled=DS.currentEnabled!=null?DS.currentEnabled:false;if(zot(currentSelected))currentSelected=DS.currentSelected!=null?DS.currentSelected:true;var that=this;var innerRadius=this.innerRadius=coreRadius+spacingInner;var outerRadius=this.outerRadius=innerRadius+height;this.setBounds(-outerRadius,-outerRadius,outerRadius*2,outerRadius*2);var backdrop=this.backdrop=new zim.Circle(outerRadius+spacingOuter,backdropColor).center(this);if(coreRadius>0)this.core=new zim.Circle(coreRadius,coreColor).center(this);if(angles&&angles.length<labels.length-1){if(zon)zogy("Radial() - not enough angles provided");return this;}
if((labels&&labels.length>0)||(icons&&icons.length>0)){var total;if(labels&&labels.length>0)total=labels.length;if(icons&&icons.length>0){if(total>0)total=Math.min(icons.length,total);else total=icons.length;}
if(rollIcons&&rollIcons.length<total){for(var j=0;j<total-rollIcons.length;j++){rollIcons.push(new zim.Circle(1,zim.clear));}}
var s=backdrop.width;var buttons=this.buttons=new zim.Container(-s/2,-s/2,s,s).centerReg(this);var gapInner=gap;if(!gapAsAngle){gap=gap/outerRadius*180/Math.PI;gapInner=gapInner/innerRadius*180/Math.PI;}
var segmentAngle=(totalAngle-gap*total+(totalAngle==360?0:gap))/total;var lastAngle=startAngle?startAngle:0;for(var i=0;i<total;i++){if(angles)segmentAngle=angles[i];var button=new zim.Shape(-s/2,-s/2,s,s).centerReg(buttons);button.num=i;button.zimSelected=false;button.angle=segmentAngle;var g=button.graphics;button.backgroundColor=zim.Pick.choose(backgroundColor);button.rollBackgroundColor=zim.Pick.choose(rollBackgroundColor);button.selectedBackgroundColor=zim.Pick.choose(selectedBackgroundColor);button.selectedRollBackgroundColor=zim.Pick.choose(selectedRollBackgroundColor);button.color=zim.Pick.choose(color);button.rollColor=zim.Pick.choose(rollColor);button.selectedColor=zim.Pick.choose(selectedColor);button.selectedRollColor=zim.Pick.choose(selectedRollColor);button.colorCommand=g.f(button.backgroundColor).command;if(zot(borderWidth)||borderWidth>0){if(!zot(borderColor)||!zot(borderWidth)){if(zot(borderColor))borderColor="black";button.borderColorCommand=g.s(borderColor).command;button.borderWidthCommand=g.ss(borderWidth).command;}}
var a0=(lastAngle-90-segmentAngle/2)*Math.PI/180;var a1=(lastAngle-90+segmentAngle/2)*Math.PI/180;var a2=(lastAngle-90+(segmentAngle+gap-gapInner)/2)*Math.PI/180;var a3=(lastAngle-90-(segmentAngle+gap-gapInner)/2)*Math.PI/180;g.arc(0,0,outerRadius,a0,a1,false);g.arc(0,0,innerRadius,a2,a3,true).cp();if(gradient){g.s().ss().rf(["rgba(0,0,0,"+gradient+")","rgba(255,255,255,"+gradient+")"],[0,1],0,0,innerRadius,0,0,outerRadius);g.arc(0,0,outerRadius,a0,a1,false);g.arc(0,0,innerRadius,a2,a3,true).cp();}
button.cursor="pointer";button.zimOverEvent=button.on("mouseover",function(e){var button=e.target;button.colorCommand.style=(button==that.selected&&currentSelected)?button.selectedRollBackgroundColor:button.rollBackgroundColor;if(button.label)button.label.color=(button==that.selected&&currentSelected)?button.selectedRollColor:button.rollColor;if(rollIcons){button.holder.removeAllChildren();rollIcons[button.num].loc(1,0,button.holder);}
if(that.stage)that.stage.update();});button.zimOutEvent=button.on("mouseout",function(e){var button=e.target;button.colorCommand.style=(button==that.selected&&currentSelected)?button.selectedBackgroundColor:button.backgroundColor;if(button.label)button.label.color=(button==that.selected&&currentSelected)?button.selectedColor:button.color;if(rollIcons){button.holder.removeAllChildren();if(icons)icons[button.num].loc(1,0,button.holder);}
if(that.stage)that.stage.update();});button.zimDownEvent=button.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",function(e){var button=e.target;var diff=button!==that.selected;that.lastSelected=that.selected;myIndex=button.num;if(currentSelected){if(diff){if(that.selected){that.selected.colorCommand.style=that.selected.backgroundColor;if(that.selected.label)that.selected.label.color=that.selected.color;}
that.selected=button;that.label=button.label;if(that.label)that.text=that.label.text;that.icon=button.icon;button.colorCommand.style=button.selectedRollBackgroundColor;if(button.label)button.label.color=button.selectedRollColor;}else{if(!currentEnabled){myIndex=-1;that.selected=null;that.label=null;that.text=null;that.icon=null;button.colorCommand.style=button.rollBackgroundColor;if(button.label)button.label.color=button.rollColor;}}}else{that.selected=button;that.label=button.label;if(that.label)that.text=that.label.text;that.icon=button.icon;}
that.dispatchEvent("change");if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();});if(icons&&icons.length>0){var h=innerRadius+height/2+iconsShiftRadial;var holder=button.holder=new zim.Container(3,h).addTo(this).reg(1,h).rot(lastAngle);holder.mouseChildren=false;holder.mouseEnabled=false;button.icon=icons[i];icons[i].loc(1,0,holder);if(!rotateIcons)icons[i].rotation=-lastAngle;}
if(labels&&labels.length>0){var loa;if(labels[i].type!="LabelOnArc"){var label=(labels[i].type=="Label"?labels[i]:new zim.Label({text:labels[i],size:size,font:font,color:color,style:style,inherit:inherit}));loa=new zim.LabelOnArc({label:label,color:color,size:size,spacing:-5,flip:(flip&&lastAngle>90&&lastAngle<270),radius:innerRadius+(height-label.height)/2+2+shiftRadial,style:style,inherit:inherit});}else{loa=labels[i];}
labels[i]=loa;button.label=loa;loa.center(this).rot(lastAngle);loa.mouseChildren=false;loa.mouseEnabled=false;}
if(i==labels.length-1)continue;var segmentAngle2=angles?angles[i+1]:segmentAngle;lastAngle+=(segmentAngle+segmentAngle2)/2+gap;}
if(!zot(startAngle)){that.rotation+=that.buttons.getChildAt(0).angle/2;}}
var myIndex=null;Object.defineProperty(this,'selectedIndex',{get:function(){return myIndex;},set:function(value){var button;if(that.buttons)button=that.buttons.getChildAt(value);if(button!==that.selected){if(that.selected){that.selected.colorCommand.style=that.selected.backgroundColor;if(that.selected.label)that.selected.label.color=that.selected.color;}
that.selected=button;if(button){if(currentSelected)button.colorCommand.style=button.selectedRollBackgroundColor;if(button.label){if(currentSelected)button.label.color=button.selectedColor;that.text=button.label.text;}}}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});if(zot(selectedIndex))selectedIndex=DS.selectedIndex!=null?DS.selectedIndex:0;that.selectedIndex=selectedIndex;zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Radial(labels,size,font,height,coreRadius,coreColor,startAngle,totalAngle,angles,flip,shiftRadial,icons,rollIcons,rotateIcons,iconsShiftRadial,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,backdropColor,color,rollColor,selectedColor,selectedRollColor,borderColor,borderWidth,gradient,gap,gapAsAngle,spacing,spacingInner,spacingOuter,currentEnabled,currentSelected,selectedIndex,style,this.group,inherit));};};zim.extend(zim.Radial,zim.Container,"clone","zimContainer",false);zim.RadialMenu=function(menu,size,font,height,coreRadius,coreColor,title,titleIcon,startAngle,totalAngle,flip,shiftRadial,rotateIcons,iconsShiftRadial,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,backdropColor,color,rollColor,selectedColor,selectedRollColor,borderColor,borderWidth,gradient,gap,gapAsAngle,spacing,spacingInner,spacingOuter,currentEnabled,currentSelected,open,under,style,group,inherit){var sig="menu, size, font, height, coreRadius, coreColor, title, titleIcon, startAngle, totalAngle, flip, shiftRadial, rotateIcons, iconsShiftRadial, backgroundColor, rollBackgroundColor, selectedBackgroundColor, selectedRollBackgroundColor, backdropColor, color, rollColor, selectedColor, selectedRollColor, borderColor, borderWidth, gradient, gap, gapAsAngle, spacing, spacingInner, spacingOuter, currentEnabled, currentSelected, open, under, style, group, inherit";var sigList=sig.split(", ");var duoTest=false;if(menu&&menu.constructor==={}.constructor){for(var i in menu){if(sigList.indexOf(i)>=0){duoTest=true;break;}}}
if(menu&&duoTest){var duo;if(duo=zob(zim.RadialMenu,arguments,sig,this))return duo;}
z_d("66.6");this.zimContainer_constructor(null,null,null,null,false);this.type="RadialMenu";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(menu))menu=DS.menu!=null?DS.menu:{A:{A1:["AA1","AA2","AA3","AA4"],A2:[],A3:[]},B:["B1","B2","B3","B4","B5","B6"],C:[]};if(zot(size))size=DS.size!=null?DS.size:30;if(zot(font))font=DS.font!=null?DS.font:"verdana";if(zot(startAngle))startAngle=DS.startAngle!=null?DS.startAngle:null;if(zot(totalAngle))totalAngle=DS.totalAngle!=null?DS.totalAngle:360;if(zot(flip))flip=DS.flip!=null?DS.flip:true;if(zot(rotateIcons))rotateIcons=DS.rotateIcons!=null?DS.rotateIcons:false;if(zot(shiftRadial))shiftRadial=DS.shiftRadial!=null?DS.shiftRadial:0;if(zot(iconsShiftRadial))iconsShiftRadial=DS.iconsShiftRadial!=null?DS.iconsShiftRadial:0;if(zot(height))height=DS.height!=null?DS.height:60;if(zot(coreRadius))coreRadius=DS.coreRadius!=null?DS.coreRadius:100;if(zot(coreColor))coreColor=DS.coreColor!=null?DS.coreColor:"#333";if(zot(title))title=DS.title!=null?DS.title:"MENU";if(zot(titleIcon))titleIcon=DS.titleIcon!=null?DS.titleIcon:null;if(zot(backdropColor))backdropColor=DS.backdropColor!=null?DS.backdropColor:zim.clear;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#666";if(zot(rollBackgroundColor))rollBackgroundColor=DS.rollBackgroundColor!=null?DS.rollBackgroundColor:"#777";if(zot(selectedBackgroundColor))selectedBackgroundColor=DS.selectedBackgroundColor!=null?DS.selectedBackgroundColor:"#444";if(zot(selectedRollBackgroundColor))selectedRollBackgroundColor=DS.selectedRollBackgroundColor!=null?DS.selectedRollBackgroundColor:selectedBackgroundColor;if(zot(color))color=DS.color!=null?DS.color:"white";if(zot(rollColor))rollColor=DS.rollColor!=null?DS.rollColor:color;if(zot(selectedColor))selectedColor=DS.selectedColor!=null?DS.selectedColor:color;if(zot(selectedRollColor))selectedRollColor=DS.selectedRollColor!=null?DS.selectedRollColor:rollColor;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:"#333";if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:2;if(zot(gapAsAngle))gapAsAngle=DS.gapAsAngle!=null?DS.gapAsAngle:false;if(zot(gap))gap=DS.gap!=null?DS.gap:(gapAsAngle?3:6);if(zot(spacing))spacing=DS.spacing!=null?DS.spacing:6;if(zot(gradient))gradient=DS.gradient!=null?DS.gradient:null;if(gradient===true)gradient=.1;if(zot(spacingInner))spacingInner=DS.spacingInner!=null?DS.spacingInner:spacing;if(zot(spacingOuter))spacingOuter=DS.spacingOuter!=null?DS.spacingOuter:spacing;if(zot(currentEnabled))currentEnabled=DS.currentEnabled!=null?DS.currentEnabled:false;if(zot(currentSelected))currentSelected=DS.currentSelected!=null?DS.currentSelected:true;if(zot(open))open=DS.open!=null?DS.open:false;if(zot(under))under=DS.under!=null?DS.under:true;var that=this;var eventType=(!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click";var lastSelected=null;var core=this.core=new zim.Circle({radius:coreRadius,color:coreColor,style:style,inherit:inherit}).addTo(this);if(titleIcon)this.titleIcon=titleIcon.center(core);if(title)this.title=new zim.Label({text:title,size:size,font:font,color:color,style:style,inherit:inherit}).center(core);core.cursor="pointer";core.on(eventType,function(e){that.leafNode=false;if(radials.length==0){changeRadial();}else{zim.loop(radials,function(radial){radial.selectedIndex=-1;radial.removeFrom();radials=[];});that.outerLevel=0;that.selected=that.outerMenu=that.selectedMenu=that.text=null;}
if(currentEnabled||that.selected!=lastSelected)that.dispatchEvent("change");lastSelected=that.selected;if(that.stage)that.stage.update();});this.closeRings=function(num){if(zot(num))num=that.outerLevel;var lev=that.outerLevel-num;zim.loop(radials,function(radial,i){if(i>lev-1){radial.removeFrom();radial.selectedIndex=-1;radials.pop();}},true);that.outerLevel=lev;that.outerMenu=radials[radials.length-1];if(that.outerMenu)that.outerMenu.selectedIndex=-1;that.selected=that.selectedMenu=that.text=null;if(radials[radials.length-2]){that.selectedMenu=radials[radials.length-2];that.selectedIndex=that.selectedMenu.selectedIndex;}
else that.selectedIndex=-1;if(that.selected!=lastSelected)that.dispatchEvent("change");lastSelected=that.selected;if(that.stage)that.stage.update();};var menus={};var tree;var ids;that.outerLevel=0;if(menu.constructor=={}.constructor){menu={core:menu};tree=that.tree=new zim.Hierarchy(menu);ids=tree.getLinearIDs();}
that.lastRadial=null;var radials=this.radials=[];if(open){changeRadial();}
function changeRadial(currentRadial){var level,radius;if(!currentRadial){level=0;radius=coreRadius;}else{level=currentRadial.ringLevel;}
zim.loop(radials,function(radial,i){if(i>level-1){radial.removeFrom();radial.selectedIndex=-1;radials.pop();}},true);var currentButton;if(currentRadial)currentButton=currentRadial.selected;if(currentButton){var id=currentButton.id;radius=currentRadial.outerRadius;makeRadial(id,level+1,radius);}else if(!currentRadial){makeRadial("id0",level+1,radius);}
that.selected=currentButton;if(that.selected){that.selectedMenu=radials[that.selected.menu.ringLevel-1];that.selectedIndex=that.selected.num;if(that.selected.label)that.text=that.selected.label.text;else that.text=null;}else{if(currentEnabled&&currentRadial){that.selectedIndex=currentRadial.selectedIndex;that.label=currentRadial.label;that.text=currentRadial.text;that.icon=currentRadial.icon;that.selectedMenu=currentRadial;}else{that.text=null;that.selectedIndex=-1;that.selectedMenu=null;}}
if(that.stage)that.stage.update();}
function makeRadial(id,level,radius){if(level)that.outerLevel=level;var currentMenu;if(!menus[id]){var data=tree.getData(id);var list=data.list;if(list&&!zim.isEmpty(list)){var props={labels:tree.getLinearList(list),coreRadius:radius,size:size,font:font,startAngle:startAngle,totalAngle:totalAngle,flip:flip,rotateIcons:rotateIcons,shiftRadial:shiftRadial,iconsShiftRadial:iconsShiftRadial,height:height,coreColor:zim.clear,backdropColor:backdropColor,backgroundColor:backgroundColor,rollBackgroundColor:rollBackgroundColor,selectedBackgroundColor:selectedBackgroundColor,selectedRollBackgroundColor:selectedRollBackgroundColor,color:color,rollColor:rollColor,selectedColor:selectedColor,selectedRollColor:selectedRollColor,borderColor:borderColor,borderWidth:borderWidth,gapAsAngle:gapAsAngle,gap:gap,gradient:gradient,spacingInner:spacingInner,spacingOuter:spacingOuter,currentSelected:currentSelected,currentEnabled:currentEnabled,style:style,inherit:inherit};var obj=tree;if(data.styles){props=zim.merge(props,data.styles);}
currentMenu=menus[id]=new zim.Radial(props);ids=tree.getLinearIDs(list);currentMenu.buttons.loop(function(button,i){button.menu=currentMenu;button.id=ids[i];});currentMenu.ringLevel=that.outerLevel;currentMenu.selectedIndex=-1;currentMenu.on("change",function(e){that.leafNode=false;changeRadial(e.target);if(currentEnabled||that.selected!=lastSelected)that.dispatchEvent("change");lastSelected=that.selected;});}}
if(menus[id]){radials.push(menus[id]);menus[id].center(that);if(under)menus[id].bot();}else{that.leafNode=true;that.outerLevel-=1;}
that.outerMenu=currentMenu;}
zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.RadialMenu(menu,size,font,height,coreRadius,coreColor,title,titleIcon,startAngle,totalAngle,flip,shiftRadial,rotateIcons,iconsShiftRadial,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,backdropColor,color,rollColor,selectedColor,selectedRollColor,borderColor,borderWidth,gradient,gap,gapAsAngle,spacing,spacingInner,spacingOuter,currentEnabled,currentSelected,open,under,style,this.group,inherit));};};zim.extend(zim.RadialMenu,zim.Container,"clone","zimContainer",false);zim.ColorPicker=function(width,colors,cols,spacing,greyPicker,alphaPicker,startBackgroundColor,draggable,shadowColor,shadowBlur,buttonBar,circles,indicator,backgroundColor,keyArrows,container,selectedIndex,selectedColor,style,group,inherit){var sig="width, colors, cols, spacing, greyPicker, alphaPicker, startBackgroundColor, draggable, shadowColor, shadowBlur, buttonBar, circles, indicator, backgroundColor, keyArrows, container, selectedIndex, selectedColor, style, group, inherit";var duo;if(duo=zob(zim.ColorPicker,arguments,sig,this))return duo;z_d("67");this.zimContainer_constructor(null,null,null,null,false);this.type="ColorPicker";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:500;if(zot(colors))colors=DS.colors!=null?DS.colors:null;if(zot(colors))standard=true;if(zot(cols))cols=DS.cols!=null?DS.cols:10;if(zot(spacing))spacing=DS.spacing!=null?DS.spacing:2;var oneRow=!standard&&colors.length>0&&colors.length<=cols;if(zot(alphaPicker))alphaPicker=DS.alphaPicker!=null?DS.alphaPicker:(oneRow?false:true);if(zot(greyPicker))greyPicker=DS.greyPicker!=null?DS.greyPicker:(oneRow?false:true);if(zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.3)";if(zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:14;if(zot(buttonBar))buttonBar=DS.buttonBar!=null?DS.buttonBar:(oneRow?false:true);if(zot(draggable)){if(buttonBar){draggable=DS.draggable!=null?DS.draggable:true;}else{draggable=DS.draggable!=null?DS.draggable:false;}}
if(zot(circles))circles=DS.circles!=null?DS.circles:false;if(zot(indicator)){indicator=DS.indicator!=null?DS.indicator:false;if(!buttonBar)indicator=DS.indicator!=null?DS.indicator:true;}
if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"black";if(zot(startBackgroundColor))startBackgroundColor=DS.startBackgroundColor!=null?DS.startBackgroundColor:null;if(zot(keyArrows))keyArrows=DS.keyArrows!=null?DS.keyArrows:true;var that=this;var stage;if(zot(container)){if(zdf)container=zdf.stage;else return;}else if(!container.getBounds){return;}else if(zot(container.getStage)){return;}
that.container=container;var secondLastBackgroundColor="#e472c4";var thirdLastBackgroundColor="#50c4b7";var lastAlpha=1;var myAlpha=1;var box=new createjs.Shape();this.addChild(box);box.x+=spacing;box.y+=spacing;var standard=false;var colorsTemp;var w;var greys=[];if(zot(colors)){standard=true;var num=6;var tot=num*num*num;num=Math.ceil(Math.pow(tot,1/2));w=(width-spacing)/18-spacing;var f=Math.floor(Math.pow(num*num,1/3));colorsTemp=[];for(var i=0;i<6;i++){for(var j=0;j<6;j++){for(var k=0;k<6;k++){colorsTemp.push("#"+con(i*3)+con(j*3)+con(k*3));}}}
colors=[];var c,r,nC,nR;for(i=0;i<colorsTemp.length;i++){c=Math.floor(i/6);r=i%6;if(c>=6*3){f=1;}else{f=0;}
nC=c-f*6*3;nR=r+f*6;colors[nR*18+nC]=colorsTemp[i];}
cols=18;greys=[thirdLastBackgroundColor,secondLastBackgroundColor];}else{w=(width-spacing)/cols-spacing;}
var rows=Math.ceil(colors.length/cols);var startAlpha=1;var myColor=String(colors[colors.length-1]);if(!zot(startBackgroundColor)){var matches=startBackgroundColor.match(/rgba\((.*)\)/);if(matches){var c=matches[1].split(",");startAlpha=c.pop();startBackgroundColor="rgb("+c.join(",")+")";}
myColor=String(startBackgroundColor);}
var lastBackgroundColor;if(standard)lastBackgroundColor=thirdLastBackgroundColor;function con(n){n=Math.floor(n).toString(16);return n+""+n;}
var g=box.graphics;var f=0;var color,r,c,rX,rY;var borderColor=DS.borderColor!=null?DS.borderColor:null;var borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(!zot(borderColor)&&zot(borderWidth))borderWidth=1;if(borderWidth&&zot(borderColor))borderColor="#333";if(borderWidth)g.s(borderColor).ss(borderWidth);for(i=0;i<colors.length;i++){c=i%cols;r=Math.floor(i/cols);rX=c*(w+spacing);rY=r*(w+spacing);if(circles){g.f(colors[i]).dc(rX+w/2,rY+w/2,w/2);}else{g.f(colors[i]).r(rX,rY,w,w);}}
var lastHeight=rY+w+spacing;that.colors=colors;var greyHeight=lastHeight;if(greyPicker){for(i=0;i<16;i++){greys.push("#"+con(i)+con(i)+con(i));}
for(i=0;i<greys.length;i++){c=Math.floor(i/cols);r=i%cols;rX=r*(w+spacing);rY=c*(w+spacing)+lastHeight;if(circles){g.f(greys[i]).dc(rX+w/2,rY+w/2,w/2);}else{g.f(greys[i]).r(rX,rY,w,w);}}
lastHeight=rY+w+spacing;var greyCols=cols;var greyRows=Math.ceil(greys.length/cols);}
that.greys=greys;if(indicator){indicator=this.indicator=circles?new zim.Circle(w/2*.5,null,null,null,null,null,null,null,false):new zim.Rectangle(w*.5,w*.5,null,null,null,null,null,null,false);indicator.alpha=.5;indicator.centerReg();this.addChild(indicator);indicator.mouseEnabled=false;function positionIndicator(i){if(zot(i)||i<0){indicator.visible=false;return;}else{indicator.visible=true;}
if(myColor=="#000"||myColor=="#000000"||myColor=="black"){indicator.color="#222";indicator.alpha=1;}else{indicator.color="black";indicator.alpha=.5;}
indicator.x=box.x+i%cols*(w+spacing)+w/2;indicator.y=box.x+Math.floor(i/cols)*(w+spacing)+w/2;}
positionIndicator(colors.indexOf(myColor));}
var margin=10;if(alphaPicker){var alpha=new zim.Container({style:false});alpha.setBounds(0,0,600,70);this.addChild(alpha);alpha.x=0;alpha.y=lastHeight;var alphaBacking=this.alphaBacking=new zim.Rectangle(600-margin*2,50,"#222",null,null,0,null,null,false);alpha.addChild(alphaBacking);zim.centerReg(alphaBacking,alpha);var sliderBut=this.alphaBut=new zim.Button({width:20,height:30,backgroundColor:"darkorange",rollBackgroundColor:"orange",label:"",corner:0,hitPadding:20,style:false});var slider=this.alphaSlider=new zim.Slider({min:0,max:1,step:.05,button:sliderBut,barLength:600*.55,barWidth:2,barColor:"#999",vertical:false,useTicks:false,inside:false,style:false});slider.currentValue=!zot(startAlpha)?startAlpha:1;alpha.addChild(slider);slider.x=40;slider.y=alpha.height/2;var alphaText=this.alphaText=new zim.Label({text:"Alpha: "+zim.decimals(startAlpha),size:30,color:"orange",backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",backgroundColor:"ignore",rollColor:"orange",group:this.group});alpha.addChild(alphaText);alphaText.x=slider.x+slider.bar.width+40;alphaText.y=alpha.height/2-alphaText.height/2;alpha.scaleX=alpha.scaleY=width/600;slider.on("change",function(){alphaText.text="Alpha: "+decimals(slider.currentValue);if(swatch){swatch.alpha=myAlpha=slider.currentValue;}
if(buttonBar){that.dispatchEvent("set");}else{that.dispatchEvent("change");}
if(that.stage)that.stage.update();});lastHeight+=alpha.height-margin;}
if(buttonBar){var nav=new zim.Container({style:false});nav.setBounds(0,0,600,100);this.addChild(nav);nav.x=0;nav.y=lastHeight+margin;var swatchText=this.swatchText=new zim.Label({align:"center",text:myColor.toUpperCase(),labelWidth:120,labelHeight:50,size:30,color:"orange",rollColor:"orange",backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",backgroundColor:"ignore",group:this.group});nav.addChild(swatchText);zim.centerReg(swatchText);swatchText.x=200/2-10;swatchText.y=50-2;if(draggable){var grip=this.grip=new zim.Shape({style:false});nav.addChild(grip);grip.graphics.f("rgba(256,256,256,.25)").r(0,0,5,20).r(10,0,5,20).r(20,0,5,20).r(30,0,5,20);grip.x=70;grip.y=65;swatchText.y=50-10;grip.mouseEnabled=false;}
var closeBut=this.closeBut=new zim.Button({width:90,height:90,label:"X",backgroundColor:"#222",rollBackgroundColor:"#444",corner:0,style:false});nav.addChild(closeBut);closeBut.x=600-closeBut.width-margin;closeBut.y=0;closeBut.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",function(){that.dispatchEvent("close");});var button=this.okBut=new zim.Button({width:150,height:90,label:"OK",backgroundColor:"#222",rollBackgroundColor:"#444",corner:0,style:false});nav.addChild(button);button.x=closeBut.x-button.width-margin;button.y=0;button.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",doChange);var swatchBacking=this.swatchBacking=new zim.Shape({style:false});nav.addChild(swatchBacking);var g=swatchBacking.graphics;g.f("black").r(0.5,0.5,50,89).f("#666").r(50,0.5,50,89).f("white").r(100,0.5,49.5,89);swatchBacking.x=button.x-150-margin;swatchBacking.y=0;var swatch=this.swatch=new zim.Rectangle(150,90,myColor,null,null,null,null,null,false);nav.addChild(swatch);swatch.x=swatchBacking.x;swatch.y=0;swatch.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",doChange);swatch.cursor="pointer";swatch.alpha=myAlpha=startAlpha;nav.scaleX=nav.scaleY=width/600;lastHeight+=nav.height;}else{box.cursor="pointer";}
if(!alphaPicker&&!buttonBar){lastHeight-=margin-spacing;}
var height=lastHeight+margin;this.setBounds(0,0,width,height);var background=this.background=new zim.Rectangle(width,height,backgroundColor,null,null,null,null,null,false);this.addChildAt(background,0);if(shadowColor!=-1&&shadowBlur>0)background.shadow=new createjs.Shadow(shadowColor,8,8,shadowBlur);function doChange(){if(myColor!=lastBackgroundColor||myAlpha!=lastAlpha){if(standard&&greyPicker){thirdLastBackgroundColor=secondLastBackgroundColor;secondLastBackgroundColor=lastBackgroundColor;var lastBackgroundColors=[thirdLastBackgroundColor,secondLastBackgroundColor];for(i=0;i<2;i++){var g=box.graphics;c=Math.floor(i/cols);r=i%cols;rX=r*(w+spacing);rY=c*(w+spacing)+greyHeight;greys[i]=lastBackgroundColors[i];g.f(background.color).r(rX-1,rY-1,w+2,w+2).f(lastBackgroundColors[i]).r(rX,rY,w,w);}
if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}
lastBackgroundColor=myColor;lastAlpha=myAlpha;that.dispatchEvent("change");}else{that.dispatchEvent("close");}}
if(draggable){var diffX,diffY;background.on("mousedown",function(e){stage=e.target.stage;diffX=e.stageX/zim.scaX-that.x;diffY=e.stageY/zim.scaY-that.y;background.cursor="move";});background.on("pressmove",function(e){that.x=e.stageX/zim.scaX-diffX;that.y=e.stageY/zim.scaY-diffY;if(that.stage)that.stage.update();});background.on("pressup",function(e){background.cursor="default";if(that.stage)that.stage.update();});}
var gridW=cols*(w+spacing);var gridH=rows*(w+spacing);if(greyPicker){var greyW=greyCols*(w+spacing);var greyH=greyRows*(w+spacing);}
box.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",function(e){var index=zim.hitTestGrid(box,gridW,gridH,cols,rows,e.stageX,e.stageY,0,0,spacing,spacing);if(!zot(index)){myColor=colors[index];if(buttonBar){swatch.color=myColor;swatchText.text=String(colors[index]).toUpperCase();if(myColor!=lastBackgroundColor)that.dispatchEvent("set");}else{doChange();}}
if(greyPicker){index=null;index=zim.hitTestGrid(box,greyW,greyH,greyCols,greyRows,e.stageX,e.stageY,0,gridH,spacing,spacing);if(!zot(index)){myColor=greys[index];if(buttonBar){swatch.color=myColor;swatchText.text=greys[index].toUpperCase();if(myColor!=lastBackgroundColor)that.dispatchEvent("set");}else{doChange();}}}
if(indicator)positionIndicator(colors.indexOf(myColor));if(buttonBar){if(that.stage)that.stage.update();}else if(indicator){if(that.stage)that.stage.update();}
setAccessibility();});Object.defineProperty(this,'selectedColor',{get:function(){return myColor;},set:function(value){value=value.toLowerCase();lastBackgroundColor=myColor=value;if(buttonBar){swatch.color=myColor;swatchText.text=myColor;if(that.stage)that.stage.update();}
if(indicator)positionIndicator(colors.indexOf(myColor));setAccessibility();}});Object.defineProperty(this,'currentValue',{get:function(){return myColor;},set:function(value){that.selectedColor=value;}});Object.defineProperty(this,'currentValueEvent',{get:function(){return myColor;},set:function(value){if(value!=that.selectedColor){that.selectedColor=value;that.dispatchEvent("change");}}});Object.defineProperty(this,'selectedIndex',{get:function(){return colors.indexOf(myColor);},set:function(value){lastBackgroundColor=myColor=colors[value];if(buttonBar){swatch.color=myColor;swatchText.text=myColor;if(that.stage)that.stage.update();}
if(indicator)positionIndicator(colors.indexOf(myColor));setAccessibility();}});Object.defineProperty(this,'selectedAlpha',{get:function(){if(alphaPicker){return decimals(slider.currentValue);}else{return 1;}},set:function(value){if(alphaPicker){lastAlpha=slider.currentValue=value;if(swatch)swatch.alpha=lastAlpha;if(alphaText)alphaText.text="Alpha: "+decimals(slider.currentValue);if(that.stage)that.stage.update();}}});Object.defineProperty(this,'colors',{get:function(){if(greyPicker)return colors.concat(greys);else return colors;},set:function(value){if(zon)zogy("ColorPicker() colors is read only - make a new ColorPicker to change");}});if(typeof KEYFOCUS!==typeof undefined)zim.KEYFOCUS=KEYFOCUS;Object.defineProperty(this,'keyFocus',{get:function(){return zim.KEYFOCUS==that;},set:function(value){if(zns)zim.KEYFOCUS=that;else KEYFOCUS=that;}});if(keyArrows&&zim.KEYFOCUS)setFocus();this.on("mousedown",function(){if(keyArrows)setFocus();});function setFocus(){that.keyFocus=true;var d=document.activeElement;if(d)d.blur();}
function setAccessibility(){if(that.zimAccessibility)that.zimAccessibility.changeTitle(that,null,true);}
this.keyDownEvent=function(e){if(!that.stage)return;if((that.zimAccessibility&&that.focus)||(!that.zimAccessibility&&that.keyFocus)){var currentTemp=that.selectedIndex;if(e.keyCode==37||e.keyCode==40){currentTemp--;changeMe();}else if(e.keyCode==38||e.keyCode==39){currentTemp++;changeMe();}
function changeMe(){if(currentTemp<0)currentTemp=that.colors.length-1;if(currentTemp>that.colors.length-1)currentTemp=0;that.selectedIndex=currentTemp;that.dispatchEvent("change");if(that.stage)that.stage.update();}}};window.addEventListener("keydown",this.keyDownEvent);this.hide=function(){that.removeFrom();that.toggled=false;if(that.zimAccessibility){var a=that.zimAccessibility;a.resize(that);if(accessibilityClicker)accessibilityClicker.focus();else that.zimTabTag.nextSibling.focus();setTimeout(function(){a.talk("ColorPicker has been closed.");},50);}
return that;};var accessibilityClicker;this.show=function(){that.center(that.container);if(that.zimAccessibility){var a=that.zimAccessibility;setTimeout(function(){if(a.activatedObject)accessibilityClicker=a.activatedObject.zimTabTag;},50);a.resize(that);a.tabIndex=that.zimTabIndex;}
that.toggled=true;return that;};this.toggle=function(state){if(state===true)that.show();else if(state===false)that.hide();else if(that.container.contains(that))that.hide();else that.show();return that;};function decimals(n){return Math.round(n*Math.pow(10,2))/Math.pow(10,2);}
if(zot(selectedIndex))selectedIndex=DS.selectedIndex!=null?DS.selectedIndex:0;that.selectedIndex=selectedIndex;if(zot(selectedColor))selectedColor=DS.selectedColor!=null?DS.selectedColor:null;if(selectedColor!=null)that.selectedColor=selectedColor;if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.ColorPicker(width,standard?null:colors,cols,spacing,greyPicker,alphaPicker,startBackgroundColor,draggable,shadowColor,shadowBlur,buttonBar,circles,indicator,backgroundColor,keyArrows,container,selectedIndex,selectedColor,style,this.group,inherit));};this.dispose=function(a,b,disposing){window.removeEventListener("keydown",that.keyDownEvent);if(slider)slider.dispose();if(!disposing)this.zimContainer_dispose(true);return true;};};zim.extend(zim.ColorPicker,zim.Container,["clone","dispose"],"zimContainer",false);zim.TextEditor=function(width,color,backgroundColor,fieldColor,fieldHeight,textSize,sizeList,optionList,colorList,fontList,live,button,titleBar,titleBarColor,titleBarBackgroundColor,titleBarHeight,wrap,limit,scroll,placeholder,password,borderColor,borderWidth,margin,corner,shadowColor,shadowBlur,draggable,boundary,frame,fontListHeight,fontListViewNum,style,group,inherit){var sig="width, color, backgroundColor, fieldColor, fieldHeight, textSize, sizeList, optionList, colorList, fontList, live, button, titleBar, titleBarColor, titleBarBackgroundColor, titleBarHeight, wrap, limit, scroll, placeholder, password, borderColor, borderWidth, margin, corner, shadowColor, shadowBlur, draggable, boundary, frame, fontListHeight, fontListViewNum, style, group, inherit";var duo;if(duo=zob(zim.TextEditor,arguments,sig,this))return duo;z_d("67.1");this.group=group;var DS=style===false?{}:zim.getStyle("TextEditor",this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:400;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:zim.lighter;if(zot(titleBar))titleBar=DS.titleBar!=null?DS.titleBar:"Text Editor";if(zot(draggable))draggable=DS.draggable!=null?DS.draggable:true;if(zot(titleBarHeight))titleBarHeight=DS.titleBarHeight!=null?DS.titleBarHeight:30;if(zot(fieldColor))fieldColor=DS.fieldColor!=null?DS.fieldColor:backgroundColor.darken(.05);if(zot(live))live=DS.live!=null?DS.live:true;if(zot(wrap))wrap=DS.wrap!=null?DS.wrap:true;if(zot(scroll))scroll=DS.scroll!=null?DS.scroll:true;if(zot(margin))margin=DS.margin!=null?DS.margin:10;if(zot(limit))limit=DS.limit!=null?DS.limit:null;if(zot(titleBar))titleBar=DS.titleBar!=null?DS.titleBar:null;if(zot(sizeList))sizeList=DS.sizeList!=null?DS.sizeList:null;if(zot(colorList))colorList=DS.colorList!=null?DS.colorList:null;if(zot(optionList))optionList=DS.optionList!=null?DS.optionList:null;if(zot(fontList))fontList=DS.fontList!=null?DS.fontList:null;if(zot(fieldColor))fieldColor=DS.fieldColor!=null?DS.fieldColor:null;if(zot(fieldHeight))fieldHeight=DS.fieldHeight!=null?DS.fieldHeight:null;if(zot(textSize))textSize=DS.textSize!=null?DS.textSize:null;if(zot(fontListHeight))fontListHeight=DS.fontListHeight!=null?DS.fontListHeight:100;if(zot(fontListViewNum))fontListViewNum=DS.fontListViewNum!=null?DS.fontListViewNum:3;if(zot(frame)){if(zdf){frame=zdf;}else{if(zon){zog("zim.TextEditor - please provide a reference to zim Frame");}return;}}
this.zimPanel_constructor(width,300,titleBar,titleBarColor,titleBarBackgroundColor,titleBarHeight,backgroundColor,borderColor,borderWidth,corner,true,null,null,null,shadowColor,shadowBlur,draggable,boundary,null,style,group,inherit);var that=this;if(zot(button))button=new zim.Button({width:50,height:50,label:"",icon:new Shape().sca(.4).f("white").p("AikFsQg5jmhphxIA1gXQBeBGA3CwQC8mRCpjOIBfAoQkPFGiSFpg"),color:zim.white,corner:10,backgroundColor:zim.green.darken(.2),borderColor:zim.white,borderWidth:2,rollBackgroundColor:zim.green,shadowBlur:3}).pos(margin,titleBarHeight+margin*2,zim.RIGHT,zim.TOP,that);that.button=button;button.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",submit);if(zot(fieldHeight))fieldHeight=DS.fieldHeight!=null?DS.fieldHeight:button.height+margin*2;function submit(){if(!live)label.text=textArea.text;that.hide();that.dispatchEvent("set");}
var textArea=that.textArea=new zim.TextArea({color:color,backgroundColor:fieldColor,width:width-button.width-margin*3,height:zot(fieldHeight)?button.height+margin*2:fieldHeight,expand:10,password:password,placeholder:placeholder,frame:frame}).loc(margin,titleBarHeight+margin+(fieldHeight&&fieldHeight<(button.height+margin*2)?(button.height-fieldHeight)/2+margin:0),null,null,false);if(!wrap)textArea.tag.style.whiteSpace="nowrap";if(limit)textArea.tag.setAttribute("maxLength",limit);if(scroll)textArea.tag.style.overflowY="auto";var label=new zim.Label();that.on("pressmove",function(){textArea.resize();});that.on("close",function(){if(that.inputEvent)textArea.off("input",that.inputEvent);textArea.removeFrom();});that.panelHeight=titleBarHeight+margin+Math.max(fieldHeight,button.height+margin*2)+margin;var mob=zim.mobile();var baseSize=mob?35:30;if(sizeList||optionList||colorList){new zim.Rectangle(width,baseSize+margin,"rgba(0,0,0,.05)").loc(0,that.panelHeight,that);var extras=[];if(colorList){var arr=Array.isArray(colorList);var colorPicker=that.colorPicker=new zim.ColorPicker({colors:arr?colorList:null,cols:arr?Math.min(colorList.length,12):null,alphaPicker:false,greyPicker:!arr,container:frame.stage});colorPicker.on("close",closePicker);function closePicker(){textArea.tag.style.display="block";colorPicker.hide();if(that.stage)that.stage.update();}
colorPicker.on("change",function(){label.color=color.color=colorPicker.selectedColor;that.dispatchEvent("update");closePicker();});that.closeColorPicker=function(){closePicker();}
var color=that.swatch=new zim.Rectangle(baseSize,baseSize,label.color,zim.dark,1).cur();color.on("mousedown",function(){that.dispatchEvent("color");textArea.tag.style.display="none";colorPicker.selectedColor=color.color;colorPicker.show();if(that.stage)that.stage.update();});extras.push(color);}
if(optionList){if(optionList===true)optionList=["bold","italic","align"];if(zot(STYLE))STYLE={};if(zot(STYLE.group))STYLE.group={};STYLE.group.zimEditor={width:baseSize,height:baseSize,corner:0,borderColor:zim.tin,shadowBlur:-1,backgroundColor:zim.light,rollBackgroundColor:zim.light,toggleBackgroundColor:zim.green,toggleColor:zim.grey};var bold,italic,selector;zim.loop(optionList,function(option){if(option.toLowerCase()=="bold"){bold=that.bold=new zim.Button({label:new zim.Label({text:"B",color:zim.grey,size:16,bold:true}),toggle:"B",group:"zimEditor"});bold.on("click",function(){label.bold=bold.toggled;that.dispatchEvent("update");if(that.stage)that.stage.update();});extras.push(bold);if(label.bold)bold.toggle();}else if(option.toLowerCase()=="italic"){italic=that.italic=new zim.Button({label:new zim.Label({text:"I",color:zim.grey,size:16,bold:true,italic:true}),toggle:"I",group:"zimEditor"});italic.on("click",function(){label.italic=italic.toggled;that.dispatchEvent("update");if(that.stage)that.stage.update();});extras.push(italic);if(label.italic)italic.toggle();}else if(option.toLowerCase()=="align"){var alignOptions=new zim.Tile(new zim.Rectangle(baseSize-10,baseSize-10,zim.grey).centerReg(),3,1,10,10);var icons=mob?["   ","   ","   "]:["   ","   ","   "];zim.loop(3,function(i){var r=alignOptions.getChildAt(i);new zim.Label(icons[i],baseSize*2/3,null,zim.white).center(r).expand(10);});var i=0;if(label.align=="right")i=2;else if(label.align=="center"||label.align=="middle")i=1;selector=that.align=new zim.Selector({tile:alignOptions,corner:0,borderWidth:1,borderColor:zim.grey,backgroundColor:zim.clear,selectedIndex:i});selector.on("change",function(){if(selector.selectedIndex==0)label.align="left";else if(selector.selectedIndex==1)label.align="center";if(selector.selectedIndex==2)label.align="right";that.dispatchEvent("update");if(that.stage)that.stage.update();});extras.push(selector);}});delete STYLE.group.zimEditor;}
if(sizeList){var size=that.sizePicker=new zim.Stepper({list:sizeList===true?null:sizeList,stepperType:sizeList===true?null:"list",min:sizeList===true?5:null,max:sizeList===true?500:null,width:150,shadowBlur:-1,borderColor:zim.dark,borderWidth:2,corner:0,backgroundColor:zim.green,downForward:false}).siz(null,baseSize);size.arrowPrev.expand(0);size.textBox.color=zim.lighter;size.on("change",function(){label.size=size.currentValue;that.dispatchEvent("update");if(that.stage)that.stage.update();});size.currentValue=label.size;extras.push(size);}
var tile=new zim.Tile(extras,extras.length,1,10,10,true).loc(margin,that.panelHeight+margin/2,that);that.panelHeight=that.panelHeight+margin+tile.height+margin;}
var fonts;if(fontList){if(!Array.isArray(fontList)){fonts=["Arial","Courier New","Georgia","Helvetica","Palatino","Tahoma","Verdana"];if(!mob){fonts=fonts.concat(["Comic Sans MS","Impact"]);}
fonts.sort();}else{fonts=fontList;}
var font=that.fonts=new zim.List({width:width-margin*2,height:fontListHeight,viewNum:fontListViewNum,backgroundColor:zim.moon,color:zim.grey,rollColor:zim.dark,rollBackgroundColor:zim.green.lighten(.5),selectedBackgroundColor:zim.mist,selectedRollBackgroundColor:zim.green.lighten(.6),selectedColor:zim.dark,backdropColor:zim.light,scrollBarColor:zim.dark,shadowBlur:-1,list:fonts}).center(that).loc(null,that.panelHeight);font.on("change",function(){label.font=font.currentValue;that.dispatchEvent("update");if(that.stage)that.stage.update();});that.panelHeight=that.panelHeight+margin+font.height+margin;}
that.show=function(l,x,y,frame){if(that.parent){if(l==that.label)return that;that.label=l;return that;}
label=l;textArea.addTo(that);var stage;if(label&&label.stage)stage=label.stage;else if(frame)stage=frame.stage;else if(zdf)stage=zdf.stage;else return that;if(!zot(x)||!zot(y))that.loc(x,y);else if(label&&label.y>stage.height/2)that.loc(stage.width/2-width/2,label.y-that.panelHeight-stage.height*.05,stage);else if(label&&label.y<=stage.height/2)that.loc(stage.width/2-width/2,label.y+label.height+stage.height*.05,stage);else that.center(stage);if(that.y<20)that.y=20;if(that.y+that.height>that.stage.height)that.y=that.stage.height-that.height-20;setLabel();that.stage.update();return that;};function setLabel(){if(label)textArea.text=label.text;if(color)color.color=label.color;if(bold)bold.toggle(label.bold==true);if(italic)italic.toggle(label.italic==true);if(selector){selector.noAnimate=true;if(label.align=="center")selector.selectedIndex=1;else if(label.align=="right")selector.selectedIndex=2;else selector.selectedIndex=0;}
if(size)size.currentValue=label.size;if(font)font.currentValue=label.font;if(that.inputEvent)textArea.off("input",that.inputEvent);that.inputEvent=textArea.on("input",function(e){if(live)label.text=textArea.text;that.dispatchEvent("input");that.dispatchEvent("update");if(that.stage)that.stage.update();});}
that.hide=function(){if(colorList)colorPicker.hide();if(textArea)textArea.removeFrom();if(zot(that.stage))return;var stage=that.stage;that.removeFrom();stage.update();return that;};Object.defineProperty(that,'label',{get:function(){return label;},set:function(value){label=value;setLabel();}});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.TextEditor(width,color,backgroundColor,fieldColor,fieldHeight,textSize,sizeList,optionList,colorList,fontList,live,button,titleBar,titleBarColor,titleBarBackgroundColor,titleBarHeight,wrap,limit,scroll,placeholder,password,borderColor,borderWidth,margin,corner,shadowColor,shadowBlur,draggable,boundary,frame,fontListHeight,fontListViewNum,style,this.group,inherit));};this.dispose=function(a,b,disposing){var stage=that.stage;if(that.inputEvent)textArea.off("input",that.inputEvent);if(colorPicker)colorPicker.dispose();if(color)color.dispose();if(font)font.dispose();if(button)button.dispose();if(textArea)textArea.dispose();if(selector)selector.dispose();if(bold)bold.dispose();if(italic)italic.dispose();if(size)size.dispose();if(!disposing)this.zimPanel_dispose();if(that.stage)that.stage.update();that.textArea=that.color=that.colorPicker=that.font=that.button=that.selector=that.bold=that.italic=that.size=null;return true;};};zim.extend(zim.TextEditor,zim.Panel,["clone","dispose"],"zimPanel",false);zim.Keyboard=function(labels,backgroundColor,color,shiftBackgroundColor,shiftHoldBackgroundColor,placeBackgroundColor,placeColor,cursorColor,shadeAlpha,borderColor,borderWidth,margin,corner,draggable,placeClose,shadowColor,shadowBlur,container,data,place,special,rtl,hardKeyboard,layout,style,group,inherit){var sig="labels, backgroundColor, color, shiftBackgroundColor, shiftHoldBackgroundColor, placeBackgroundColor, placeColor, cursorColor, shadeAlpha, borderColor, borderWidth, margin, corner, draggable, placeClose, shadowColor, shadowBlur, container, data, place, special, rtl, hardKeyboard, layout, style, group, inherit";var duo;if(duo=zob(zim.Keyboard,arguments,sig,this))return duo;z_d("67.2");this.zimContainer_constructor(1000,400,null,null,false);this.type="Keyboard";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(labels))labels=DS.labels!=null?DS.labels:[];if(!Array.isArray(labels))labels=[labels];if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#333";if(zot(color))color=DS.color!=null?DS.color:"white";if(zot(shiftBackgroundColor))shiftBackgroundColor=DS.shiftBackgroundColor!=null?DS.shiftBackgroundColor:"orange";if(zot(shiftHoldBackgroundColor))shiftHoldBackgroundColor=DS.shiftHoldBackgroundColor!=null?DS.shiftHoldBackgroundColor:"red";if(zot(placeBackgroundColor))placeBackgroundColor=DS.placeBackgroundColor!=null?DS.placeBackgroundColor:"#50c4b7";if(zot(placeColor))placeColor=DS.placeColor!=null?DS.placeColor:color;if(zot(cursorColor))cursorColor=DS.cursorColor!=null?DS.cursorColor:"#50c4b7";if(zot(shadeAlpha))shadeAlpha=DS.shadeAlpha!=null?DS.shadeAlpha:.2;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:"rgba(0,0,0,.1)";if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(margin))margin=DS.margin!=null?DS.margin:5;if(zot(corner))corner=DS.corner!=null?DS.corner:30;if(zot(draggable))draggable=DS.draggable!=null?DS.draggable:false;if(zot(placeClose))placeClose=DS.placeClose!=null?DS.placeClose:true;if(zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.2)";if(zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:14;if(zot(data))data=DS.data!=null?DS.data:[[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l"],["shift","z","x","c","v","b","n","m","backspace"],["?123"]],[["1","2","3","4","5","6","7","8","9","0"],["!","@","#","$","/","^","&","*","(",")"],["1/2","-","'","\"",":",";",",","?","backspace"],["ABC"]],[["+","x","%","=","<",">","{","}","[","]"],["   ","  ","  ","$","   ","~","`","  ","   ","   "],["2/2","_","\\","|","   ","   ","  ","  ","backspace"],["ABC"]]];if(!data[3])data[3]={e:["  ","  ","  ","  ","  ","  ","  "],u:["  ","  ","  ","  ","  "],i:["  ","  ","  ","  ","  ","  "],o:["  ","  ","  ","  ","  ","  ","  ","  "],a:["  ","  ","  ","  ","  ","  ","  ","  "],n:["  ","  "]};var that=this;if(zot(place))place=DS.place!=null?DS.place:true;if(zot(rtl))rtl=DS.rtl!=null?DS.rtl:false;if(zot(hardKeyboard))hardKeyboard=DS.hardKeyboard!=null?DS.hardKeyboard:true;if(zot(layout))layout=DS.layout!=null?DS.layout:"qwerty";layout=layout.toLowerCase();if(layout!="qwerty"){if(layout=="arabic"){data=[[["  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  "],["  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  "],["  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","back"],["?123","  "]],[["1","2","3","4","5","6","7","8","9","0","*"],["!","@","#","$","/","^","&","*","(",")","*"],["1/2","-","'","\"",":",";",",","?","*","backspace"],["ABC","*"]],[["+","x","%","=","<",">","{","}","[","]","*"],["   ","  ","  ","$","   ","~","`","  ","   ","   ","*"],["2/2","_","\\","|","   ","   ","  ","  ","*","backspace"],["ABC","*"]],{:["  ","  ","  ","  "],:["  "],:["  ","  "],:["  "],:["  ","  ","  ","  ","  ","  ","  ","  "],"*":["  ","  ","  ","  ","  ","  ","  ","  "],n:["  ","  "]}];}else if(layout=="hebrew"){data=[[["  ","  ","  ","  ","  ","  ","  ","  ","backspace"],["  ","  ","  ","  ","  ","  ","  ","  ","  ","  "],["  ","  ","  ","  ","  ","  ","  ","  ","  "],["?123",","]],[["1","2","3","4","5","6","7","8","9","0"],["!","@","#","$","/","^","&","*","(",")"],["1/2","-","'","\"",":",";",",","?","backspace"],["ABC",","]],[["+","x","%","=","<",">","{","}","[","]"],["   ","  ","  ","$","   ","~","`","  ","   ","   "],["2/2","_","\\","|","   ","   ","  ","  ","backspace"],["ABC",","]],{e:["  ","  ","  ","  ","  ","  ","  "],u:["  ","  ","  ","  ","  "],i:["  ","  ","  ","  ","  ","  "],o:["  ","  ","  ","  ","  ","  ","  ","  "],a:["  ","  ","  ","  ","  ","  ","  ","  "],n:["  ","  "]}];}else if(layout=="azerty"){data=[[["a","z","e","r","t","y","u","i","o","p"],["q","s","d","f","g","h","j","k","l","m"],["shift","w","x","c","v","b","n","  ","backspace"],["?123",","]],[["1","2","3","4","5","6","7","8","9","0"],["!","@","#","$","/","^","&","*","(",")"],["1/2","-","'","\"",":",";",",","?","backspace"],["ABC",","]],[["+","x","%","=","<",">","{","}","[","]"],["   ","  ","  ","$","   ","~","`","  ","   ","   "],["2/2","_","\\","|","   ","   ","  ","  ","backspace"],["ABC",","]],{e:["  ","  ","  ","  ","  ","  ","  "],u:["  ","  ","  ","  ","  "],i:["  ","  ","  ","  ","  ","  "],o:["  ","  ","  ","  ","  ","  ","  ","  "],a:["  ","  ","  ","  ","  ","  ","  ","  "],n:["  ","  "]}];}else if(layout=="turkish"){data=[[["q","w","e","r","t","y","u","  ","o","p","  ","  "],["a","s","d","f","g","h","j","k","l","  ","i"],["shift","z","x","c","v","b","n","m","  ","  ","backspace"],["?123","*"]],[["1","2","3","4","5","6","7","8","9","0","*"],["!","@","#","$","/","^","&","*","(",")","*"],["1/2","-","'","\"",":",";",",","?","*","backspace"],["ABC","*"]],[["+","x","%","=","<",">","{","}","[","]","*"],["   ","  ","  ","$","   ","~","`","  ","   ","   ","*"],["2/2","_","\\","|","   ","   ","  ","  ","*","backspace"],["ABC","*"]],{e:["  ","  ","  ","  ","  ","  ","  "],u:["  ","  ","  ","  ","  "],i:["  ","  ","  ","  ","  ","  "],o:["  ","  ","  ","  ","  ","  ","  ","  "],a:["  ","  ","  ","  ","  ","  ","  ","  "],n:["  ","  "]},{:"I",i:"  "},{I:"  ",:"i"}];}}
that.data=data;var mess="zim display - Keyboard(): Please pass in a reference to a container with bounds set";if(zot(container)){if(zdf){container=zdf.stage;}else{zogy(mess);return;}}else if(!container.getBounds){zogy(mess);return;}else if(zot(container.stage)){zogy("zim display - Keyboard(): The container must have a stage property");return;}
if(shadowColor!=-1&&shadowBlur>0)that.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);var currentStage=zdf?zdf.stage:null;that.labels=labels;var maxWidth;var maxNum=10;zim.loop(data[0],function(d){if(d.length>maxNum)maxNum=d.length;});var numH=maxNum;var botArray=["@","",".","/","away"];if(!zot(special))botArray.splice(1,0,special);var textKeys=zim.copy(data[0]);textKeys[3]=textKeys[3].concat(botArray);var numberKeys1=zim.copy(data[1]);numberKeys1[3]=numberKeys1[3].concat(botArray);var numberKeys2=zim.copy(data[2]);numberKeys2[3]=numberKeys2[3].concat(botArray);var textKeyButtons=[];var size=(1000-((numH-1)*5))/numH;var statuses={def:"default",shift:"shift",number1:"number1",number2:"number2"};var currentStatus=statuses.def;var currentKeyboard;var alternativeMenu;var textBlinker;var bigShiftOn=false;var shiftKey;var currentLabel;var insertPoint=0;var cursorShiftMenu;var buttonsCursor=[];var shiftKeyIcon;var backspaceIcon;var backIcon;var hideKeyBoardIcon;var dragButton;var dragY;makeIcons();makeButtons(currentStatus);if(draggable)makeDragButton();this.on("mousedown",buttonPressed);function buttonPressed(e){currentStage=that.stage;if(alternativeMenu){that.removeChild(alternativeMenu);}
if(cursorShiftMenu){if(buttonsCursor.indexOf(e.target)<0){removeCursorShiftMenu();}}
if(!zot(e.target.na)){if(draggable&&e.target===dragButton){that.tickerMouseEvent=currentStage.on("stagemousemove",function(e){that.mouseYAmount=e.stageY;});zim.Ticker.add(startDragging);that.on("pressup",stopDragging);dragY=e.stageY-that.localToGlobal(0,0).y;}else if(!zot(special)&&e.target.na===special){that.dispatchEvent("special");}else if(e.target.na==="shift"){shiftKeys();}else if(e.target.toggle==="?123"){that.removeChild(currentKeyboard);makeButtons(statuses.number1);}else if(e.target.toggle==="ABC"){that.removeChild(currentKeyboard);currentStatus=statuses.def;makeButtons();if(bigShiftOn)shiftKeys(true);}else if(e.target.toggle==="1/2"){that.removeChild(currentKeyboard);makeButtons(statuses.number2);}else if(e.target.toggle==="2/2"){that.removeChild(currentKeyboard);makeButtons(statuses.number1);}else if(e.target.na==="away"){hideKeyboard();that.dispatchEvent("close");}else if(data[3]&&data[3][e.target.na]){makeAlternativeLetters(e.target.na);}else if(e.target.na==="return"){addToLabel("\n");}else if(e.target.na==="backspace"){backspaceRemovesLetter();}else if(e.target.na==="back"){backspaceRemovesLetter();}else if(e.target.na===""){addToLabel(" ");}else{addToLabel(e.target.na);}
currentStage.update();}}
that.addChar=function(chara){if(!zot(chara)&&chara.match(/^.$/))addToLabel(chara);};that.removeChar=function(){backspaceRemovesLetter(true);};var shiftEvent;function shiftKeys(immediate){var bigShift=false;var i;if(currentStatus===statuses.def){shiftKey.color=immediate?shiftHoldBackgroundColor:shiftBackgroundColor;for(i=0;i<textKeyButtons.length-6-(zot(special)?0:1);i++){var tkb=textKeyButtons[i];if(tkb.label.text.length>0){if(tkb.na.length===1){if(data[4]&&data[4][tkb.label.text])tkb.label.text=data[4][tkb.label.text];else tkb.label.text=tkb.label.text.toUpperCase();tkb.label.centerReg(tkb).mov(0,6);}else{tkb.label.centerReg(tkb);}}}
if(!immediate){bigShift=true;setTimeout(putBigShiftOn,500);shiftEvent=that.on("pressup",doNotPutBigShiftOn);}
currentStatus=statuses.shift;}else{shiftKey.color=backgroundColor;bigShiftOn=false;for(i=0;i<textKeyButtons.length-6;i++){var tkb=textKeyButtons[i];if(tkb.label.text.length>0){if(tkb.na.length===1){if(data[5]&&data[5][tkb.label.text])tkb.label.text=data[5][tkb.label.text];else tkb.label.text=tkb.label.text.toLowerCase();tkb.label.centerReg(tkb).mov(0,3);}else{tkb.label.centerReg(tkb);}}}
currentStatus=statuses.def;}
currentKeyboard.updateCache();if(that.stage)that.stage.update();function putBigShiftOn(){if(bigShift){bigShiftOn=true;shiftKey.color=shiftHoldBackgroundColor;currentKeyboard.updateCache();if(that.stage)that.stage.update();}}
function doNotPutBigShiftOn(e){that.off("pressup",shiftEvent);bigShift=false;}}
function makeButtons(which){var typeKeyboard;var label;var button;var bakking;var xPos=0;var yPos=0;var thisWidth;var bigKey;var thisIsSpacekey=false;var thisKeyLetter;var passesLetter;var dark=false;if(zot(which))which=statuses.def;if(which===statuses.def){typeKeyboard=textKeys;}else if(which===statuses.number1){typeKeyboard=numberKeys1;}else if(which===statuses.number2){typeKeyboard=numberKeys2;}
currentKeyboard=new zim.Container(1000,430,null,null,false).addTo(that);for(var i=0;i<typeKeyboard.length;i++){if(i<=1||(which==statuses.def&&i==2&&typeKeyboard[2][0]!="shift")){xPos=(size/2+2.5)*(numH-typeKeyboard[i].length);}
for(var j=0;j<typeKeyboard[i].length;j++){thisIsSpacekey=false;thisKeyLetter=null;dark=false;if(typeKeyboard[i][j]=="backspace"){bigKey=true;thisKeyLetter=backspaceIcon;dark=true;}else if(typeKeyboard[i][j]=="back"){bigKey=false;thisKeyLetter=backspaceIcon;dark=true;}else if(typeKeyboard[i][j]=="shift"){bigKey=true;thisKeyLetter=shiftKeyIcon;}else if((i==3||(which!=statuses.def&&i==2))&&j==0){bigKey=true;dark=true;}else if(typeKeyboard[i][j]==""){bigKey=false;thisIsSpacekey=true;}else if(typeKeyboard[i][j]=="away"){thisKeyLetter=hideKeyBoardIcon;bigKey=true;dark=true;}else{bigKey=false;}
if(bigKey){thisWidth=(size*1.5+2.5);}else if(thisIsSpacekey){thisWidth=(size+5)*((zot(special)?4:3)+numH-10+1-data[0][3].length)-5;if(data[0][3].indexOf("backspace")!=-1){thisWidth-=size/2;}}else{thisWidth=size;}
button=new zim.Rectangle(thisWidth,size,backgroundColor,borderColor,borderWidth,corner,null,null,false).cur().addTo(currentKeyboard);if(dark)button.addChild(new zim.Rectangle(thisWidth,size,"black",null,null,corner,null,null,false).alp(shadeAlpha));if(thisKeyLetter){button.label=label=new zim.Label({text:"",backgroundColor:"ignore",font:DS.font!=null?DS.font:null,style:false});}else{button.label=label=new zim.Label({lineWidth:10,lineHeight:25,font:DS.font!=null?DS.font:null,text:typeKeyboard[i][j],color:color,align:"center",style:false});}
if(thisKeyLetter){var clone=thisKeyLetter.clone();clone.scaleTo(button,70,70);clone.centerReg(button);}
if(!passesLetter){label.centerReg(button).mov(0,(!isNaN(label.text))?7:3);button.x=xPos;button.y=yPos;button.na=typeKeyboard[i][j];if(i==2&&j==0&&which==statuses.number1)button.toggle="1/2";if(i==2&&j==0&&which==statuses.number2)button.toggle="2/2";if(i==3&&j==0&&which==statuses.def)button.toggle="?123";if(i==3&&j==0&&which!=statuses.def)button.toggle="ABC";if(button.toggle)label.mov(0,3);textKeyButtons.push(button);if(button.na=="shift"){shiftKey=button;}
xPos=button.x+button.width+5;}else{passesLetter=false;xPos+=67.33;}}
yPos+=size+5;xPos=0;}
currentKeyboard.cache(borderWidth?-borderWidth:0,borderWidth?-borderWidth:0,borderWidth?currentKeyboard.width+borderWidth*2:currentKeyboard.width,borderWidth?currentKeyboard.height+borderWidth*2:currentKeyboard.height);}
function makeAlternativeLetters(letter){var thisArray=data[3][letter];var mouseReleased=false;var alternativeMenuIsmade=false;var timeWait;timeWait=zim.timeout(500,makeAlternatemenu,null,"ms");var mouseUpEvent=that.on("pressup",mouseUp);function mouseUp(e){mouseReleased=true;that.off("pressup",mouseUpEvent);if(!alternativeMenuIsmade){addToLabel(letter);}}
function makeAlternatemenu(){var label,bakking,button,overlay,xPos=0,thisLetter;timeWait.clear();if(!mouseReleased){alternativeMenuIsmade=true;alternativeMenu=new zim.Container(1000,size,null,null,false).addTo(that,0);alternativeMenu.y=-size-5;for(var i=0;i<thisArray.length;i++){if(currentStatus===statuses.shift){thisLetter=thisArray[i].toUpperCase();}else{thisLetter=thisArray[i];}
label=new zim.Label({lineWidth:10,lineHeight:25,text:thisLetter,font:DS.font!=null?DS.font:null,color:color,align:"center",style:false});button=new zim.Rectangle(size,size,backgroundColor,borderColor,borderWidth,corner,null,null,false).addTo(alternativeMenu);overlay=new zim.Rectangle(size,size,"white",null,null,corner,null,null,false).alp(.2);button.addChild(overlay);label.center(button);button.na=thisArray[i];button.x=xPos;xPos+=size+5;}
if(that.stage)that.stage.update();}}}
function makeIcons(){shiftKeyIcon=new zim.Shape({style:false});shiftKeyIcon.graphics.f(color).p("AhIFoIAAjYIixAAID5n3ID6H3IixAAIAADYgAjHBxICeAAIAADYIBTAAIAAjYICeAAIjImSg");shiftKeyIcon.setBounds(-51/2,-72/2,51,72);backspaceIcon=new zim.Container({style:false});var backspaceShape1=new zim.Shape({style:false});backspaceShape1.graphics.f(color).p("ACgC+IigigIifCgQgGAGgJAAQgJAAgGgGQgGgGgBgJQABgJAGgGICgigIigifQgGgGgBgJQABgJAGgGQAGgGAJAAQAIAAAHAGICfCgICgigQAGgGAJAAQAJAAAGAGQAGAGABAJQgBAJgGAGIigCfICgCgQAGAGABAJQgBAJgGAGQgGAGgJAAQgJAAgGgGg");backspaceShape1.setTransform(82.6,32);backspaceShape1.addTo(backspaceIcon);var backspaceShape2=new zim.Shape({style:false});backspaceShape2.graphics.f(color).s().p("AkhFAQgcAAgUgUIkHj6QgVgUAAgeQAAgdAVgVIEHj6QAUgTAcAAINKAAQAdAAAUAUQAUAUAAAdIAAH1QAAAdgUATQgUAVgdAAgAk0kOIkGD8QgIAHAAALQAAALAIAIIEGD7QAIAHALAAINKAAQALAAAIgIQAHgHAAgLIAAn1QAAgLgHgIQgIgIgLAAItKAAQgLAAgIAHg");backspaceShape2.setTransform(62.2,32);backspaceShape2.addTo(backspaceIcon);backspaceIcon.setBounds(0,0,125,64);hideKeyBoardIcon=new zim.Container({style:false});hideKeyBoardIcon.setBounds(0,0,147,86);var hideKeyBoardIconArray=[{p:("Ai+heIF9AAIi/C9g"),transform:[73.4,76]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[128.4,43.2]},{p:("AnNAzIAAhlIObAAIAABlg"),transform:[73,43.2]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[18.8,43.2]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[128.2,29.5]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[114.5,29.5]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[100.8,29.5]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[87.1,29.5]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[73.4,29.5]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[59.7,29.5]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[46,29.5]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[32.3,29.5]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[18.6,29.5]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[128,15.8]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[114.3,15.8]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[100.6,15.8]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[86.9,15.8]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[73.2,15.8]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[59.5,15.8]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[45.8,15.8]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[32.1,15.8]},{p:("AgyAzIAAhlIBlAAIAABlg"),transform:[18.4,15.8]},{p:("AphEnQgzAAgkgkQglglAAgzIAAlVQAAgzAlglQAkgkAzAAITDAAQAzAAAkAkQAlAlAAAzIAAFVQAAAzglAlQgkAkgzAAgAqjjtQgcAcAAAnIAAFVQAAAnAcAbQAbAcAnAAITDAAQAnAAAcgcQAbgbAAgnIAAlVQAAgngbgcQgcgcgnAAIzDAAQgnAAgbAcg"),transform:[73.4,29.5]}];var thisShape;for(var i=0;i<hideKeyBoardIconArray.length;i++){thisShape=new zim.Shape({style:false});thisShape.graphics.f(color).s().p(hideKeyBoardIconArray[i].p);thisShape.setTransform(hideKeyBoardIconArray[i].transform[0],hideKeyBoardIconArray[i].transform[1]);thisShape.addTo(hideKeyBoardIcon);}}
function makeDragButton(){dragButton=new zim.Rectangle((size*1.5+2.5)+2.5,size,backgroundColor,borderColor,borderWidth,corner,null,null,false).addTo(that,0).cur();var rect;for(var i=0;i<4;i++){rect=new zim.Rectangle(dragButton.width*0.4,4,color,null,null,null,null,null,false).centerReg(dragButton).alp(.2);rect.y-=-22+(i*15);}
dragButton.x=(8.5*size)+(40);dragButton.y=-size-5;dragButton.na="drag";}
function hideKeyboard(){that.hide();}
function startDragging(){if(that.mouseYAmount)that.y=that.parent.globalToLocal(0,that.mouseYAmount-dragY).y;}
function stopDragging(){currentStage.off("pressmousemove",that.tickerMouseEvent);zim.Ticker.remove(startDragging);}
that.setBounds(1000,400-(numH-10)*26);function positionBlinker(){if(!currentLabel||!textBlinker)return;var positionXBlinker=currentLabel.label.x+currentLabel.label.getBounds().x;for(var i=0;i<insertPoint;i++){positionXBlinker+=currentLabel.widthArray[i]?currentLabel.widthArray[i]:0;}
textBlinker.heightOnly=currentLabel.getBounds().height*(currentLabel.backing&&zot(currentLabel.padding)?.9:1)-((currentLabel.paddingVertical&&currentLabel.background)?currentLabel.paddingVertical*2:0);textBlinker.center(currentLabel);textBlinker.x=positionXBlinker;}
function makeCursorShiftmenu(){if(cursorShiftMenu)return that;if(!currentLabel)return that;var tekens=placeClose?["<",">","x"]:["<",">"];var label;var bakking;var button;var point;buttonsCursor=[];point=currentLabel.localToLocal(0,0,that);cursorShiftMenu=new zim.Container({style:false}).addTo(that).pos({x:point.x,y:point.y+currentLabel.height+15,reg:true}).cur();for(var i=0;i<tekens.length;i++){bakking=new zim.Rectangle(size,size,placeBackgroundColor,borderColor,borderWidth,corner,null,null,false);if(tekens[i]=="x")new zim.Rectangle(size,size,"black",null,null,corner,null,null,false).alp(shadeAlpha).addTo(bakking);button=new zim.Label({lineWidth:10,text:tekens[i],backing:bakking,font:DS.font!=null?DS.font:null,color:placeColor,align:"center",valign:"center",style:false});button.pos(0,0,zim.LEFT,zim.TOP,cursorShiftMenu).cache();button.x=button.x+i*(size+5);buttonsCursor.push(button);}
point=currentLabel.localToLocal(0,0,that);cursorShiftMenu.x=point.x;cursorShiftMenu.y=point.y+currentLabel.height+15;cursorShiftMenu.on("click",verschuifCursor);function verschuifCursor(e){if(buttonsCursor.indexOf(e.target)==0){if(insertPoint>0)insertPoint--;}else if(buttonsCursor.indexOf(e.target)==1){if(insertPoint<currentLabel.text.length)insertPoint++;}else{removeCursorShiftMenu();}
positionBlinker();}
if(that.stage)that.stage.update();}
function removeCursorShiftMenu(){if(!cursorShiftMenu)return that;cursorShiftMenu.removeAllEventListeners();that.removeChild(cursorShiftMenu);cursorShiftMenu=null;}
function addToLabel(letter){if(!currentLabel)return;var measureField;var widthMeasureField;if(letter==="del"){if(currentLabel)currentLabel.text=[currentLabel.text.slice(0,insertPoint-1),currentLabel.text.slice(insertPoint)].join('');insertPoint--;makeWidthsArray();}else{if(currentStatus===statuses.shift){letter=letter.toUpperCase();}
var textBeforeCheck=currentLabel.text;measureField=currentLabel.clone().removeFrom();measureField.text=letter;widthMeasureField=measureField.label.getMeasuredWidth();if(!currentLabel.widthArray){currentLabel.widthArray=[currentLabel.breedte];}else{currentLabel.widthArray.splice(insertPoint,0,widthMeasureField);}
if(insertPoint<currentLabel.text.length){currentLabel.text=[currentLabel.text.slice(0,insertPoint),letter,currentLabel.text.slice(insertPoint)].join('');}else{currentLabel.text+=letter;}
if(currentLabel&&currentLabel.label.getBounds().width<maxWidth){insertPoint++;positionBlinker();}else{currentLabel.text=textBeforeCheck;}}
if(currentStatus===statuses.shift&&!bigShiftOn){that.removeChild(currentKeyboard);makeButtons();currentStatus=statuses.def;}
positionBlinker();var keyEvent=new createjs.Event("keydown");keyEvent.letter=letter;that.dispatchEvent(keyEvent);if(that.stage)that.stage.update();}
function activateLabel(e){if(!that.stage)return;var point;var pointLabel;var sumUp=0;var found=false;currentLabel=e.target;if(!currentLabel.widthArrayCheck)makeWidthsArray();maxWidth=currentLabel.label.lineWidth?currentLabel.label.lineWidth:10000;point=currentLabel.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);point.x-=currentLabel.label.x;point.y-=currentLabel.label.y;for(var i=0;i<currentLabel.widthArray.length;i++){sumUp+=currentLabel.widthArray[i];if(point.x<sumUp-currentLabel.widthArray[i]/2+currentLabel.label.getBounds().x){insertPoint=i;found=true;break;}}
if(!found){insertPoint=currentLabel.text.length;}
positionBlinker();if(place&&!cursorShiftMenu&&currentLabel.text.length>0){makeCursorShiftmenu();}
if(cursorShiftMenu&&currentLabel){if(currentLabel.text.length>0){point=currentLabel.localToLocal(0,0,that);cursorShiftMenu.x=point.x;cursorShiftMenu.y=point.y+currentLabel.height+15;}else{removeCursorShiftMenu();}}}
function makeWidthsArray(){if(!currentLabel)return;var measureField=new Label("");currentLabel.widthArray=[];for(var i=0;i<currentLabel.text.length;i++){measureField=currentLabel.clone().removeFrom();measureField.text=currentLabel.text[i];currentLabel.widthArray.push(measureField.label.getMeasuredWidth());}
measureField.text=currentLabel.text;currentLabel.widthArrayCheck=true;positionBlinker();}
function backspaceRemovesLetter(once){var removalOkay=true;var timeOut;function haalWeg(){if(!currentLabel||currentLabel.text.length<1||that.currentIndex==0){removalOkay=false;}
if(removalOkay){removeLetter();if(timeOut)timeOut=zim.timeout(200,haalWeg,null,"ms");}
if(currentLabel&&currentLabel.text.length<1){stopRemoval();}}
function removeLetter(){if(currentLabel&&currentLabel.text.length>0){if(that.selectedIndex>0)addToLabel("del");if(once)stopRemoval();else that.on("pressup",stopRemoval);}else{addToLabel("del");}}
function stopRemoval(){removalOkay=false;if(timeOut)timeOut.clear();that.off("pressup",stopRemoval);}
removeLetter();timeOut=zim.timeout(300,haalWeg,null,"ms");if(that.stage)that.stage.update();}
function setLabels(){for(var i=0;i<labels.length;i++){labels[i].clickEvent=labels[i].on("click",activateLabel);}}
setLabels();function unsetLabels(){if(labels.length>1){for(var i=0;i<labels.length;i++){labels[i].off("click",labels[i].clickEvent);}}}
function makeCursor(){if(textBlinker)return;currentLabel=labels[0];maxWidth=(currentLabel&&currentLabel.label.lineWidth)?currentLabel.label.lineWidth:10000;if(currentLabel){textBlinker=new zim.Rectangle(3,currentLabel.height-((currentLabel.paddingVertical&&currentLabel.background)?currentLabel.paddingVertical*2:0),cursorColor,null,null,null,null,null,false).center(currentLabel);textBlinker.x=0;textBlinker.visible=false;textBlinker.animate({obj:{alpha:0},rewind:true,loop:true,loopWait:750,time:250,id:"knipperTekst",timeUnit:"ms"});for(var j=0;j<labels.length;j++){labels[j].widthArray=[0];}
makeWidthsArray();}}
makeCursor();function removeCursor(){zim.stopAnimate("knipperTekst");if(currentLabel)currentLabel.removeChild(textBlinker);textBlinker=null;currentLabel=null;}
Object.defineProperty(this,'selectedLabel',{get:function(){return currentLabel;},set:function(label){var obj={target:label};activateLabel(obj);that.hidePlace();}});Object.defineProperty(this,'selectedIndex',{get:function(){return insertPoint;},set:function(index){insertPoint=index;positionBlinker();}});this.show=function(index){that.addTo(container);if(!zot(index)){var obj={target:labels[index]};activateLabel(obj);}
if(textBlinker)textBlinker.visible=true;that.toggled=true;return that;};this.hide=function(){that.removeFrom(container);if(textBlinker)textBlinker.visible=false;currentStage.update();that.toggled=false;return that;};this.toggle=function(state){if(state===true)that.show();else if(state===false)that.hide();else if(that.parent)that.hide();else that.show();return that;};this.showPlace=function(){makeCursorShiftmenu();return that;};this.hidePlace=function(){removeCursorShiftMenu();return that;};this.addLabels=function(labs){if(!Array.isArray(labs))labs=[labs];for(var i=labs.length-1;i>=0;i--){var ind=labels.indexOf(labs[i]);if(ind>=0||labs[i].type!="Label")labs.splice(i,1);else labs[i].widthArray=[0];}
unsetLabels();labels=labels.concat(labs);setLabels();makeCursor();if(textBlinker)textBlinker.visible=true;return that;};this.removeLabels=function(labs){if(!Array.isArray(labs))labs=[labs];unsetLabels();for(var i=0;i<labs.length;i++){var ind=labels.indexOf(labs[i]);if(ind>=0)labels.splice(ind,1);}
setLabels();if(labels.length==0){if(currentLabel)removeCursor();}else{if(currentLabel&&labels.indexOf(currentLabel)==-1){removeCursor();makeCursor();}}
return that;};var background=new zim.Rectangle(this.width,this.height,zim.clear,null,null,null,null,null,false).addTo(this).expand().bot();background.on("mousedown",function(){});background.on("click",function(){});this.resize=function(){that.scaleTo(currentStage,100-margin*2/currentStage.width*100,50-margin*2/currentStage.height*100);that.y=currentStage.height-that.height-margin;that.x=currentStage.width/2-that.width/2;if(currentLabel&&cursorShiftMenu){var point=currentLabel.localToLocal(0,0,that);cursorShiftMenu.x=point.x;cursorShiftMenu.y=point.y+currentLabel.height+15;}
if(that.stage)that.stage.update();return that;};this.resize();if(that.selectedLabel)that.selectedIndex=that.selectedLabel.text.length;if(hardKeyboard){this.keydownEvent=function(e){if(!that.stage)return;var k=that;if(zot(k))return;if(e.keyCode==35)k.selectedIndex=k.selectedLabel.text.length;if(e.keyCode==36)k.selectedIndex=0;if(e.keyCode==37)k.selectedIndex=k.selectedIndex-1;if(e.keyCode==39)k.selectedIndex=k.selectedIndex+1;if(e.keyCode==46){if(k.selectedIndex<k.selectedLabel.text.length){k.selectedIndex=k.selectedIndex+1;k.removeChar();}}
if(e.keyCode==8){e.preventDefault();k.removeChar();}
k.addChar(e.key);if(that.stage)that.stage.update();};window.addEventListener("keydown",this.keydownEvent);}
if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){var kb=new zim.Keyboard(labels,backgroundColor,color,shiftBackgroundColor,shiftHoldBackgroundColor,placeBackgroundColor,cursorColor,shadeAlpha,margin,corner,draggable,placeClose,shadowColor,shadowBlur,container,data,place,special,rtl,hardKeyboard,layout,style,this.group,inherit);return that.cloneProps(kb);};this.dispose=function(a,b,disposing){background.removeAllEventListeners();background=null;if(that.keydownEvent)window.removeEventListener("keydown",that.keydownEvent);for(var i=0;i<that.labels.length;i++){that.labels[i].removeAllEventListeners();}
if(textBlinker)textBlinker.dispose();that.labels=currentLabel=null;if(currentStage)currentStage.off("pressmousemove",that.tickerMouseEvent);if(!disposing)that.zimContainer_dispose(true);return true;};};zim.extend(zim.Keyboard,zim.Container,["clone","dispose"],"zimContainer",false);zim.Organizer=function(width,list,useAdd,useRemove,usePosition,autoAdd,autoRemove,autoPosition,addForward,removeForward,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,color,rollColor,selectedColor,selectedRollColor,spacing,corner,keyEnabled,gradient,gloss,backdropColor,style,group,inherit){var sig="width, list, useAdd, useRemove, usePosition, autoAdd, autoRemove, autoPosition, addForward, removeForward, backgroundColor, rollBackgroundColor, selectedBackgroundColor, selectedRollBackgroundColor, color, rollColor, selectedColor, selectedRollColor, spacing, corner, keyEnabled, gradient, gloss, backdropColor, style, group, inherit";var duo;if(duo=zob(zim.Organizer,arguments,sig,this))return duo;z_d("67.3");this.group=group;var DS=style===false?{}:zim.getStyle("Organizer",this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:(list&&list.vertical)?list.width:300;if(zot(useAdd))useAdd=DS.useAdd!=null?DS.useAdd:true;if(zot(useRemove))useRemove=DS.useRemove!=null?DS.useRemove:true;if(zot(usePosition))usePosition=DS.usePosition!=null?DS.usePosition:true;if(zot(autoAdd))autoAdd=DS.autoAdd!=null?DS.autoAdd:useAdd;if(zot(autoRemove))autoRemove=DS.autoRemove!=null?DS.autoRemove:useRemove;if(zot(autoPosition))autoPosition=DS.autoPosition!=null?DS.autoPosition:usePosition;if(zot(addForward))addForward=DS.addForward!=null?DS.addForward:true;if(zot(removeForward))removeForward=DS.removeForward!=null?DS.removeForward:true;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"#777";if(zot(rollBackgroundColor))rollBackgroundColor=DS.rollBackgroundColor!=null?DS.rollBackgroundColor:"#555";if(zot(selectedBackgroundColor))selectedBackgroundColor=DS.selectedBackgroundColor!=null?DS.selectedBackgroundColor:"#333";if(zot(color))color=DS.color!=null?DS.color:"white";if(zot(rollColor))rollColor=DS.rollColor!=null?DS.rollColor:color;if(zot(selectedColor))selectedColor=DS.selectedColor!=null?DS.selectedColor:color;if(zot(selectedRollColor))selectedRollColor=DS.selectedRollColor!=null?DS.selectedRollColor:color;if(zot(spacing))spacing=DS.spacing!=null?DS.spacing:1;if(zot(corner))corner=DS.corner!=null?DS.corner:0;if(zot(gradient))gradient=DS.gradient!=null?DS.gradient:.2;if(zot(gloss))gloss=DS.gloss!=null?DS.gloss:null;if(zot(backdropColor))backdropColor=DS.backdropColor!=null?DS.backdropColor:null;if(!Array.isArray(corner)){corner=[corner,corner,corner,corner];}
if(!useAdd&&!usePosition&&!useRemove)return;var buttonNum=(useAdd?1:0)+(usePosition?4:0)+(useRemove?1:0);var buttonSize=(width+spacing)/buttonNum;var buttonStyle={width:buttonSize,height:buttonSize,label:"",shadowColor:-1,gradient:gradient,corner:corner,backgroundColor:backgroundColor,rollBackgroundColor:rollBackgroundColor};var buttons=[];var addIcon=new zim.Shape();addIcon.graphics.f(color).p("AAAA4Ih6B8Ig5g4IB8h8Ih7h6IA4g5IB6B8IB7h8IA5A5Ih8B6IB8B7Ig5A5g");if(useAdd)buttons.push(new zim.Button({icon:addIcon.sca(.55).rot(-45).reg(1),inherit:buttonStyle}));if(usePosition){var arrowIcon=new zim.Shape();arrowIcon.graphics.f(color).p("AiJieIETCeIkTCfg");buttons.push(new zim.Button({icon:arrowIcon.sca(.6).rot(list&&!list.vertical?180:-90).reg(-2),inherit:buttonStyle}));buttons.push(new zim.Button({icon:arrowIcon.clone().sca(.6).rot(list&&!list.vertical?0:90).reg(-2),inherit:buttonStyle}));var endIcon=new zim.Shape();endIcon.graphics.f(color).p("AiFCLIAAkVIBXAAIAAEVgAgiAAICoiHIAAEQg");buttons.push(new zim.Button({icon:endIcon.sca(.62).rot(list&&!list.vertical?0:90).reg(0),inherit:buttonStyle}));buttons.push(new zim.Button({icon:endIcon.clone().sca(.62).rot(list&&!list.vertical?180:-90).reg(0),inherit:buttonStyle}));}
if(useRemove)buttons.push(new zim.Button({icon:addIcon.clone().rot(0).sca(.55),inherit:buttonStyle}));if(buttons.length==0)buttons=[""];this.zimTabs_constructor(width,buttonSize,buttons,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,color,rollColor,selectedColor,selectedRollColor,false,spacing,true,false,corner,null,true,gradient,gloss,null,null,null,null,null,null,null,null,null,null,backdropColor);var that=this;that.list=list;that.type="Organizer";that.setButtons=function(){if(usePosition){var startIndex=useAdd?1:0;if(buttons[startIndex+0])buttons[startIndex+0].icon.rotation=that.list&&!that.list.vertical?180:-90;if(buttons[startIndex+1])buttons[startIndex+1].icon.rotation=that.list&&!that.list.vertical?0:90;if(buttons[startIndex+2])buttons[startIndex+2].icon.rotation=that.list&&!that.list.vertical?0:90;if(buttons[startIndex+3])buttons[startIndex+3].icon.rotation=that.list&&!that.list.vertical?180:-90;}};var listEvent=false;var lastList=list;that.change(function(e){if((!listEvent&&that.list)||(that.list&&that.list!=lastList)){if(that.list!=lastList){if(lastList)lastList.noChange();}
that.list.change(function(e){that.orgItem=that.list.selected;that.orgIndex=that.list.selectedIndex;});listEvent=true;lastList=that.list;}
var val=e.target.selectedIndex;if(!useAdd)val++;if(!usePosition&&(!useAdd||val>0))val=5;var badIndex=zot(that.list.selectedIndex)||that.list.selectedIndex<0;if(badIndex)that.currentValue=null;that.lastIndex=that.list.selectedIndex;switch(val){case 0:if(autoAdd){var index=Math.max(0,that.list.selectedIndex);that.add(index);}
that.orgType="add";break;case 1:if(badIndex)break;if(autoPosition){var index=that.list.selectedIndex;that.up(index);}
that.orgType="up";break;case 2:if(badIndex)break;if(autoPosition){var index=that.list.selectedIndex;that.down(index);}
that.orgType="down";break;case 3:if(badIndex)break;if(autoPosition){var index=that.list.selectedIndex;that.toTop(index);}
that.orgType="top";break;case 4:if(badIndex)break;if(autoPosition){var index=that.list.selectedIndex;that.toBottom(index);}
that.orgType="bottom";break;case 5:if(badIndex)break;if(autoRemove){var index=that.list.selectedIndex;that.remove(index);}
that.orgType="remove";break;}});this.add=function(index,item,clone){if(zot(index))index=that.lastIndex;if(zot(item))item="";if(addForward){var index=Math.min(that.list.length,Math.max(0,that.list.selectedIndex)+1);}else{var index=Math.max(0,that.list.selectedIndex);}
that.list.addAt(item,index,clone);that.list.selectedIndexPlusPosition=index;that.orgItem=that.list.selected;that.orgIndex=that.list.selectedIndex;return that;};this.up=function(index){if(zot(index))index=that.lastIndex;var button=that.list.items[index];if(zot(button))return that;that.list.removeAt(1,index);that.list.addAt(button,index-1);that.list.selectedIndexPlusPosition=Math.max(0,index-1);that.orgItem=that.list.selected;that.orgIndex=that.list.selectedIndex;return that;};this.down=function(index){if(zot(index))index=that.lastIndex;var button=that.list.items[index];if(zot(button))return that;that.list.removeAt(1,index);that.list.addAt(button,index+1);that.list.selectedIndexPlusPosition=Math.min(that.list.length-1,index+1);that.orgItem=that.list.selected;that.orgIndex=that.list.selectedIndex;return that;};this.toTop=function(index){if(zot(index))index=that.lastIndex;var button=that.list.items[index];if(zot(button))return that;that.list.removeAt(1,index);that.list.addAt(button,0);that.list.first();that.orgItem=that.list.selected;that.orgIndex=that.list.selectedIndex;return that;};this.toBottom=function(index){if(zot(index))index=that.lastIndex;var button=that.list.items[index];if(zot(button))return;that.list.removeAt(1,index);that.list.addAt(button,that.list.length);that.list.last();that.orgItem=that.list.selected;that.orgIndex=that.list.selectedIndex;return that;};this.remove=function(index){if(zot(index)){if(that.list.selectedIndex>=0)index=that.list.selectedIndex;else return that;}
var same=index==that.list.selectedIndex;that.removedItem=that.list.items[index];that.list.removeAt(1,index);if(same){if(!removeForward){index=Math.max(0,index-1);}}else{index=that.list.selectedIndex;}
that.list.selectedIndexPlusPosition=Math.min(that.list.length-1,index);that.orgItem=that.list.selected;that.orgIndex=that.list.selectedIndex;return that;};if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Organizer(width,list,useAdd,useRemove,usePosition,autoAdd,autoRemove,autoPosition,addForward,removeForward,backgroundColor,rollBackgroundColor,selectedBackgroundColor,selectedRollBackgroundColor,color,rollColor,selectedColor,selectedRollColor,spacing,corner,keyEnabled,gradient,gloss,backdropColor,style,that.group,inherit));};this.dispose=function(a,b,disposing){buttons=null;if(!disposing){that.zimTabs_dispose(true);}
return true;};};zim.extend(zim.Organizer,zim.Tabs,["clone","dispose"],"zimTabs",false);zim.Scrambler=function(tile,keys,keyProperty,scramble,time,wait,num,shadowColor,shadowBlur,swap,swapLock,style,group,inherit){var sig="tile, keys, keyProperty, scramble, time, wait, num, shadowColor, shadowBlur, swap, swapLock, style, group, inherit";var duo;if(duo=zob(zim.Scrambler,arguments,sig,this))return duo;z_d("67.35");this.zimContainer_constructor(null,null,null,null,false);this.type="Scrambler";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(tile))tile=DS.tile!=null?DS.tile:tile;if(zot(keys))keys=DS.keys!=null?DS.keys:null;if(zot(keyProperty))keyProperty=DS.keyProperty!=null?DS.keyProperty:null;if(zot(scramble))scramble=DS.scramble!=null?DS.scramble:true;if(zot(time))time=DS.time!=null?DS.time:0;if(zot(wait))wait=DS.wait!=null?DS.wait:0;if(zot(num))num=DS.num!=null?DS.num:1;if(zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.3)";if(zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:5;if(zot(swap))swap=DS.swap!=null?DS.swap:false;if(zot(swapLock))swapLock=DS.swapLock!=null?DS.swapLock:false;if(swapLock)swap=true;if(zot(tile))return;tile.addTo(this);var that=this;that.complete=true;var timeType=getTIME(time);getTIME(wait);var tileWidth=(tile.width+tile.spacingH)/tile.cols;var tileHeight=(tile.height+tile.spacingV)/tile.rows;var startX,startY;tile.on("mousedown",function(e){if(swapLock){var current=tile.current;if(that.testItem(e.target,current.indexOf(e.target))){e.target.noMouse();e.target.noDrag();return;}}
startX=e.target.x;startY=e.target.y;if(shadowColor!=-1&&shadowBlur>0){var shad=new createjs.Shadow(shadowColor,3,3,shadowBlur);if(e.target.backing)e.target.backing.shadow=shad;else e.target.shadow=shad;}
if(that.upEvent)tile.off("pressup",that.upEvent);that.upEvent=tile.on("pressup",function(e){var good=true;if(swapLock){var cbg=e.target.boundsToGlobal();var index=tile.hitTestGrid(tile.width,tile.height,tile.cols,tile.rows,cbg.x+cbg.width/2,cbg.y+cbg.height/2,null,null,tile.spacingH,tile.spacingV,null,"open");if(zot(index))good=false;else{var currentTile=current[index[0]];if(e.target==currentTile)good=false;else good=!that.testItem(currentTile,index[0]);}}
if(swap&&good)doMove(e);e.target.mouseEnabled=false;e.target.animate({props:{x:startX,y:startY},time:.1,id:"zimScrambler",timeUnit:"seconds",call:function(){if(!that.complete&&that.test()){that.complete=true;that.dispatchEvent("complete");}
if(shadowColor!=-1&&shadowBlur>0){if(e.target.backing)e.target.backing.shadow=null;else e.target.shadow=null;}
e.target.mouseEnabled=true;}});},null,true);if(!swap){if(that.moveEvent)tile.off("pressmove",that.moveEvent);that.moveEvent=tile.on("pressmove",function(e){doMove(e);});}});function doMove(e){var current=e.target;current.stopAnimate();var cbg=current.boundsToGlobal();var cdata=tile.hitTestGrid(tile.width,tile.height,tile.cols,tile.rows,cbg.x+cbg.width/2,cbg.y+cbg.height/2,null,null,tile.spacingH,tile.spacingV,null,"open");if(zot(cdata))return;zim.loop(tile,function(t){if(t==current||t.paused===false)return;var tbg=t.boundsToGlobal();var tdata=tile.hitTestGrid(tile.width,tile.height,tile.cols,tile.rows,tbg.x+tbg.width/2,tbg.y+tbg.height/2,null,null,tile.spacingH,tile.spacingV,null,"open");if(zot(tdata))return;if(cdata[2]==tdata[2]&&((t.x>=current.x&&t.x<=current.x+tileWidth/2)||(t.x<=current.x&&t.x>=current.x-tileWidth/2))){var temp=t.x;t.mouseEnabled=false;t.top().ord(-1);t.animate({props:{x:startX},time:.2,id:"zimScrambler",timeUnit:"seconds",call:function(){t.mouseEnabled=true;if(swap&&!that.complete&&that.test()){that.complete=true;that.dispatchEvent("complete");}}});startX=temp;}
if(cdata[1]==tdata[1]&&((t.y>=current.y&&t.y<=current.y+tileHeight/2)||(t.y<=current.y&&t.y>=current.y-tileHeight/2))){var temp=t.y;t.mouseEnabled=false;t.top().ord(-1);t.animate({props:{y:startY},time:.201,override:false,id:"zimScrambler",timeUnit:"seconds",call:function(){t.mouseEnabled=true;if(swap&&!that.complete&&that.test()){that.complete=true;that.dispatchEvent("complete");}}});startY=temp;}},true);}
this.test=function(){var current=tile.current;return zim.loop(current,function(item,i){if(zot(item))return false;if(!that.testItem(item,i))return false;});};this.testItem=function(item,i){if(zot(item))return;if(zot(i))i=tile.current.indexOf(item);if(keys){var key=zot(keyProperty)?item.key:item[keyProperty];if(key!=keys[i])return false;}else{if(tile.items[i]!=item)return false;}
return true;};this.starts=[];this.order=[];zim.loop(tile.rows*tile.cols,function(i){that.order.push(i);});var startOrder=that.order.slice();tile.loop(function(t){that.starts.push({x:t.x,y:t.y});});this.inactive=false;this.scramble=function(time,wait,num){if(zot(wait))wait=0;if(zot(time))time=0;if(zot(num)||time==0)num=1;offScrambler();zim.timeout(wait,function(){if(time>0)zim.interval(time/num,doScramble,num,true);else doScramble();});setTimeout(function(){that.complete=false;tile.loop(function(t){t.mouse();});that.mouse();tile.drag({boundary:tile});},timeType=="s"?(wait+time)*1000:wait+time);function doScramble(){var answer=true;var times=0;while(answer&&times<50){times++;zim.shuffle(that.order);answer=zim.loop(that.order,function(o,i){var item=tile.getChildAt(o);if(keys){var key=zot(keyProperty)?item.key:item[keyProperty];if(key!=keys[i])return false;}else{if(tile.items[i]!=item)return false;}});}
moveTiles(that.order,time/num);zim.timeout(time,function(){that.dispatchEvent("scrambled");})}};if(scramble){that.scramble(time,wait,num);}else{that.added(function(){tile.drag({boundary:tile});});}
function offScrambler(){if(that.upEvent)tile.off("pressup",that.upEvent);if(that.moveEvent)tile.off("pressmove",that.moveEvent);tile.noDrag();if(wait+time>0){that.noMouse();}}
function moveTiles(order,time,wait,disable){zim.stopAnimate("zimScrambler");zim.loop(tile.items,function(item,i,t){var start=that.starts[order[i]];if(time){item.animate({props:{x:start.x,y:start.y},time:time,ease:wait?"quadInOut":"quadOut",wait:wait,timeUnit:"seconds",id:"zimScrambler"});}else{item.loc(start);if(that.stage){item.drag({boundary:tile});}else{if(i==t-1){that.added(function(){tile.drag({boundary:tile});});}}}});}
this.solve=function(time,wait,disable){if(zot(disable))disable=true;if(zot(wait))wait=0;if(zot(time))time=0;if(wait+time==0&&disable)that.noMouse();setTimeout(function(){that.order=startOrder.slice();offScrambler();moveTiles(that.order,time,0,disable);},timeType=="s"?wait*1000:wait);if(!disable){setTimeout(function(){that.mouse();tile.drag({boundary:tile});},timeType=="s"?(wait+time)*1000:wait+time);}};this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){zenable(that,value);if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&that.stage)that.stage.update();}});this.dispose=function(a,b,disposing){tile.removeAllEventListeners();if(!disposing){that.zimContainer_dispose(true);if(that.stage)that.stage.update();}
return true;};if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Scrambler(tile.clone(),keys,keyProperty,scramble,time,wait,num,shadowColor,shadowBlur,swap,swapLock,style,that.group,inherit));};};zim.extend(zim.Scrambler,zim.Container,["clone","dispose"],"zimContainer",false);zim.Connectors=function(width,height,points,node,line,linear,linearWrap,linearOrder,num,snapH,snapV,dropType,deleteNode,dblclick,fullMove,min,max,boundary,expand,nodeRollColor,nodeRollBorderColor,nodeSelectedColor,nodeSelectedBorderColor,baseColor,baseBorderColor,baseRollover,rootLock,grandChildren,dblclickTime,style,group,inherit){var sig="width, height, points, node, line, linear, linearWrap, linearOrder, num, snapH, snapV, dropType, deleteNode, dblclick, fullMove, min, max, boundary, expand, nodeRollColor, nodeRollBorderColor, nodeSelectedColor, nodeSelectedBorderColor, baseColor, baseBorderColor, baseRollover, rootLock, grandChildren, dblclickTime, style, group, inherit";var duo;if(duo=zob(zim.Connectors,arguments,sig,this))return duo;z_d("67.39");this.group=group;var DS=style===false?{}:zim.getStyle("Connectors",this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:null;if(zot(height))height=DS.height!=null?DS.height:null;this.zimContainer_constructor(null,null,null,null,false);this.type="Connectors";if(zot(points))points=DS.points!=null?DS.points:[[0,0],[100,0],[100,100],[0,100]];if(zot(node))node=DS.node!=null?DS.node:new zim.Circle(10,zim.grey,zim.grey);node.removeFrom();if(node.color==zim.clear&&!node.hitArea)node.expand(0);if(zot(line))line=DS.line!=null?DS.line:new zim.Line({length:10,thickness:3,color:zim.tin,strokeObj:{caps:"round"}});if(zot(num))num=DS.num!=null?DS.num:10;if(zot(linear))linear=DS.linear!=null?DS.linear:false;if(zot(linearWrap))linearWrap=DS.linearWrap!=null?DS.linearWrap:true;if(zot(nodeRollColor))nodeRollColor=DS.nodeRollColor!=null?DS.nodeRollColor:node.color.match("rgb")?node.color:node.color.lighten(.2);if(zot(nodeRollBorderColor))nodeRollBorderColor=DS.nodeRollBorderColor!=null?DS.nodeRollBorderColor:node.borderColor;if(zot(nodeSelectedColor))nodeSelectedColor=DS.nodeSelectedColor!=null?DS.nodeSelectedColor:zim.white;if(zot(nodeSelectedBorderColor))nodeSelectedBorderColor=DS.nodeSelectedBorderColor!=null?DS.nodeSelectedBorderColor:node.borderColor;if(zot(baseColor))baseColor=DS.baseColor!=null?DS.baseColor:node.color;if(zot(baseBorderColor))baseBorderColor=DS.baseBorderColor!=null?DS.baseBorderColor:node.borderColor;if(zot(baseRollover))baseRollover=DS.baseRollover!=null?DS.baseRollover:false;if(zot(min))min=DS.min!=null?DS.min:node.radius?node.radius*2:Math.min(node.width,node.height);if(zot(max))max=DS.max!=null?DS.max:null;if(zot(expand))expand=DS.expand!=null?DS.expand:zim.mobile()?10:0;if(zot(dropType))dropType=DS.dropType!=null?DS.dropType:"any";if(zot(deleteNode))deleteNode=DS.deleteNode!=null?DS.deleteNode:true;if(zot(dblclick))dblclick=DS.dblclick!=null?DS.dblclick:true;if(zot(fullMove))fullMove=DS.fullMove!=null?DS.fullMove:true;if(zot(dblclickTime))dblclickTime=DS.dblclickTime!=null?DS.dblclickTime:.5;var timeType=getTIME(dblclickTime);dblclickTime*=timeType=="s"?1000:1;if(zot(snapH))snapH=DS.snapH!=null?DS.snapH:null;if(zot(snapV))snapV=DS.snapV!=null?DS.snapV:null;if(zot(rootLock))rootLock=DS.rootLock!=null?DS.rootLock:false;if(zot(grandChildren))grandChildren=DS.grandChildren!=null?DS.grandChildren:true;if(linear&&points.length<=1){if(zon)zogy("Connector() - linear needs more than one point");return;}
var that=this;that.node=node;that.line=line;var nodeColor=node.color;var nodeBorderColor=node.borderColor;var offColor=zim.faint;var lines=that.lines=new zim.Container(width,height).addTo(that);var nodes=that.nodes=new zim.Container(width,height).addTo(that);if(points.type=="Blob"||points.type=="Squiggle"){var p=[];zim.loop(points.points,function(point){p.push([point[0],point[1]]);});points=p;}
that.points=points;this.addNode=function(x,y,base){if(linear)return;return addNode(x,y);};function addNode(x,y,base,orientation){if(x.addChild){dropType="on";rootLock=true;grandChildren=false;base=x;if(!base.connectorMoveEvent){if(!that.bases)that.bases=[];that.bases.push(base);base.connectorMoveEvent=base.on("pressmove",function(){base.positionConnectors(base,true,true);});base.connectorUpEvent=base.on("pressup",function(){base.positionConnectors(base,true,true);});if(baseRollover){base.connectorOverEvent=base.on("mouseover",function(){addBaseColors(base);});base.connectorOutEvent=base.on("mouseout",function(){removeBaseColors(base);});}
base.positionConnectors=function(base,arrowAdjustStart,arrowAdjustEnd){zim.loop(base.connectors,function(node){var newPoint=base.parent.localToLocal(base.x-base.baseStart.x+node.nodeStart.x,base.y-base.baseStart.y+node.nodeStart.y,node.parent);node.x=newPoint.x;node.y=newPoint.y;drawLines(node,arrowAdjustStart,arrowAdjustEnd);});if(base.stage)base.stage.update();};base.setConnectorColors=function(color,borderColor,rollColor,rollBorderColor){if(!zot(color))base.connectorColor=color;if(!zot(borderColor))base.connectorBorderColor=borderColor;if(!zot(rollColor))base.connectorRollColor=rollColor;if(!zot(rollBorderColor))base.connectorRollBorderColor=rollBorderColor;zim.loop(base.connectors,function(node){if(!zot(color))node.color=color;if(!zot(borderColor))node.borderColor=borderColor;});return base;};base.setConnectorColors(baseColor,baseBorderColor,nodeRollColor,nodeRollBorderColor);}
var baseBounds=base.getBounds();if(line.endHead)
baseBounds;if(!Array.isArray(y))y=[y,y];var basePoints=[];if(y.length==2)y=[y[0],y[1],y[0],y[1]];if(line.lineOrientation==zim.HORIZONTAL||line.lineOrientation=="auto"){zim.loop([y[0],y[1]],function(data,i){if(data==-1||data==-2){var top=base.localToLocal(i==0?baseBounds.x:baseBounds.x+baseBounds.width,baseBounds.y,that);basePoints.push([top.x,top.y,zim.HORIZONTAL]);}
if(data==-1||data==-3){var bot=base.localToLocal(i==0?baseBounds.x:baseBounds.x+baseBounds.width,baseBounds.y+baseBounds.height,that);basePoints.push([bot.x,bot.y,zim.HORIZONTAL]);}
if(data>0){zim.loop(data,function(j,t){var side=base.localToLocal(i==0?baseBounds.x:baseBounds.x+baseBounds.width,baseBounds.y+baseBounds.height*(j+1)/(t+1),that);basePoints.push([side.x,side.y,zim.HORIZONTAL]);});}});}
if(line.orientation==zim.VERTICAL||line.lineOrientation=="auto"){zim.loop([y[2],y[3]],function(data,i){if(data==-1||data==-2){var left=base.localToLocal(baseBounds.x,i==0?baseBounds.y:baseBounds.y+baseBounds.height,that);basePoints.push([left.x,left.y,zim.VERTICAL]);}
if(data==-1||data==-3){var right=base.localToLocal(baseBounds.x+baseBounds.width,i==0?baseBounds.y:baseBounds.y+baseBounds.height,that);basePoints.push([right.x,right.y,zim.VERTICAL]);}
if(data>0){zim.loop(data,function(j,t){var side=base.localToLocal(baseBounds.x+baseBounds.width*(j+1)/(t+1),i==0?baseBounds.y:baseBounds.y+baseBounds.height,that);basePoints.push([side.x,side.y,zim.VERTICAL]);});}});}
base.connectors=[];base.baseStart=new zim.Point(base.x,base.y);zim.loop(basePoints,function(point){var node=addNode(point[0],point[1],base,point[2]);addBaseConnector(base,node);});setTimeout(function(){base.positionConnectors(base,true,true);},50);return that;}
var theNode=node.clone().loc(x,y,nodes).drag({boundary:boundary}).expand(expand);theNode.orientation=orientation;theNode.on("mouseover",overNode);theNode.on("mouseout",outNode);theNode.on("mousedown",downNode);theNode.on("pressmove",moveNode);theNode.on("pressup",upNode);if(deleteNode)theNode.hold(holdNode);theNode.creations=[];return theNode;}
function setNodes(){zim.loop(points,function(point){var node=addNode(point[0],point[1]);});if(linear){nodes.loop(function(node,i,t){if(i==0){if(linearWrap){node.before=nodes.getChildAt(t-1);}else{node.before=null;}
node.after=nodes.getChildAt(i+1);}else if(i==t-1){if(linearWrap){node.after=nodes.getChildAt(0);}else{node.after=null;}
node.before=nodes.getChildAt(i-1);}else{node.before=nodes.getChildAt(i-1);node.after=nodes.getChildAt(i+1);}
if(linearOrder&&i>0)node.noMouse();});}}
setNodes();that.keyEvent=function(e){if(deleteNode&&e.keyCode==46){zim.loop(selectedList,function(obj){if(obj&&obj.parent)removeNode(obj);});if(that.stage)that.stage.update();}}
window.addEventListener("keydown",that.keyEvent);function holdNode(e){var stage=e.target.stage;var node=e.target;if(that.bases||(rootLock&&!node.creator.creator))return;if(node.adding)removeNode(node.creator);else removeNode(node);if(stage)stage.update();}
function overNode(e){var node=e.target;if(node.selected)return;node.color=node.base?node.base.connectorRollColor:nodeRollColor;node.borderColor=node.base?node.base.connectorRollBorderColor:nodeRollBorderColor;if(that.stage)that.stage.update();}
function outNode(e){var node=e.target;if(node.selected)return;node.color=node.base?node.base.connectorColor:nodeColor;node.borderColor=node.base?node.base.connectorBorderColor:nodeBorderColor;if(that.stage)that.stage.update();}
var selectedList=[];var stagedownID;var downCount=0;var downID;function downNode(e){var child=e.target;if(!linear&&(!rootLock||child.creator)&&dblclick){if(downCount==0){downID=setTimeout(function(){downCount=0;if(selectedList){var frame=that.stage?that.stage.frame:zdf;var clearMove=nodes.loop(function(node){if(node.hitTestPoint(frame.mouseX,frame.mouseY)&&node.selected)return false;});if(clearMove)clearselectedList();}},dblclickTime);}
downCount++;}
child.startX=child.x;child.startY=child.y;if(!linear&&selectedList.length>0){zim.loop(selectedList,function(obj){obj.startX=obj.x;obj.startY=obj.y;});}
if(child.creations.length>=num||child.selected||(child.creator&&!grandChildren))return;child.adding=true;var parent=addNode(child.x,child.y).bot();parent.creations=child.creations;parent.creatorLine=child.creatorLine;parent.creator=child.creator;parent.orientation=child.orientation;parent.startX=child.startX;parent.startY=child.startY;if(child.base){parent.base=child.base;parent.baseStart=child.baseStart;parent.nodeStart=child.nodeStart;parent.connectors=child.connectors;child.base=child.baseStart=child.nodeStart=child.connectors=null;if(parent.base.connectors)parent.base.connectors.splice(parent.base.connectors.indexOf(child),1,parent);parent.color=parent.base.connectorColor;parent.borderColor=parent.base.connectorBorderColor;}
parent.before=child.before;parent.after=child.after;if(parent.before)parent.before.after=parent;if(parent.after)parent.after.before=parent;if(parent.creator){var index=parent.creator.creations.indexOf(child);if(index!=-1)parent.creator.creations.splice(index,1,parent);}
zim.loop(parent.creations,function(creation){creation.creator=parent;});child.creator=parent;child.creatorLine=line.clone().setPoints(child.x,child.y,child.x,child.y).addTo(lines).alp(0);child.creatorLine.lineOrientation=child.orientation;child.creatorLine.node=child;child.creatorLine.creatorNode=parent;child.creations=[];parent.creations.push(child);}
function moveNode(e){var node=e.target;if(node.creatorLine)node.creatorLine.alp(1);if(!linear&&selectedList.length>0&&selectedList.indexOf(node)==-1)clearselectedList();drawLines(node,false,true);if(that.bases){zim.loop(that.bases,function(base){if(node.creator&&node.creator.base==base)return;if(!base.connectorsOn&&node.hitTestBounds(base)){addBaseColors(base);}
if(base.connectorsOn&&!node.hitTestBounds(base)){removeBaseColors(base);}});}
that.stage.update();}
function upNode(e){var node=e.target;if(that.bases){zim.loop(that.bases,function(base){if(base==node.base)return;if(base.connectorsOn){removeBaseColors(base);}});}
var dbl=false;if(!linear&&downCount>1){clearTimeout(downID);var n=node.adding?node.creator:node;if(node.adding)removeNode(n.creations[n.creations.length-1]);if(!n.selected){var frame=that.stage?that.stage.frame:zdf;selectNode(n,!frame.ctrlKey);}
downCount=0;dbl=true;}
if(!linear&&!that.base){if(snapH)node.x=Math.round(node.x/snapH)*snapH;if(snapV)node.y=Math.round(node.y/snapV)*snapV;}
if((min&&zim.dist(node.x,node.y,node.startX,node.startY)<min)||(max&&zim.dist(node.x,node.y,node.startX,node.startY)>max)){if(node.adding){removeNode(node);}else{node.loc(node.startX,node.startY);if(!dbl)drawLines(node);}
that.stage.update();that.dispatchEvent("noconnection");return;}
var complete=false;var connected=false;if(linear){var parentNode=node.creator;that.connectionStart=parentNode;that.connectionEnd=node;if(parentNode.before&&node.hitTestCircle(parentNode.before)&&!linearOrder){node.loc(parentNode.before).removeFrom();parentNode.before.after=null;if(!parentNode.before.before)parentNode.before.noMouse();parentNode.before=null;if(!parentNode.after)parentNode.noMouse();connected=true;complete=testComplete();}else if(parentNode.after&&node.hitTestCircle(parentNode.after)){node.loc(parentNode.after).removeFrom();parentNode.after.before=null;if(!parentNode.after.after)parentNode.after.noMouse();if(linearOrder)parentNode.after.mouse();parentNode.after=null;if(!parentNode.before)parentNode.noMouse();if(linearOrder)parentNode.noMouse();connected=true;complete=testComplete();}else{if(!parentNode||node.creations.length>0){node.loc(node.startX,node.startY).bot();}else{removeNode(node);that.stage.update();that.dispatchEvent("noconnection");return;}}}else{if(dropType=="off"){var good=nodes.loop(function(obj){if(node==obj)return;if(node.hitTestCircles(obj)){if(node.adding)removeNode(node);else{node.loc(node.startX,node.startY);drawLines(node);}
if(rootLock)checkRootLock(node);if(!fullMove&&node.creator&&num>0&&node.creator.creations.length>=num)node.creator.noMouse();that.dispatchEvent("connection");that.stage.update();return false;}});if(!good){noConnect(node);return;}}else if(dropType=="on"||dropType=="single"){var hitCount=0;var hitObj;var bad=nodes.loop(function(obj,i,total){if(node==obj)return;if(node.hitTestCircles(obj)){hitObj=obj;if(that.bases&&(node.orientation!=obj.orientation||(node.creator&&node.creator.base&&node.creator.base==obj.base)))return;if(dropType=="on")return false;hitCount++;hitCount+=obj.creations.length;}});if(bad&&!(dropType=="single"&&hitCount==1)){noConnect(node);return;}else{node.loc(hitObj);if((node.creator&&node.orientation==zim.VERTICAL&&Math.round(node.y)==Math.round(node.creator.startY))||(node.creator&&node.orientation==zim.HORIZONTAL&&Math.round(node.x)==Math.round(node.creator.startX)))return;if(hitObj.base&&hitObj.base.connectors)addBaseConnector(hitObj.base,node);complete=true;}}}
if(!fullMove&&node.creator&&num>0&&node.creator.creations.length>=num)node.creator.noMouse();node.adding=false;drawLines(node,true,true);zim.loop(selectedList,function(obj){obj.startX=obj.x;obj.startY=obj.y;});node.startX=node.x;node.startY=node.y;if(rootLock)checkRootLock(node);if(connected)that.dispatchEvent("connection");else that.dispatchEvent("noconnection");if(complete)that.dispatchEvent("complete");that.stage.update();}
function noConnect(node){if(node.adding||!grandChildren)removeNode(node);else{node.loc(node.startX,node.startY);drawLines(node);}
if(rootLock)checkRootLock(node);if(node.base&&node.base.connectors)removeBaseConnector(node.base,node);that.stage.update();that.dispatchEvent("noconnection");}
function addBaseColors(base){zim.loop(base.connectors,function(node){node.color=base.connectorRollColor;node.borderColor=base.connectorRollBorderColor;});base.connectorsOn=true;base.stage.update();}
function removeBaseColors(base){zim.loop(base.connectors,function(node){node.color=base.connectorColor;node.borderColor=base.connectorBorderColor;});base.connectorsOn=false;base.stage.update();}
function addBaseConnector(base,node){base.connectors.push(node);node.nodeStart=node.parent.localToLocal(node.x,node.y,base.parent);node.nodeStart.x-=base.x-base.baseStart.x;node.nodeStart.y-=base.y-base.baseStart.y;node.base=base;}
function removeBaseConnector(base,node){base.connectors.splice(base.connectors.indexOf(node),1);node.nodeStart=null;node.base=null;}
function checkRootLock(node){if(!node.creator)return;if(node.creator.creator){checkRootLock(node.creator);return;}
if(node.creator&&node.creator.creations.length>=num)node.creator.noMouse();else node.creator.mouse();}
function selectNode(n,children){if(children){zim.loop(n.creations,function(c){selectNode(c,children);});}
n.selected=true;n.color=n.base?n.base.connectorColor:nodeSelectedColor;n.borderColor=n.base?n.base.connectorBorderColor:nodeSelectedBorderColor;selectedList.push(n);n.top();if(!stagedownID){stagedownID=that.stage.on("stagemousedown",function(e){var frame=that.stage?that.stage.frame:zdf;var clearMove=nodes.loop(function(node){if(node.hitTestPoint(frame.mouseX,frame.mouseY))return false;});if(clearMove)clearselectedList();});}}
this.selectNode=function(node,children){selectNode(node,children);};function testComplete(){var complete=nodes.loop(function(node){if(node.before||node.after){return false;}});if(complete){nodes.loop(function(node){node.noMouse();});return true;}}
function clearselectedList(){zim.loop(selectedList,function(obj){obj.selected=false;obj.color=obj.base?obj.base.connectorColor:nodeColor;obj.borderColor=obj.base?obj.base.connectorBorderColor:nodeBorderColor;});selectedList=[];that.stage.off("stagemousedown",stagedownID);stagedownID=null;that.stage.update();}
function drawLines(node,arrowAdjustStart,arrowAdjustEnd){var list=selectedList.length>0?selectedList:[node];zim.loop(list,function(obj){if(obj!=node)obj.loc(obj.startX+node.x-node.startX,obj.startY+node.y-node.startY);if(obj.creator){obj.creatorLine.setPoints(obj.x,obj.y,obj.creator.x,obj.creator.y,arrowAdjustStart,arrowAdjustEnd);}
zim.loop(obj.creations,function(creation){creation.creatorLine.setPoints(creation.x,creation.y,creation.creator.x,creation.creator.y,arrowAdjustStart,arrowAdjustEnd);});});}
function removeNode(node){zim.loop(node.creations,function(creation){removeNode(creation);},true);if(node.creatorLine){node.creatorLine.removeFrom();var index=node.creator.creations.indexOf(node);if(index!=-1)node.creator.creations.splice(index,1);if(!node.creator.mouseEnabled&&!(rootLock&&!node.creator.creator))node.creator.mouse();}
node.removeFrom();node.removeAllEventListeners();node=null;return that;}
this.removeNode=function(node){removeNode(node);};function arrive(node){nodes.loop(function(n){if(node==n)return;if(node.type=="Circle"){if(n.hitTestCircles(node))n.color=offColor;}else{if(n.hitTestBounds(node))n.color=offColor;}});}
function leave(node){var set=false;nodes.loop(function(n){if(node==n)return;if(node.type=="Circle"){if(n.hitTestCircles(node)){if(!set){n.color=nodeColor;set=true;}else{n.color=offColor;}}}else{if(n.hitTestBounds(node)){if(!set){n.color=nodeColor;set=true;}else{n.color=offColor;}}}});}
this.removeConnectors=function(){zim.loop(nodes,function(node){removeNode(node);},true);setNodes();that.stage.update();};this.removeBase=function(base){zim.loop(base.connectors,function(node){removeNode(node);});clearBaseEvents(base);};this.addBase=function(base,baseInfo){addNode(base,baseInfo);};function clearBaseEvents(base){base.off("pressmove",base.connectorMoveEvent);base.off("pressup",base.connectorUpEvent);if(base.connectorOverEvent)base.off("mouseover",base.connectorOverEvent);if(base.connectorOutEvent)base.off("mouseout",base.connectorOutEvent);base.connectors=null;base.baseStart=null;base.positionConnectors=base.setConnectorColors=null;base.connectorColor=base.connectorBorderColor=base.connectorRollColor=base.connectorRollBorderColor=null;that.bases.splice(that.bases.indexOf(base),1);if(that.stage)that.stage.update();}
Object.defineProperty(this,'selectedList',{get:function(){return selectedList;},set:function(value){if(zon)zogy("Selectors() - selectedList is read only");}});this.dispose=function(a,b,disposing){that.nodes.loop(function(node){node.removeFrom();node.removeAllEventListeners();node=null;},true);that.lines.loop(function(line){line.removeFrom();line=null;},true);window.removeEventListener("keydown",that.keyEvent);that.keyEvent=null;if(that.bases){zim.loop(that.bases,function(base){clearBaseEvents(base);});}
if(!disposing){that.zimContainer_dispose(true);if(that.stage)that.stage.update();}
return true;};if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Collectors(width,height,points,node,line,linear,linearWrap,linearOrder,num,snapH,snapV,dropType,deleteNode,dblclick,fullMove,min,max,boundary,expand,nodeRollColor,nodeRollBorderColor,nodeSelectedColor,nodeSelectedBorderColor,baseColor,baseBorderColor,baseRollover,rootLock,grandChildren,dblclickTime,style,that.group,inherit));};};zim.extend(zim.Connectors,zim.Container,["clone","dispose"],"zimContainer",false);zim.Marquee=function(width,height,items,time,transition,speed,direction,marginLeft,marginRight,marqueeType,borderColor,borderWidth,refresh,mix,style,group,inherit){var sig="width, height, items, time, transition, speed, direction, marginLeft, marginRight, marqueeType, borderColor, borderWidth, refresh, mix, style, group, inherit";var duo;if(duo=zob(zim.Marquee,arguments,sig,this))return duo;z_d("67.4");this.group=group;var DS={};var DS=style===false?{}:zim.getStyle("Marquee",this.group,inherit);var that=this;if(zot(width))width=DS.width!=null?DS.width:300;if(zot(height))height=DS.height!=null?DS.height:100;var timeType=getTIME(time);if(zot(time))time=DS.time!=null?DS.time:timeType=="s"?5:5000;if(zot(transition))transition=DS.transition!=null?DS.transition:"slide";if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:"#333";if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:1;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(marginLeft))marginLeft=DS.marginLeft!=null?DS.marginLeft:25;if(zot(marginRight))marginRight=DS.marginRight!=null?DS.marginRight:25;if(zot(speed))speed=DS.speed!=null?DS.speed:timeType=="s"?.5:500;checkTIME(speed,timeType);if(zot(direction))direction=DS.direction!=null?DS.direction:"right";if(zot(refresh))refresh=DS.refresh!=null?DS.refresh:timeType=="s"?30*60:30*60*1000;if(zot(mix))mix=DS.mix!=null?DS.mix:true;this.zimContainer_constructor(width+marginLeft+marginRight,height,null,null,false);this.type="Marquee";this.speed=speed;var mask=new zim.Rectangle(width-1,height-1,zim.clear).addTo(that).mov(marginLeft+.5,.5);var content=this.content=new zim.Container(width,height).loc(marginLeft,0,that).setMask(mask);var pages=this.pages=new zim.Pages(null,transition,speed,null,content).addTo(content);var startCheck=false;this.add=function(obj,url,target,skip,center){if(zot(center))center=true;obj.scaleTo(content);if(url)obj.cur().on("click",function(){zgo(url,target);});pages.addPage(obj);if(center)pages.center();obj.marqueeViews=0;obj.marquee=that;if(!startCheck)startSelection();if(!skip)makeIndicator();if(border)border.top();};this.remove=function(obj){if(that.selected==obj){if(that.pages.pages.length==1)return;var newIndex=that.selectedIndex+1;if(newIndex==that.pages.pages.length)newIndex=0;that.pages.go(newIndex,null,null,0);setTimeout(function(){that.pages.removePage(obj);if(obj.dispose)obj.dispose();makeIndicator();},20);}else{that.pages.removePage(obj);if(obj.dispose)obj.dispose();makeIndicator();}};function startSelection(){startCheck=true;that.selectedIndex=0;that.selected=pages.pages[that.selectedIndex].page;that.lastSelected=null;if(that.selected.marqueeOn)that.selected.marqueeOn();that.interval=zim.interval(time,function(){that.go();});}
if(!zot(items)&&!Array.isArray(items))items=[items];if(items&&items.length>0){if(mix)zim.shuffle(items);zim.loop(items,function(item){that.add(item,null,null,true);});}
if(refresh>0)var to=zim.timeout(refresh*(timeType=="s"?1000:1),function(){location.reload();},null,"ms");that.go=function(page){that.selected.marqueeViews+=1;if(that.selected.marqueeOff)that.selected.marqueeOff();if(page){that.selected=page;zim.loop(pages.pages,function(p,i){if(p.page==page){that.selectedIndex=i;return;}});that.interval.interval=that.selected.marqueeTime?that.selected.marqueeTime:time;that.interval.pause(pause.toggled,null,true);}else{var next=that.selectedIndex+1;that.selectedIndex=next%pages.pages.length;that.selected=pages.pages[that.selectedIndex].page;that.interval.time=that.selected.marqueeTime?that.selected.marqueeTime:time;}
that.dispatchEvent("page");if(that.selected.marqueeOn)that.selected.marqueeOn();pages.go(that.selected,direction,transition,speed);};pages.on("pagetransitioned",function(){that.dispatchEvent("pagetransitioned");if(that.indicator)that.indicator.selectedIndex=that.selectedIndex;});var _paused=false;var left=that.left=new zim.Container(marginLeft-4,height-4);var pauseIcon=new zim.Shape().sca(.6);pauseIcon.graphics.f(zim.light).mt(0,0).p("AAhCLIAAkVIBXAAIAAEVgAh3CLIAAkVIBXAAIAAEVg");var playIcon=new zim.Shape().sca(.6).reg(-2,0);playIcon.graphics.f(zim.light).mt(0,0).p("AiJieIETCeIkTCfg");var pause=that.button=new zim.Button({label:"",icon:pauseIcon,toggleIcon:playIcon,width:45,height:45,corner:0,shadowBlur:0}).scaleTo(left,100).pos(0,0,false,true,left);pause.on("click",function(){if(that.interval)that.interval.pause(pause.toggled);_paused=pause.toggled;that.stage.update();});var prop;function makeIndicator(){if(zot(marginLeft)||marginLeft==0)return;var gutterLeft=4*marginLeft/25;left.pos((marginLeft-left.width)-gutterLeft,gutterLeft/2,false,true,that);if(that.indicator){that.indicator.dispose();that.indicator.removeFrom();}
if(!prop)prop=new zim.Proportion(8,16,left.width+gutterLeft,left.width/2+gutterLeft,-1);that.indicator=new zim.Indicator({width:(pages.pages.length<=2?pages.pages.length:pages.pages.length-1)*(left.width-3),height:prop.convert(pages.pages.length),num:pages.pages.length,shadowBlur:-1,interactive:true,scale:1.2,indicatorType:marqueeType});that.indicator.fit(0,0,height-pause.height,pause.width);that.indicator.rot(direction=="down"?-90:90).center(left).pos(null,left.width-gutterLeft/2,null,true);that.indicator.selectedIndex=that.selectedIndex;that.indicator.on("change",function(){that.go(pages.pages[that.indicator.selectedIndex].page);});}
makeIndicator();if(!zot(marginRight)&&marginRight>0&&typeof zdf!="undefined"&&zdf){var gutterRight=4*marginRight/25;var right=that.right=new zim.Container(45,270);var icon=that.icon=zdf.makeIcon(zim.grey,zim.lighter,zim.silver).sca(.5).pos(0,0,true,true,right).mov(0,0).cur();icon.on("mouseover",function(){lab.animate({props:{scaleX:1},time:500,ease:"backOut",override:true,timeUnit:"ms"});icon.stage.update();});icon.on("mouseout",function(){lab.animate({props:{scaleX:0},time:300,ease:"backIn",override:true,timeUnit:"ms"});icon.stage.update();});icon.on("mousedown",function(){zgo("https://zimjs.com/marquee","_blank");});var lab=that.label=new zim.Label({text:"MARQUEE",color:zim.dark,backgroundColor:zim.lighter,shiftVertical:1,paddingVertical:5}).rot(-90).pos(0,13,true,false,right).reg(-10).sca(0,1).mov(0);right.fit(0,0,marginRight-gutterRight,height-gutterRight);right.pos(marginRight-right.width-gutterRight,gutterRight/2,true,true,that);}
if(that.stage)that.stage.update();this.pause=function(state,immediate){if(zot(state))state=true;if(state==_paused)return;_paused=state;that.interval.pause(state,immediate);that.button.toggle(state);};Object.defineProperty(this,'paused',{get:function(){return _paused;},set:function(value){if(zon)zogy("Marquee() - paused is read only - use pause()");}});Object.defineProperty(this,'time',{get:function(){return time;},set:function(value){time=value;that.interval.time=time;}});this.load=function(data,path){var a=[];if(mix)zim.shuffle(data);zim.loop(data,function(asset){if(Array.isArray(asset))a.push(asset[0]);else a.push(asset);});var frame=that.stage?that.stage.frame:zdf;that.marqueeLoader=frame.loadAssets(a,path);that.loadEvent=that.marqueeLoader.on("assetload",function(e){var d=data[e.asset.id];if(Array.isArray(d)){var u=d[0];var t=d[1];}else{var u=d;var t="_self";}
that.add(e.asset,u,t);makeIndicator();});return that;};if(!zot(borderColor)){var border=new zim.Rectangle(width-1,height-1,zim.clear,borderColor,borderWidth).loc(mask,null,that);border.mouseEnabled=false;}
if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Marquee(width,height,items,time,transition,speed,direction,marqueeType,borderColor,borderWidth,refresh,mix,style,this.group,inherit));};this.dispose=function(a,b,disposing){if(to)to.clear();if(that.interval)that.interval.clear();if(that.loadEvent)that.marqueeLoader.off("assetload",that.loadEvent);pages.dispose();pages=null;if(!disposing)this.zimContainer_dispose(true);return true;};};zim.extend(zim.Marquee,zim.Container,["clone","dispose"],"zimContainer");zim.Loader=function(width,height,label,type,backgroundColor,rollBackgroundColor,color,rollColor,borderColor,borderRollColor,borderWidth,corner,shadowColor,shadowBlur,hitPadding,gradient,gloss,dashed,backing,rollBacking,rollPersist,icon,rollIcon,toggle,toggleBacking,rollToggleBacking,toggleIcon,rollToggleIcon,toggleEvent,frame,multiple,accept,style,group,inherit){var sig="width, height, label, type, backgroundColor, rollBackgroundColor, color, rollColor, borderColor, borderRollColor, borderWidth, corner, shadowColor, shadowBlur, hitPadding, gradient, gloss, dashed, backing, rollBacking, rollPersist, icon, rollIcon, toggle, toggleBacking, rollToggleBacking, toggleIcon, rollToggleIcon, toggleEvent, frame, multiple, accept, style, group, inherit";var duo;if(duo=zob(zim.Loader,arguments,sig,this))return duo;z_d("67.5");this.group=group;var DS=style===false?{}:zim.getStyle("Loader",this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:250;if(zot(height))height=DS.height!=null?DS.height:70;if(zot(type))type=DS.type!=null?DS.type:"image";type=type.toLowerCase();if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"rgba(0,0,0,.05)";if(zot(rollBackgroundColor))rollBackgroundColor=DS.rollBackgroundColor!=null?DS.rollBackgroundColor:"rgba(0,0,0,.1)";if(zot(color))color=DS.color!=null?DS.color:"rgba(0,0,0,.5)";if(zot(rollColor))rollColor=DS.rollColor!=null?DS.rollColor:color;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:"rgba(0,0,0,.3)";if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:1;if(zot(dashed))dashed=DS.dashed!=null?DS.dashed:true;if(zot(corner))corner=DS.corner!=null?DS.corner:0;if(zot(multiple))multiple=DS.multiple!=null?DS.multiple:true;if(zot(label))label=DS.label!=null?DS.label:new zim.Label({text:"UPLOAD PIC",color:color,rollColor:rollColor,valign:"center",align:"center",backing:"ignore",shadowColor:"ignore",shadowBlur:"ignore",backgroundColor:"ignore",group:this.group});if(zot(frame)){if(zdf){frame=zdf;}else{if(zon){zog("zim.Loader - please provide a reference to zim Frame");}return;}}
this.zimButton_constructor(width,height,label,backgroundColor,rollBackgroundColor,color,rollColor,borderColor,borderRollColor,borderWidth,corner,shadowColor,shadowBlur,hitPadding,gradient,gloss,dashed,backing,rollBacking,rollPersist,icon,rollIcon,toggle,null,null,null,null,toggleBacking,rollToggleBacking,toggleIcon,rollToggleIcon,toggleEvent,null,null,null,null,null,null,null,null,null,null,null,null,false);this.type="Loader";var that=this;var stage=frame.stage;label=that.label;var uploadTag=that.tag=document.createElement("input");document.body.appendChild(uploadTag);uploadTag.setAttribute("type","file");uploadTag.setAttribute("aria-hidden",true);if(multiple)uploadTag.setAttribute("multiple","multiple");if(accept)uploadTag.setAttribute("accept",accept);uploadTag.hidden=true;uploadTag.zimDisplay=uploadTag.style.display||"inline-block";uploadTag.style.cssText="border:thin solid grey; z-index:2; width:"+width+"px; height:"+height+"px; overflow:hidden; outline:none;"
+"position:absolute; left:0px; top:0px; display:none; cursor:pointer; opacity: 0; filter: alpha(opacity=0);";this.addEventListener('mousedown',function(){uploadTag.click();});uploadTag.addEventListener('change',handleFile);var upload=new createjs.DOMElement(uploadTag);stage.addChild(upload);upload.alpha=0;var pRatio=frame.retina?(window.devicePixelRatio||1):1;var time1;var time2;this.resize=function(){if(!that.stage){uploadTag.setAttribute("aria-hidden",true);uploadTag.hidden=true;uploadTag.style.display="none";return;}
uploadTag.setAttribute("aria-hidden",false);uploadTag.hidden=false;uploadTag.style.display=uploadTag.zimDisplay;time1=setTimeout(function(){var displayProps=that.getConcatenatedMatrix().decompose();var point=that.localToGlobal(0,0);if(frame.retina){upload.x=frame.x/stage.scaleX+point.x/pRatio;upload.y=frame.y/stage.scaleY+point.y/pRatio;zim.sca(upload,displayProps.scaleX/pRatio/stage.scaleX,displayProps.scaleY/pRatio/stage.scaleY);}else{upload.x=frame.x+point.x*frame.scale;upload.y=frame.y+point.y*frame.scale;zim.sca(upload,frame.scale*displayProps.scaleX,frame.scale*displayProps.scaleY);}
stage.update();},50);return that;};this.resize();that.on("added",function(){uploadTag.style.display="block";uploadTag.hidden=false;uploadTag.style.display="block";that.resize();});that.added(addedCallback);function addedCallback(){that.resize();time2=setTimeout(function(){uploadTag.style.display="block";uploadTag.hidden=false;uploadTag.style.display="block";},50);that.on("added",addedCallback,null,true);}
that.on("removed",function(){if(time1)clearTimeout(time1);if(time2)clearTimeout(time2);if(uploadTag){uploadTag.style.display="none";uploadTag.hidden=true;uploadTag.style.display="none";}});function handleFile(e){var files;if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0){files=e.dataTransfer.files;}else{files=e.target.files;}
if(type=="text"||type=="json"){var texts=[];var firstText;var lastText;if(type.toLowerCase()=="json"){var jsons=[];var firstJSON;var lastJSON;}}else{var bitmaps=[];var firstBitmap;var lastBitmap;}
for(var i=0;i<files.length;i++){(function(file){var reader=new FileReader();reader.onload=function(event){if(type=="text"||type=="json"){var text=event.target.result;texts.push(text);if(type=="json"){var json=JSON.parse(text);jsons.push(json);}
if(texts.length==1){firstText=text;if(type=="json")firstJSON=json;}
if(texts.length==files.length){var e=new createjs.Event("loaded");e.texts=texts;e.text=firstText;e.lastText=text;e.total=texts.length;if(type=="json"){e.jsons=jsons;e.json=firstJSON;e.lastJSON=json;}
that.dispatchEvent(e);uploadTag.value="";}}else{var img=new Image();img.onload=function(){var bitmap=new zim.Bitmap(img);bitmaps.push(bitmap);if(bitmaps.length==1)firstBitmap=bitmap;if(bitmaps.length==files.length){var e=new createjs.Event("loaded");e.bitmaps=bitmaps;e.bitmap=firstBitmap;e.lastBitmap=bitmap;e.total=bitmaps.length;that.dispatchEvent(e);uploadTag.value="";}};img.src=event.target.result;}};if(type=="text"||type=="json")reader.readAsText(file);else reader.readAsDataURL(file);})(files[i]);}}
var xhr=new XMLHttpRequest();if(xhr.upload){var uploadEvent=function(e){uploadTag.removeEventListener('change',handleFile);handleFile(e);setInterval(function(){uploadTag.addEventListener('change',handleFile);},100);}
uploadTag.addEventListener("drop",uploadEvent);}
this.save=function(content,filename,x,y,width,height,cached,cachedBounds,type,data){var sig="content, filename, x, y, width, height, cached, cachedBounds, type, data";var duo;if(duo=zob(that.save,arguments,sig))return duo;if(zot(content))content=frame.stage;if(zot(type))type="png";if(zot(filename)){filename="saved_"+String(zim.makeID("numbers",5))+"."+type;}else{var parts=filename.split(".");if(parts.length==1){filename+="."+type;}else{var types=["png","jpg","jpeg"];var ind=types.indexOf(parts[parts.length-1].toLowerCase());if(ind==-1){filename+="."+type;}else{type=types[ind];}}}
if(zot(x))x=0;if(zot(y))y=0;if(zot(width))width=(content.getBounds&&content.getBounds())?content.getBounds().width:frame.width;if(zot(height))height=(content.getBounds&&content.getBounds())?content.getBounds().height:frame.height;content.cache(x,y,width,height);if(data){var image=content.cacheCanvas.toDataURL('image/'+type);if(cached){if(cachedBounds)content.cache(cachedBounds.x,cachedBounds.y,cachedBounds.width,cachedBounds.height);}else{content.uncache();}
return image;}
var isMsEdge=/Edge\/(\d)+/.test(navigator.userAgent);if(isMsEdge){var win=window.open();win.document.write("<html><head><title>saved</title></head><body style='margin:0px;padding:0px;overflow:hidden'><img src="+content.cacheCanvas.toDataURL('image/'+type)+"></body></html>");win.document.close();}else{if(type=="jpg")type="jpeg";var a=document.createElement("a");a.setAttribute("download",filename);a.setAttribute("href",content.cacheCanvas.toDataURL('image/'+type));document.body.appendChild(a);a.click();document.body.removeChild(a);}
if(cached){if(cachedBounds)content.cache(cashedBounds.x,cashedBounds.y,cashedBounds.width,cashedBounds.height);}else{content.uncache();}
return that;};if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){var u=new zim.Loader(width,height,!zot(label)?label.clone():null,backgroundColor,rollBackgroundColor,color,rollColor,borderColor,borderWidth,corner,shadowColor,shadowBlur,hitPadding,gradient,gloss,!zot(backing)?backing.clone():null,!zot(rollBacking)?rollBacking.clone():null,rollPersist,!zot(icon)?icon.clone():null,!zot(rollIcon)?rollIcon.clone():null,toggle,!zot(toggleBacking)?toggleBacking.clone():null,!zot(rollToggleBacking)?rollToggleBacking.clone():null,!zot(toggleIcon)?toggleIcon.clone():null,!zot(rollToggleIcon)?rollToggleIcon.clone():null,toggleEvent,frame,style,this.group);return that.cloneProps(u);};Object.defineProperty(this,'frame',{get:function(){return frame;},set:function(value){if(value!=frame){frame.off("update",that.updateEvent);frame.off("resize",that.resizeEvent);frame=value;that.resizeEvent=frame.on("resize",that.resize);that.updateEvent=frame.on("update",that.resize);that.resize();}}});this.resizeEvent=frame.on("resize",that.resize);this.updateEvent=frame.on("update",that.resize);this.dispose=function(a,b,disposing){var stage;if(that.stage)stage=that.stage;frame.off("update",that.updateEvent);frame.off("resize",that.resizeEvent);if(handleFile)uploadTag.removeEventListener('change',handleFile);if(uploadEvent)uploadTag.removeEventListener("drop",uploadEvent);if(uploadTag&&uploadTag.parentNode){uploadTag.parentNode.removeChild(uploadTag);}
uploadTag=null;if(!disposing){this.zimButton_dispose();if(stage)stage.update();}
return true;};};zim.extend(zim.Loader,zim.Button,["clone","dispose"],"zimButton",false);zim.TextArea=function(width,height,size,padding,color,backgroundColor,borderColor,borderWidth,corner,shadowColor,shadowBlur,dashed,id,placeholder,readOnly,spellCheck,password,inputType,wrap,maxLength,frame,expand,style,group,inherit){var sig="width, height, size, padding, color, backgroundColor, borderColor, borderWidth, corner, shadowColor, shadowBlur, dashed, id, placeholder, readOnly, spellCheck, password, inputType, wrap, maxLength, frame, expand, style, group, inherit";var duo;if(duo=zob(zim.TextArea,arguments,sig,this))return duo;z_d("67.6");this.group=group;var DS=style===false?{}:zim.getStyle("TextArea",this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:250;if(zot(height))height=DS.height!=null?DS.height:70;if(zot(size))size=DS.size!=null?DS.size:20;if(zot(padding))padding=DS.padding!=null?DS.padding:5;if(zot(color))color=DS.color!=null?DS.color:"#666";if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"rgba(256,256,256,.1)";if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:"rgba(0,0,0,.1)";if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:null;if(borderColor<0||borderWidth<0)borderColor=borderWidth=null;else if(borderColor!=null&&borderWidth==null)borderWidth=1;if(zot(corner))corner=DS.corner!=null?DS.corner:0;if(!zot(shadowBlur)&&zot(shadowColor))shadowColor=DS.shadowColor!=null?DS.shadowColor:"rgba(0,0,0,.3)";if(!zot(shadowColor)&&zot(shadowBlur))shadowBlur=DS.shadowBlur!=null?DS.shadowBlur:10;if(zot(password))password=DS.password!=null?DS.password:false;if(zot(inputType))inputType=DS.inputType!=null?DS.inputType:false;if(zot(wrap))wrap=DS.wrap!=null?DS.wrap:true;if(zot(maxLength))maxLength=DS.maxLength!=null?DS.maxLength:null;if(zot(spellCheck))spellCheck=DS.spellCheck!=null?DS.spellCheck:true;if(zot(readOnly))readOnly=DS.readOnly!=null?DS.readOnly:false;if(zot(placeholder))placeholder=DS.placeholder!=null?DS.placeholder:null;this.maxLength=maxLength;if(zot(expand))expand=DS.expand!=null?DS.expand:20;if(expand===true)expand=20;if(zot(frame)){if(zdf){frame=zdf;}else{if(zon){zog("zim.TextArea - please provide a reference to zim Frame");}return;}}
this.zimContainer_constructor(width,height,null,null,false);this.type="TextArea";var that=this;var stage=frame.stage;var background=this.background=new zim.Rectangle(width,height,backgroundColor,borderColor,borderWidth,corner,dashed,null,false).expand(expand);if(shadowColor!=-1&&shadowBlur>0)background.shadow=new createjs.Shadow(shadowColor,3,3,shadowBlur);that.addChild(background);var textareaTag=that.tag=inputType||password?document.createElement("input"):document.createElement("textarea");if(frame.tag){frame.tag.appendChild(textareaTag);}else{document.body.appendChild(textareaTag);}
if(!zot(id)){textareaTag.setAttribute("id",id);textareaTag.setAttribute("name",id);}
if(password){textareaTag.setAttribute("type","password");}else if(inputType){textareaTag.setAttribute("type",inputType);}
textareaTag.readOnly=readOnly;textareaTag.spellcheck=spellCheck;if(placeholder)textareaTag.setAttribute("placeholder",placeholder);textareaTag.zimDisplay=textareaTag.style.display||"inline-block";textareaTag.style.cssText="background-color:rgba(0,0,0,.01); color:"+color+"; "
+"resize:none; z-index:3; width:"+(width-padding*2)+"px; height:"+(height-padding*2)+"px; overflow:hidden; outline:none;"
+"font-size:"+size+"px; font-family:"+(DS.font!=null?DS.font:"arial")+"; border:none; position:absolute; left:0px; top:0px; display:none;";that.taInput=function(){if(!zot(that.maxLength)&&that.text.length>that.maxLength){that.text=that.text.substring(0,that.maxLength);}
that.dispatchEvent("input");}
that.taFocus=function(){if(frame.zil)window.removeEventListener("keydown",frame.zil[0]);that.dispatchEvent("focus");}
that.taBlur=function(){if(frame.zil)window.addEventListener("keydown",frame.zil[0]);that.dispatchEvent("blur");}
textareaTag.addEventListener('change',that.taChange);textareaTag.addEventListener('input',that.taInput);textareaTag.addEventListener('focus',that.taFocus);textareaTag.addEventListener('blur',that.taBlur);var textarea=new createjs.DOMElement(textareaTag);textarea.alpha=0;this.on('mousedown',function(){setTimeout(function(){textareaTag.focus();},100);});this.setFocus=function(type){if(zot(type))type=true;if(type)textareaTag.focus();else textareaTag.blur();return that;};var pRatio=frame.retina?(window.devicePixelRatio||1):1;var time1;var time2
this.resize=function(){time1=setTimeout(function(){var displayProps=that.getConcatenatedMatrix().decompose();var point=that.localToGlobal(padding,padding);if(frame.retina){if(frame.tag){textarea.x=point.x/pRatio;textarea.y=point.y/pRatio;}else{textarea.x=frame.x/stage.scaleX+point.x/pRatio;textarea.y=frame.y/stage.scaleY+point.y/pRatio;}
zim.sca(textarea,displayProps.scaleX/pRatio/stage.scaleX,displayProps.scaleY/pRatio/stage.scaleY);}else{if(frame.tag){textarea.x=point.x*frame.scale;textarea.y=point.y*frame.scale;}else{textarea.x=frame.x+point.x*frame.scale;textarea.y=frame.y+point.y*frame.scale;}
zim.sca(textarea,frame.scale*displayProps.scaleX,frame.scale*displayProps.scaleY);}
textarea.alpha=1;if(that.stage)stage.update();},20);return that;};this.resize();that.added(addedCallback);function addedCallback(){stage.addChild(textarea);time2=setTimeout(function(){textareaTag.style.display=textareaTag.zimDisplay;},50);that.resize();that.on("added",addedCallback,null,true);}
that.on("removed",function(){if(time1)clearTimeout(time1);if(time2)clearTimeout(time2);stage.removeChild(textarea);if(textareaTag)textareaTag.style.display="none";});Object.defineProperty(this,'currentValue',{get:function(){return textareaTag.value;},set:function(value){textareaTag.value=value;}});Object.defineProperty(this,'text',{get:function(){return textareaTag.value;},set:function(value){textareaTag.value=value;}});Object.defineProperty(this,'focus',{get:function(){return(document.activeElement==textareaTag);},set:function(value){that.setFocus(value);}});Object.defineProperty(this,'readOnly',{get:function(){return textareaTag.readOnly;},set:function(value){textareaTag.readOnly=value;}});if(typeof KEYFOCUS!==typeof undefined)zim.KEYFOCUS=KEYFOCUS;Object.defineProperty(this,'keyFocus',{get:function(){return zim.KEYFOCUS==that;},set:function(value){zim.KEYFOCUS=that;}});if(!zim.KEYFOCUS)that.keyFocus=true;that.taMousedown=function(){that.keyFocus=true;}
textareaTag.addEventListener("mousedown",that.taMousedown);if(!wrap)textareaTag.style.whiteSpace="pre";if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){var u=new zim.TextArea(width,height,size,padding,color,backgroundColor,borderColor,borderWidth,corner,shadowColor,shadowBlur,dashed,id,placeholder,readOnly,spellCheck,password,inputType,wrap,maxLength,frame,expand,style,this.group,inherit);return that.cloneProps(u);};Object.defineProperty(this,'frame',{get:function(){return frame;},set:function(value){if(value!=frame){frame.off("update",that.updateEvent);frame.off("resize",that.resizeEvent);frame=value;that.resizeEvent=frame.on("resize",that.resize);that.updateEvent=frame.on("update",that.resize);pRatio=frame.retina?(window.devicePixelRatio||1):1;stage=frame.stage;that.resize();}}});this.resizeEvent=frame.on("resize",that.resize);this.updateEvent=frame.on("update",that.resize);this.dispose=function(a,b,disposing){var stage;if(that.stage)stage=that.stage;frame.off("update",that.updateEvent);frame.off("resize",that.resizeEvent);if(textareaTag&&textareaTag.parentNode){textareaTag.parentNode.removeChild(textareaTag);}
textareaTag.removeEventListener('change',that.taChange);textareaTag.removeEventListener('input',that.taInput);textareaTag.removeEventListener('focus',that.taFocus);textareaTag.removeEventListener('blur',that.taBlur);textareaTag.removeEventListener("mousedown",that.taMousedown);textareaTag=null;if(!disposing){this.zimContainer_dispose(true);if(stage)stage.update();}
that.background=null;return true;};};zim.extend(zim.TextArea,zim.Container,["clone","dispose"],"zimContainer",false);zim.Tag=function(width,height,id,frame,backgroundColor,padding,paddingHorizontal,paddingVertical,expand,style,group,inherit){var sig="width, height, id, frame, backgroundColor, padding, paddingHorizontal, paddingVertical, expand, style, group, inherit";var duo;if(duo=zob(zim.Tag,arguments,sig,this))return duo;z_d("67.7");this.group=group;var DS=style===false?{}:zim.getStyle("Tag",this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:250;if(zot(height))height=DS.height!=null?DS.height:70;if(zot(id))id=DS.id!=null?DS.id:"zimTag_"+zim.rand(10000);if(zot(frame)){if(zdf){frame=zdf;}else{if(zon){zog("zim.TextArea - please provide a reference to zim Frame");}return;}}
if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"rgba(0,0,0,0)";if(zot(padding))padding=DS.padding!=null?DS.padding:10;if(zot(paddingHorizontal))paddingHorizontal=DS.paddingHorizontal!=null?DS.paddingHorizontal:padding;if(zot(paddingVertical))paddingVertical=DS.paddingVertical!=null?DS.paddingVertical:padding;if(zot(expand))expand=DS.expand!=null?DS.expand:20;if(expand===true)expand=20;this.zimContainer_constructor(width,height,null,null,false);this.type="Tag";this.tagID=id;this.id=id;var that=this;var stage=frame.stage;var background=that.background=new zim.Rectangle(width+paddingHorizontal,height+paddingVertical,backgroundColor).center(this).expand(expand?expand:0);var tag=that.tag=document.createElement("div");document.body.appendChild(tag);tag.setAttribute("id",id);tag.setAttribute("name",id);tag.zimDisplay=tag.style.display||"inline-block";tag.style.cssText="resize:none; z-index:3; width:"+width+"px; height:"+height+"px; overflow:hidden; outline:none;"
+"position:absolute; left:0px; top:0px; display:none;";var cjsTag=new createjs.DOMElement(tag);cjsTag.alpha=0;var pRatio=frame.retina?(window.devicePixelRatio||1):1;var time1;var time2;this.resize=function(){time1=setTimeout(function(){var displayProps=that.getConcatenatedMatrix().decompose();var point=that.localToGlobal(0,0);if(frame.retina){cjsTag.x=frame.x/stage.scaleX+point.x/pRatio;cjsTag.y=frame.y/stage.scaleY+point.y/pRatio;zim.sca(cjsTag,displayProps.scaleX/pRatio/stage.scaleX,displayProps.scaleY/pRatio/stage.scaleY);}else{cjsTag.x=frame.x+point.x*frame.scale;cjsTag.y=frame.y+point.y*frame.scale;zim.sca(cjsTag,frame.scale*displayProps.scaleX,frame.scale*displayProps.scaleY);}
cjsTag.alpha=1;if(that.stage)stage.update();},50);return that;};this.resize();that.added(addedCallback);function addedCallback(){stage.addChild(cjsTag);time2=setTimeout(function(){tag.style.display=tag.zimDisplay;},50);that.resize();that.on("added",addedCallback,null,true);}
that.on("removed",function(){if(time1)clearTimeout(time1);if(time2)clearTimeout(time2);stage.removeChild(cjsTag);if(tag)tag.style.display="none";});this.add=function(html){tag.innerHTML+=html;return that;};Object.defineProperty(this,'innerHTML',{get:function(){return tag.innerHTML;},set:function(value){tag.innerHTML=value;}});Object.defineProperty(this,'style',{get:function(){return tag.style;},set:function(value){tag.style=value;}});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){var u=new zim.Tag(width,height,id,frame,backgroundColor,padding,paddingHorizontal,paddingVertical,expand,style,this.group,inherit);return that.cloneProps(u);};Object.defineProperty(this,'frame',{get:function(){return frame;},set:function(value){if(value!=frame){frame.off("update",that.updateEvent);frame.off("resize",that.resizeEvent);frame=value;that.resizeEvent=frame.on("resize",that.resize);that.updateEvent=frame.on("update",that.resize);that.resize();}}});this.resizeEvent=frame.on("resize",that.resize);this.updateEvent=frame.on("update",that.resize);this.dispose=function(a,b,disposing){var stage;if(that.stage)stage=that.stage;frame.off("update",that.updateEvent);frame.off("resize",that.resizeEvent);if(tag&&tag.parentNode){tag.parentNode.removeChild(tag);}
tag=null;if(!disposing){this.zimContainer_dispose(true);if(stage)stage.update();}
return true;};};zim.extend(zim.Tag,zim.Container,["clone","dispose"],"zimContainer",false);function zenable(t,v){if(v){t.mouseChildren=true;t.mouseEnabled=true;t._enabled=true;}else{t.mouseChildren=false;t.mouseEnabled=false;t._enabled=false;}}
zim.addTo=function(obj,container,index,localToLocal){var sig="obj, container, index, localToLocal";var duo;if(duo=zob(zim.addTo,arguments,sig))return duo;z_d("47.5");if(zot(obj)){zog("zim methods - addTo(): please provide object");return;}
if(zot(container)){if(zdf){container=zdf.stage;}
else{zog("zim methods - addTo(): please provide container");return;}}
if(zot(localToLocal))localToLocal=true;if(!obj.parent)localToLocal=false;if(localToLocal)var point=obj.parent.localToLocal(obj.x,obj.y,container);if(zot(index)||isNaN(index)){container.addChild(obj);}
else{container.addChildAt(obj,index);}
if(localToLocal){obj.x=point.x;obj.y=point.y;}
return obj;};zim.removeFrom=function(obj,container){z_d("47.6");if(zot(obj)){zog("zim methods - removeFrom(): please provide object");return;}
if(zot(container)){if(obj.parent)obj.parent.removeChild(obj);}
else container.removeChild(obj);return obj;};zim.added=function(obj,call,interval,maxTime){z_d("47.7");if(zot(obj)||zot(call)||typeof call!="function")return;var timeType=getTIME(interval);if(zot(interval))interval=timeType=="s"?.1:100;if(obj.stage){(call)(obj.stage,obj);return;}
var t=interval*(timeType=="s"?1000:1);var mt;if(maxTime){checkTIME(maxTime);mt=maxTime*(timeType=="s"?1000:1);}
var startTime=Date.now();var startCount=0;var startID=setInterval(function(){if(startCount>5){clearInterval(startID);return;}
startCount++;if(obj.stage){(call)(obj.stage,obj);clearInterval(startID);clearInterval(id);}},10);var id=setInterval(function(){if(mt>0&&startTime-Date.now()>mt)clearInterval(id);if(obj.stage){(call)(obj.stage,obj);clearInterval(id);}},t);return id;};zim.centerReg=function(obj,container,index,add){var sig="obj, container, index, add";var duo;if(duo=zob(zim.centerReg,arguments,sig))return duo;if(obj.type=="AC"&&zdf){zdf.ac("centerReg",arguments);return obj.addTo(container,index);}
z_d("48");if(zot(obj)||!obj.getBounds||!obj.getBounds()){zog("zim methods - centerReg(): please provide object with bounds set");return obj;}
if(zot(add))add=true;if(zot(container)&&obj.parent&&add){container=obj.parent;if(zot(index))index=obj.parent.getChildIndex(obj);obj.parent.removeChild(obj);}
if(!zot(container)&&container==obj.parent){if(zot(index))index=obj.parent.getChildIndex(obj);obj.parent.removeChild(obj);}
var oB=obj.getBounds();obj.regX=oB.x+oB.width/2;obj.regY=oB.y+oB.height/2;return add?zim.center(obj,container,index):obj;};zim.center=function(obj,container,index,add){var sig="obj, container, index, add";var duo;if(duo=zob(zim.center,arguments,sig))return duo;if(obj.type=="AC"&&zdf){zdf.ac("center",arguments);return obj.addTo(container,index);}
if(!zim.centerCheck){z_d("48.1");zim.centerCheck=true;}
if(zot(obj)||!obj.getBounds){zog("zim.center(): please provide object with bounds");return obj;}
if(zot(container)){if(obj.parent)container=obj.parent;else if(zdf)container=zdf.stage;}
if(zot(container)||!container.getBounds){zog("zim.center(): please provide container with bounds");return obj;}
var oB=obj.getBounds();var cB=container.getBounds();if(zot(add))add=true;var resetCheck=false;if(zot(cB)){container.setBounds(0,0);cB=container.getBounds();resetCheck=true;}
if(add&&container.addChild){if(zot(index)||(typeof index==='number'&&isNaN(index))){if(!container.contains(obj))container.addChild(obj);}else{container.addChildAt(obj,index);}}
if(zot(oB)){obj.x=cB.x+cB.width/2;obj.y=cB.y+cB.height/2;return obj;}
var zeroX=false;var zeroY=false;if(container.scaleX==0){zeroX=true;container.scaleX=.00001;}
if(container.scaleY==0){zeroY=true;container.scaleY=.00001;}
var reg=obj.localToLocal(obj.regX,obj.regY,container);var glob=zim.boundsToGlobal(obj);var loc=zim.boundsToGlobal(container,glob,true);if(zeroX)container.scaleX=0;if(zeroY)container.scaleY=0;obj.x=cB.x+cB.width/2-loc.width/2+(reg.x-loc.x);obj.y=cB.y+cB.height/2-loc.height/2+(reg.y-loc.y);if(!add&&container.getStage&&container.stage&&obj.parent){var p=container.localToLocal(obj.x,obj.y,obj.parent);obj.x=p.x;obj.y=p.y;}
if(resetCheck)container.setBounds(null);return obj;};zim.place=function(obj,id){z_d("49");if(zot(obj))return;if(zot(id))id="obj";zim.lastPlace=obj;function report(){zog(id+".x = "+Math.round(obj.x)+"; "+id+".y = "+Math.round(obj.y)+";");zog(id+".loc("+Math.round(obj.x)+", "+Math.round(obj.y)+");");}
zim.drag({obj:obj,currentTarget:true,dragCursor:"crosshair"});obj.on("mousedown",function(){zim.lastPlace=obj;});var frame=zdf;if(frame){frame.on("keydown",function(e){if(obj!=zim.lastPlace)return;var k=e.keyCode;if(k>=37&&k<=40){var a=e.shiftKey?10:1;obj.mov(k==37?-1*a:k==39?1*a:0,k==38?-1*a:k==40?1*a:0);report();if(obj.stage)obj.stage.update();}});}
zog("place "+id+" - to get new position");obj.on("click",report);return obj;};zim.placeReg=function(obj,id){z_d("49.5");if(zot(obj))return;var stage=obj.stage;if(zot(stage)){zog("zim.placeReg() - add object to stage before calling placeReg()");return obj;}
if(zot(id))id="obj";function report(){var p=obj.globalToLocal(cursor.x,cursor.y);zog(id+".regX = "+Math.round(p.x)+"; "+id+".regY = "+Math.round(p.y)+";");zog(id+".reg("+Math.round(p.x)+", "+Math.round(p.y)+");");}
var p=obj.parent.localToGlobal(obj.x,obj.y);var cursor=new zim.Shape(-25,-25,50,50,null,false).addTo(stage).pos({x:p.x,y:p.y,reg:true});cursor.graphics.s("white").mt(-25,0).lt(25,0).mt(0,-25).lt(0,20);cursor.compositeOperation="difference";cursor.expand(0);zim.drag({obj:cursor});zog("place cursor to get new registration point location");stage.on("stagemouseup",report);return obj;};zim.pos=function(obj,x,y,horizontal,vertical,container,index,add,reg,regX,regY){var sig="obj, x, y, horizontal, vertical, container, index, add, reg, regX, regY";var duo;if(duo=zob(zim.pos,arguments,sig))return duo;if(obj.type=="AC"&&zdf){zdf.ac("pos",arguments);return obj.addTo(container,index);}
z_d("41.5");var right=false;if(horizontal=="right")right=true;var bottom=false;if(vertical=="bottom")bottom=true;var PR=zim.POSREG;if(window.POSREG!=null)PR=window.POSREG;if(zot(reg))reg=PR;if(zot(obj))return;if(zot(reg)&&zot(regX))regX=false;if(zot(reg)&&zot(regY))regY=false;if(!zot(reg)&&zot(regX))regX=reg;if(!zot(reg)&&zot(regY))regY=reg;if(zot(add))add=true;if(!zot(container)&&!container.addChild)container=null;if(!obj.getBounds&&!obj.getBounds()){regX=regY=false;}
if(zot(container)){if(obj.parent)container=obj.parent;else if(zdf)container=zdf.stage;}
if(!obj.parent&&zot(x))x=0;if(!obj.parent&&zot(y))y=0;var resetObjCheck=false;if(!obj.getBounds()){obj.setBounds(0,0);resetObjCheck=true;}
var resetContainerCheck=false;if(container&&!container.getBounds()){container.setBounds(0,0);resetContainerCheck=true;}
if(!zot(container)&&container.addChild&&add){var lastBounds=container.getBounds().clone();function addMe(){if(zot(index)||(typeof index==='number'&&isNaN(index))){if(!container.contains(obj))container.addChild(obj);}else{container.addChildAt(obj,index);}}
addMe();var currentBounds=container.getBounds();if(lastBounds.width!=currentBounds.width||lastBounds.height!=currentBounds.height||lastBounds.x!=currentBounds.x||lastBounds.y!=currentBounds.y){obj.removeFrom();container.setBounds(lastBounds.x,lastBounds.y,lastBounds.width,lastBounds.height);resetContainerCheck=true;addMe();}}
if(!regX&&!regY){if((horizontal=="center"||horizontal=="middle")&&(vertical=="center"||vertical=="middle")){obj.center(container);obj.mov(x,y);if(resetObjCheck)obj.setBounds(null);if(resetContainerCheck)container.setBounds(null);return obj;}}
if(horizontal=="center"||horizontal=="middle"){if(regX)obj.x=container.width/2;else{var yy=obj.y;obj.center();obj.y=yy;}
obj.mov(x);x=null;horizontal=null;}else{if(horizontal===true)right=true;}
if(vertical=="center"||vertical=="middle"){if(regY)obj.y=container.height/2;else{var xx=obj.x;obj.center();obj.x=xx;}
obj.mov(0,y);y=null;vertical=null;}else{if(vertical===true)bottom=true;}
if(obj.parent&&obj.parent.getBounds){container=obj.parent;if(zot(x)&&right==true)x=0;if(zot(y)&&bottom==true)y=0;if(!zot(x))obj.x=x;if(!zot(y))obj.y=y;if(zot(x)&&zot(y)&&!right&&!bottom){if(resetObjCheck)obj.setBounds(null);if(resetContainerCheck)container.setBounds(null);return obj;}
var shiftX=0;var shiftY=0;if(obj.getBounds()){var projected=getTransformedBounds();function getTransformedBounds(){var bounds=obj.getBounds();var x=bounds.x,y=bounds.y,width=bounds.width,height=bounds.height,mtx=obj._props.matrix;mtx=obj.getMatrix(mtx);if(x||y){mtx.appendTransform(0,0,1,1,0,0,0,-x,-y);}
var x_a=width*mtx.a,x_b=width*mtx.b;var y_c=height*mtx.c,y_d=height*mtx.d;var tx=mtx.tx,ty=mtx.ty;var minX=tx,maxX=tx,minY=ty,maxY=ty;if((x=x_a+tx)<minX){minX=x;}else if(x>maxX){maxX=x;}
if((x=x_a+y_c+tx)<minX){minX=x;}else if(x>maxX){maxX=x;}
if((x=y_c+tx)<minX){minX=x;}else if(x>maxX){maxX=x;}
if((y=x_b+ty)<minY){minY=y;}else if(y>maxY){maxY=y;}
if((y=x_b+y_d+ty)<minY){minY=y;}else if(y>maxY){maxY=y;}
if((y=y_d+ty)<minY){minY=y;}else if(y>maxY){maxY=y;}
return{x:minX,y:minY,width:maxX-minX,height:maxY-minY};}
if(!zot(x)){if(!right){var local=new zim.Point(projected.x,projected.y);}else{var local=new zim.Point(projected.x+projected.width,projected.y+projected.height);}
shiftX=local.x-x;}
if(!zot(y)){if(!bottom){var local=new zim.Point(projected.x,projected.y);}else{var local=new zim.Point(projected.x+projected.width,projected.y+projected.height);}
shiftY=local.y-y;}
var b=container.getBounds();if(!zot(x)){if(right){if(regX)obj.x=b.width+b.x-x;else obj.x=b.width+b.x-x-shiftX;}else{if(regX)obj.x=x;else obj.x=x-shiftX;obj.x+=b.x;}}
if(!zot(y)){if(bottom){if(regY)obj.y=b.height+b.y-y;else obj.y=b.height+b.y-y-shiftY;}else{if(regY)obj.y=y;else obj.y=y-shiftY;obj.y+=b.y;}}}}
if(resetObjCheck)obj.setBounds(null);if(resetContainerCheck)container.setBounds(null);return obj;};zim.loc=function(obj,target,y,container,index,add,localToLocal,x){var sig="obj, target, y, container, index, add, localToLocal, x";var duo;if(duo=zob(zim.loc,arguments,sig))return duo;if(obj.type=="AC"&&zdf){zdf.ac("loc",arguments);return obj.addTo(container,index);}
z_d("41.55");if(zot(obj))return;if(typeof target=="number"){x=target;target=null;}
if(!zot(target)){if(!zot(target.x))x=target.x;if(!zot(target.y))y=target.y;}
if(zot(x)&&zot(target))x=obj.x;if(zot(y)&&zot(target))y=obj.y;if(zot(add))add=true;if(zot(container)){if(obj.parent)container=obj.parent;else if(zdf)container=zdf.stage;}
if(add&&container){if(!obj.parent||container!=obj.parent){if(zot(index)||isNaN(index)){container.addChild(obj);}
else{container.addChildAt(obj,index);}}else if(!zot(index)){container.addChildAt(obj,index);}}
if(zot(localToLocal))localToLocal=true;if(target&&target.parent&&obj.parent&&localToLocal){var point=target.parent.localToLocal(x,y,obj.parent);x=point.x;y=point.y;}
obj.x=x;obj.y=y;return obj;};zim.mov=function(obj,x,y){var sig="obj, x, y";var duo;if(duo=zob(zim.mov,arguments,sig))return duo;if(obj.type=="AC"&&zdf){zdf.ac("mov",arguments);return obj;}
z_d("41.6");if(zot(obj))return;if(!zot(x))obj.x+=x;if(!zot(y))obj.y+=y;return obj;};zim.sca=function(obj,scale,scaleY){if(obj.type=="AC"&&zdf){zdf.ac("sca",arguments);return obj;}
z_d("41.97");if(zot(obj)||zot(obj.scaleX))return obj;if(zot(scale))scale=obj.scaleX;if(zot(scaleY))scaleY=scale;obj.scaleX=scale;obj.scaleY=scaleY;return obj;};zim.alp=function(obj,alpha){z_d("41.7");if(zot(obj))return;if(!zot(alpha)){obj.alpha=obj.hovOriginal=alpha;if(obj.tag&&obj.tag.style){if(obj.type!="Loader")obj.tag.style.opacity=alpha;if(alpha==0)obj.tag.style.display=obj.tag.zimDisplay="none";else obj.tag.style.display=obj.tag.zimDisplay="inline-block";}}
return obj;};zim.vis=function(obj,visible){z_d("41.71");if(zot(obj))return;obj.visible=visible;if(obj.tag&&obj.tag.style){if(!visible)obj.tag.style.display=obj.tag.zimDisplay="none";else obj.tag.style.display=obj.tag.zimDisplay="inline-block";}
return obj;};zim.ble=function(obj,blendMode){z_d("41.72");if(zot(obj))return;if(zot(blendMode))blendMode="difference";obj.compositeOperation=blendMode;return obj;};zim.hov=function(obj,value,type){z_d("41.75");if(zot(obj))return;if(zot(value))value=1;if(zot(type))type=(typeof value=="number")?"alpha":"color";if(obj.hovMouseover){obj.off("mouseover",obj.hovMouseover);obj.off("mouseout",obj.hovMouseout);}
if(value==-1){obj.cur("default");if(!zot(obj.hovOld))obj[obj.hovType]=obj.hovOld;obj.hovOld=null;if(obj.stage)obj.stage.update();return obj;}
obj.cur();obj.hovOld=obj[type];obj.hovNew=value;obj.hovType=type;obj.hovMouseover=obj.on("mouseover",function(){obj[type]=obj.hovNew;if(obj.stage)obj.stage.update();});obj.hovMouseout=obj.on("mouseout",function(){obj[type]=obj.hovOld;if(obj.stage)obj.stage.update();});return obj;};zim.rot=function(obj,rotation,x,y){z_d("41.8");if(zot(obj))return;if(obj.type=="AC"&&zdf){zdf.ac("rot",arguments);return obj;}
if(!zot(rotation)){if(obj.parent&&(!zot(x)||!zot(y))){if(zot(x))x=obj.x;if(zot(y))y=obj.y;var diffX=x-obj.x;var diffY=y-obj.y;var inside=obj.parent.localToLocal(x,y,obj);var outside=new zim.Point(obj.x,obj.y);obj.reg(inside.x,inside.y);obj.rotation=rotation;obj.x=x;obj.y=y;var backPoint=obj.parent.localToLocal(outside.x,outside.y,obj);obj.reg(backPoint.x,backPoint.y);obj.x=outside.x;obj.y=outside.y;}else{obj.rotation=rotation;}}
return obj;};zim.siz=function(obj,width,height,only){z_d("41.85");if(zot(obj))return;if(obj.type=="AC"&&zdf){zdf.ac("siz",arguments);return obj;}
if(zot(only))only=false;if(!zot(width)&&!zot(height)){obj.widthOnly=width;obj.heightOnly=height;}else if(!zot(width)){if(only){obj.widthOnly=width;}else{obj.width=width;}}else if(!zot(height)){if(only){obj.heightOnly=height;}else{obj.height=height;}}
return obj;};zim.ske=function(obj,skewX,skewY){z_d("41.9");if(zot(obj))return;if(obj.type=="AC"&&zdf){zdf.ac("ske",arguments);return obj;}
if(!zot(skewX))obj.skewX=skewX;if(!zot(skewY))obj.skewY=skewY;return obj;};zim.reg=function(obj,regX,regY,still){z_d("41.95");if(zot(obj))return;if(obj.type=="AC"&&zdf){zdf.ac("reg",arguments);return obj;}
var lastRegX=obj.regX;var lastRegY=obj.regY;if(!zot(regX))obj.regX=regX;if(!zot(regY))obj.regY=regY;if(still&&obj.parent){var p=obj.localToLocal(lastRegX,lastRegY,obj.parent);obj.x-=p.x-obj.x;obj.y-=p.y-obj.y;}
return obj;};zim.top=function(obj){z_d("41.62");if(zot(obj)||!obj.parent)return obj;obj.parent.setChildIndex(obj,obj.parent.numChildren-1);return obj;};zim.bot=function(obj){z_d("41.63");if(zot(obj)||!obj.parent)return obj;obj.parent.setChildIndex(obj,0);return obj;};zim.ord=function(obj,num){z_d("41.64");if(zot(obj)||!obj.parent)return;if(zot(num))num=0;obj.parent.setChildIndex(obj,obj.parent.getChildIndex(obj)+num);return obj;};zim.cur=function(obj,type){z_d("41.1");if(zot(obj)){zog("zim methods - cur(): please provide object");return obj;}
if(zot(type))type="pointer";obj.cursor=type;return obj;};zim.sha=function(obj,color,offsetX,offsetY,blur){z_d("41.2");if(zot(obj)){zog("zim methods - sha(): please provide object");return obj;}
if(zot(color))color="rgba(0,0,0,.3)";if(color.blur){obj.shadow=color;return obj;}
if(zot(offsetX))offsetX=obj.width?obj.width*.08:5;if(zot(offsetY))offsetY=obj.height?obj.height*.08:5;if(zot(blur))blur=obj.width?obj.width*.16:10;obj.shadow=new createjs.Shadow(color,offsetX,offsetY,blur);return obj;};zim.dep=function(obj,depth){z_d("41.65");if(zot(obj))return;if(zot(depth))depth=0;obj.depth=depth;return obj;};zim.nam=function(obj,name){z_d("41.67");if(zot(obj)||zot(name))return;obj.name=name;zim.zimObjectIDs[name]=obj;return obj;};zim.movement=function(obj,call,immediate){z_d("47.75");var stage=obj.stage||zdf.stage;if(zim.mobile()){if(obj.zimMovementEvent)stage.off("pressmove",obj.zimMovementEvent);obj.zimMovementEvent=obj.on("pressmove",function(e){call(e);});}else{if(obj.zimMouseoverEvent)obj.off("mouseover",obj.zimMouseoverEvent);obj.zimMouseoverEvent=obj.on("mouseover",motioning);function motioning(){stage=obj.stage;obj.zimMovementStage=stage;if(obj.zimMovementEvent)stage.off("stagemousemove",obj.zimMovementEvent);obj.zimMovementEvent=stage.on("stagemousemove",function(e){call(e);});obj.on("mouseout",function(){if(obj.zimMovementEvent)stage.off("stagemousemove",obj.zimMovementEvent);},null,true);}
if(immediate)motioning();}
return obj;};zim.noMovement=function(obj){z_d("47.9");if(zot(obj))return;if(obj.zimMouseoverEvent)obj.off("mouseover",obj.zimMouseoverEvent);if(obj.zimMovementEvent&&obj.zimMovementStage)obj.zimMovementStage.off("stagemousemove",obj.zimMovementEvent);return obj;};zim.tap=function(obj,call,distance,time,once,dbl,dblTime,call2){var sig="obj, call, distance, time, once, dbl, dblTime, call2";var duo;if(duo=zob(zim.tap,arguments,sig))return duo;z_d("47.8");if(zot(obj)||zot(call)||typeof call!="function")return;if(zot(distance))distance=5;var timeType=getTIME(time);if(zot(time))time=timeType=="s"?8:8000;if(zot(once))once=false;if(zot(dbl))dbl=false;if(zot(dblTime))dblTime=timeType=="s"?1:1000;obj.cursor="pointer";var stage;var firstTap=false;var doubleCheck=false;if(dbl){obj.zimDblClickDownEvent=obj.on("mousedown",function(e){if(firstTap){firstTap=false;return;}
firstTap=true;stage=e.target.stage;if(e.currentTarget.type=="List"){if(e.target.type=="WindowBacking")return;var local=e.currentTarget.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);if(local.y<=0)return;}
var lastX=e.stageX/zim.scaX;var lastY=e.stageY/zim.scaY;var startTime=Date.now();doubleCheck=true;if(obj.zimDoubleTimeout)clearTimeout(obj.zimDoubleTimeout);obj.zimDoubleTimeout=setTimeout(function(){doubleCheck=false;firstTap=false;if(obj.zimDblClickUpEvent)obj.off("pressup",obj.zimDblClickUpEvent);},timeType=="s"?dblTime*1000:dblTime);obj.zimDblClickUpEvent=obj.on("pressup",function(e){if(firstTap||!doubleCheck)return;if(Math.abs(lastX+lastY-e.stageX/zim.scaX-e.stageY/zim.scaY)<distance&&Date.now()-startTime<(timeType=="s"?time*1000:time)){if(obj.excludeTap)return;call(e);}else if(call2)call2(e);e.remove();});},null,once);}else{obj.zimClickDownEvent=obj.on("mousedown",function(e){stage=e.target.stage;if(e.currentTarget.type=="List"){if(e.target.type=="WindowBacking")return;var local=e.currentTarget.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);if(local.y<=0)return;}
var lastX=e.stageX/zim.scaX;var lastY=e.stageY/zim.scaY;var startTime=Date.now();obj.zimClickUpEvent=obj.on("pressup",function(e){if(Math.abs(lastX+lastY-e.stageX/zim.scaX-e.stageY/zim.scaY)<distance&&Date.now()-startTime<(timeType=="s"?time*1000:time)){if(obj.excludeTap)return;call(e);}else if(call2)call2(e);e.remove();});},null,once);}
return obj;};zim.noTap=function(obj){z_d("47.9");if(zot(obj))return;if(obj.cursor)obj.cursor="default";if(obj.zimClickDownEvent)obj.off("mousedown",obj.zimClickDownEvent);if(obj.zimClickUpEvent)obj.off("pressup",obj.zimClickUpEvent);if(obj.zimDoubleTimeout)clearInterval(obj.zimDoubleTimeout);return obj;};zim.hold=function(obj,call,distance,time,once){z_d("47.87");if(zot(obj)||zot(call)||typeof call!="function")return;if(zot(distance))distance=5;var timeType=getTIME(time);if(zot(time))time=timeType=="s"?1.5:1500;if(zot(once))once=false;obj.cursor="pointer";var stage;obj.zimClickHoldDownEvent=obj.on("mousedown",function(e){stage=e.target.stage;if(zot(stage.frame))stage.frame=zdf;if(zot(stage.frame)||!stage.frame.mousemoveEvent){if(zot(stage.frame))stage.frame={};stage.frame.mouseX=e.stageX/zim.scaX;stage.frame.mouseY=e.stageY/zim.scaY;if(stage.frame.mouseholdEvent)stage.off("stagemousemove",stage.frame.mouseholdEvent);stage.frame.mouseholdEvent=stage.on("stagemousemove",function(e){stage.frame.mouseX=e.stageX/zim.scaX;stage.frame.mouseY=e.stageY/zim.scaY;});}
if(e.currentTarget.type=="List"){if(e.target.type=="WindowBacking")return;var local=e.currentTarget.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);if(local.y<=0)return;}
var lastX=e.stageX/zim.scaX;var lastY=e.stageY/zim.scaY;var startTime=Date.now();clearInterval(obj.zimHoldInterval);var count=0;obj.zimHoldInterval=setInterval(function(){if(count<10){if(Math.abs(lastX+lastY-stage.frame.mouseX-stage.frame.mouseY)>distance){clearInterval(obj.zimHoldInterval);}}else{if(Math.abs(lastX+lastY-stage.frame.mouseX-stage.frame.mouseY)<distance){if(obj.excludeHold)return;call(e);}
clearInterval(obj.zimHoldInterval);}
count++;},time/10*(timeType=="s"?1000:1));obj.zimClickHoldUpEvent=obj.on("pressup",function(e){clearInterval(obj.zimHoldInterval);if(stage&&stage.frame.mouseholdEvent){stage.off("stagemousemove",stage.frame.mouseholdEvent);}},null,true);},null,once);return obj;};zim.noHold=function(obj){z_d("47.88");if(zot(obj))return;if(obj.cursor)obj.cursor="default";obj.off("mousedown",obj.zimClickHoldDownEvent);obj.off("pressup",obj.zimClickHoldUpEvent);if(obj.stage&&obj.stage.frame.mouseEvent){obj.stage.off("stagemousemove",obj.stage.frame.mouseEvent);}
clearInterval(obj.zimHoldTimeout);return obj;};zim.change=function(obj,call,once){z_d("47.85");if(zot(obj)||zot(call)||typeof call!="function")return;if(zot(once))once=false;obj.zimChangeEvent=obj.on("change",function(e){call(e);},null,once);return obj;};zim.noChange=function(obj){z_d("47.95");if(zot(obj))return;obj.off("mousedown",obj.zimChangeEvent);return obj;};zim.drag=function(obj,boundary,overCursor,dragCursor,all,swipe,localBounds,onTop,surround,slide,slideDamp,slideSnap,reg,removeTweens,startBounds,rect,currentTarget,offStage){var sig="obj, boundary, overCursor, dragCursor, all, swipe, localBounds, onTop, surround, slide, slideDamp, slideSnap, reg, removeTweens, startBounds, rect, currentTarget, offStage";var duo;if(duo=zob(zim.drag,arguments,sig))return duo;z_d("31");if(zot(obj)||!obj.on)return;var DA=zim.DRAGALL;if(window.DRAGALL!=null)DA=window.DRAGALL;if(zot(all)&&zot(currentTarget))all=DA;if(zot(all)&&zot(currentTarget))currentTarget=false;else if(!zot(all))currentTarget=all;else if(zot(currentTarget))currentTarget=false;if(obj.type=="Tag"||obj.type=="TextArea"||obj.type=="Loader")currentTarget=true;if(boundary&&boundary.getBounds&&obj.numChildren&&obj.numChildren>1&&obj.mouseChildren==true&&!all){var args=Array.prototype.slice.call(arguments);args[4]=true;obj.loop(function(o){args[0]=o;zim.drag.apply(null,args);});return obj;}
if(obj.zimDown)obj.noDrag();obj.cursor=(zot(overCursor))?"pointer":overCursor;if(zot(swipe))swipe=false;if(zot(localBounds))localBounds=false;if(zot(onTop))onTop=true;if(zot(surround))surround=false;if(zot(slide))slide=false;if(zot(slideDamp))slideDamp=.3;if(zot(slideSnap))slideSnap=true;var snapOptions=["horizontal","vertical","auto"];if(slideSnap!==true&&snapOptions.indexOf(slideSnap)<0)slideSnap=false;if(zot(reg))reg=false;if(zot(removeTweens))removeTweens=true;if(zot(startBounds))startBounds=true;if(zot(boundary)&&!zot(rect))boundary=rect;obj.dragPaused=false;if(slide){var dampX;var dampY;var back;var lastCount;var backX;var backY;var upX;var upY;var objUpX;var objUpY;var lastBackX;var lastBackY;var lastX;var lastY;var hasMoved;}else{obj.zimDragTicker=function(){};}
obj._draggable=true;zim.setSwipe(obj,swipe);obj.zimBoundary=boundary;obj.zimLocalBounds=localBounds;obj.downCheck=false;var moveCheck=false;var diffX;var diffY;var point;var r;var rLocal;obj.zimAdded=obj.on("added",initializeObject,null,true);obj.zimRemoved=obj.on("removed",unInitializeObject,null,true);if(obj.parent)initializeObject();function initializeObject(){obj.off("added",obj.zimAdded);boundary=obj.zimBoundary;if(boundary&&boundary.getBounds&&boundary.type!="Blob"){obj.zimLocalBounds=false;if(boundary.type!="Stage"&&boundary.type!="StageGL")boundary=boundary.boundsToGlobal();else boundary=new zim.Boundary(0,0,boundary.width,boundary.height);var bounds=obj.boundsToGlobal();var point=obj.localToGlobal(obj.regX,obj.regY);var tl=new zim.Point(point.x-bounds.x,point.y-bounds.y);var bw=obj.borderWidth?obj.borderWidth:0;boundary.x+=tl.x+bw/2;boundary.y+=tl.y+bw/2;boundary.width-=bounds.width+bw;boundary.height-=bounds.height+bw;obj.zimBoundary=boundary;}
diffX=0;diffY=0;if(obj.zimBoundary&&obj.zimBoundary.type!="Blob"){if(localBounds){r=zim.boundsToGlobal(obj.parent,obj.zimBoundary);if(surround)rLocal=obj.zimBoundary;}else{r=obj.zimBoundary;if(surround)rLocal=zim.boundsToGlobal(obj.parent,obj.zimBoundary,true);}}
if(r&&startBounds){point=obj.parent.localToGlobal(obj.x,obj.y);positionObject(obj,point.x,point.y);}
if(slide){setTimeout(function(){dampX=new zim.Damp(obj.x,slideDamp);dampY=new zim.Damp(obj.y,slideDamp);obj.zimDragImmediate=function(x,y){objUpX=x;objUpY=y;upX=lastBackX=upY=lastBackY=0;if(!zot(x))dampX.immediate(x);if(!zot(y))dampY.immediate(y);};back=3;lastCount=0;backX=[];backY=[];upX=obj.x;upY=obj.y;objUpX=obj.x;objUpY=obj.y;lastBackX=obj.x;lastBackY=obj.y;lastX=-10000;lastY=-10000;obj.zimDragMoving=true;setUpSlide();},50);}
if(!zot(obj.zimMaskDynamic))obj.zimMaskApply();}
function unInitializeObject(){if(obj.zimDragTicker)zim.Ticker.remove(obj.zimDragTicker);}
var dragObject;var stage;obj.pointers={};obj.zimDown=obj.on("mousedown",function(e){if(!obj.stage||obj.dragPaused)return;stage=obj.stage;if(!obj.zmu)obj.zmu=stage.frame.on("mouseupplus",function(e){if(obj.downCheck){if(!slide)obj.downCheck=false;doUp(e,true);}});obj.dragMouseX=Math.round(e.stageX/zim.scaX)+stage.x;obj.dragMouseY=Math.round(e.stageY/zim.scaY)+stage.y;var id="id"+Math.abs(e.pointerID+1);obj.pointers[id]=true;dragObject=(currentTarget)?e.currentTarget:e.target;if(obj.zimBoundary&&!dragObject.getBounds()){zog("zim.drag() - drag object needs bounds set");return;}
obj.downCheck=true;obj.stage.mouseMoveOutside=true;if(!zim.Ticker.has(obj.zimDragTicker))zim.Ticker.add(obj.zimDragTicker,obj.stage);if(removeTweens)createjs.Tween.removeTweens(dragObject);if(!dragObject.parent)return;if(onTop){var nc=dragObject.parent.numChildren-1;if(dragObject.parent.getChildAt(nc).type=="Keyboard")nc--;dragObject.parent.setChildIndex(dragObject,nc);if(dragObject.ZIMoutlineShape)dragObject.outline();}
if(dragObject.parent==obj.stage)var point=new zim.Point(e.stageX/zim.scaX,e.stageY/zim.scaY);else var point=dragObject.parent.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);if(reg){dragObject.x=point.x;dragObject.y=point.y;}
diffX=point.x-dragObject.x;diffY=point.y-dragObject.y;if(obj.zimBoundary){if(localBounds){r=zim.boundsToGlobal(dragObject.parent,obj.zimBoundary);if(surround)rLocal=obj.zimBoundary;}else{r=obj.zimBoundary;if(surround)rLocal=zim.boundsToGlobal(dragObject.parent,obj.zimBoundary,true);}}
obj.cursor=(zot(dragCursor))?"pointer":dragCursor;if(slide){obj.slideStartX=obj.x;obj.slideStartY=obj.y;hasMoved=obj.zimDragMoving;lastCount=0;backX=[point.x];backY=[point.y];lastX=-10000;lastY=-10000;obj.zimDragMoving=true;}
if(obj.type=="Pen"){obj.zimDragCheck=true;moveCheck=false;}},true);obj.zimMove=obj.on("pressmove",function(e){if(!obj.downCheck||obj.dragPaused)return;var x=(offStage?e.rawX:e.stageX)/zim.scaX+stage.x;var y=(offStage?e.rawY:e.stageY)/zim.scaY+stage.y;obj.dragMouseX=Math.round(x);obj.dragMouseY=Math.round(y);positionObject(dragObject,x,y);if(dragObject.ZIMoutlineShape)dragObject.outline();if(obj.type=="Pen"&&!moveCheck&&obj.drawing)moveCheck=true;else if(obj.type=="Tag"||obj.type=="TextArea"||obj.type=="Loader")obj.resize();},true);function positionObject(o,x,y){if(zot(o))o=(dragObject)?dragObject:obj;if(!o.parent)return;if(zot(x)||zot(y)){var p=o.parent.localToGlobal(o.x,o.y);diffX=diffY=0;if(obj.zimBoundary){if(localBounds){r=zim.boundsToGlobal(o.parent,obj.zimBoundary);if(surround)rLocal=o.zimBoundary;}else{r=obj.zimBoundary;if(surround)rLocal=zim.boundsToGlobal(o.parent,obj.zimBoundary,true);}}
x=p.x;y=p.y;if(slide){objUpX=o.x;objUpY=o.y;dragObject=o;if(dampX)dampX.immediate(objUpX);if(dampY)dampY.immediate(objUpY);}}
if(stage&&stage.type)var point=o.parent.globalToLocal(x,y);else var point=o.parent.globalToLocal(x*zim.scaX,y*zim.scaY);var checkedPoint;if(slide&&slideSnap){if(slideSnap=="vertical"){checkedPoint=checkBounds(o,point.x-diffX,point.y-diffY);o.x=checkedPoint.x;o.y=point.y-diffY;}else if(slideSnap=="horizontal"){checkedPoint=checkBounds(o,point.x-diffX,point.y-diffY);o.x=point.x-diffX;o.y=checkedPoint.y;}else{o.x=point.x-diffX;o.y=point.y-diffY;}}else{checkedPoint=checkBounds(o,point.x-diffX,point.y-diffY);o.x=checkedPoint.x;o.y=checkedPoint.y;}
if(slide&&!hasMoved&&(o.slideStartX!=o.x||o.slideStartY!=o.y))hasMoved=true;}
obj.zimPosition=positionObject;obj.zimUp=obj.on("pressup",function(e){doUp(e);},true);function doUp(e,outsideUp){var id="id"+Math.abs(e.pointerID+1);delete obj.pointers[id];if(!obj.downCheck||obj.dragPaused)return;obj.cursor=(zot(overCursor))?"pointer":overCursor;if(slide){dragObject.dispatchEvent("slidestart");if(dragObject.parent){var x=offStage?e.rawX:e.stageX;var y=offStage?e.rawY:e.stageY;var point=dragObject.parent.globalToLocal(x/zim.scaX,y/zim.scaY);}else{var point=new zim.Point(0,0);}
obj.downCheck=false;upX=point.x;upY=point.y;objUpX=dragObject.x;objUpY=dragObject.y;if(outsideUp){lastBackX=upX=0;lastBackY=upY=0;}
dampX.immediate(dragObject.x);dampY.immediate(dragObject.y);}else{var pointerCount=0;for(var o in obj.pointers){pointerCount++;}
if(pointerCount==0)zim.Ticker.remove(obj.zimDragTicker);if(obj.type=="Pen"){obj.zimDragCheck=false;if(moveCheck&&obj.drawing)obj.stopCheck();}}
if(obj.stage)obj.stage.update();}
function checkBounds(o,x,y){if(!o.parent)return{x:x,y:y};if(r){if(surround){var w=o.getBounds().width;var h=o.getBounds().height;var bx=o.getBounds().x;var by=o.getBounds().y;if(w<rLocal.width){x=rLocal.x+(rLocal.width-w)/2+(o.regX-bx);}else{if(x-(o.regX-bx)>rLocal.x){x=rLocal.x+(o.regX-bx);}
if(x-(o.regX-bx)+w<rLocal.x+rLocal.width){x=rLocal.x+rLocal.width+(o.regX-bx)-w;}}
if(o.height<rLocal.height){y=rLocal.y+(rLocal.height-h)/2+(o.regY-by);}else{if(y-(o.regY-by)>rLocal.y){y=rLocal.y+(o.regY-by);}
if(y-(o.regY-by)+h<rLocal.y+rLocal.height){y=rLocal.y+rLocal.height+(o.regY-by)-h;}}}else{if(r.type=="Blob"){if(r.shape.hitTestPoint(x,y))return{x:x,y:y};else return{x:obj.x,y:obj.y};}else{var point=o.parent.localToGlobal(x,y);x=Math.max(r.x,Math.min(r.x+r.width,point.x));y=Math.max(r.y,Math.min(r.y+r.height,point.y));point=o.parent.globalToLocal(x,y);x=point.x;y=point.y;}}}
return{x:x,y:y};}
function setUpSlide(){var stage=obj.stage;obj.zimDragTicker=function(){if(zot(obj.slideStartX))return;if(!dragObject)dragObject=obj;if(obj.downCheck){if(dragObject.parent){var point=dragObject.parent.globalToLocal(obj.dragMouseX,obj.dragMouseY);}else{var point=new zim.Point(0,0);}
lastCount++;backX.push(point.x);backY.push(point.y);if(lastCount>=back){lastBackX=backX.shift();lastBackY=backY.shift();}else{lastBackX=backX[0];lastBackY=backY[0];}}else{if(!obj.zimDragMoving)return;var desiredX=objUpX+upX-lastBackX;var desiredY=objUpY+upY-lastBackY;if(r){var checkedPoint=checkBounds(dragObject,desiredX,desiredY);desiredX=checkedPoint.x;desiredY=checkedPoint.y;}
if(!slideSnap){var checkedPoint=checkBounds(dragObject,dampX.convert(desiredX),dampY.convert(desiredY));dragObject.x=checkedPoint.x;dragObject.y=checkedPoint.y;testMove(dragObject,dragObject.x,dragObject.y,dragObject.x,dragObject.y);}else{dragObject.x=dampX.convert(desiredX);dragObject.y=dampY.convert(desiredY);testMove(dragObject,dragObject.x,dragObject.y,desiredX,desiredY);}}};function testMove(o,x,y,desiredX,desiredY){if(Math.abs(o.x-lastX)<.1&&Math.abs(o.y-lastY)<.1){obj.zimDragMoving=false;o.x=desiredX;o.y=desiredY;o.slideStartX=null;o.slideStartY=null;if(hasMoved){o.dispatchEvent("slidestop");zim.Ticker.remove(obj.zimDragTicker);}
if(obj.type=="Pen"){obj.zimDragCheck=false;if(moveCheck&&obj.drawing)obj.stopCheck();}}else{lastX=x;lastY=y;}}}
return obj;};zim.noDrag=function(obj,recursive){z_d("32");if(zot(obj)||!obj.on)return;if(zot(recursive))recursive=true;if(recursive&&obj.numChildren&&obj.numChildren>1){for(var i=0;i<obj.numChildren;i++){var o=obj.getChildAt(i);undrag(o);}}
undrag(obj);function undrag(obj){obj.cursor=null;obj._draggable=false;zim.setSwipe(obj,true);obj.off("added",obj.zimAdded);obj.off("removed",obj.zimRemoved);obj.off("mousedown",obj.zimDown);obj.off("pressmove",obj.zimMove);obj.off("pressup",obj.zimUp);if(obj.zmu){if(obj.stage)obj.stage.frame.off("mouseupplus",obj.zmu);else zdf.off("mouseupplus",obj.zmu);}
if(zim.Ticker){if(obj.zimDragSlide)zim.Ticker.remove(obj.zimDragSlide);if(obj.zimDragTicker)zim.Ticker.remove(obj.zimDragTicker);}
obj.zimDragMoving=obj.zimAdded=obj.zimRemoved=obj.zimDown=obj.zimMove=obj.zimUp=obj.zimBoundary=obj.zimDragSlide=null;obj.slideStartX=obj.slideStartY=obj.zimDragImmediate=null;obj.dragMouseX=obj.zimPosition=obj.dragMouseY=obj.zimDown=obj.zimUp=null;obj.zimDragTicker=obj.zimDragSlide=null;}
return obj;};zim.dragBoundary=function(obj,boundary,immediate){z_d("33");if(zot(obj)||!obj.on)return;if(zot(boundary))return;obj.zimBoundary=boundary;obj.zimDragMoving=true;if(obj.zimPosition)obj.zimPosition();return obj;};zim.dragRect=zim.dragBoundary;zim.mouse=function(obj){z_d("33.1");if(obj.zimLastMouse)obj.mouseChildren=obj.zimLastMouse;obj.mouseEnabled=true;return obj;};zim.noMouse=function(obj){z_d("33.15");obj.zimLastMouse=obj.mouseChildren;obj.mouseChildren=false;obj.mouseEnabled=false;return obj;};zim.wire=function(source,target,prop,twoWay,setSource,filter,call,input){var sig="source, target, prop, twoWay, setSource, filter, call, input";var duo;if(duo=zob(zim.wire,arguments,sig))return duo;z_d("33.2");if(zot(zim.Ticker))if(zon){zog("wire() - requires ZIM Frame");return source;}
if(zot(target))if(zon){zog("wire() - requires a target");return source;}
var DW=zim.DEFAULTWIRE;if(window.DEFAULTWIRE!=null)DW=window.DEFAULTWIRE;if(!zot(input)){}else if(DW&&DW!="currentValue"&&DW!="selectedIndex"){input=DW;}else{if(DW&&source.hasOwnProperty(DW))input=DW;else{if(source.hasOwnProperty("currentValue"))input="currentValue";else if(source.hasOwnProperty("selectedIndex"))input="selectedIndex";else input=prop;}}
if(zot(prop))prop=input;if(source.addChild)source.zimWire=true;if(target.addChild)target.zimWired=true;zim.Ticker.addWire(source,[target,prop,twoWay,setSource,filter,call,input]);return source;};zim.noWire=function(source,target,prop,input){var sig="source, target, prop, input";var duo;if(duo=zob(zim.noWire,arguments,sig))return duo;z_d("33.25");if(zot(zim.Ticker))if(zon){zog("noWire() - requires ZIM Frame");return source;}
zim.Ticker.removeWire(source,target,prop,input);return source;};zim.wired=function(target,source,prop,twoWay,setSource,filter,call,input){var sig="target, source, prop, twoWay, setSource, filter, call, input";var duo;if(duo=zob(zim.wired,arguments,sig))return duo;z_d("33.3");if(zot(zim.Ticker))if(zon){zog("wired() - requires ZIM Frame");return target;}
zim.wire(source,target,prop,twoWay,setSource,filter,call,input);return target;};zim.noWired=function(target,source,prop,input){var sig="target, source, prop, input";var duo;if(duo=zob(zim.noWire,arguments,sig))return duo;z_d("33.35");if(zot(zim.Ticker))if(zon){zog("noWired() - requires ZIM Frame");return target;}
zim.Ticker.removeWire(source,target,prop,input);return target;};if(typeof zimDefaultBind=="undefined")var zimDefaultBind;zim.bind=function(obj,id,props,extra,filter,bindObj){var sig="obj, id, props, extra, filter, bindObj";var duo;if(duo=zob(zim.bind,arguments,sig))return duo;z_d("33.17");if(!zimDefaultBind){if(zon)zogy("bind() - needs a Bind() object created first");return obj;}
if(zot(id)){if(zon)zogy("bind() - needs a unique id");return obj;}
var b=bindObj||zimDefaultBind;b.add(id,obj,props,extra,filter);return obj;};zim.noBind=function(obj,props,removeConnectionData,call,bindObj){var sig="obj, props, removeConnectionData, call, bindObj";var duo;if(duo=zob(zim.noBind,arguments,sig))return duo;z_d("33.18");if(!zimDefaultBind)return obj;var b=bindObj||zimDefaultBind;b.remove(obj,props,removeConnectionData,call);return obj;};zim.transform=function(obj,move,stretchX,stretchY,scale,rotate,allowToggle,visible,onTop,showStretch,showRotate,showScale,showReg,showBorder,borderColor,borderWidth,dashed,customCursors,handleSize,regSize,snapDistance,snapRotation,cache,events,ghostColor,ghostWidth,ghostDashed,ghostHidden,frame){var sig="obj, move, stretchX, stretchY, scale, rotate, allowToggle, visible, onTop, showStretch, showRotate, showScale, showReg, showBorder, borderColor, borderWidth, dashed, customCursors, handleSize, regSize, snapDistance, snapRotation, cache, events, ghostColor, ghostWidth, ghostDashed, ghostHidden, frame";var duo;if(duo=zob(zim.transform,arguments,sig))return duo;z_d("33.5");if(zot(obj)||!obj.getBounds){zog("zim methods - transform(): please provide object with bounds set");return obj;}
if(!obj.getBounds()){zog("zim methods - transform(): please setBounds() on object");return obj;}
if(!obj.parent){zog("zim methods - transform(): object should be on stage first");return obj;}
if(zot(move))move=true;if(zot(stretchX))stretchX=true;if(zot(stretchY))stretchY=true;if(obj.width==0)stretchX=false;if(obj.height==0)stretchY=false;if(zot(scale))scale=true;if(zot(rotate))rotate=true;var mobile=zim.mobile();if(zot(allowToggle))allowToggle=true;if(zot(visible))visible=true;if(zot(onTop))onTop=true;if(zot(showStretch))showStretch=mobile?true:false;if(zot(showRotate))showRotate=mobile?true:false;if(zot(showScale))showScale=true;if(zot(showReg))showReg=true;if(zot(showBorder))showBorder=true;if(zot(borderColor))borderColor="brown";if(zot(borderWidth))borderWidth=1;if(zot(ghostColor))ghostColor=null;if(zot(ghostWidth))ghostWidth=null;if(ghostColor<0||ghostWidth<0)ghostColor=ghostWidth=null;else if(ghostColor!=null&&ghostWidth==null)ghostWidth=1;if(zot(ghostDashed))ghostDashed=true;if(zot(ghostHidden))ghostHidden=false;if(zot(frame))frame=zdf;if(zot(customCursors))customCursors=mobile?false:true;if(zot(handleSize))handleSize=mobile?20:10;if(zot(regSize))regSize=16;if(zot(snapDistance))snapDistance=10;if(zot(snapRotation))snapRotation=5;if(zot(cache))cache=true;if(zot(events))events=false;if(obj.type=="Tag"||obj.type=="TextArea"||obj.type=="Loader")events=true;obj.mouseChildren=false;var con=obj.getConcatenatedMatrix().decompose();var stage=obj.stage?obj.stage:frame.stage;if(zot(frame.eventRemove)){stage.enableMouseOver();frame.ctrlKey=false;frame.shiftKey=false;window.addEventListener("keydown",function(e){frame.altKey=e.altKey;frame.ctrlKey=e.ctrlKey;});window.addEventListener("keyup",function(e){frame.altKey=e.altKey;frame.ctrlKey=e.ctrlKey;});}
var oB=obj.getBounds();var shape=new zim.Shape({style:false});var shapeG=new zim.Shape({style:false});var shapeR=new zim.Shape({style:false});shapeG.mouseEnabled=false;shapeR.controlType="reg";var p=obj.parent;var g=shape.graphics;var gG=shapeG.graphics;var gR=shapeR.graphics;var pTL;var pTR;var pBR;var pBL;var pR;var pMid;var cur;var mids;var corners;var controls=new zim.Container({style:false});controls.type="TransformControls";var squares=new zim.Container({style:false});var sidesH=new zim.Container({style:false});var sidesV=new zim.Container({style:false});var rotators=new zim.Container({style:false});var totalRotation;var totalScaleX;var totalScaleY;var totalSkewX;var totalSkewY;if(!zot(obj.zimMaskDynamic))obj.zimMaskApply();if(customCursors){var moveCursor=new zim.Container({style:false});var transformCursor=new zim.Container({style:false});makeCursor(moveCursor);makeCursor(transformCursor);function makeCursor(type){if(type==moveCursor)new zim.Triangle(16,12,12,"white").addTo(type).mov(0,-13.5);new zim.Triangle(16,12,12,"white").addTo(type).mov(13.5).rot(90);if(type==moveCursor)new zim.Triangle(16,12,12,"white").addTo(type).mov(0,13.5).rot(180);new zim.Triangle(16,12,12,"white").addTo(type).mov(-13.5).rot(-90);if(type==moveCursor)new zim.Triangle(10,7,7,"black").addTo(type).mov(0,-13);new zim.Triangle(10,7,7,"black").addTo(type).mov(13).rot(90);if(type==moveCursor)new zim.Triangle(10,7,7,"black").addTo(type).mov(0,13).rot(180);new zim.Triangle(10,7,7,"black").addTo(type).mov(-13).rot(-90);if(cache)type.cache(-20,-20,40,40);}
var ccData={"nw-resize":45,"ne-resize":-45,"n-resize":90,"e-resize":0};}
function getTotals(){var temp=obj;totalRotation=0;totalScaleX=1;totalScaleY=1;totalSkewX=0;totalSkewY=0;while(temp.parent){totalRotation+=temp.rotation;totalScaleX*=temp.scaleX;totalScaleY*=temp.scaleY;totalSkewX+=temp.skewX;totalSkewY+=temp.skewY;temp=temp.parent;}}
getTotals();var originalR=totalRotation;var cursors=["nw-resize","ne-resize","nw-resize","ne-resize"];var opposites=[2,3,0,1];for(var i=0;i<4;i++){if(showScale){var rect=new zim.Rectangle(handleSize,handleSize,"#e472c4","#333",2,null,null,null,false);rect.centerReg(squares);if(cache)rect.cache(-1,-1,handleSize+2,handleSize+2);}else{var rect=new zim.Rectangle(handleSize,handleSize,"rgba(0,0,0,0)","rgba(0,0,0,0)",2,null,null,null,false);rect.centerReg(squares);rect.expand(0);}
rect.rotation=totalRotation;cur=customCursors?"none":cursors[i];rect.drag({overCursor:cur,dragCursor:cur,onTop:false});rect.controlType="corner";rect.cu=cursors[i];}
for(var i=0;i<opposites.length;i++){squares.getChildAt(i).op=squares.getChildAt(opposites[i]);}
var cursorsSide=["n-resize","e-resize","n-resize","e-resize"];opposites=[1,1,0,0];for(var i=0;i<4;i++){var w=i%2==0?obj.width/2:handleSize;var h=i%2==0?handleSize:obj.height/2;if(showStretch){var rect=new zim.Rectangle(handleSize,handleSize,"#AAA","#333",2,null,null,null,false);rect.centerReg(i%2==0?sidesV:sidesH);if(cache)rect.cache(-1,-1,handleSize+2,handleSize+2);}else{var rect=new zim.Rectangle(w,h,"rgba(0,0,0,0)",null,null,null,null,null,false);rect.centerReg(i%2==0?sidesV:sidesH);rect.expand(0);}
rect.rotation=totalRotation;cur=customCursors?"none":cursorsSide[i];rect.drag({overCursor:cur,dragCursor:cur,onTop:false});rect.controlType="side";rect.cu=cursorsSide[i];}
for(var i=0;i<opposites.length;i++){var whichSide=i%2==0?sidesV:sidesH;whichSide.getChildAt(Math.floor(i/2)).op=whichSide.getChildAt(opposites[i]);}
var cursorsRotators=["ne-resize","nw-resize","ne-resize","nw-resize"];for(var i=0;i<4;i++){if(showRotate){var rect=new zim.Circle(handleSize,"#e472c4",null,null,null,null,null,null,false);rect.addTo(rotators);if(cache)rect.cache(-handleSize,-handleSize,handleSize*2,handleSize*2);}else{var rect=new zim.Circle(handleSize,"rgba(0,0,0,0)",null,null,null,null,null,null,false);rect.addTo(rotators);rect.expand(0);}
cur=customCursors?"none":cursorsRotators[i];rect.drag({overCursor:cur,dragCursor:cur,onTop:false});rect.controlType="rotate";rect.cu=cursorsRotators[i];}
var offSet=1.8;rotators.alpha=.5;setRotators();function setRotators(){var shiftRX=handleSize*offSet*zim.sign(totalScaleX);var shiftRY=handleSize*offSet*zim.sign(totalScaleY);rotators.getChildAt(0).reg(shiftRX,shiftRY);rotators.getChildAt(1).reg(-shiftRX,shiftRY);rotators.getChildAt(2).reg(-shiftRX,-shiftRY);rotators.getChildAt(3).reg(shiftRX,-shiftRY);stage.update();}
function makeControls(){g.c();gG.c();gR.c();pTL=obj.localToGlobal(oB.x,oB.y);pTR=obj.localToGlobal(oB.x+oB.width,oB.y);pBR=obj.localToGlobal(oB.x+oB.width,oB.y+oB.height);pBL=obj.localToGlobal(oB.x,oB.y+oB.height);var pTM=obj.localToGlobal(oB.x+oB.width/2,oB.y);var pRM=obj.localToGlobal(oB.x+oB.width,oB.y+oB.height/2);var pBM=obj.localToGlobal(oB.x+oB.width/2,oB.y+oB.height);var pLM=obj.localToGlobal(oB.x,oB.y+oB.height/2);pR=obj.localToGlobal(obj.regX,obj.regY);pMid=obj.localToGlobal(oB.x+oB.width/2,oB.y+oB.height/2);corners=[pTL,pTR,pBR,pBL];mids=[pTM,pRM,pBM,pLM];if(showBorder){g.s(borderColor);if(dashed)g.sd([10,5],0);g.ss(borderWidth).mt(pTL.x,pTL.y).lt(pTR.x,pTR.y).lt(pBR.x,pBR.y).lt(pBL.x,pBL.y).lt(pTL.x,pTL.y).cp();}
if(!zot(ghostColor)){gG.s(ghostColor);if(ghostDashed)gG.sd([10,5],0);gG.ss(ghostWidth).mt(pTL.x,pTL.y).lt(pTR.x,pTR.y).lt(pBR.x,pBR.y).lt(pBL.x,pBL.y).lt(pTL.x,pTL.y).cp();}
shape.setBounds(pTL.x,pTL.y,pTR.x-pTL.x,pBL.y-pTL.y);if(showReg){gR.s("#eee").ss(borderWidth).f("rgba(0,0,0,.1)").dc(0,0,regSize);gR.s("#222").ss(borderWidth).dc(0,0,regSize*.3);}
getTotals();var skX=Math.min(50,Math.abs(totalSkewX))*zim.sign(totalSkewX);var skY=Math.min(50,Math.abs(totalSkewY))*zim.sign(totalSkewY);var ro=(totalRotation)*zim.sign(totalScaleX*totalScaleY)*zim.sign(obj.scaleX*obj.scaleY);for(var i=0;i<corners.length;i++){var c=corners[i];squares.getChildAt(i).loc(c.x,c.y).ske(skX,skY).rot(ro);rotators.getChildAt(i).loc(c.x,c.y).rot(ro);var m=mids[i];var whichSide=i%2==0?sidesV:sidesH;whichSide.getChildAt(Math.floor(i/2)).loc(m.x,m.y).ske(skX,skY).rot(ro);if(!showStretch){whichSide.getChildAt(Math.floor(i/2)).sca(i%2==0?totalScaleX/2:1,i%2==0?1:totalScaleY/2);}}
shapeR.x=pR.x;shapeR.y=pR.y;}
makeControls();var dragger=new zim.Shape(1000,1000,null,null,null,false);function drawDragger(){dragger.x=0;dragger.y=0;dragger.graphics.c().f("rgba(0,0,0,.01)").mt(pTL.x,pTL.y).lt(pTR.x,pTR.y).lt(pBR.x,pBR.y).lt(pBL.x,pBL.y).lt(pTL.x,pTL.y).cp();dragger.reg(pR.x,pR.y);dragger.x=pR.x;dragger.y=pR.y;}
drawDragger();controls.on("dblclick",function(e){if(frame.ctrlKey&&obj.transformControls.visible){obj.scaleX=1;obj.scaleY=1;obj.rotation=0;makeControls();drawDragger();stage.update();}
pressUp(e,true);});var toggleControlsEvent=controls.on("mousedown",toggleCheck);var toggleObjEvent=obj.on("mousedown",toggleCheck);function toggleCheck(e){var underPoint=stage.getObjectUnderPoint(e.stageX,e.stageY,1);if(mobile||(underPoint&&((obj.contains&&obj.contains(underPoint))||(!obj.contains&&obj==underPoint)))){if(!obj.transformControls.visible){if(customCursors){dragReady=false;dragger.mouseEnabled=false;}else{frame.canvas.style.cursor="move";}
obj.transformControls.show();obj.dispatchEvent("transformshow");}}else{if(obj.transformControls.visible&&(!underPoint||!controls.contains(underPoint))){obj.transformControls.hide();obj.dispatchEvent("transformhide");}}}
var toggleStageEvent=stage.on("stagemousedown",function(e){var underPoint=stage.getObjectUnderPoint(e.stageX,e.stageY,1);var layerPress=(underPoint&&underPoint.parent&&underPoint.parent.layer&&underPoint.parent.layer==obj);if(obj.transformControls.visible&&(!underPoint||(!controls.contains(underPoint)&&!layerPress))){obj.dispatchEvent("transformhide");obj.transformControls.hide();}});if(!allowToggle){controls.off("mousedown",toggleControlsEvent);obj.off("mousedown",toggleObjEvent);stage.off("stagemousedown",toggleStageEvent);}
var startX;var startY;var startSX;var startSY;var startR;var startAngle;var diffX;var diffY;var cornerPoint;var objStartX;var objStartY;var objRX;var objRY;var rotateCheck=false;var mousePress=false;var mousemoveEvent;var dragmoveEvent;var objCursor=obj.cursor;var transformEvent;var carrier=new zim.Circle(30,"rgba(0,0,0,0)",null,null,null,null,null,null,false).expand(20);if(customCursors){carrier.mouseEnabled=false;carrier.mouseChildren=false;carrier.addChild(transformCursor);squares.on("mouseover",showCustomCursor);squares.on("mouseout",hideCustomCursor);sidesH.on("mouseover",showCustomCursor);sidesH.on("mouseout",hideCustomCursor);sidesV.on("mouseover",showCustomCursor);sidesV.on("mouseout",hideCustomCursor);rotators.on("mouseover",showCustomCursor);rotators.on("mouseout",hideCustomCursor);var carrier2=new zim.Circle(30,"rgba(0,0,0,0)",null,null,null,null,null,null,false).expand(20);carrier2.cursor="none";}
squares.on("mousedown",transformMousedown);squares.on("pressmove",scalePressmove);squares.on("pressup",pressUp);sidesH.on("mousedown",transformMousedown);sidesH.on("pressmove",scalePressmove);sidesH.on("pressup",pressUp);sidesV.on("mousedown",transformMousedown);sidesV.on("pressmove",scalePressmove);sidesV.on("pressup",pressUp);rotators.on("mousedown",transformMousedown);rotators.on("pressmove",rotatePressmove);rotators.on("pressup",pressUp);function transformMousedown(e){mousePress=true;if(onTop){upTop();}
if(mousemoveEvent)stage.off("stagemousemove",mousemoveEvent);startX=e.target.x;startY=e.target.y;objStartX=obj.x;objStartY=obj.y;startSX=obj.scaleX;startSY=obj.scaleY;if(e.target.controlType=="rotate"){rotateCheck=true;startR=obj.rotation;var startRX=e.stageX/zim.scaX;var startRY=e.stageY/zim.scaY;var point=p.localToGlobal(objStartX,objStartY);objRX=point.x;objRY=point.y;startAngle=Math.atan2(startRY-objRY,startRX-objRX)*180/Math.PI;}
if(frame.ctrlKey||e.target.controlType=="rotate"){diffX=Math.abs(startX-obj.x);diffY=Math.abs(startY-obj.y);}else{diffX=Math.abs(startX-e.target.op.x);diffY=Math.abs(startY-e.target.op.y);}
if(e.target.controlType!="rotate")cornerPoint=e.target.op.parent.localToLocal(e.target.op.x,e.target.op.y,obj.parent);if(carrier.stage)stage.setChildIndex(carrier,stage.getChildIndex(controls));else carrier.addTo(stage,stage.getChildIndex(controls)+1);carrier.x=e.stageX/zim.scaX;carrier.y=e.stageY/zim.scaY;carrier.cursor=customCursors?"none":e.target.cu;if(customCursors){obj.getConcatenatedMatrix().decompose(con);if(!con.rotation)con.rotation=0;transformCursor.rotation=con.rotation*zim.sign(totalScaleX*totalScaleY)*zim.sign(obj.scaleX*obj.scaleY)+ccData[e.target.cu]+originalR;if(e.target.controlType!="side"&&totalScaleX*totalScaleY<0)transformCursor.rotation+=90;carrier2.addTo(stage,1).pos({x:e.stageX/zim.scaX,y:e.stageY/zim.scaY,reg:true});}
dragger.visible=false;obj.cursor="none";}
function scalePressmove(e){var scale=1;if(frame.ctrlKey&&e.target.controlType=="corner"){scale=(diffX>diffY)?(e.target.x-objStartX)/(startX-objStartX):(e.target.y-objStartY)/(startY-objStartY);}else{if(diffX>diffY){if(startX-e.target.op.x)scale=(e.target.x-e.target.op.x)/(startX-e.target.op.x);}else{if(startY-e.target.op.y)scale=(e.target.y-e.target.op.y)/(startY-e.target.op.y);}}
if(e.target.controlType=="corner"){obj.scaleX=scale*startSX;obj.scaleY=scale*startSY;}else{obj.scaleX=(e.target.cu=="e-resize")?scale*startSX:startSX;obj.scaleY=(e.target.cu=="n-resize")?scale*startSY:startSY;}
makeControls();carrier.x=e.stageX/zim.scaX;carrier.y=e.stageY/zim.scaY;if(customCursors){carrier2.x=e.stageX/zim.scaX;carrier2.y=e.stageY/zim.scaY;}
if(!frame.ctrlKey||e.target.controlType=="side"){var newCornerPoint=e.target.op.parent.localToLocal(e.target.op.x,e.target.op.y,obj.parent);obj.x-=(newCornerPoint.x-cornerPoint.x)*zim.sign(totalScaleX)*zim.sign(obj.scaleX);obj.y-=(newCornerPoint.y-cornerPoint.y)*zim.sign(totalScaleY)*zim.sign(obj.scaleY);}
makeControls();if(obj.transformControls.events){var type=e.target.controlType;dispatchEvents(e,type);}}
function rotatePressmove(e){var angle=Math.atan2(e.stageY/zim.scaY-objRY,e.stageX/zim.scaX-objRX)*180/Math.PI;if(frame.shiftKey){obj.rot(Math.round((startR+(angle-startAngle)*zim.sign(totalScaleX)*zim.sign(obj.scaleX))/45)*45);}else{obj.rot(startR+(angle-startAngle)*zim.sign(totalScaleX)*zim.sign(obj.scaleX));}
makeControls();carrier.x=e.stageX/zim.scaX;carrier.y=e.stageY/zim.scaY;if(customCursors){obj.getConcatenatedMatrix().decompose(con);if(!con.rotation)con.rotation=0;transformCursor.rotation=con.rotation*zim.sign(totalScaleX*totalScaleY)*zim.sign(obj.scaleX*obj.scaleY)+ccData[e.target.cu]+originalR;if(e.target.controlType!="side"&&totalScaleX*totalScaleY<0)transformCursor.rotation+=90;carrier2.x=e.stageX/zim.scaX;carrier2.y=e.stageY/zim.scaY;}
makeControls();if(obj.transformControls.events){var type=e.target.controlType;dispatchEvents(e,type,null,false);}}
function pressUp(e,reset){setRotators();var type=e?e.target.controlType:"move";if(reset)type="reset";if(customCursors)carrier2.removeFrom(stage);dispatchEvents(e,type,true);stage.update();}
function dispatchEvents(e,type,pressup,cursors){if(cursors==null)cursors=true;var tCheck=false;transformEvent=null;if(type=="move"){if(obj.x!=startProperties.x||obj.y!=startProperties.y){transformEvent=new createjs.Event("transformed");transformEvent.transformType="move";}
if(cursors)tCheck=dragger.hitTestPoint(e.stageX/zim.scaX,e.stageY/zim.scaY);}else if(type=="corner"){if(obj.scaleX!=startProperties.scaleX||obj.scaleY!=startProperties.scaleY){transformEvent=new createjs.Event("transformed");transformEvent.transformType="size";}
if(cursors)tCheck=squares.hitTestPoint(e.stageX/zim.scaX,e.stageY/zim.scaY);}else if(type=="side"){if(obj.scaleX!=startProperties.scaleX||obj.scaleY!=startProperties.scaleY){transformEvent=new createjs.Event("transformed");transformEvent.transformType="stretch";}
if(cursors)tCheck=sidesH.hitTestPoint(e.stageX/zim.scaX,e.stageY/zim.scaY)||sidesV.hitTestPoint(e.stageX/zim.scaX,e.stageY/zim.scaY);}else if(type=="rotate"){if(obj.rotation!=startProperties.rotation){transformEvent=new createjs.Event("transformed");transformEvent.transformType="rotate";}
if(cursors)tCheck=rotators.hitTestPoint(e.stageX/zim.scaX,e.stageY/zim.scaY);}else if(type=="reg"){if(obj.regX!=startProperties.regX||obj.regY!=startProperties.regY){transformEvent=new createjs.Event("transformed");transformEvent.transformType="reg";}}else if(type=="reset"){transformEvent=new createjs.Event("transformed");transformEvent.transformType="reset";}else{transformEvent=new createjs.Event("transformed");transformEvent.transformType="unknown";}
if(cursors&&!tCheck){carrier.removeFrom(stage);frame.canvas.style.cursor="default";obj.cursor=objCursor;}
if(transformEvent){transformEvent.pressup=pressup;if(obj.type=="Tag"||obj.type=="TextArea"||obj.type=="Loader")obj.resize();obj.dispatchEvent(transformEvent);}}
function showCustomCursor(e){if(mousePress)return;if(carrier.stage)stage.setChildIndex(carrier,stage.getChildIndex(controls));else carrier.addTo(stage,stage.getChildIndex(controls)+1);carrier2.addTo(stage,1);carrier.x=e.stageX/zim.scaX;carrier.y=e.stageY/zim.scaY;carrier2.x=e.stageX/zim.scaX;carrier2.y=e.stageY/zim.scaY;obj.getConcatenatedMatrix().decompose(con);if(!con.rotation)con.rotation=0;transformCursor.rotation=con.rotation*zim.sign(totalScaleX*totalScaleY)*zim.sign(obj.scaleX*obj.scaleY)+ccData[e.target.cu]+originalR;if(e.target.controlType!="side"&&totalScaleX*totalScaleY<0)transformCursor.rotation+=90;stage.update();if(mousemoveEvent)stage.off("stagemousemove",mousemoveEvent);mousemoveEvent=stage.on("stagemousemove",function(e){carrier.x=e.stageX/zim.scaX;carrier.y=e.stageY/zim.scaY;stage.update();});}
function hideCustomCursor(e){stage.off("stagemousemove",mousemoveEvent);if(mousePress)return;obj.cursor=objCursor;carrier.removeFrom(stage);carrier2.removeFrom(stage);stage.update();}
function upTop(){if(onTop){var nc=p.numChildren-1;if(p.getChildAt(nc).type=="Keyboard")nc--;p.setChildIndex(obj,nc);addControls();}}
function addControls(){if(p==stage){controls.removeFrom();stage.addChildAt(controls,stage.getChildIndex(obj)+1);}else{var insert=p;while(insert.parent&&insert.parent!=stage){insert=insert.parent;}
if(obj.stage){if(controls.parent==stage)stage.removeChild(controls);stage.addChildAt(controls,stage.getChildIndex(insert)+1);}}}
shapeR.drag();shapeR.on("mousedown",upTop);shapeR.on("pressup",function(e){if(!frame.ctrlKey){for(var i=0;i<corners.length;i++){if(zim.dist(shapeR.x,shapeR.y,corners[i].x,corners[i].y)<snapDistance){shapeR.x=corners[i].x;shapeR.y=corners[i].y;break;}}
if(zim.dist(shapeR.x,shapeR.y,pMid.x,pMid.y)<snapDistance){shapeR.x=pMid.x;shapeR.y=pMid.y;}}
var originalRotation=obj.rotation;var point=obj.globalToLocal(shapeR.x,shapeR.y);if(p==stage)var rPoint=new zim.Point(shapeR.x,shapeR.y);else var rPoint=p.globalToLocal(shapeR.x,shapeR.y);obj.reg(point.x,point.y);obj.rotation=0;obj.x=obj.x+rPoint.x-obj.x;obj.y=obj.y+rPoint.y-obj.y;obj.rotation=originalRotation;makeControls();drawDragger();pressUp(e);stage.update();});var dragReady=true;cur=customCursors?"none":"move";dragger.drag({overCursor:cur,dragCursor:cur,onTop:false});dragger.controlType="move";if(customCursors){dragger.on("mouseover",draggerOver);dragger.on("mouseout",draggerOut);}
function draggerOut(){stage.off("stagemousemove",dragmoveEvent);if(mousePress)return;moveCursor.removeFrom(controls);stage.update();}
function draggerOver(e){if(mousePress||!customCursors||!dragReady)return;moveCursor.addTo(controls).pos({x:e.stageX/zim.scaX,y:e.stageY/zim.scaY,reg:true});stage.update();if(dragmoveEvent)stage.off("stagemousemove",dragmoveEvent);dragmoveEvent=stage.on("stagemousemove",function(e){moveCursor.x=e.stageX/zim.scaX;moveCursor.y=e.stageY/zim.scaY;stage.update();});}
dragger.on("mousedown",upTop);dragger.on("pressmove",function(e){if(!obj.transformControls.visible)return;if(p==stage)var point=new zim.Point(dragger.x,dragger.y);else var point=p.globalToLocal(dragger.x,dragger.y);obj.x=point.x;obj.y=point.y;makeControls();if(obj.transformControls.events){var type="move";dispatchEvents(e,type);}});dragger.on("pressup",function(e){if(!obj.transformControls.visible)return;pressUp(e);});var stageUpEvent=stage.on("stagemouseup",function(){mousePress=false;dragger.mouseEnabled=true;if(!dragReady){transformEvent=new createjs.Event("transformed");if(obj.x!=startProperties.x||obj.y!=startProperties.y){transformEvent.transformType="move";}else{transformEvent.transformType="select";}
transformEvent.pressup=true;obj.dispatchEvent(transformEvent);}
dragReady=true;dragger.visible=true;if(rotateCheck){if(!frame.ctrlKey&&snapRotation>1){obj.rotation=Math.round(obj.rotation/snapRotation)*snapRotation;makeControls();}}
drawDragger();dragger.mouseEnabled=true;rotateCheck=false;stage.update();});function getStartProperies(){startProperties={x:obj.x,y:obj.y,rotation:obj.rotation,regX:obj.regX,regY:obj.regY,scaleX:obj.scaleX,scaleY:obj.scaleY};}
var startProperties;getStartProperies();var compareObjEvent=obj.on("mousedown",getStartProperies);var compareControlEvent=controls.on("mousedown",getStartProperies);controls.addChild(shape);if(move)controls.addChild(dragger);if(scale)controls.addChild(squares);if(stretchX)controls.addChild(sidesH);if(stretchY)controls.addChild(sidesV);if(rotate)controls.addChild(rotators);controls.addChild(shapeR);var pressmoveEvent;if(move){obj.drag({overCursor:"pointer",dragCursor:"pointer",onTop:false,removeTweens:false});pressmoveEvent=obj.on("pressmove",function(e){makeControls();drawDragger();setRotators();if(obj.transformControls.events){var type="move";dispatchEvents(e,type);}});}
var toggleStart=allowToggle;obj.transformControls={visible:visible,events:events,ghost:!zot(ghostColor),ghostEnabled:!zot(ghostColor),show:function(){if(onTop)upTop();addControls();obj.toggled=true;obj.transformControls.visible=true;if(shapeG.parent)shapeG.removeFrom();stage.update();return obj;},hide:function(){if(obj.transformControls.ghost)var index=stage.getChildIndex(controls);stage.removeChild(controls);if(obj.transformControls.ghost&&obj.transformControls.ghostEnabled)stage.addChildAt(shapeG,index);obj.toggled=false;obj.transformControls.visible=false;if(customCursors){if(mousemoveEvent)stage.off("stagemousemove",mousemoveEvent);if(dragmoveEvent)stage.off("stagemousemove",dragmoveEvent);mousePress=false;carrier.removeFrom(stage);carrier2.removeFrom(stage);}
if(!move)obj.cursor=objCursor;stage.update();return obj;},remove:function(noHide){if(!noHide){obj.transformControls.hide();}
allowToggle=false;if(move){obj.noDrag();obj.off("pressmove",pressmoveEvent);}},add:function(noShow){if(!noShow){obj.transformControls.show();}
allowToggle=toggleStart;if(move){obj.drag({overCursor:"pointer",dragCursor:"pointer",onTop:false,removeTweens:false});pressmoveEvent=obj.on("pressmove",pressmoveEvent);}},allowToggleOn:function(){allowToggle=toggleStart=true;toggleControlsEvent=controls.on("mousedown",toggleControlsEvent);toggleObjEvent=obj.on("mousedown",toggleObjEvent);toggleStageEvent=stage.on("stagemousedown",toggleStageEvent);},allowToggleOff:function(){allowToggle=toggleStart=false;controls.off("mousedown",toggleControlsEvent);obj.off("mousedown",toggleObjEvent);stage.off("stagemousedown",toggleStageEvent);},disable:function(){controls.mouseChildren=false;controls.mouseEnabled=false;if(move){obj.noDrag();obj.off("pressmove",pressmoveEvent);}},enable:function(){controls.mouseChildren=true;controls.mouseEnabled=true;if(move){obj.drag({overCursor:"pointer",dragCursor:"pointer",onTop:false,removeTweens:false});pressmoveEvent=obj.on("pressmove",pressmoveEvent);}},recordData:function(toJSON){var data={type:obj.type,index:p.getChildIndex(obj),x:obj.x,y:obj.y,scaleX:obj.scaleX,scaleY:obj.scaleY,rotation:obj.rotation,skewX:obj.skewX,skewY:obj.skewY,regX:obj.regX,regY:obj.regY,controls:obj.transformControls.visible};return toJSON?JSON.stringify(data):data;},setData:function(data,fromJSON){if(zot(data))return;if(fromJSON)data=JSON.parse(data);var visible=data.controls;delete data.controls;var index=data.index;if(zot(index))index=0;delete data.index;for(var i in data){obj[i]=data[i];}
setTimeout(function(){makeControls();drawDragger();setRotators();p.setChildIndex(obj,index);if(obj.transformControls.visible&&obj.type!="Layer")obj.transformControls.show();else obj.transformControls.hide();if(obj.transformControls.ghost&&!obj.transformControls.ghostEnabled&&!obj.transformControls.visible)stage.addChild(shapeG);},90);return obj;},hideGhost:function(){obj.transformControls.ghost=false;shapeG.removeFrom();},showGhost:function(){obj.transformControls.ghost=true;if(obj.transformControls.ghostEnabled&&!obj.transformControls.visible){var insert=p;while(insert.parent&&insert.parent!=stage){insert=insert.parent;}
if(shapeG.stage){stage.setChildIndex(shapeG,stage.getChildIndex(insert)+1);}else{stage.addChildAt(shapeG,stage.getChildIndex(insert)+1);}}},addGhost:function(){if(ghostWidth>0){obj.transformControls.ghostEnabled=true;obj.transformControls.showGhost();}
else{if(zon)zogy("transform() - ghostWidth must be > 0 when making transform");}},removeGhost:function(){obj.transformControls.ghostEnabled=false;obj.transformControls.hideGhost();},resize:function(dispatch){p=obj.parent;makeControls();drawDragger();setRotators();if(visible)obj.transformControls.show();if(dispatch){var transformEvent=new createjs.Event("transformed");transformEvent.pressup=true;transformEvent.transformType="resize";obj.dispatchEvent(transformEvent);}
return obj;},dispose:function(){obj.transformControls.hide();allowToggle=false;if(move){obj.noDrag();obj.off("pressmove",pressmoveEvent);}
obj.transformControls.hideGhost();dragger.removeAllEventListeners();rotators.removeAllEventListeners();shapeR.removeAllEventListeners();sidesH.removeAllEventListeners();sidesV.removeAllEventListeners();squares.removeAllEventListeners();controls.removeAllEventListeners();if(toggleObjEvent)obj.off("mousedown",toggleObjEvent);if(toggleControlsEvent)obj.off("mousedown",toggleControlsEvent);if(toggleStageEvent)stage.off("stagemousedown",toggleStageEvent);if(mousemoveEvent)stage.off("stagemousemove",mousemoveEvent);if(dragmoveEvent)stage.off("stagemousemove",dragmoveEvent);if(stageUpEvent)stage.off("stagemouseup",stageUpEvent);if(compareObjEvent)obj.off("mousedown",compareObjEvent);if(pressmoveEvent)obj.off("pressmove",pressmoveEvent);controls=carrier=carrier2=null;obj.transformControls=null;},controls:controls,scaleControls:squares,stretchXControls:sidesH,stretchYControls:sidesV,rotateControls:rotators};obj.toggle=function(state){if(state===true)obj.transformControls.show();else if(state===false)obj.transformControls.hide();else if(obj.transformControls.visible)obj.transformControls.hide();else obj.transformControls.show();return obj;};if(obj.transformControls.ghost){obj.transformControls.toggleGhost=function(state){if(state===true)obj.transformControls.showGhost();else if(state===false)obj.transformControls.hideGhost();else if(obj.transformControls.visible)obj.transformControls.hideGhost();else obj.transformControls.showGhost();return obj;};}
if(visible)obj.transformControls.show();else if(!ghostHidden&&obj.transformControls.ghost)obj.transformControls.showGhost();return obj;};zim.gesture=function(obj,move,scale,rotate,boundary,minScale,maxScale,snapRotate,localBounds,slide,slideEffect,regControl,onTop,surround,circularBounds,rect){var sig="obj, move, scale, rotate, boundary, minScale, maxScale, snapRotate, localBounds, slide, slideEffect, regControl, onTop, surround, circularBounds, rect";var duo;if(duo=zob(zim.gesture,arguments,sig))return duo;z_d("34.5");if(zot(obj)||!obj.on)return;if(zot(move))move=true;if(zot(scale))scale=true;if(zot(rotate))rotate=true;if(zot(localBounds))localBounds=false;if(zot(snapRotate))snapRotate=1;if(zot(slide))slide=false;if(zot(slideEffect))slideEffect=5;if(zot(regControl))regControl=false;if(zot(onTop))onTop=true;if(zot(surround))surround=false;if(surround&&rotate){surround=rect=null;if(zon)zogy("gesture() - does not support surround when rotate is true");}
if(zot(circularBounds))circularBounds=false;if(zot(boundary)&&!zot(rect))boundary=rect;var slideData;var slideCount;var slideSlice;var slideTotal;var timeType=getTIME();if(!zot(obj.zimMaskDynamic))obj.zimMaskApply();if(!obj.zimTouch){var dampScaleX=new zim.Damp(obj.scaleX,.05);var dampScaleY=new zim.Damp(obj.scaleY,.05);var scaleRatio=obj.scaleX/obj.scaleY;obj.zimTouch={move:move,scale:scale,rotate:rotate,pointers:{},checkBounds:function(x,y){if(obj.zimTouch.boundary){var boundary=obj.zimTouch.boundary;var point=obj.parent.localToLocal(x,y,obj.parent);if(surround){x=Math.min(boundary.x,Math.max(boundary.x+boundary.width,point.x));y=Math.min(boundary.y,Math.max(boundary.y+boundary.height,point.y));}else{x=Math.max(boundary.x,Math.min(boundary.x+boundary.width,point.x));y=Math.max(boundary.y,Math.min(boundary.y+boundary.height,point.y));}
point=obj.parent.globalToLocal(x,y);x=point.x;y=point.y;}
return{x:x,y:y};}};if(boundary){obj.zimTouch.boundary=boundary;if(localBounds)obj.zimTouch.boundary=zim.boundsToGlobal(obj.parent,boundary);obj.zimTouch.boundaryStartX=obj.zimTouch.boundary.x;obj.zimTouch.boundaryStartY=obj.zimTouch.boundary.y;obj.zimTouch.boundaryStartW=obj.zimTouch.boundary.width;obj.zimTouch.boundaryStartH=obj.zimTouch.boundary.height;var result=obj.zimTouch.checkBounds(obj.x,obj.y);obj.x=result.x;obj.y=result.y;}
if(slide){slideSlice=10;slideTotal=5;slideCount=0;slideData=[];obj.zimTouch.slideInterval=zim.interval(slideSlice/(timeType=="s"?1000:1),function(){slideData[slideCount++%slideTotal]=[obj.x,obj.y];});obj.zimTouch.slideInterval.pause();obj.animate({x:obj.x,y:obj.y},10/(timeType=="s"?1000:1),"quadOut");}
var matrixStart;var startScaleX;var startScaleY;var startRotation;var startRegX;var startRegY;var lastPoint;var maxTouches;obj.zimTouch.mousedown=obj.on("mousedown",function(e){if(zot(maxTouches))maxTouches=1;else maxTouches++;var stage=obj.stage;if(onTop){var nc=obj.parent.numChildren-1;if(obj.parent.getChildAt(nc).type=="Keyboard")nc--;obj.parent.setChildIndex(obj,nc);if(obj.ZIMoutlineShape)obj.outline();}
if(!regControl){lastPoint=null;startScaleX=obj.scaleX;startScaleY=obj.scaleY;startRotation=obj.rotation;startRegX=obj.regX;startRegY=obj.regY;obj.reg(0,0);matrixStart=obj.getMatrix();obj.regX=startRegX;obj.regY=startRegY;}
var id="id"+Math.abs(e.pointerID+1);var local=obj.parent.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);obj.zimTouch.pointers[id]={startX:local.x,startY:local.y,x:local.x,y:local.y};if(obj.zimTouch.move||obj.zimTouch.rotate){obj.zimTouch.total=0;zim.loop(obj.zimTouch.pointers,function(id){obj.zimTouch.total++;});}
if(slide&&obj.zimTouch.total==1)obj.zimTouch.slideInterval.pause(false);setTouches();});obj.zimTouch.pressmove=obj.on("pressmove",function(e){var stage=obj.stage;var id="id"+Math.abs(e.pointerID+1);var local=obj.parent.globalToLocal(e.stageX/zim.scaX,e.stageY/zim.scaY);if(obj.zimTouch.pointers[id]){obj.zimTouch.pointers[id].x=local.x;obj.zimTouch.pointers[id].y=local.y;}
var newX=0;var newY=0;var aveX=0;var aveY=0;var deltaX=0;var deltaY=0;zim.loop(obj.zimTouch.pointers,function(id,pointer){newX+=pointer.x-pointer.startX;newY+=pointer.y-pointer.startY;aveX+=pointer.x;aveY+=pointer.y;});deltaX=newX/obj.zimTouch.total;deltaY=newY/obj.zimTouch.total;newX=obj.zimTouch.startX+deltaX;newY=obj.zimTouch.startY+deltaY;aveX=aveX/obj.zimTouch.total;aveY=aveY/obj.zimTouch.total;var proxy={x:obj.x,y:obj.y,scaleX:obj.scaleX,scaleY:obj.scaleY,rotation:obj.rotation};if(obj.zimTouch.move){var result=obj.zimTouch.checkBounds(newX,newY);proxy.x=result.x;proxy.y=result.y;}
if(obj.zimTouch.pair.length==2){var point1=obj.zimTouch.pair[0];var point2=obj.zimTouch.pair[1];if(obj.zimTouch.scale){var startDistance=Math.sqrt(Math.pow((point2.startX-point1.startX),2)+Math.pow((point2.startY-point1.startY),2));var currentDistance=Math.sqrt(Math.pow((point2.x-point1.x),2)+Math.pow((point2.y-point1.y),2));var newScaleX=obj.zimTouch.startSX+(currentDistance/startDistance-1);var newScaleY=obj.zimTouch.startSY+(currentDistance/startDistance-1);proxy.scaleX=newScaleX;proxy.scaleY=newScaleY;proxy.scaleX=dampScaleX.convert(newScaleX);proxy.scaleY=dampScaleY.convert(newScaleY);var minBad=(!zot(minScale)&&Math.min(newScaleX,newScaleY)<minScale);var maxBad=(!zot(maxScale)&&Math.max(newScaleX,newScaleY)>maxScale);if(minBad||maxBad){if(minBad){if(scaleRatio>1){proxy.scaleY=minScale;proxy.scaleX=minScale*scaleRatio;}else{proxy.scaleX=minScale;proxy.scaleY=minScale/scaleRatio;}}else if(maxBad){if(scaleRatio>1){proxy.scaleX=maxScale;proxy.scaleY=maxScale/scaleRatio;}else{proxy.scaleY=maxScale;proxy.scaleX=maxScale*scaleRatio;}}
dampScaleX.immediate(proxy.scaleX);dampScaleY.immediate(proxy.scaleY);}}
if(obj.zimTouch.rotate){var startAngle=Math.atan2((point1.startY-point2.startY),(point1.startX-point2.startX))*(180/Math.PI);var currentAngle=Math.atan2((point1.y-point2.y),(point1.x-point2.x))*(180/Math.PI);var deltaR=currentAngle-startAngle;proxy.rotation=obj.zimTouch.startR+deltaR;}
if(regControl){obj.scaleX=proxy.scaleX;obj.scaleY=proxy.scaleY;obj.rotation=proxy.rotation;if(obj.zimTouch.move){obj.x=proxy.x;obj.y=proxy.y;}}else{obj.reg(0,0);var adjust=obj.parent.localToGlobal(aveX,aveY);aveX=adjust.x;aveY=adjust.y;var point=zot(lastPoint)?obj.globalToLocal(aveX,aveY):obj.globalToLocal(lastPoint.x,lastPoint.y);var matrix=matrixStart.clone().translate(point.x,point.y).rotate(proxy.rotation-startRotation).scale(proxy.scaleX/startScaleX,proxy.scaleY/startScaleY).translate(-(point.x),-(point.y));matrix.decompose(obj);if(obj.zimTouch.move){obj.x+=deltaX;obj.y+=deltaY;}
lastPoint=obj.localToGlobal(point.x,point.y);obj.reg(startRegX,startRegY);}
if(obj.zimTouch.scale)obj.dispatchEvent("scale");if(obj.zimTouch.rotate)obj.dispatchEvent("rotate");if(obj.zimTouch.move)obj.dispatchEvent("move");}else{obj.x=proxy.x;obj.y=proxy.y;if(obj.zimTouch.move)obj.dispatchEvent("move");}
if(obj.type=="Tag"||obj.type=="TextArea"||obj.type=="Loader")obj.resize();if(obj.ZIMoutlineShape)obj.outline();if(obj.getStage&&obj.stage)obj.stage.update();});var mouseCount=0;obj.on("mousedown",function(){var mouseCount=1;obj.stage.on("stagemousedown",function(){mouseCount++;});obj.stage.on("stagemouseup",function(){mouseCount--;if(mouseCount==0){setTimeout(function(){if(obj.zimTouch)obj.zimTouch.total=0;if(obj.zimTouch)obj.zimTouch.pointers={};maxTouches=null;},50);}});},null,true);obj.zimTouch.pressup=obj.on("pressup",function(e){var id="id"+Math.abs(e.pointerID+1);delete obj.zimTouch.pointers[id];if(obj.zimTouch.move||obj.zimTouch.rotate)obj.zimTouch.total--;if(rotate&&!zot(snapRotate)&&obj.zimTouch.total==0){if(snapRotate>0){obj.rotation=Math.round(obj.rotation/snapRotate)*snapRotate;}else if(snapRotate==0){obj.rotation=Math.round(obj.rotation);}}
if(slide&&obj.zimTouch.total==0&&maxTouches==1){obj.zimTouch.slideInterval.pause();var startSlide=slideData[(slideCount+1)%slideData.length];var currentSlide=slideData[(slideCount)%slideData.length];var newX=obj.x+(startSlide[0]-currentSlide[0])*slideEffect;var newY=obj.y+(startSlide[1]-currentSlide[1])*slideEffect;var result=obj.zimTouch.checkBounds(newX,newY);var newT=slideTotal*slideSlice*slideEffect*Math.min((obj.x-result.x)/(obj.x-newX)||1,(obj.y-result.y)/(obj.y-newY)||1);obj.animate({x:result.x,y:result.y},newT/(timeType=="s"?1000:1),"quadOut",function(){obj.dispatchEvent("slidestop");});}
if(obj.zimTouch.total==0)maxTouches=null;if(obj.getStage&&obj.stage)obj.stage.update();setTouches();});function setTouches(){obj.zimTouch.pair=[];zim.loop(obj.zimTouch.pointers,function(id,pointer,i){pointer.startX=pointer.x;pointer.startY=pointer.y;if(i<=1)obj.zimTouch.pair.push(pointer);});obj.zimTouch.startX=obj.x;obj.zimTouch.startY=obj.y;obj.zimTouch.startSX=obj.scaleX;obj.zimTouch.startSY=obj.scaleY;obj.zimTouch.startR=obj.rotation;}
if(boundary){remakeBoundary();obj.on("move",remakeBoundary);}
function remakeBoundary(){var p=obj.localToGlobal(obj.regX,obj.regY);if(circularBounds){var leftTop=obj.parent.localToGlobal(obj.x-obj.width/2,obj.y-obj.height/2);var botRight=obj.parent.localToGlobal(obj.x+obj.width/2,obj.y+obj.height/2);var b={x:leftTop.x,y:leftTop.y,width:botRight.x-leftTop.x,height:botRight.y-leftTop.y};}else{var b=obj.boundsToGlobal();}
var r={x:obj.zimTouch.boundaryStartX+p.x-b.x,y:obj.zimTouch.boundaryStartY+p.y-b.y,width:obj.zimTouch.boundaryStartW-b.width,height:obj.zimTouch.boundaryStartH-b.height};obj.gestureBoundary(r,false);}}
return obj;};zim.noGesture=function(obj,move,scale,rotate){var sig="obj, move, scale, rotate";var duo;if(duo=zob(zim.noGesture,arguments,sig))return duo;z_d("34.6");if(zot(obj)||!obj.on||!obj.zimTouch)return;if(zot(move))move=true;if(zot(scale))scale=true;if(zot(rotate))rotate=true;obj.zimTouch.move=!move;obj.zimTouch.scale=!scale;obj.zimTouch.rotate=!rotate;if(!obj.zimTouch.move&&!obj.zimTouch.scale&&!obj.zimTouch.rotate){obj.off("mousedown",obj.zimTouch.mousedown);obj.off("pressmove",obj.zimTouch.pressmove);obj.off("pressup",obj.zimTouch.pressup);delete obj.zimTouch;}
return obj;};zim.gestureBoundary=function(obj,boundary,update){z_d("34.7");if(zot(obj)||!obj.on)return;if(zot(boundary)||!obj.zimTouch)return;if(obj.zimTouch.localBounds&&obj.parent){obj.zimTouch.boundary=zim.boundsToGlobal(obj.parent,boundary);}else{obj.zimTouch.boundary=boundary;}
if(zot(update))update=true;if(update){obj.zimTouch.boundaryStartX=boundary.x;obj.zimTouch.boundaryStartY=boundary.y;obj.zimTouch.boundaryStartW=boundary.width;obj.zimTouch.boundaryStartH=boundary.height;}
var result=obj.zimTouch.checkBounds(obj.x,obj.y);obj.x=result.x;obj.y=result.y;return obj;};zim.effect=function(obj,effect,x,y,width,height){z_d("33.16");if(zot(effect))return obj;if(zot(obj.effects))obj.effects={};if(!Array.isArray(effect))effect=[effect];var customCount=0;for(var j=0;j<effect.length;j++){var eff=effect[j];if(!eff.type){if(eff instanceof createjs.BlurFilter)eff.type="BlurEffect";else if(eff instanceof createjs.ColorFilter)eff.type="ColorEffect";else if(eff instanceof createjs.AlphaMaskFilter)eff.type="AlphaEffect";else if(eff instanceof createjs.ColorMatrixFilter)eff.type="MultiEffect";else if(zot(eff.type))eff.type="custom"+customCount++;}
var e=eff.type.replace(/effect/i,"");obj.effects[e.toLowerCase()]=eff;}
obj.filters=[];for(var i in obj.effects){obj.filters.push(obj.effects[i]);}
obj.cache(x,y,width,height);return obj;};zim.updateEffects=function(obj,redoChache){z_d("33.163");if(obj.updateCache){if(!redoChache)obj.updateCache();else obj.cache();}
return obj;};zim.noEffect=function(obj,effects,cache){z_d("33.165");if(zot(cache))cache=false;if(zot(effects)){var storeMulti;if(obj.effects.multi)storeMulti=obj.effects.multi;obj.effects={};if(storeMulti)obj.effects.multi=storeMulti;}else{if(!obj.effects)obj.effects={};if(!Array.isArray(effects))effects=[effects];for(var j=0;j<effects.length;j++){var e=effects[j].replace(/effect/i,"");delete obj.effects[e.toLowerCase()];}}
obj.filters=[];for(var i in obj.effects){obj.filters.push(obj.effects[i]);}
if(cache||obj.filters.length>0){if(obj.updateCache)obj.updateCache();}else{if(obj.uncache)obj.uncache();}
return obj;};zim.addPhysics=function(obj,dynamic,contract,shape,friction,linear,angular,density,bounciness,maskBits,categoryBits,physics,restitution){var sig="obj, dynamic, contract, shape, friction, linear, angular, density, bounciness, maskBits, categoryBits, physics, restitution";var duo;if(duo=zob(zim.addPhysics,arguments,sig))return duo;z_d("34.8");if(zot(physics)){if(typeof(zimPhysics)=="undefined"){if(zon){zog("ZIM Physics module must be imported");}return obj;}
if(zot(zimDefaultPhysics))zimDefaultPhysics=new zim.Physics();physics=zimDefaultPhysics;}
obj.physics=physics;var defaultShape="rectangle";if(obj.type=="Circle"||obj.type=="Dial")defaultShape="circle";else if(obj.type=="Triangle")defaultShape="triangle";if(zot(shape))shape=defaultShape;if(zot(bounciness))bounciness=restitution;setPhysics(obj,dynamic,contract,shape,friction,linear,angular,density,bounciness,maskBits,categoryBits);return obj;};zim.removePhysics=function(obj){z_d("34.85");if(zot(obj.physics))return obj;if(obj==obj.physics.followObj)obj.physics.follow(null);obj.follow=obj.noFollow=obj.control=obj.noControl=obj.sleep=obj.wake=null;obj.impulse=obj.force=obj.spin=obj.torque=null;obj.physics.remove(obj.body);obj.physics=null;return obj;};zim.hitTestPoint=function(obj,x,y,boundsCheck){if(!zim.zimhtp){z_d("35");zim.zimhtp=true;}
if(!obj.stage||zot(x)||zot(y))return false;var stage=obj.stage;if(zot(obj)||!obj.globalToLocal)return;if(zot(boundsCheck))boundsCheck=true;if(boundsCheck){var bounds=obj.getBounds();if(bounds){var boundPoint=obj.globalToLocal(x,y);if(boundPoint.x>bounds.x+bounds.width||boundPoint.x<bounds.x)return false;if(boundPoint.y>bounds.y+bounds.height||boundPoint.y<bounds.y)return false;}}
var point={x:x,y:y};if(obj.image||obj.spriteSheet||obj.type=="Shape")point=obj.globalToLocal(point.x,point.y);else point=obj.globalToLocal(point.x*zim.scaX,point.y*zim.scaY);return obj.hitTest(point.x,point.y);};zim.hitTestReg=function(a,b,boundsCheck){if(!zim.zimhtr){z_d("36");zim.zimhtr=true;}
if(!a.stage||!b.stage)return false;var stage=a.stage;if(zot(a)||zot(b)||!a.localToLocal||!b.localToLocal)return;if(zot(boundsCheck))boundsCheck=true;var point=b.localToGlobal(b.regX,b.regY);var bounds=a.getBounds();if(boundsCheck&&bounds){var boundPoint=a.globalToLocal(point.x,point.y);if(boundPoint.x>bounds.x+bounds.width||boundPoint.x<bounds.x)return false;if(boundPoint.y>bounds.y+bounds.height||boundPoint.y<bounds.y)return false;}
if(a.image||a.spriteSheet||a.type=="Shape")point=a.globalToLocal(point.x,point.y);else point=a.globalToLocal(point.x*zim.scaX,point.y*zim.scaY);return a.hitTest(point.x,point.y);};zim.hitTestRect=function(a,b,num,boundsCheck){if(!zim.zimhtr){z_d("37");zim.zimhtr=true;}
if(!a.stage||!b.stage)return false;var stage=a.stage;if(zot(a)||zot(b)||!a.hitTest||!b.getBounds)return;if(zot(num))num=0;if(zot(boundsCheck))boundsCheck=true;var bounds=b.getBounds();if(!bounds){if(zon)zogy("hitTestRect():\n please setBounds() on param b object");return;}
if(boundsCheck){var bounds2=a.getBounds();if(bounds2&&!zim.hitTestBounds(a,b))return false;}
function test(point){if(a.image||a.spriteSheet||a.type=="Shape")point=a.globalToLocal(point.x,point.y);else point=a.globalToLocal(point.x*zim.scaX,point.y*zim.scaY);if(a.hitTest(point.x,point.y))return true;}
var centerX=bounds.x+bounds.width/2;var centerY=bounds.y+bounds.height/2;var point=b.localToGlobal(centerX,centerY);if(test(point))return true;var shiftX,shiftY,point;for(var i=0;i<=num;i++){shiftX=bounds.width*(i+1)/(num+1);shiftY=bounds.height*(i+1)/(num+1);point=b.localToGlobal(bounds.x+shiftX,bounds.y);if(test(point))return true;point=b.localToGlobal(bounds.x+bounds.width,bounds.y+shiftY);if(test(point))return true;point=b.localToGlobal(bounds.x+bounds.width-shiftX,bounds.y+bounds.height);if(test(point))return true;point=b.localToGlobal(bounds.x,bounds.y+bounds.height-shiftY);if(test(point))return true;}};zim.hitTestCircle=function(a,b,num,boundsCheck){if(!zim.zimhtc){z_d("38");zim.zimhtr=true;}
z_d("38");if(!a.stage||!b.stage)return;var stage=a.stage;if(zot(a)||zot(b)||!a.hitTest||!b.getBounds)return;if(zot(num))num=8;if(zot(boundsCheck))boundsCheck=true;var bounds=b.getBounds();if(!bounds){if(zon)zogy("hitTestCircle():\n please setBounds() on param b object");return;}
var bounds2=a.getBounds();if(boundsCheck&&bounds2&&!zim.hitTestBounds(a,b))return false;function test(point){if(a.image||a.spriteSheet||a.type=="Shape")point=a.globalToLocal(point.x,point.y);else point=a.globalToLocal(point.x*zim.scaX,point.y*zim.scaY);if(a.hitTest(point.x,point.y))return true;}
var centerX=bounds.x+bounds.width/2;var centerY=bounds.y+bounds.height/2;var point=b.localToGlobal(centerX,centerY);if(test(point))return true;var radius=(bounds.width+bounds.height)/2/2;var angle,pointX,pointY;for(var i=0;i<num;i++){angle=i/num*2*Math.PI;pointX=centerX+(radius*Math.cos(angle));pointY=centerY+(radius*Math.sin(angle));point=b.localToGlobal(pointX,pointY);if(test(point))return true;}
return false;};zim.hitTestCircleRect=function(a,b,margin){if(!zim.zimhtcr){z_d("38.2");zim.zimhtcr=true;}
if(!a.stage||!b.stage)return;var stage=a.stage;if(zot(a)||zot(b)||!a.getBounds||!b.getBounds)return;var aBounds=a.getBounds();var bBounds=b.getBounds();if(!aBounds||!bBounds){if(zon)zogy("hitTestCircleRect():\n please setBounds() on both objects");return;}
if(zot(margin))margin=0;var radius=(a.radius?a.radius:(aBounds.width+aBounds.height)/2)+margin;var rect=b.boundsToGlobal();var point=a.localToGlobal(0,0);var cx=point.x;var cy=point.y;var left=rect.x;var top=rect.y;var right=rect.x+rect.width;var bottom=rect.y+rect.height;var closestX=(cx<left?left:(cx>right?right:cx));var closestY=(cy<top?top:(cy>bottom?bottom:cy));var dx=closestX-cx;var dy=closestY-cy;return(dx*dx+dy*dy)<=radius*radius;};zim.hitTestCircles=function(a,b,margin){if(!zim.zimhtcs){z_d("38.5");zim.zimhtcs=true;}
if(!a.stage||!b.stage)return;var stage=a.stage;if(zot(a)||zot(b)||!a.hitTest||!a.getBounds||!b.getBounds)return;var aBounds=a.getBounds();var bBounds=b.getBounds();if(!aBounds||!bBounds){if(zon)zogy("hitTestCircles():\n please setBounds() on both objects");return;}
if(zot(margin))margin=0;var p1=a.localToGlobal(aBounds.x+aBounds.width/2,aBounds.y+aBounds.height/2);var p2=b.localToGlobal(bBounds.x+bBounds.width/2,bBounds.y+bBounds.height/2);var m1=a.getConcatenatedMatrix();var m2=b.getConcatenatedMatrix();var scale1X=Math.sqrt((m1.a/stage.scaleX*m1.a/stage.scaleX)+(m1.c/stage.scaleX*m1.c/stage.scaleX));var scale1Y=Math.sqrt((m1.b/stage.scaleY*m1.b/stage.scaleY)+(m1.d/stage.scaleY*m1.d/stage.scaleY));var scale2X=Math.sqrt((m2.a/stage.scaleX*m2.a/stage.scaleX)+(m2.c/stage.scaleX*m2.c/stage.scaleX));var scale2Y=Math.sqrt((m2.b/stage.scaleY*m2.b/stage.scaleY)+(m2.d/stage.scaleY*m2.d/stage.scaleY));var d=Math.sqrt(Math.abs(Math.pow(p1.x-p2.x,2)+Math.pow(p1.y-p2.y,2)));if(aBounds.width*Math.max(scale1X,scale1Y)/2+bBounds.width*Math.max(scale2X,scale2Y)/2>=d-margin)return true;else return false;};zim.hitTestBounds=function(a,b,margin,boundsShape){if(!zim.zimhtb){z_d("39");zim.zimhtb=true;}
if(!a.stage||!b.stage)return;if(zot(a)||zot(b)||!a.getBounds||!b.getBounds)return;var boundsCheck=false;if(boundsShape&&boundsShape.graphics)boundsCheck=true;var aB=a.getBounds();var bB=b.getBounds();if(!aB||!bB){if(zon)zogy("hitTestBounds():\n please setBounds() on both objects");return;}
if(zot(margin))margin=0;var adjustedA=zim.boundsToGlobal(a);var adjustedB=zim.boundsToGlobal(b);if(boundsCheck){var g=boundsShape.graphics;g.c();g.ss(1).s("blue");g.r(adjustedA.x,adjustedA.y,adjustedA.width,adjustedA.height);g.s("green");g.r(adjustedB.x,adjustedB.y,adjustedB.width,adjustedB.height);boundsShape.stage.update();}
return zim.rectIntersect(adjustedA,adjustedB,margin);};zim.hitTestPath=function(a,b,num,showPoints){if(!zim.zimhtpa){z_d("37.5");zim.zimhtpa=true;}
if(!a.stage||!b.stage)return;var stage=a.stage;if(zot(a)||zot(b)||!a.hitTest)return;if(b.type!="Squiggle"&&b.type!="Blob")return;var aB=a.getBounds();if(zot(num))num=2;if(zot(showPoints))showPoints=false;function test(point){if(a.image||a.spriteSheet||a.type=="Shape")point=a.globalToLocal(point.x,point.y);else point=a.globalToLocal(point.x*zim.scaX,point.y*zim.scaY);if(a.hitTest(point.x,point.y))return true;}
var points=b.interpolate(num,null,true,null,true);if(showPoints){if(!b.hitPathPoints)b.hitPathPoints=new zim.Container().addTo();else b.hitPathPoints.removeAllChildren();b.hitPathPoints.top();for(var i=0;i<points.length;i++){var point=points[i];point=b.localToGlobal(point.x,point.y);new zim.Circle(3).loc(point.x,point.y,b.hitPathPoints);}}
if(aB){var bounds=zim.boundsAroundPoints(points);if(!zim.rectIntersect(a.boundsToGlobal(aB),b.boundsToGlobal(bounds)))return;}
for(var i=0;i<points.length;i++){var point=points[i];point=b.localToGlobal(point.x,point.y);if(test(point))return true;}
return false;};zim.hitTestGrid=function(obj,width,height,cols,rows,x,y,offsetX,offsetY,spacingX,spacingY,local,type){if(!zim.zimhtg){z_d("41");zim.zimhtg=true;}
if(!obj.stage)return false;if(!zot(obj)&&!local){var point=obj.globalToLocal(x,y);x=point.x;y=point.y;}
if(zot(offsetX))offsetX=0;if(zot(offsetY))offsetY=0;if(zot(spacingX))spacingX=0;if(zot(spacingY))spacingY=0;width+=spacingX;height+=spacingY;var sizeX=width/(cols);var sizeY=height/(rows);var col=Math.min(cols-1,Math.max(0,Math.floor((x-offsetX+spacingX/2)/sizeX)));var row=Math.min(rows-1,Math.max(0,Math.floor((y-offsetY+spacingY/2)/sizeY)));if(type!="open"){if((x-offsetX)>sizeX*(col+1)-spacingX||(x-offsetX)<sizeX*(col))return;if((y-offsetY)>sizeY*(row+1)-spacingY||(y-offsetY)<sizeY*(row))return;}
var index=row*cols+col;if(zot(type)||type=="index")return index;if(type=="col")return col;if(type=="row")return row;if(type=="array"||type=="open")return[index,col,row];};zim.animate=function(target,props,time,ease,call,params,wait,waitedCall,waitedParams,loop,loopCount,loopWait,loopCall,loopParams,loopWaitCall,loopWaitParams,loopPick,rewind,rewindWait,rewindCall,rewindParams,rewindWaitCall,rewindWaitParams,rewindTime,rewindEase,sequence,sequenceCall,sequenceParams,sequenceReverse,ticker,cjsProps,css,protect,override,from,set,id,events,sequenceTarget,dynamic,drag,clamp,startPaused,clean,obj,seriesWait,sequenceWait,rate,pauseOnBlur,easeAmount,easeFrequency,timeUnit,timeCheck){var sig="target, props, time, ease, call, params, wait, waitedCall, waitedParams, loop, loopCount, loopWait, loopCall, loopParams, loopWaitCall, loopWaitParams, loopPick, rewind, rewindWait, rewindCall, rewindParams, rewindWaitCall, rewindWaitParams, rewindTime, rewindEase, sequence, sequenceCall, sequenceParams, sequenceReverse, ticker, cjsProps, css, protect, override, from, set, id, events, sequenceTarget, dynamic, drag, clamp, startPaused, clean, obj, seriesWait, sequenceWait, rate, pauseOnBlur, easeAmount, easeFrequency, timeUnit, timeCheck";if(target&&(target.props||target.obj)){var duo;if(duo=zob(zim.animate,arguments,sig))return duo;}
if(target.type=="AC"&&zdf){zdf.ac("animate",arguments);return target;}
if(!zim.animateCheck){z_d("45");zim.animateCheck=true;}
if(!target)return;var AN=zim.ANIMATE;if(window.ANIMATE!=null)AN=window.ANIMATE;if(!AN)return target;if(zot(timeCheck))timeCheck=true;var timeType=getTIME(null,timeUnit,null,null,zot(timeCheck)?false:!timeCheck);if(loopCount>0)loop=true;var startArguments=arguments;var startParams=Array.prototype.slice.call(arguments);if(zot(props)&&!zot(obj))props=obj;obj=props;if(zot(obj)){if(zon){zog("animate() - need props");}return target;}
if(target.type=="BeadsContainer"){if(zot(sequence))sequence=0;}
if(zot(pauseOnBlur))pauseOnBlur=true;if(target.type=="Tone")pauseOnBlur=false;if(pauseOnBlur){if(zot(zim.blurCheck))zim.setBlurDetect();zim.pauseAnimateOnBlur=true;}
if(!zot(sequence)&&target.addChild){}else{time=zim.Pick.choose(time);ease=zim.Pick.choose(ease);wait=zim.Pick.choose(wait);loopCount=zim.Pick.choose(loopCount);loopWait=zim.Pick.choose(loopWait);rewind=zim.Pick.choose(rewind);rewindWait=zim.Pick.choose(rewindWait);if(zot(rewindTime))rewindTime=time;else rewindTime=zim.Pick.choose(rewindTime);sequenceReverse=zim.Pick.choose(sequenceReverse);from=zim.Pick.choose(from);set=zim.Pick.choose(set);var zikTypes=["loopCount","loopWait","rewind","rewindWait"];for(var prop in cjsProps){if(zikTypes.indexOf(prop)>=0)cjsProps[prop]=zim.Pick.choose(cjsProps[prop]);}}
var newProps={override:((!zot(target)&&!zot(target.zimX)&&!zot(obj.x))||(!zot(target)&&!zot(target.zimY)&&!zot(obj.y)))};if(!zot(loop))newProps.loop=loop;if(!zot(loopCount))newProps.count=loopCount;if(!zot(loopWait))newProps.loopWait=loopWait;if(!zot(loopCall))newProps.loopCall=loopCall;if(!zot(loopWaitParams))newProps.loopWaitParams=loopWaitParams;if(!zot(loopWaitCall))newProps.loopWaitCall=loopWaitCall;if(!zot(loopParams))newProps.loopParams=loopParams;if(!zot(loopPick))newProps.loopPick=loopPick;if(!zot(rewind))newProps.rewind=rewind;if(!zot(rewindWait))newProps.rewindWait=rewindWait;if(!zot(rewindCall))newProps.rewindCall=rewindCall;if(!zot(rewindParams))newProps.rewindParams=rewindParams;if(!zot(rewindWaitCall))newProps.rewindWaitCall=rewindWaitCall;if(!zot(rewindWaitParams))newProps.rewindWaitParams=rewindWaitParams;if(!zot(props))newProps=zim.merge(newProps,cjsProps);cjsProps=newProps;zim.loop(obj,function(o,v){if(typeof o=="string"){var sp=o.split(".");if(sp.length>1&&o.substr(0,1)!="."){obj["."+o]=v;delete obj[o];o="."+o;}
if(sp.length>1&&typeof v=="string"){var sub=v.substr(0,1);if(sub!="+"&&sub!="-")obj[o]="+"+v;}}});function getValue(what,prop){if(prop.substr(0,1)=="."){var dots=prop.split(".");var lastdot=what;for(var i=1;i<dots.length;i++){lastdot=lastdot[dots[i]];}
return lastdot;}else{return what[prop];}}
function setValue(what,prop,val){if(prop.substr(0,1)=="."){var dots=prop.split(".");var lastdot=what;for(var i=1;i<dots.length-1;i++){lastdot=lastdot[dots[i]];}
lastdot[dots[dots.length-1]]=val;}else{what[prop]=val;}}
target.zimTweenOriginals={};var sequenceTarget;if(!zot(sequence)&&target.addChild){var newTarget=[];for(var i=0;i<target.numChildren;i++){newTarget.push(target.getChildAt(i));}
sequenceTarget=target;target=newTarget;}
var extraTypes=["extra","zoom","speed","layer","fade"];var extraLookup={zoom:target.type=="Pen"?"size":"scale",speed:"percentSpeed",layer:"layer",fade:"alpha"};if(target instanceof Array){if(sequenceReverse)target.reverse();var currentTarget=0;for(var i=0;i<target.length;i++){var tar=target[i];if(from){var val;tar.zimObj={};for(var prop in obj){if(extraTypes.indexOf(prop)>=0)val=obj[prop];else val=zim.Pick.choose(obj[prop]);tar.zimObj[prop]=tar[prop];if(typeof val=="string"){var newStart;if(tar.zimLastObj&&!zot(tar.zimLastObj[prop]))newStart=tar.zimLastObj[prop];else newStart=tar[prop];val=newStart+Number(val.replace(/\s/g,""));}
if(tar.zimLastObj)tar.zimLastObj[prop]=rewind?tar.zimTweenOriginals[prop]:obj[prop];tar[prop]=val;}}else{tar.zimObj={};for(var prop in obj){if(extraTypes.indexOf(prop)>=0)tar.zimObj[prop]=obj[prop];else tar.zimObj[prop]=obj[prop];}}
var seqTime=i*sequence;if(i==0&&sequence!=0)seqTime=timeType=="s"?.02:20;zim.animate(tar,tar.zimObj,time,ease,(i==target.length-1?call:null),(i==target.length-1?params:null),wait,waitedCall,waitedParams,null,null,null,null,null,null,null,loopPick,null,null,null,null,null,null,rewindTime,rewindEase,null,sequenceCall,sequenceParams,null,ticker,zim.copy(cjsProps),css,protect,override,null,set,id,events,sequenceTarget,dynamic,drag,clamp,startPaused,clean,obj,seriesWait,seqTime,rate,pauseOnBlur,easeAmount,easeFrequency,timeUnit,timeCheck);}
return sequenceTarget;}
var t=time;var t2=rewindTime;if(zot(t))t=timeType=="s"?1:1000;if(zot(rewindTime))rewindTime=t2=t;if(zot(ease))ease="quadInOut";if(zot(wait))wait=0;if(zot(rewindWait))rewindWait=0;if(zot(cjsProps))cjsProps={override:(!zot(target.zimX)&&!zot(obj.x)||!zot(target.zimY)&&!zot(obj.y))};if(zot(params))params=target;if(zot(ticker))ticker=true;if(zot(css))css=false;if(zot(protect))protect=false;if(zot(from))from=false;if(zot(set))set={};if(set.scale){set.scaleX=set.scaleY=set.scale;delete set.scale;}
if(!zot(override))cjsProps.override=override;if(zot(drag))drag=false;if(zot(startPaused))startPaused=drag?true:false;if(zot(dynamic))dynamic=false;if(zot(clamp))clamp=true;if(zot(clean))clean=true;if(zot(rate))rate=1;target.futureRate=rate;var tween;var idSet;var providedID;if(obj instanceof Array){var currentCount=1;if(obj.length==0)return this;var starts;var lastParamTarget;prepareSeries();prepareIds();runMaster();function runMaster(){if(target.zimLastObj){zim.loop(target.zimLastObj,function(i){if(zot(target.zimTweenOriginals[i]))return;target[i]=target.zimTweenOriginals[i];target.zimLastObj[i]=target.zimTweenOriginals[i];});}
var o;var w=wait;var lastEnd=0;var duration;var durationRewind;for(var i=0;i<obj.length;i++){o=obj[i];if(zot(o.target))continue;if(zot(o.time))o.time=t;w+=(o.wait?o.wait:0);duration=o.time;durationRewind=(zot(o.rewindTime)?duration:o.rewindTime);if(o.rewind)duration=duration+durationRewind+(o.rewindWait?o.rewindWait:0);if(o.loop){duration*=o.loopCount;duration+=(o.loopCount-1)*(o.loopWait?o.loopWait:0);}
if(zot(o.params))o.params=o.target;lastParamTarget=o.target;if(w<0){lastEnd+=w;w=0;}
var currentObj={target:o.target,obj:zim.copy(o.obj),seriesWait:lastEnd,wait:w,waitedCall:o.waitedCall,waitedParams:o.waitedParams,time:o.time,ease:o.ease,from:o.from,rewind:o.rewind,call:o.call,params:o.params,loop:o.loop,loopCount:o.loopCount,loopWait:o.loopWait,loopCall:o.loopCall,loopParams:o.loopParams,loopWaitCall:o.loopWaitCall,loopWaitParams:o.loopWaitParams,loopPick:o.loopPick,rewindWait:o.rewindWait,rewindCall:o.rewindCall,rewindParams:o.rewindParams,rewindWaitCall:o.rewindWaitCall,rewindWaitParams:o.rewindWaitParams,rewindTime:o.rewindTime,rewindEase:o.rewindEase,set:zim.copy(o.masterSet),events:events,rate:target.futureRate,pauseOnBlur:o.pauseOnBlur,easeAmount:o.easeAmount,easeFrequency:o.easeFrequency,override:false,id:id};if(i==obj.length-1){endSeries(currentObj);}
zim.animate(currentObj);lastEnd+=w+duration;w=0;}}
function endSeries(currentObj){var savedCall=currentObj.call;var savedParams=currentObj.params;if(cjsProps.loop&&(!cjsProps.count||currentCount<cjsProps.count)){currentObj.call=function(){if(cjsProps.loopCall&&typeof cjsProps.loopCall=='function'){(cjsProps.loopCall)(cjsProps.loopParams);}
if(cjsProps.loopWait){if(zot(target.zimTweens))target.zimTweens={};tween=target.zimTweens[id]=target.zimTween=createjs.Tween.get(target,{override:cjsProps.override}).wait(cjsProps.loopWait,true).call(goNext);tween.timeScale=target.futureRate;}else{goNext();}
function goNext(){for(var k=0;k<starts.objects.length;k++){if(starts.objects[k].set)starts.objects[k].set(starts.values[k]);}
if(cjsProps.loopWaitCall&&typeof cjsProps.loopWaitCall=='function'){(cjsProps.loopWaitCall)(cjsProps.loopWaitParams);}
runMaster();}};}else{currentObj.call=function(){if(savedCall&&typeof savedCall=='function'){(savedCall)(savedParams);}
if(zot(params))params=lastParamTarget;if(call&&typeof call=='function'){(call)(params);}
endTween(id);target.zimLastObj=null;};}
currentCount++;}
function prepareSeries(){if(target&&!target.seriesTweens){target.seriesTweens=[];target.seriesCalls=[];target.seriesParams=[];}
var o;for(var i=0;i<obj.length;i++){o=obj[i];if(o.target){if(!o.target.seriesTweens)o.target.seriesTweens=[];if(!o.target.seriesCalls)o.target.seriesCalls=[];if(!o.target.seriesParams)o.target.seriesParams=[];o.target.seriesTweens.push(o.props);o.target.seriesCalls.push(o.call);o.target.seriesParams.push(o.params);}else{target.seriesTweens.push(o.props);target.seriesCalls.push(o.call);target.seriesParams.push(o.params);}}
target.seriesCalls.push(call);target.seriesParams.push(params);o=obj[0];var ttar;if(!target)ttar=o.target;else ttar=target;ttar.zimSeriesOriginals={};for(i=obj.length-1;i>=0;i--){o=obj[i];if(zot(o.props)&&!zot(o.obj))o.props=o.obj;o.obj=o.props;zim.loop(o.obj,function(oo,v){if(oo=="path")ttar.zimSeriesOriginals[oo]=obj[oo];else ttar.zimSeriesOriginals[oo]=getValue(ttar,oo);});}
var froms=new zim.Dictionary();starts=new zim.Dictionary();for(var i=0;i<obj.length;i++){o=obj[i];if(!target)target=o.target;if(zot(o.target))o.target=target;if(zot(o.ease))o.ease=ease;if(zot(o.target))continue;if(i==0)o.target.zimSeriesArgs=startArguments;if(zot(o.props)&&!zot(o.obj))o.props=o.obj;o.obj=o.props;if(o.loop&&(zot(o.loopCount)||o.loopCount<=0)){o.loopCount=0;obj.splice(i+1,obj.length);}
if(!zot(o.obj.scale)){o.obj.scaleX=o.obj.scaleY=o.obj.scale;delete o.obj.scale;}
if(o.from){var firstFrom=froms.at(o.target);if(firstFrom){if(o.set){var temp=zim.copy(o.obj);var merged=zim.merge(firstFrom,o.set);o.obj=getFroms(o.target,o.obj,merged);o.set=zim.merge(o.set,temp);}else{o.set=zim.copy(o.obj);o.obj=getFroms(o.target,o.obj,firstFrom);}
o.from=false;}else{froms.add(o.target,getFroms(o.target,o.obj,o.set));}}
var startProps={};for(var iii in o.obj){startProps[iii]=o.set?(o.set[iii]?o.set[iii]:o.target[iii]):o.target[iii];}
if(zot(starts.at(o.target)))starts.add(o.target,{});var newEntry=zim.merge(starts.at(o.target),startProps);starts.remove(o.target);starts.add(o.target,newEntry);o.masterSet=zim.copy(o.set);}
if(zot(target.zimTweens))target.zimTweens={};}
return target;}
if(obj){if(obj.x)target.zimX=true;if(obj.y)target.zimY=true;}
if(!zot(obj.shape)&&obj.shape.type==target.type&&(target.type=="Blob"||target.type=="Squiggle")){var targetPoints=target.pointObjects;var shapePoints=obj.shape.pointObjects;if(targetPoints.length!=shapePoints.length){if(zon)zogy("animate() - shapes must be of same number of points");delete obj.shape;}else{var shape=obj.shape;delete obj.shape;var blobShift=zot(obj.blobShift)?0:obj.blobShift;delete obj.blobShift;var first=true;for(var i=0;i<targetPoints.length;i++){var targetPoint=targetPoints[i];var shapePoint=shapePoints[(targetPoints.length*20000+i+blobShift)%targetPoints.length];for(j=0;j<4;j++){if(j==1)continue;var controls=targetPoint[j];var shapeControls=shapePoint[j];var animateParams=zim.copy(startParams);animateParams[0]=controls;animateParams[1]={x:shapePoint[j].x,y:shapePoint[j].y,rotation:shapePoint[j].rotation};if(first){animateParams[37]=true;if(controls.animateEvent)controls.off("animation",controls.animateEvent);controls.animateEvent=controls.on("animation",function(){target.update();});}
first=false;zim.animate.apply(zim.animate,animateParams);}}
if(zim.isEmpty(obj))return target;}}
if(zot(target))return;if(!target.tweenStates)target.tweenStates={all:true};var fromCheck=false;if(obj.note){if(Array.isArray(obj.note)){zim.loop(obj.note,function(n,i){if(typeof n=="string")obj.note[i]=zim.Synth.note(n);});}else if(obj.note.min){obj.note.min=zim.Synth.note(obj.note.min);obj.note.max=zim.Synth.note(obj.note.max);}else if(obj.note.array){zim.loop(obj.note.array,function(n,i){if(typeof n=="string")obj.note.array[i]=zim.Synth.note(n);});}else if(typeof obj.note=="function"){if(zon){zog("animate() - use frequency in ZIM VEE functions not note");return target;}}else{obj.note=zim.Synth.note(obj.note);}
obj.frequency=obj.note;delete obj.note;}
function isGetter(obj,prop){return!!Object.getOwnPropertyDescriptor(obj,prop)['get'];}
if(target.type=="Sprite"||!target.hasOwnProperty("paused")){Object.defineProperty(target,'paused',{get:function(){return target.animatePaused;},set:function(value){target.animatePaused=value;}});target.paused=true;}
target.endTween=function(callType,ids){target.stopAnimate(ids);if(callType!="all"&&callType!="main"&&callType!="none")callType="all";if(!target.seriesTweens){zim.loop(target.zimLastObj,function(o){if(typeof target.zimLastObj[o]=="string"){target.zimLastObj[o]=target[o]+Number(target.zimLastObj[o].replace(/\s/g,""));}
setValue(target,o,target.zimLastObj[o]);});if(callType!="none"&&call)call(params);}else{zim.loop(target.seriesTweens,function(objSeries,i,t){zim.loop(objSeries,function(o){if(typeof objSeries[o]=="string"){objSeries[o]=target[o]+Number(objSeries[o].replace(/\s/g,""));}
setValue(target,o,objSeries[o]);});if(callType=="all"){if(target.seriesCalls[i])target.seriesCalls[i](target.seriesParams[i]);}});if(callType!="none"){var lastCall=target.seriesCalls[target.seriesCalls.length-1];if(lastCall)lastCall(target.seriesParams[target.seriesParams.length-1]);}
target.seriesTweens=null;target.seriesCalls=null;target.seriesParams=null;}
if(target.stage)target.stage.update();return target;};effectCheck=false;zim.loop(obj,function(o,v){if(o=="path")target.zimTweenOriginals[o]=obj[o];else target.zimTweenOriginals[o]=getValue(target,o);if(o.match("hue")){obj["hueBatch"]=v;delete obj.hue;effectCheck=true;}
else if(o.match("saturation")){obj["saturationBatch"]=v;delete obj.saturation;effectCheck=true;}
else if(o.match("brightness")){obj["brightnessBatch"]=v;delete obj.brightness;effectCheck=true;}
else if(o.match("contrast")){obj["contrastBatch"]=v;delete obj.contrast;effectCheck=true;}
else if(o.match(/^.effects/)){effectCheck=true;}});target.resetTween=function(paused){if(zot(paused))paused=true;target.pauseAnimate();var origins=target.zimSeriesOriginals?target.zimSeriesOriginals:target.zimTweenOriginals;zim.loop(origins,function(o){if(o=="path"){target.percentComplete=0;target.zimPath=origins[o];var startPoint;if(target.zimStartPercent)startPoint=target.zimPath.getCurvePoint(target.zimStartPercent/100);else startPoint=target.zimPath.getCurvePoint(target.zimStartPercent/100);target.loc(startPoint.x,startPoint.y);}
else setValue(target,o,origins[o]);});target.zimLastObj=null;if(target.stage)target.stage.update();target.stopAnimate();if(target.zimPath)startParams[1].path=target.zimPath;if(!zot(target.zimStartRotation))target.rotation=target.zimStartRotation;target.zimStartRotation=null;if(!zot(target.zimStartScaleX))target.scaleX=target.zimStartScaleX;target.zimStartScaleX=null;if(!zot(target.zimStartScaleY))target.scaleY=target.zimStartScaleY;target.zimStartScaleY=null;zim.animate.apply(null,target.zimSeriesArgs?target.zimSeriesArgs:startParams);target.pauseAnimate(paused);return target;};target.replayTween=function(){target.resetTween(false);return target;};if(obj.path||dynamic){var startPercentComplete;if(target.requestedPercentComplete)startPercentComplete=target.requestedPercentComplete;else if(target.percentComplete&&!isGetter(target,"percentComplete"))startPercentComplete=target.percentComplete;target.requestedPercentComplete=null;if(zot(startPercentComplete))startPercentComplete=0;target.pathRatio=0;target.zimStartRotation=target.rotation;}
if(css)ticker=false;if(zot(target.zimTweens))target.zimTweens={};var stage;if(!css){if(!target.stage){if(zdf)stage=zdf.stage;else css=true;}else{stage=target.stage;}}
if(target.setColorRange&&!zot(obj.color)){var color=obj.color;delete obj.color;obj.colorRange=1;target.setColorRange(target.color,color);target.colorRange=0;}
var savedPicks={};for(var i in obj){if(extraTypes.indexOf(i)>=0)continue;savedPicks[i]=zim.copy(obj[i]);obj[i]=zim.Pick.choose(obj[i]);}
if(!zot(obj.scale)){obj.scaleX=obj.scaleY=zim.Pick.choose(obj.scale);delete obj.scale;}
for(var o in obj){if(!target.zimBusy)break;if(target.zimBusy[o])delete obj[o];}
if(zim.isEmpty(obj))return;if(target.type!="Sprite")target.paused=false;function addZimBusy(){if(!target.zimMouseEnabledCheck){target.zimMouseEnabledCheck=true;target.zimLastMouseEnabled=target.mouseEnabled;}
target.mouseEnabled=false;setTimeout(function(){if(!target.zimBusy)target.zimBusy={};for(var o in obj){target.zimBusy[o]=true;}
target.zimMouseEnabledCheck=null;target.mouseEnabled=target.zimLastMouseEnabled;},70);}
if(protect||cjsProps.loop||cjsProps.rewind)addZimBusy();prepareIds();function prepareIds(){if(zot(id)){id=zim.makeID(10);}else{id=String(id);providedID=id;}
if(zot(target.zimIdSets))target.zimIdSets={};if(!zot(target.zimIdSets[id])){idSet=id;id=zim.makeID(10);target.zimIdSets[idSet].push(id);}else if(!zot(target.zimTweens[id])){idSet=id;id=zim.makeID(10);target.zimIdSets[idSet]=[idSet];target.zimTweens[idSet].zimIdSet=idSet;target.zimIdSets[idSet].push(id);}}
extraTypes.shift();for(i in set)set[i]=zim.Pick.choose(set[i]);for(i in cjsProps){if(i=="waitedCall"||i=="waitedParams"||i=="loopCall"||i=="rewindCall"||i=="loopWaitCall"||i=="rewindWaitCall")continue;cjsProps[i]=zim.Pick.choose(cjsProps[i]);}
prepareRelative();function prepareRelative(){relativeAdjust();relativeSetAdjust();if(target.seriesTweens)target.seriesTweens[0]=obj;if(from&&!fromCheck)obj=getFroms(target,obj,set,true);}
function prepareRelative2(){relativeAdjust();if(from&&!fromCheck)obj=getFroms(target,obj,set,true);}
function relativeAdjust(){var newStart;if(!target.zimLastObj)target.zimLastObj={};for(i in obj){if(typeof obj[i]=="string"){if(obj[i].substr(0,1)=="+")continue;if(target.zimLastObj&&!zot(target.zimLastObj[i]))newStart=target.zimLastObj[i];else newStart=target[i];obj[i]=newStart+Number(obj[i].replace(/\s/g,""));}
target.zimLastObj[i]=rewind?target.zimTweenOriginals[i]:obj[i];}}
function relativeSetAdjust(){var newStart;for(i in set){if(typeof set[i]=="string"){if(set[i].substr(0,1)=="+")continue;if(target.zimLastObj&&!zot(target.zimLastObj[i]))newStart=target.zimLastObj[i];else newStart=target[i];set[i]=newStart+Number(set[i].replace(/\s/g,""));}
target.zimLastObj[i]=rewind?target.zimTweenOriginals[i]:obj[i];}}
if(target.getBounds&&zot(target.percentCompleteCheck)){target.percentCompleteCheck=true;Object.defineProperty(target,'percentComplete',{get:function(){if(this.zimTween){return this.zimTween.duration?this.zimTween.position/this.zimTween.duration*100:0;}else{return 0;}},set:function(value){if(this.zimTween){immediateCheck=true;setPercent(value,true);}else{this.requestedPercentComplete=value;}}});Object.defineProperty(target,'percentCompleteNoAngle',{get:function(){if(this.zimTween){return this.zimTween.duration?this.zimTween.position/this.zimTween.duration*100:0;}else{return 0;}},set:function(value){if(this.zimTween){setPercent(value,false);}else{this.requestedPercentComplete=value;}}});}
Object.defineProperty(target,'rate',{get:function(){return target.futureRate;},set:function(value){target.futureRate=value;zim.loop(target.zimTweens,function(id,tw){tw.timeScale=value;});},configurable:true});function setPercent(value,setAngle){target.zimTween.startPaused=false;if(!dynamic){target.zimTween.setPosition(Math.round(value*target.zimTween.duration/100));}else{if(!zot(target.zimTween.currentTime)){target.zimTween.currentTime=target.zimTween.currentTime-target.zimTween.position+value*target.zimTween.duration/100;}}
if(setAngle&&pathObject&&obj.orient!==false&&pathObject.getCurvePoint){target.rotation=pathObject.getCurvePoint(value/100,null,null,true).angle+(startAngle?startAngle:0);}
if(immediateCheck&&typeof pathPercent!="undefined")pathPercent=value;if(target.handlePath)target.handlePath();}
var pathObject;if(!zot(obj.path)&&obj.path.segmentPoints){if(zot(obj.orient))obj.orient=true;if(obj.orient&&zot(obj.flip))obj.flip=true;if(target.type=="Pen")target.infinite=true;target.zimOnPath=true;if(zot(target.pathRatio))target.pathRatio=0;if(obj.orient){obj.orient=obj.path;obj.startOrient=obj.rotation;}
pathObject=obj.path;if(drag){delete obj.path;delete obj.percent;if(zon&&(target.startPercent>0||target.percent!=100))zog("ZIM.animate() - startPercent and percent currently not supported with drag on path");var newPoint=pathObject.getCurvePoint(target.pathRatio,percents,segments);if(newPoint){latestSegmentIndex=newPoint.z;var locPoint=target.parent.globalToLocal(newPoint.x,newPoint.y);target.x=locPoint.x;target.y=locPoint.y;}}else{if(zot(target.startPercent)){target.startPercent=zim.Pick.choose(!zot(obj.startPercent)?obj.startPercent:0);}
if(zot(target.percent)){target.percent=zim.Pick.choose(!zot(obj.percent)?obj.percent:100);}
delete obj.path;delete obj.percent;}
var dynamicPath=!pathObject.lockControls;delete obj.path;obj.pathRatio=1;}
function getFroms(target,obj,set,update){fromCheck=true;if(pathObject&&(!zot(target.percentComplete)||(set&&!zot(set.percentComplete)))){if(!set)set={};if(zot(set.pathRatio))set.pathRatio=!zot(set.percentComplete)?set.percentComplete/100:target.percentComplete/100;}
var newObj={};for(i in obj){if(set&&!zot(set[i])){newObj[i]=set[i];}else{newObj[i]=target[i];}
if(update)target[i]=obj[i];}
return newObj;}
var lastPercentComplete=target.percentComplete;var flipCheck=true;var mouseCheck=false;var activeCheck=true;var latestSegmentIndex=0;var redirect=true;if(!zot(obj.redirect)){redirect=obj.redirect;delete obj.redirect;}
if(pathObject){var segments;var percents;if(!dynamicPath){segments=zim.copy(pathObject.segmentPoints);percents=zim.copy(pathObject.segmentRatios);}
target.currentPercent=target.startPercent+target.percent*target.pathRatio;var newPointRatio=((1000000+target.currentPercent)%100)/100;var newPoint=pathObject.getCurvePoint(newPointRatio,percents,segments);if(target.parent&&newPoint){var locPoint=target.parent.globalToLocal(newPoint.x,newPoint.y);target.x=locPoint.x;target.y=locPoint.y;}
if(drag){ease="linear";target.cursor="pointer";var pathPercent=target.percentComplete;var pathDownCheck=false;var lastPause=startPaused?startPaused:target.paused;var lastForward=true;var currentForward=true;var lastPathPercent=pathPercent;var stage;var pixels=10;var segments=zim.copy(pathObject.segmentPoints);var length=0;zim.loop(segments,function(point){length+=zim.distanceAlongCurve(point);});var numPoints=Math.round(length/segments.length/pixels);var testPoints=pathObject.interpolate(numPoints,null,true,null,true);var currentDist=(pathPercent?pathPercent:0)/100*length;var targetDist=currentDist;var dirTest=0;pathObject.zimAnimateChanged=false;var segmentRatios=zim.copy(pathObject.segmentRatios);target.zimAnimatePathChange=pathObject.on("change",function(){pathObject.zimAnimateChanged=true;});target.zimAnimatePathDown=pathObject.on("mousedown",function(){pathDownCheck=true;if(target.paused==true)mouseCheck=true;});target.zimAnimatePathUp=pathObject.on("pressup",function(){mouseCheck=false;});target.zimAnimateDragDown=target.on("mousedown",function(e){stage=e.target.stage;if(!target.amu)target.amu=stage.frame.on("mouseupplus",function(){mouseCheck=false;});stage.mouseMoveOutside=true;flipCheck=false;activeCheck=true;setTimeout(function(){flipCheck=true;},50);mouseCheck=true;if(pathObject.zimAnimateChanged){segments=zim.copy(pathObject.segmentPoints);length=0;zim.loop(segments,function(point){length+=zim.distanceAlongCurve(point);});numPoints=Math.round(length/segments.length/pixels);testPoints=pathObject.interpolate(numPoints,null,true,null,true);segmentRatios=zim.copy(pathObject.segmentRatios);}
pathObject.zimAnimateChanged=false;pathPercent=target.percentComplete;dampPercent.immediate(pathPercent);var calcPercent=dirTest=pathPercent;if(rewind){if(tween.position>tween.duration/2)calcPercent=(100-pathPercent)*2;else calcPercent=pathPercent*2;}
currentDist=(calcPercent?calcPercent:0)/100*length;targetDist=currentDist;});var movingCheck=false;target.zimAnimateDragPress=target.on("pressmove",function(e){movingCheck=true;getPathPercent(e);});function getPathPercent(e){var point=pathObject.globalToLocal(e.rawX/zim.scaX,e.rawY/zim.scaY);var mousePlace=currentDist;if(pathObject.type=="Blob"){if(dirSamples[0]<dirSamples[4])currentForward=true;else if(dirSamples[0]>dirSamples[4])currentForward=false;if(mousePlace<10&&!currentForward){targetDist=currentDist=mousePlace=length-5;dampPercent.immediate(targetDist/length*100);dirSamples=[length-1,length-2,length,length-3,length-4];}else if(mousePlace>length-10&&currentForward){targetDist=currentDist=mousePlace=5;dampPercent.immediate(targetDist/length*100);dirSamples=[0,0,0,0,0];}}
var dPoint={x:point.x,y:point.y,r:mousePlace};testPoints.sort(function(a,b){var aPoint={x:a.x,y:a.y,r:a.r*length};var bPoint={x:b.x,y:b.y,r:b.r*length};var aDiff=Math.sqrt(Math.pow(dPoint.x-aPoint.x,2)+Math.pow(dPoint.y-aPoint.y,2)+Math.pow(dPoint.r-aPoint.r,2));var bDiff=Math.sqrt(Math.pow(dPoint.x-bPoint.x,2)+Math.pow(dPoint.y-bPoint.y,2)+Math.pow(dPoint.r-bPoint.r,2));return aDiff-bDiff;});targetDist=testPoints[0].r*length;pathPercent=targetDist/length*100;pathPercent=zim.constrain(pathPercent,0,99.95);if(rewind){pathPercent/=2;if(tween.position>tween.duration/2)pathPercent=100-pathPercent;}}
target.animateReturn=function(){if(!rewind){if(zon)zogy("animate() - animateReturn() needs rewind set to true");return;}
lastForward=false;currentForward=false;if(target.percentComplete<50)target.percentComplete=100-target.percentComplete;target.pauseAnimate(false);};target.zimAnimateDragUp=target.on("pressup",function(){if(target.paused==false)mouseCheck=false;flipCheck=false;setTimeout(function(){flipCheck=true;},50);if(dirSamples[0]<dirSamples[4])currentForward=true;else if(dirSamples[0]>dirSamples[4])currentForward=false;if(!target.paused&&rewind&&redirect&&currentForward!=lastForward){target.percentComplete=100-target.percentComplete;lastForward=currentForward;}});var dampPercent=new zim.Damp(pathPercent,.15);var lastPercent=0;var dirCount=0;var dirSamples=[0,0,0,0,0];var immediateCheck=false;target.zimDragAnimateTicker=zim.Ticker.add(function(){if(!drag)return;if(++dirCount%20){dirSamples.push(targetDist);dirSamples.shift();}
currentDist=targetDist;if(pathDownCheck)pathPercent=target.percentComplete;if(mouseCheck||(activeCheck&&target.paused==true)){if(pathDownCheck||immediateCheck||(pathObject.type=="Blob"&&Math.abs(lastPercent-pathPercent)>(rewind?45:90))){pathDownCheck=false;var newPercent=pathPercent;dampPercent.immediate(newPercent);immediateCheck=false;}else{var newPercent=dampPercent.convert(pathPercent);}
if(Math.abs(lastPercent-newPercent)>.1){target.percentCompleteNoAngle=newPercent;lastPercent=newPercent;}else{target.percentCompleteNoAngle=newPercent;activeCheck=false;movingCheck=false;}}else{activeCheck=false;}},stage);}}
var pathOrient;if(obj.orient){if(obj.orient===true){var oPoint=target.parent.localToGlobal(!zot(obj.x)?obj.x:target.x,!zot(obj.y)?obj.y:target.y);obj.orient={x:oPoint.x,y:oPoint.y};}
pathOrient=obj.orient;delete obj.orient;var startAngle=target.rotation;target.rotation=pathObject.getPointAngle(0)+startAngle;if(pathOrient!=pathObject){var orientPoint;if(pathOrient.parent){orientPoint=pathOrient.parent.localToLocal(pathOrient.x,pathOrient.y,target.parent);}else{orientPoint=target.parent.globalToLocal(pathOrient.x,pathOrient.y);}
target.rotation=zim.angle(target.x,target.y,orientPoint.x,orientPoint.y)+startAngle;}}
var pathFlip;var startFlip;if(obj.flip){pathFlip=obj.flip;delete obj.flip;startFlip=target.scaleX;}
var pathFlipVertical;var startFlipVertical;if(obj.flipVertical){pathFlipVertical=obj.flipVertical;delete obj.flipVertical;startFlipVertical=target.scaleY;}
var lastX=target.x;var lastY=target.y;var count=0;if(cjsProps.loop){if(!zot(cjsProps.count)){count=cjsProps.count;delete cjsProps.count;var currentCount=1;}}
var wait3=0;if(cjsProps.loopWait){wait3=cjsProps.loopWait;loopWait=cjsProps.loopWait;delete cjsProps.loopWait;}
var call3;if(cjsProps.loopCall){call3=cjsProps.loopCall;delete cjsProps.loopCall;}
var params3=target;if(cjsProps.loopParams){params3=cjsProps.loopParams;delete cjsProps.loopParams;}
if(TIMECHECK&&timeCheck){if(t)checkTIME(t,timeType);if(t2)checkTIME(t2,timeType);if(wait)checkTIME(wait,timeType);if(wait2)checkTIME(wait2,timeType);if(wait3)checkTIME(wait3,timeType);if(loopWait)checkTIME(loopWait,timeType);if(cjsProps.rewindWait)checkTIME(cjsProps.rewindWait,timeType);if(seriesWait)checkTIME(seriesWait,timeType);if(sequenceWait)checkTIME(sequenceWait,timeType);}
if(timeType=="s"){if(t)t*=1000;if(t2)t2*=1000;if(wait)wait*=1000;if(wait2)wait2*=1000;if(wait3)wait3*=1000;if(loopWait)loopWait*=1000;if(cjsProps.rewindWait)cjsProps.rewindWait*=1000;if(seriesWait)seriesWait*=1000;if(sequenceWait)sequenceWait*=1000;}
function doLoopCall(){if(!cjsProps.loop)return;if(sequenceCall&&typeof sequenceCall=='function'){var sp=zot(sequenceParams)?target:sequenceParams;(sequenceCall)(sp);}
if(call3&&typeof call3=='function'){(call3)(params3);}
if(loopPick){var r=zim.Pick.choose(target.futureRate);if(!zot(target.futureRate))tween.timeScale=r;var adjustedScale;if(!zot(savedPicks.scale)){adjustedScale=zim.Pick.choose(savedPicks.scale);}
if(!from){if(tween.step&&tween.step.prev&&tween.step.prev.props){for(var i in tween.step.prev.props){if(extraTypes.indexOf(i)>=0)continue;var p=zim.Pick.choose(savedPicks[i]);if(typeof p=="string"){if(p.substr(0,1)!="+"){var newStart;if(target.zimLastObj&&!zot(target.zimLastObj[i]))newStart=target.zimLastObj[i];else newStart=target[i];p=newStart+Number(p.replace(/\s/g,""));}}
target.zimLastObj[i]=rewind?target.zimTweenOriginals[i]:p;if(!zot(savedPicks[i]))tween.step.prev.props[i]=p;if(i=="scaleX"&&!zot(adjustedScale))tween.step.prev.props.scaleX=adjustedScale;if(i=="scaleY"&&!zot(adjustedScale))tween.step.prev.props.scaleY=adjustedScale;}}}else{}}}
var call4;if(cjsProps.loopWaitCall){call4=cjsProps.loopWaitCall;delete cjsProps.loopWaitCall;}
var params4=target;if(cjsProps.loopWaitParams){params4=cjsProps.loopWaitParams;delete cjsProps.loopWaitParams;}
function doLoopWaitCall(){if(call4&&typeof call4=='function'){(call4)(params4);}}
var customEases=["ballisticIn","ballisticOut","ballisticInOut","snapIn","snapOut","snapInOut","slowmoIn","slowmoOut","slowmoInOut",];if(customEases.indexOf(ease)!=-1){var ba=[0.4,0.75,0.9,.95];var sn=[0.99,-0.69,0.53,0.014];var sm=[1.18,0.69,1,0.96];if(ease=="ballisticIn")ease=zik(zim.zimEase(ba));else if(ease=="ballisticOut")ease=zik(zim.zimEase(ba).reverse());else if(ease=="ballisticInOut")ease=zik(zim.zimEase(ba,null,true));else if(ease=="snapIn")ease=zik(zim.zimEase(sn));else if(ease=="snapOut")ease=zik(zim.zimEase(sn).reverse());else if(ease=="snapInOut")ease=zik(zim.zimEase(sn,null,true));else if(ease=="slowmoIn")ease=zik(zim.zimEase(sm));else if(ease=="slowmoOut")ease=zik(zim.zimEase(sm).reverse());else if(ease=="slowmoInOut")ease=zik(zim.zimEase(sm,null,true));}
if(cjsProps.rewind){if(ease){if(ease instanceof Function){var ease2=zik(ease.reverse());}else{var ease2=ease;if(ease2.indexOf("InOut")==-1){if(ease2.indexOf("Out")!=-1){ease2=ease2.replace("Out","In");}else if(ease2.indexOf("In")!=-1){ease2=ease2.replace("In","Out");}}}}
if(rewindEase){var ease2=rewindEase;}}
if(ease instanceof Function){var finalEase=ease;}else{var equation="get"+ease.charAt(0).toUpperCase()+ease.slice(1);var ea=zik(easeAmount);var ef=zik(easeFrequency);if((!zot(ea)||!zot(ef))&&createjs.Ease[equation]){if(!zot(ef)&&zot(ea))ea=1;if(!zot(ea)&&zot(ef))ef=.3*1.5;var finalEase=createjs.Ease[equation](ea,ef);}else{var finalEase=createjs.Ease[ease];}}
if(ease2){if(ease2 instanceof Function){var finalEase2=ease2;}else{equation="get"+ease2.charAt(0).toUpperCase()+ease2.slice(1);ea=zik(easeAmount);ef=zik(easeFrequency);if((!zot(ea)||!zot(ef))&&createjs.Ease[equation]){if(!zot(ef)&&zot(ea))ea=1;if(!zot(ea)&&zot(ef))ef=.3*1.5;var finalEase2=createjs.Ease[equation](ea,ef);}else{var finalEase2=createjs.Ease[ease2];}}}
if(cjsProps.rewind){var wait2=0;delete cjsProps.rewind;rewind=true;rewindWait=cjsProps.rewindWait;if(cjsProps.rewindWait){wait2=cjsProps.rewindWait;delete cjsProps.rewindWait;}
var call2;if(cjsProps.rewindCall){call2=cjsProps.rewindCall;var params2=cjsProps.rewindParams;if(zot(params2))params2=target;delete cjsProps.rewindCall;delete cjsProps.rewindParams;}
function doRewindCall(){if(call2&&typeof call2=='function'){(call2)(params2);}}
var call5;if(cjsProps.rewindWaitCall){call5=cjsProps.rewindWaitCall;var params5=cjsProps.rewindWaitParams;if(zot(params5))params5=target;delete cjsProps.rewindWaitCall;delete cjsProps.rewindWaitParams;}
function doRewindWaitCall(){if(call5&&typeof call5=='function'){(call5)(params5);}}
if(seriesWait>0||sequenceWait>0||wait>0){if(seriesWait>0||sequenceWait>0){tween=target.zimTweens[id]=target.zimTween=createjs.Tween.get(target,{override:cjsProps.override}).wait(seriesWait>0?seriesWait:0,true).wait(sequenceWait>0?sequenceWait:0,true).call(function(){sequenceWait=seriesWait=0;preTween1(tween);});tween.timeScale=target.futureRate;}else{preTween1();}}else{prepareRelative2();tween1();}
function preTween1(lastTween){prepareRelative2();tween=target.zimTweens[id]=target.zimTween=createjs.Tween.get(target,{override:cjsProps.override}).wait(wait,true).call(function(){if(waitedCall&&typeof waitedCall=='function'){(waitedCall)(zot(waitedParams)?target:waitedParams);}
wait=0;tween1(tween);});tween.timeScale=target.futureRate;if(lastTween)transferIds(lastTween,tween);}
function tween1(lastTween){var obj2=getStart();if(target.set&&!from)target.set(set);tween=target.zimTweens[id]=target.zimTween=createjs.Tween.get(target,cjsProps).to(obj,t,finalEase).call(doRewindWaitCall).wait(wait2,true).call(doRewindCall).to(obj2,t2,finalEase2).call(doneAnimating).wait(wait3,true).call(doLoopCall);tween.timeScale=target.futureRate;if(lastTween)transferIds(lastTween,tween);setZimTweenProps();}}else{if(seriesWait>0||sequenceWait>0||wait>0){if(seriesWait>0||sequenceWait>0){tween=target.zimTweens[id]=target.zimTween=createjs.Tween.get(target,{override:cjsProps.override}).wait(seriesWait>0?seriesWait:0,true).wait(sequenceWait>0?sequenceWait:0,true).call(function(){sequenceWait=seriesWait=0;preTween2(tween);});tween.timeScale=target.futureRate;}else{preTween2();}}else{prepareRelative2();tween2();}
function preTween2(lastTween){prepareRelative2();tween=target.zimTweens[id]=target.zimTween=createjs.Tween.get(target,{override:cjsProps.override}).wait(wait,true).call(function(){wait=0;if(waitedCall&&typeof waitedCall=='function'){(waitedCall)(zot(waitedParams)?target:waitedParams);}
tween2(tween);});tween.timeScale=target.futureRate;if(lastTween)transferIds(lastTween,tween);}
function tween2(lastTween){if(target.set&&!from){target.set(set);}
tween=target.zimTweens[id]=target.zimTween=createjs.Tween.get(target,cjsProps).to(obj,t,finalEase).call(doneAnimating).wait(wait3,true).call(doLoopCall);tween.timeScale=target.futureRate;if(lastTween)transferIds(lastTween,tween);setZimTweenProps();}}
function transferIds(lastTween,tween){tween.zimIdSet=lastTween.zimIdSet;tween.zimObj=lastTween.zimObj;tween.zimTicker=lastTween.zimTicker;tween.zimExtraTickers=lastTween.zimExtraTickers;tween.requestID=lastTween.requestID;}
tween.startPaused=startPaused;tween.rewinding=false;if(!zot(rate))tween.timeScale=zim.Pick.choose(rate);var zimTicker;if(!css&&ticker){if(startPercentComplete){target.pathRatio=(target.percentComplete&&Math.round(target.percentComplete)!=100)?target.percentComplete/100:0;target.percentCompleteNoAngle=Math.round(startPercentComplete)!=100?startPercentComplete:0;}
if(events&&!zot(sequenceTarget)&&sequenceTarget.dispatchEvent){zimTicker=zim.Ticker.add(function(){if(effectCheck)target.updateEffects();if(pathObject||pathOrient||pathFlip||pathFlipVertical){handlePath();}
sequenceTarget.dispatchEvent("animation");},stage);}else if(events&&target.dispatchEvent){zimTicker=zim.Ticker.add(function(){if(effectCheck)target.updateEffects();if(pathObject||pathOrient||pathFlip||pathFlipVertical){handlePath();}
target.dispatchEvent("animation");},stage);}else{zimTicker=zim.Ticker.add(function(){if(effectCheck)target.updateEffects();if(pathObject||pathOrient||pathFlip||pathFlipVertical){handlePath();}},stage);}}
function totalArr(arr){if(!Array.isArray(arr))return;var totalNumber=0;for(var i=0,l=arr.length;i<l;i++){totalNumber+=arr[i];}
return totalNumber;}
var forwardStack=[1,1,1];var handlePath=function(){if(!target.parent||tween.passive||tween.startPaused)return;if(drag&&rewind&&((lastPathPercent<50&&target.percentComplete>50)||(lastPathPercent>50&&target.percentComplete<50))){lastForward=target.percentComplete<50;}
lastPathPercent=target.percentComplete;if(pathObject){if(dynamicPath){segments=pathObject.segmentPoints;percents=pathObject.segmentRatios;}
if(drag){var newPoint=pathObject.getCurvePoint(target.pathRatio,percents,segments);}else{target.currentPercent=target.startPercent+target.percent*target.pathRatio;var newPointRatio=((1000000+target.currentPercent)%100)/100;if(target.pathRatio==1)newPointRatio+=target.percent>0?1:0;var newPoint=pathObject.getCurvePoint(newPointRatio,percents,segments);}
if(newPoint){latestSegmentIndex=newPoint.z;var locPoint=target.parent.globalToLocal(newPoint.x,newPoint.y);target.x=locPoint.x;target.y=locPoint.y;}}
var opposite=(startAngle==90||startAngle==270||startAngle==-90);if(pathFlip&&flipCheck){if(lastX>target.x&&zim.sign(opposite?target.scaleY:target.scaleX)==zim.sign(startFlip))opposite?target.scaleY*=-1:target.scaleX*=-1;if(lastX<target.x&&zim.sign(opposite?target.scaleY:target.scaleX)!=zim.sign(startFlip))opposite?target.scaleY*=-1:target.scaleX*=-1;}
if(pathFlipVertical&&flipCheck){if(lastY>target.y&&zim.sign(opposite?target.scaleX:target.scaleY)==zim.sign(startFlipVertical))opposite?target.scaleX*=-1:target.scaleY*=-1;if(lastY<target.y&&zim.sign(opposite?target.scaleX:target.scaleY)!=zim.sign(startFlipVertical))opposite?target.scaleX*=-1:target.scaleY*=-1;}
var aa;if(pathOrient){if(pathObject==pathOrient){aa=zim.angle(lastX,lastY,target.x,target.y)+startAngle;}else{var orientPoint;if(pathOrient.parent){orientPoint=pathOrient.parent.localToLocal(pathOrient.x,pathOrient.y,target.parent);}else{orientPoint=target.parent.globalToLocal(pathOrient.x,pathOrient.y);}
aa=zim.angle(target.x,target.y,orientPoint.x,orientPoint.y)+startAngle;}
if(aa!=0){if(!target.paused||movingCheck){if(pathFlip&&lastX-target.x>0)aa+=180;var aaa=aa;if(!pathFlip&&lastX-target.x>0)aaa=aa-180;target.rotation=aaa==startAngle?target.rotation:aaa;}}}
if(drag){var diff=target.x-lastX+target.y-lastY;if(Math.abs(diff)>2){forwardStack.push(zim.sign(diff));forwardStack.shift();tween.forward=totalArr(forwardStack);}}
lastX=target.x;lastY=target.y;};if(pathObject)target.handlePath=handlePath;if(!zot(target.zimMaskDynamic))target.zimMaskApply();function doneAnimating(){if(target.seriesTweens)target.seriesTweens.shift();if(target.seriesCalls)target.seriesCalls.shift();if(target.seriesParams)target.seriesParams.shift();if(target.paused&&target.type!="Sprite"){if(call&&typeof call=='function'){(call)(params);}
return;}
if(cjsProps.loop){if(count>0){if(currentCount<count){doLoopWaitCall();currentCount++;return;}else{if(rewind){if(target.set)target.set(getStart());}else{if(target.set)target.set(obj);}}}else{doLoopWaitCall();return;}}
if(clean)endTween(id);else target.pauseAnimate(true,id);if(!cjsProps.loop&&sequenceCall&&typeof sequenceCall=='function'){var sp=zot(sequenceParams)?target:sequenceParams;(sequenceCall)(sp);}
if(call&&typeof call=='function'){(call)(params);}}
function getStart(){var startObj={};for(var i in obj){if(css&&target.style){if(!zot(set[i])&&!from){startObj[i]=set[i];}else{startObj[i]=target.style[i];}}else{if(!zot(set[i])&&!from){startObj[i]=set[i];}else{if(i.substr(0,1)=="."){var dots=i.split(".");var lastdot=target;for(var j=1;j<dots.length;j++){lastdot=lastdot[dots[j]];}
startObj[i]=lastdot;}else{startObj[i]=target[i];}}}}
return startObj;}
function removeBusy(obj){if(!target.zimBusy)return;for(var o in obj){delete target.zimBusy[o];}
if(zim.isEmpty(target.zimBusy))target.zimBusy=null;}
var zimPaused=false;setZimTweenProps();function setZimTweenProps(){tween.zimObj=obj;tween.zimTicker=zimTicker;tween.zimPaused=zimPaused;if(idSet)tween.zimIdSet=idSet;if(providedID){if(zot(zim.idSets))zim.idSets={};if(zot(zim.idSets[providedID])){zim.idSets[providedID]=[target];}else{if(zim.idSets[providedID].indexOf(target)<0)zim.idSets[providedID].push(target);}}
if(!zim.animatedObjects)zim.animatedObjects=new zim.Dictionary(true);zim.animatedObjects.add(target,true);}
function endTween(id){if(target.tweenStates&&target.tweenStates[id])delete target.tweenStates[id];if(zot(target.zimTweens)||zot(target.zimTweens[id]))return;target.zimX=null;target.zimY=null;removeBusy(target.zimTweens[id].zimObj);target.zimTweens[id].paused=true;endTicker(id);var idSet=target.zimTweens[id].zimIdSet;if(!zot(idSet)&&target.zimIdSets){var sets=target.zimIdSets[idSet];if(sets)sets.splice(sets.indexOf(id),1);if(sets&&sets.length==0){delete target.zimIdSets[idSet];if(zim.isEmpty(target.zimIdSets))delete target.zimIdSets;}}
if(target.type=="Pen"&&target.zimOnPath){target.stop();target.zimOnPath=false;}
delete target.zimTweens[id];if(zim.isEmpty(target.zimTweens)){target.stopAnimate(null,null,null,false,true);}
if((target.zimTweens&&target.zimTweens[id])||(target.zimIdSets&&target.zimIdSets[idSet?idSet:id])){}else{if(zim.idSets&&zim.idSets[idSet?idSet:id]){zim.idSets[idSet?idSet:id];var targetIndex=zim.idSets[idSet?idSet:id].indexOf(target);if(targetIndex>=0)zim.idSets[idSet?idSet:id].splice(targetIndex,1);if(zim.idSets[idSet?idSet:id].length<=0){delete zim.idSets[idSet?idSet:id];if(zim.isEmpty(zim.idSets))delete zim.idSets;}}}}
function endTicker(id){-function(){var ticker=target.zimTweens[id].zimTicker;if(target.zimTweens[id].extraTickers){for(var k=0;k<target.zimTweens[id].extraTickers.length;k++){zim.Ticker.remove(target.zimTweens[id].extraTickers[k]);}}
if(target.zimTweens[id].requestID)cancelAnimationFrame(target.zimTweens[id].requestID);if(ticker){setTimeout(function(){if(ticker)zim.Ticker.remove(ticker);ticker=null;},200);}}();}
function pauseTicker(id,paused){var tween=target.zimTweens[id];tween.paused=paused;if(paused==tween.zimPaused)return;tween.zimPaused=paused;if(paused){if(tween.zimTicker)tween.zimAnimateTimeout=setTimeout(function(){zim.Ticker.remove(tween.zimTicker);},200);}else{tween.startPaused=false;clearTimeout(tween.zimAnimateTimeout);if(tween.zimTicker)tween.zimTicker=zim.Ticker.add(tween.zimTicker,stage);}}
function expandIds(ids){var actualIds=[];for(var i=0;i<ids.length;i++){if(target.zimIdSets&&!zot(target.zimIdSets[ids[i]])){actualIds=actualIds.concat(target.zimIdSets[ids[i]]);}else{actualIds.push(ids[i]);}}
return actualIds;}
if(!target.stopAnimate||!target.stopAnimate.real){target.stopAnimate=function(ids,toEnd,include,command,internal){if(internal&&drag){target.pauseAnimate();return;}
if(zot(ids)){target.tweenStates={};}
if(toEnd){target.endTween(null,ids);return target;}
if(zot(command))command=true;if(target.pan==undefined)target.paused=true;if(target.type=="Pen"&&target.zimOnPath){target.stop();target.zimOnPath=false;}
if(zot(include))include=true;if(command&&drag){if(pathObject)pathObject.off("change",target.zimAnimatePathChange);target.off("mousedown",target.zimAnimateDragDown);target.off("pressmove",target.zimAnimateDragPress);target.off("pressup",target.zimAnimateDragUp);if(target.amu)stage.frame.off("mouseupplus",target.amu);zim.Ticker.remove(target.zimDragAnimateTicker);}
if(zot(ids)){if(!include)return target;target.zimBusy=null;createjs.Tween.removeTweens(target);for(var id in target.zimTweens){endTicker(id);}
target.zimTweens=null;target.zimIdSets=null;target.zimTween=null;if(zim.idSets&&zim.idSets[idSet?idSet:id]){delete zim.idSets[idSet?idSet:id];if(zim.isEmpty(zim.idSets))delete zim.idSets;}
zim.animatedObjects.remove(target);}else{if(!Array.isArray(ids))ids=[ids];var actualIds=expandIds(ids);for(var id in target.zimTweens){if(target.zimTweens[id].requestID){cancelAnimationFrame(target.zimTweens[id].requestID);}
if(include&&actualIds.indexOf(id)>=0){endTween(id,command);}
if(!include&&actualIds.indexOf(id)<0){endTween(id,command);}}}
return target;};target.stopAnimate.real=true;target.pauseAnimate=function(paused,ids,include,ignoreDynamic){if(ids=="pauseOnBlur"){ids=null;}else if(zot(ids)){target.tweenStates={all:paused===false?true:false};}
if(target.type=="Pen"){if(paused===false){if(target.zimOnPath)target.infinite=true;}else{target.stop();}}
if(usingDynamic&&!ignoreDynamic){target.pause(paused,ids);return target;}
if(zot(paused))paused=true;mouseCheck=false;target.paused=paused;if(zot(include))include=true;if(zot(ids)&&!include)return target;if(zot(ids)){for(var id in target.zimTweens){pauseTicker(id,paused);}}else{if(!Array.isArray(ids))ids=[ids];var actualIds=expandIds(ids);for(var id in target.zimTweens){if(include&&actualIds.indexOf(id)>=0){pauseTicker(id,paused);target.tweenStates[id]=!paused;}
if(!include&&actualIds.indexOf(id)<0){pauseTicker(id,paused);target.tweenStates[id]=!paused;}}}
if(target.type=="Sprite"){if(!target.running)target.stop();}
return target;};}
if(startPaused)target.pauseAnimate(true,id,null,true);var extra;if(obj.extra){extra=obj.extra;delete obj.extra;if(!Array.isArray(extra))extra=[extra];}
for(var i=0;i<extraTypes.length;i++){var type=extraTypes[i];if(obj[type]){if(zot(extra))extra=[];makeExtra(type,obj[type]);delete obj[type];}}
function makeExtra(prop,arr){if(arr===true)extra.push({outputProp:extraLookup[prop]});else if(Array.isArray(arr))extra.push({outputProp:extraLookup[prop],outputMin:arr[0],outputMax:arr[1],inputMin:arr[2],inputMax:arr[3]});else extra.push({outputProp:extraLookup[prop],outputMax:arr});}
if(extra){target.zimStartScaleX=target.scaleX;target.zimStartScaleY=target.scaleY;tween.extraTickers=[];var extraObj;var extraProportion;for(var i=0;i<extra.length;i++){var eObj=extra[i];if(zot(eObj.inputObj))eObj.inputObj=target;if(zot(eObj.inputProp))eObj.inputProp="y";if(zot(eObj.inputMin))eObj.inputMin=0;if(zot(eObj.inputMax))eObj.inputMax=eObj.inputProp=="x"?stage.width:stage.height;if(zot(eObj.outputObj))eObj.outputObj=target;if(zot(eObj.outputProp))eObj.outputProp="scale";if(zot(eObj.outputMin))eObj.outputMin=0;if(zot(eObj.outputMax))eObj.outputMax=eObj.outputMin+1;if(zot(eObj.constrain))eObj.constrain=true;for(var j in eObj){obj[j]=zim.Pick.choose(obj[j]);}
if(eObj.outputProp=="percentSpeed")dynamic=true;extraProportion=new zim.Proportion(eObj.inputMin,eObj.inputMax,eObj.outputMin,eObj.outputMax,eObj.factor,eObj.outputRound);var func=function(){var eO=eObj;var eP=extraProportion;var lastNewValue=0;return function(){var newValue;var eTarget=eO.outputObj;var iV=eO.inputObj[eO.inputProp];if(eO.inputProp=="x"||eO.inputProp=="y"){if(eO.inputObj.parent){var ppp=eO.inputObj.parent.localToGlobal(iV,iV);iV=ppp[eO.inputProp];}}
if(eO.constrain)newValue=zim.constrain(eP.convert(iV),eO.outputMin,eO.outputMax);else newValue=eP.convert(iV);if(Number.isNaN(newValue))newValue=eO.outputMin!=null?eO.outputMin:0;if(eO.outputProp=="scale"){eTarget.scaleX=zim.sign(eTarget.scaleX)*newValue;eTarget.scaleY=zim.sign(eTarget.scaleY)*newValue;}else if(eO.outputProp=="scaleX"){eTarget.scaleX=zim.sign(eTarget.scaleX)*newValue;}else if(eO.outputProp=="scaleY"){eTarget.scaleY=zim.sign(eTarget.scaleY)*newValue;}else if(eO.outputProp=="layer"){if(!eTarget.parent)return;var newLayer=zim.constrain(Math.round(newValue),0,eTarget.parent.numChildren-1);if(newLayer!=eTarget.parent.getChildIndex(eTarget))eTarget.parent.setChildIndex(eTarget,newLayer);}else if(eO.outputProp=="percentSpeed"){eTarget[eO.outputProp]=newValue*100;}else{eTarget[eO.outputProp]=newValue;}};}();func();tween.extraTickers.push(zim.Ticker.add(func,stage));}}
var usingDynamic;var requestID;if(dynamic||target.zimAnimateDragDown){var dynamicObj={};if(dynamic){usingDynamic=true;target.pauseAnimate(true,id,null,true);target.paused=false;tween.currentTime=0;var myTween=tween;if(zot(target.percentSpeed))target.percentSpeed=tween.startPaused?0:100;var baseSpeed=1000/60;tween.currentTime=0;var setToMiddle=(!sequenceWait&&!seriesWait&&!wait&&!count&&cjsProps.loop);if(clamp&&cjsProps.loop&&!count)clamp=false;var calculatedDuration=time+(rewind?(rewindTime?rewindTime:time):0)+(rewindWait?rewindWait:0)+(loopWait?loopWait:0);calculatedDuration*=timeType=="s"?1000:1;var clampMultiplier=1;if(cjsProps.loop&&count)clampMultiplier=count;var clampEnd;if(clamp)clampEnd=calculatedDuration*clampMultiplier;function advanceTween(){tween.requestID=requestID=requestAnimationFrame(advanceTween);if(!dynamic||(tween.startPaused&&target.percentSpeed==0))return;tween.startPaused=false;if(tween!=myTween){myTween=tween;tween.currentTime=0;target.pauseAnimate(true,id,null,true);target.paused=false;setToMiddle=(!sequenceWait&&!seriesWait&&!wait&&!count&&cjsProps.loop);}
if(setToMiddle){tween.currentTime+=10000*calculatedDuration;tween.setPosition(tween.currentTime,true);setToMiddle=false;}
var newTime=tween.currentTime+baseSpeed*target.percentSpeed/100;if(clampEnd&&wait==0)newTime=zim.constrain(newTime,0,clampEnd);tween.currentTime=newTime;tween.setPosition(tween.currentTime);if(pathObject||pathOrient||pathFlip||pathFlipVertical){handlePath();}
stage.update();}
advanceTween();}
var lastSpeed;var pausing=false;target.pause=function(state,time){if(zot(state))state=true;if(zot(time))time=0;if(state){if(target.zimAnimateDragDown){drag=false;target.cursor="default";if(pathObject)pathObject.off("change",target.zimAnimatePathChange);target.off("mousedown",target.zimAnimateDragDown);target.off("pressmove",target.zimAnimateDragPress);target.off("pressup",target.zimAnimateDragUp);if(!dynamic)return;}
lastSpeed=target.percentSpeed;if(time>0){pausing=true;zim.animate({target:target,props:{percentSpeed:0},override:false,ticker:false,time:time,call:function(){pausing=false;target.percentSpeed=0;target.paused=true;dynamic=false;target.dispatchEvent("pause");}});}else{tween.startPaused=false;pausing=false;target.percentSpeed=0;target.paused=true;dynamic=false;setTimeout(function(){target.dispatchEvent("pause");},10);}}else{if(target.zimAnimateDragDown){drag=true;target.cursor="pointer";if(pathObject)target.zimAnimatePathChange=pathObject.on("change",target.zimAnimatePathChange);target.zimAnimateDragDown=target.on("mousedown",target.zimAnimateDragDown);target.zimAnimateDragPress=target.on("pressmove",target.zimAnimateDragPress);target.zimAnimateDragUp=target.on("pressup",target.zimAnimateDragUp);if(!dynamic)return;}
mouseCheck=false;tween.currentTime=tween.position;if(time>0){pausing=true;zim.animate({target:target,props:{percentSpeed:lastSpeed},override:false,ticker:false,time:time,call:function(){pausing=false;target.percentSpeed=lastSpeed;target.paused=false;dynamic=true;}});}else{pausing=false;target.percentSpeed=lastSpeed;target.paused=false;dynamic=true;}}
return target;};}
return target;};zim.stopAnimate=function(ids,toEnd){z_d("45.12");if(zot(ids)){if(zim.animatedObjects){for(var i=zim.animatedObjects.length-1;i>=0;i--){zim.animatedObjects.objects[i].stopAnimate(null,toEnd);}}
return;}
if(!Array.isArray(ids))ids=[ids];if(!zim.idSets)return;for(var j=0;j<ids.length;j++){var idSet=ids[j];if(zim.idSets[idSet]){var idLength=zim.idSets[idSet].length-1;for(var i=idLength;i>=0;i--){zim.idSets[idSet][i].stopAnimate(idSet,toEnd);}}}};zim.stopZimAnimate=function(ids){z_d("45.1");zim.stopAnimate(ids);};zim.pauseAnimate=function(state,ids){z_d("45.22");if(zot(state))state=true;if(zot(ids)||ids=="pauseOnBlur"){if(zim.animatedObjects){for(var i=zim.animatedObjects.length-1;i>=0;i--){zim.animatedObjects.objects[i].pauseAnimate(state,ids);}}
return;}
if(!Array.isArray(ids))ids=[ids];if(!zim.idSets)return;for(var j=0;j<ids.length;j++){var idSet=ids[j];if(zim.idSets[idSet]){for(var i=zim.idSets[idSet].length-1;i>=0;i--){zim.idSets[idSet][i].pauseAnimate(state,idSet);}}}};zim.pauseZimAnimate=function(state,ids){z_d("45.2");zim.pauseAnimate(state,ids);};zim.wiggle=function(target,property,baseAmount,minAmount,maxAmount,minTime,maxTime,totalTime,type,ease,integer,id,startType,ticker,wait){var sig="target, property, baseAmount, minAmount, maxAmount, minTime, maxTime, totalTime, type, ease, integer, id, startType, ticker, wait";var duo;if(duo=zob(zim.wiggle,arguments,sig))return duo;z_d("45.25");if(zot(target)||zot(baseAmount)||zot(minAmount))return target;if(zot(maxAmount))maxAmount=minAmount;var timeType=getTIME(minTime,null,40);if(zot(minTime))minTime=timeType=="s"?1:1000;if(zot(maxTime))maxTime=minTime;checkTIME(maxTime,timeType,40);if(zot(ease))ease="quadInOut";if(zot(integer))integer=false;if(zot(id))id=zim.makeID();if(zot(type))type="both";if(zot(startType))startType="both";if(zot(ticker))ticker=true;if(zot(wait))wait=0;checkTIME(totalTime,timeType,40);if(!zot(totalTime))target.wiggleTimeout=setTimeout(function(){target.stopAnimate(id);target.dispatchEvent("wigglestop");},totalTime*(timeType=="s"?1000:1));var results={};var count=0;var lastWiggle;function wiggleMe(){var time=zim.rand(zim.Pick.choose(minTime),zim.Pick.choose(maxTime),false);var obj={};var set={};set[property]=zim.Pick.choose(baseAmount);if(type=="negative"||(count==0&&startType=="negative")){var wiggle=-zim.rand(zim.Pick.choose(minAmount),zim.Pick.choose(maxAmount),integer);}else if(type=="positive"||(count==0&&startType=="positive")){var wiggle=zim.rand(zim.Pick.choose(minAmount),zim.Pick.choose(maxAmount),integer);}else{if(count==0){var wiggle=zim.rand(zim.Pick.choose(minAmount),zim.Pick.choose(maxAmount),integer,true);}else{var wiggle=zim.rand(zim.Pick.choose(minAmount),zim.Pick.choose(maxAmount),integer)*zim.sign(lastWiggle)*-1;}}
obj[property]=zim.Pick.choose(baseAmount)+wiggle;if(count==0)time=time/2;lastWiggle=wiggle;count++;if(type=="negative"||type=="positive"){zim.animate({target:target,obj:obj,set:set,ease:ease,time:time*2,wait:zik(wait),rewind:true,override:false,call:wiggleMe,id:id,ticker:(target.stage?true:false),timeCheck:false});}else{zim.animate({target:target,obj:obj,ease:ease,time:time,wait:zik(wait),override:false,call:wiggleMe,id:id,ticker:(target.stage?true:false),timeCheck:false});}}
if(target.addTo&&!target.stage){target.added(wiggleMe);}else wiggleMe();return target;};zim.loop=function(obj,call,reverse,step,start,end){var sig="obj, call, reverse, step, start, end";var duo;if(duo=zob(zim.loop,arguments,sig))return duo;if(!zim.zimLoopCheck)z_d("45.3");zim.zimLoopCheck=true;if(zot(obj)||zot(call))return undefined;if(zot(reverse))reverse=false;if(zot(step)||step<=0)step=1;var type=typeof obj=="number"?"number":(obj.constructor===Array?"array":(obj.constructor==={}.constructor?"object":(obj instanceof NodeList?"nodelist":(typeof obj=="string"?"string":(obj instanceof HTMLCollection?"htmlcollection":"invalid")))));if(type=="container"&&!obj.addChild){return undefined;}
if(type=="number"||type=="string"||type=="array"||type=="nodelist"||type=="htmlcollection"){var length=type=="number"?obj:obj.length;var total=getTotal(length-1);if(total==0)return;if(reverse){for(var i=start;i>=end;i-=step){if(type=="number"){var r=call(i,total,start,end,obj);}else if(type=="array"||type=="string"){var r=call(obj[i],i,total,start,end,obj);}else{var r=call(obj.item(i),i,total,start,end,obj);}
if(typeof r!='undefined')return r;}}else{for(var i=start;i<=end;i+=step){if(type=="number"){var r=call(i,total,start,end,obj);}else if(type=="array"||type=="string"){var r=call(obj[i],i,total,start,end,obj);}else{var r=call(obj.item(i),i,total,start,end,obj);}
if(typeof r!='undefined')return r;}}
return true;}else if(type=="object"){var length=0;var props=[];for(var i in obj){length++;props.push(i);}
var total=getTotal(length-1);if(total==0)return;if(reverse){for(var i=start;i>=end;i-=step){var r=call(props[i],obj[props[i]],i,total,start,end,obj);if(typeof r!='undefined')return r;}}else{for(var i=start;i<=end;i+=step){var r=call(props[i],obj[props[i]],i,total,start,end,obj);if(typeof r!='undefined')return r;}}
return true;}else{var total=getTotal(obj.numChildren-1);if(total==0)return;if(reverse){for(var i=start;i>=end;i-=step){var r=call(obj.getChildAt(i),i,total,start,end,obj);if(typeof r!='undefined')return r;}}else{for(var i=start;i<=end;i+=step){var r=call(obj.getChildAt(i),i,total,start,end,obj);if(typeof r!='undefined')return r;}}
return true;}
function getTotal(max){if(zot(start))start=reverse?max:0;if(zot(end))end=reverse?0:max;if((reverse&&end>start)||(!reverse&&start>end))return 0;if((start<0&&end)<0||(start>max&&end>max))return 0;start=Math.max(0,Math.min(start,max));end=Math.max(0,Math.min(end,max));return Math.floor((reverse?(start-end):(end-start))/step)+1;}};zim.scaleTo=function(obj,boundObj,percentX,percentY,type,boundsOnly){var sig="obj, boundObj, percentX, percentY, type, boundsOnly";var duo;if(duo=zob(zim.scaleTo,arguments,sig))return duo;if(obj.type=="AC"&&zdf){zdf.ac("scaleTo",arguments);return obj;}
z_d("43");if(zot(boundObj))boundObj=zdf&&zdf.stage?zdf.stage:null;if(zot(obj)||!obj.getBounds||!obj.getBounds()){zog("zim methods - scaleTo(): please provide an object (with setBounds) to scale");return obj;}
if(zot(boundObj)||!boundObj.getBounds||!boundObj.getBounds()){zog("zim methods - scaleTo(): please provide a boundObject (with setBounds) to scale to");return obj;}
if(zot(percentX))percentX=-1;if(zot(percentY))percentY=-1;if(percentX==-1&&percentY==-1)percentX=percentY=100;if(zot(type))type="fit";if(type=="smallest")type="fit";else if(type=="biggest"||type=="outside"||type=="largest")type="fill";else if(type=="both"||type=="stretch")type="full";if(zot(boundsOnly))boundsOnly=false;var w=boundObj.getBounds().width*percentX/100*(boundsOnly?1:boundObj.scaleX);var h=boundObj.getBounds().height*percentY/100*(boundsOnly?1:boundObj.scaleY);if(boundObj.type=="Stage"||boundObj.type=="StageGL"){w=boundObj.width*percentX/100;h=boundObj.height*percentY/100;}
if((percentX==-1||percentY==-1)&&type!="full"){if(percentX==-1){zim.sca(obj,h/obj.getBounds().height);}else{zim.sca(obj,w/obj.getBounds().width);}
return obj;}
if(type=="full"){obj.scaleX=(percentX!=-1)?w/obj.getBounds().width:obj.scaleX;obj.scaleY=(percentY!=-1)?h/obj.getBounds().height:obj.scaleY;return obj;}else if(type=="fill"){var scale=Math.max(w/obj.getBounds().width,h/obj.getBounds().height);}else{var scale=Math.min(w/obj.getBounds().width,h/obj.getBounds().height);}
zim.sca(obj,scale);return obj;};zim.fit=function(obj,left,top,width,height,type){var sig="obj, left, top, width, height, type";var duo;if(duo=zob(zim.fit,arguments,sig))return duo;if(obj.type=="AC"&&zdf){zdf.ac("fit",arguments);return obj;}
z_d("46");if(zot(obj)||!obj.getBounds)return;if(!obj.getBounds()){zog("zim methods - fit(): please setBounds() on object");return;}
if(zot(left)){if(!obj.stage){zog("zim methods - fit(): please add boundary dimensions or add obj to stage first");return;}
if(!obj.stage.getBounds()){zog("zim methods - fit(): please add boundary dimensions or add obj with bounds to stage first");return;}
var stageW=obj.stage.getBounds().width;var stageH=obj.stage.getBounds().height;left=0;top=0;width=stageW;height=stageH;}
if(type===true)type="fit";else if(type===false)type="fill";if(zot(type))type="fit";obj.scaleX=obj.scaleY=1;var w=width;var h=height;var objW=obj.getBounds().width;var objH=obj.getBounds().height;var newW;var newH;var scaleX;var scaleY;var scale;if(type=="full"){obj.scaleX=scaleX=w/objW;obj.scaleY=scaleY=h/objH;newW=w;newH=h;}else{if(type=="fit"){if(w/h>=objW/objH){scale=h/objH;}else{scale=w/objW;}}else if(type=="fill"){if(w/h>=objW/objH){scale=w/objW;}else{scale=h/objH;}}
scaleX=scaleY=scale;}
obj.scaleX=scaleX;obj.scaleY=scaleY;newW=objW*scaleX;newH=objH*scaleY;obj.x=(obj.regX-obj.getBounds().x)*scaleX+left+(w-newW)/2;obj.y=(obj.regY-obj.getBounds().y)*scaleY+top+(h-newH)/2;return{x:obj.x,y:obj.y,width:newW,height:newH,scale:scale,scaleX:scaleX,scaleY:scaleY,bX:left,bY:top,bWidth:width,bHeight:height};};zim.boundsCheck=false;zim.boundsToGlobal=function(obj,rect,flip){if(!zim.boundsCheck){z_d("40");zim.boundsCheck=true;}
if(zot(obj)||!obj.getBounds)return;if(zot(flip))flip=false;var oB=obj.getBounds();if(!oB&&zot(rect)){zog("zim methods - boundsToGlobal():\n please setBounds() on object (or a rectangle)");return;}
if(rect)oB=rect;if(flip){var pTL=obj.globalToLocal(oB.x,oB.y);var pTR=obj.globalToLocal(oB.x+oB.width,oB.y);var pBR=obj.globalToLocal(oB.x+oB.width,oB.y+oB.height);var pBL=obj.globalToLocal(oB.x,oB.y+oB.height);}else{var pTL=obj.localToGlobal(oB.x,oB.y);var pTR=obj.localToGlobal(oB.x+oB.width,oB.y);var pBR=obj.localToGlobal(oB.x+oB.width,oB.y+oB.height);var pBL=obj.localToGlobal(oB.x,oB.y+oB.height);}
var newTLX=Math.min(pTL.x,pTR.x,pBR.x,pBL.x);var newTLY=Math.min(pTL.y,pTR.y,pBR.y,pBL.y);var newBRX=Math.max(pTL.x,pTR.x,pBR.x,pBL.x);var newBRY=Math.max(pTL.y,pTR.y,pBR.y,pBL.y);return new createjs.Rectangle(newTLX,newTLY,newBRX-newTLX,newBRY-newTLY);};zim.resetBounds=function(obj,a,b,c,d){z_d("40.5");if(!zot(c)){var boundsX=a;var width=c;var boundsY=b;var height=d;}else{var boundsX=0;var width=a;var boundsY=0;var height=b;}
if(zot(height))height=width;if(!zot(a))obj.setBounds(boundsX,boundsY,width,height);else obj.setBounds(null);return obj;};zim.copyMatrix=function(obj,source){z_d("45.5");obj.x=source.x;obj.y=source.y;obj.scaleX=source.scaleX;obj.scaleY=source.scaleY;obj.regX=source.regX;obj.regY=source.regY;obj.rotation=source.rotation;obj.skewX=source.skewX;obj.skewY=source.skewY;return obj;};zim.duplicate=function(obj,exact){z_d("45.6");var d=obj.clone(exact);for(var prop in obj){if(obj.hasOwnProperty(prop)&&d[prop]==null){if(prop=="parent")continue;d[prop]=obj[prop];}}
return d;};zim.expand=function(obj,padding,paddingVertical,paddingRight,paddingBottom){var sig="padding, paddingVertical, paddingRight, paddingBottom";var duo;if(duo=zob(zim.expand,arguments,sig))return duo;z_d("50");if(zot(obj)||!obj.getBounds||!obj.getBounds()){zog("zim methods - expand(): please provide object with bounds set");return obj;}
if(zot(padding))padding=20;if(zot(paddingVertical))paddingVertical=padding;if(!zot(paddingRight)||!zot(paddingBottom)){if(zot(paddingRight))paddingRight=padding;if(zot(paddingBottom))paddingBottom=paddingVertical;var paddingLeft=padding;var paddingTop=paddingVertical;}else{var paddingLeft=paddingRight=padding;var paddingTop=paddingBottom=paddingVertical;}
var oB=obj.getBounds();var rect=new createjs.Shape();rect.graphics.f("0").r(oB.x-paddingLeft,oB.y-paddingTop,oB.width+paddingLeft+paddingRight,oB.height+paddingTop+paddingBottom);obj.hitArea=rect;return obj;};zim.setSwipe=function(obj,swipe){z_d("34");if(zot(obj)||!obj.on)return;obj.zimNoSwipe=(swipe)?null:true;if(obj instanceof createjs.Container)dig(obj);function dig(container){var num=container.numChildren;var temp;for(var i=0;i<num;i++){temp=container.getChildAt(i);temp.zimNoSwipe=obj.zimNoSwipe;if(temp instanceof createjs.Container){dig(temp);}}}
return obj;};zim.setMask=function(obj,mask,dynamic){z_d("50.1");if(zot(obj)){zog("zim methods - setMask(): please provide obj");}
if(zot(mask)){setMaskNull();return obj;}
var stage=obj.stage||(zdf?zdf.stage:null);function setMaskNull(){if(obj.zimMask&&obj.zimMask.parent)obj.zimMask.parent.removeChild(obj.zimMask);obj.zimMask=null;if(obj.zimMaskTicker)zim.Ticker.remove(obj.zimMaskTicker);obj.mask=null;}
if(obj.zimMaskOriginal&&obj.zimMaskOriginal!=mask)setMaskNull();if(zot(dynamic)){dynamic=(mask.type=="Blob"||!zot(mask.zimDown)||!zot(mask.transformControls)||!zot(mask.zimTouch)||!zot(mask.zimTweens));mask.zimMaskDynamic=dynamic;}
obj.zimMaskOriginal=mask;var m;function apply(){if(dynamic&&(!stage||!mask.stage))return obj;if(m&&m.dispose)m.dispose();m=null;obj.zimMask=mask.zimMask=m=mask.shape.clone();zim.copyMatrix(m,mask);mask.addChildAt(m,0);m.alpha=0;if(!obj.parent){obj.mask=m;return;}
var mm=mask.getConcatenatedMatrix().decompose();var om=obj.parent.getConcatenatedMatrix().decompose();m.scaleX=mm.scaleX/om.scaleX;m.scaleY=mm.scaleY/om.scaleY;m.rotation=(mm.rotation?mm.rotation:0)-(om.rotation?om.rotation:0);var p=mask.localToLocal(mask.shape.x+mask.regX,mask.shape.y+mask.regY,obj.parent);m.x=p.x;m.y=p.y;obj.mask=m;}
mask.zimMaskApply=function(){if(obj.zimMaskTicker)zim.Ticker.remove(obj.zimMaskTicker);obj.zimMaskTicker=zim.Ticker.add(apply);};if(mask&&mask.shape){apply();if(dynamic)mask.zimMaskApply();}else{m=mask;obj.mask=m;}
return obj;};zim.outline=function(obj,color,size,boundsOnly){var sig="obj, color, size, boundsOnly";var duo;if(duo=zob(zim.outline,arguments,sig))return duo;z_d("47");if(obj.type&&obj.type=="zimOultineShape"){if(zon)zogy("zim.outline() - warning, you are trying to outline an outline - do not outline in a loop");return obj;}
if(zot(obj)||!obj.getBounds){zog("zim methods - outline(): please provide object with bounds set");return obj;}
if(!obj.getBounds()){zog("zim methods - outline(): please setBounds() on object");return obj;}
if(!obj.parent){zog("zim methods - outline(): object should be on stage first");return obj;}
if(zot(color))color="brown";if(zot(size))size=2;if(size<=0){if(obj.ZIMoutlineShape)obj.ZIMoutlineShape.parent.removeChild(obj.ZIMoutlineShape);if(obj.ZIMoutlineShapeC)obj.ZIMoutlineShapeC.parent.removeChild(obj.ZIMoutlineShapeC);obj.ZIMoutlineShape=obj.ZIMoutlineShapeC=null;return;}
var oB=obj.getBounds();var shape=obj.ZIMoutlineShape=(obj.ZIMoutlineShape)?(obj.ZIMoutlineShape):new zim.Shape();shape.type="zimOutlineShape";var shapeC=obj.ZIMoutlineShapeC=(obj.ZIMoutlineShapeC)?(obj.ZIMoutlineShapeC):new zim.Shape();shapeC.type="zimOutlineShape";var p=obj.parent;obj.outlineToggled=true;obj.outlineToggle=function(type){if(type===true){obj.ZIMoutlineShape.visible=true;obj.ZIMoutlineShapeC.visible=true;}else if(type===false){obj.ZIMoutlineShape.visible=false;obj.ZIMoutlineShapeC.visible=false;}else{obj.ZIMoutlineShape.visible=!obj.ZIMoutlineShape.visible;obj.ZIMoutlineShapeC.visible=!obj.ZIMoutlineShapeC.visible;}
obj.outlineToggled=obj.ZIMoutlineShape.visible;return obj;};var pTL=obj.localToLocal(oB.x,oB.y,p);var pTR=obj.localToLocal(oB.x+oB.width,oB.y,p);var pBR=obj.localToLocal(oB.x+oB.width,oB.y+oB.height,p);var pBL=obj.localToLocal(oB.x,oB.y+oB.height,p);var pC=obj.localToLocal(0,0,p);var g=shape.graphics.c();var gC=shapeC.graphics.c();g.s(color).ss(size).mt(pTL.x,pTL.y).lt(pTR.x,pTR.y).lt(pBR.x,pBR.y).lt(pBL.x,pBL.y).lt(pTL.x,pTL.y).cp();if(!boundsOnly){var s=10;var ss=s+1;gC.s("white").ss(size+2);gC.mt(-ss,0).lt(ss,0);gC.mt(0,-ss).lt(0,ss);gC.s(color).ss(size);gC.mt(-s,0).lt(s,0);gC.mt(0,-s).lt(0,s);gC.cp();shapeC.x=pC.x;shapeC.y=pC.y;shapeC.rotation=obj.rotation;g.s("white").ss(size+2).dc(obj.x,obj.y,s+6);g.s(color).ss(size).dc(obj.x,obj.y,s+6);}
obj.parent.removeChild(shape);obj.parent.removeChild(shapeC);var index=obj.parent.getChildIndex(obj);obj.parent.addChildAt(shapeC,index+1);obj.parent.addChildAt(shape,index+1);shape.mouseEnabled=false;shapeC.mouseEnabled=false;return obj;};zim.STYLE=null;zim.ignore="ignore";zim.getStyle=function(type,group,inherit){if(!zim.STYLECHECK){z_d("50.34");zim.STYLECHECK=true;}
var functionList=["pos","addTo","center","centerReg","mov","drag","transform","gesture","outline","bounds","animate","wiggle","cache"];var DS=zim.STYLE;if(typeof STYLE!==typeof undefined)DS=STYLE;for(var prop in STYLE){var val=STYLE[prop];if(prop.match(/^[(A-Z)]/)){if(!STYLE.type)STYLE.type={};if(STYLE.type[prop])STYLE.type[prop]=zim.merge(STYLE.type[prop],val);else STYLE.type[prop]=val;delete STYLE[prop];}};if(!zot(DS))DS=zim.copy(DS);else DS={};if(zot(inherit)){inherit={};}else{for(var i=0;i<functionList.length;i++){delete inherit[functionList[i]];}}
var IS=inherit;var TS=DS.type;if(TS)delete DS.type;if(!zot(group)&&!zot(DS.group)){var groups=group.split(",");var GS={};for(var i=0;i<groups.length;i++){var g=groups[i].trim();if(!zot(DS.group[g]))GS=zim.merge(GS,DS.group[g]);}
delete DS.group;}
if(!zot(type)&&!zot(TS)&&!zot(TS[type]))DS=zim.merge(DS,TS[type]);if(!zot(group)&&!zot(GS))DS=zim.merge(DS,GS);var val;for(var s in DS){if(IS[s]){delete DS[s];continue;}
val=functionList.indexOf(s)==-1&&!DS.delayPick?zim.Pick.choose(DS[s]):DS[s];if(val=="ignore"){delete DS[s];continue;}
else if(val&&val.constructor==={}.constructor)val=zim.copy(val,true,false);DS[s]=val;}
DS=zim.merge(DS,IS);if(DS.style===false)return{};return DS;};zim.styleTransforms=function(obj,styles){var zimTransformList=["visible","x","y","scale","scaleX","scaleY","rotation","alpha","skewX","skewY","regX","regY"];if(styles){if(styles.add){obj.addTo();}
if(styles.addTo){obj.addTo(styles.addTo===true?null:styles.addTo);}
if(styles.center){obj.center(styles.center===true?null:styles.center);}
if(styles.centerReg){obj.centerReg(styles.centerReg===true?null:styles.centerReg);}
for(var i=0;i<zimTransformList.length;i++){if(styles[zimTransformList[i]]!=null)obj[zimTransformList[i]]=zim.Pick.choose(styles[zimTransformList[i]]);}
if(styles.bounds){if(styles.bounds.constructor==={}.constructor){obj.setBounds(styles.bounds.x?styles.bounds.x:0,styles.bounds.y?styles.bounds.y:0,styles.bounds.width?styles.bounds.width:100,styles.bounds.height?styles.bounds.height:100);}}
if(styles.x!=null){if(styles.loc){if(styles.loc.x==null)styles.loc.x=styles.x;}else{styles.loc={x:styles.x};}}
if(styles.y!=null){if(styles.loc){if(styles.loc.y==null)styles.loc.y=styles.y;}else{styles.loc={y:styles.y};}}
if(styles.loc){if(styles.loc.constructor==={}.constructor){obj.loc(zim.Pick.choose(styles.loc.x),zim.Pick.choose(styles.loc.y));}else{obj.loc(zim.Pick.choose(styles.loc));}}
if(styles.pos){if(styles.pos.constructor==={}.constructor){obj.pos(zim.Pick.choose(styles.pos.x),zim.Pick.choose(styles.pos.y),zim.Pick.choose(styles.pos.right),zim.Pick.choose(styles.pos.bottom),zim.Pick.choose(styles.pos.container),zim.Pick.choose(styles.pos.index),styles.pos.add,zim.Pick.choose(styles.pos.reg),zim.Pick.choose(styles.pos.regX),zim.Pick.choose(styles.pos.regY));}else{var sp=zim.Pick.choose(styles.pos);if(sp=="left"||sp=="top")obj.pos();if(sp=="right")obj.pos({right:true});if(sp=="bottom")obj.pos({bottom:true});if(sp=="rightbottom"||sp=="bottomright")obj.pos({right:true,bottom:true});if(sp=="center")obj.center();}}
if(styles.mov||styles.move){if(styles.move)styles.mov=styles.move;if(styles.mov.constructor==={}.constructor){obj.mov(zim.Pick.choose(styles.mov.x),zim.Pick.choose(styles.mov.y));}else{obj.mov(zim.Pick.choose(styles.mov));}}
if(styles.outline){setTimeout(function(){obj.outline(styles.outline.constructor==={}.constructor?styles.outline:null);if(obj.stage)obj.stage.update();},20);}
if(styles.drag){obj.drag(styles.drag.constructor==={}.constructor?styles.drag:{currentTarget:true});}
if(styles.gesture){obj.gesture(styles.gesture.constructor==={}.constructor?styles.gesture:null);}
if(styles.transform){setTimeout(function(){obj.transform(styles.transform.constructor==={}.constructor?styles.transform:null);},20);}
if(styles.animate){if(!Array.isArray(styles.animate))styles.animate=[styles.animate];for(var i=0;i<styles.animate.length;i++){-function(){var sty=styles.animate[i];if(sty.constructor==={}.constructor)setTimeout(function(){obj.animate(sty);},20);}();}}
if(styles.wiggle){if(!Array.isArray(styles.wiggle))styles.wiggle=[styles.wiggle];for(var i=0;i<styles.wiggle.length;i++){-function(){var sty=styles.wiggle[i];if(sty.constructor==={}.constructor)setTimeout(function(){obj.wiggle(sty);},20);}();}}
if(styles.expand){obj.expand(styles.expand===true?null:styles.expand);}
if(styles.cache){if(styles.cache.constructor==={}.constructor){if(styles.cache.x)obj.cache(zim.Pick.choose(styles.cache.x),zim.Pick.choose(styles.cache.y),zim.Pick.choose(styles.cache.x),zim.Pick.choose(styles.cache.y));else obj.cache(zim.Pick.choose(styles.cache.width),zim.Pick.choose(styles.cache.height));}else{obj.cache();}}}};zim.Style={remembered:{},clear:function(){STYLE={};return zim.Style;},clearTypes:function(){STYLE={};delete STYLE.types;return zim.Style;},clearGroups:function(){STYLE={};delete STYLE.groups;return zim.Style;},remember:function(id){if(!STYLE)STYLE={};if(zot(id))id="default";zim.Style.remembered[id]=zim.copy(STYLE,true);return zim.Style;},clearRemembered:function(id){if(zot(id))zim.Style.remembered={};else delete zim.Style.remembered[id];return zim.Style;},recall:function(id){if(zot(id))id="default";STYLE=zim.Style.remembered[id];return zim.Style;},add:function(obj){if(!STYLE)STYLE={};STYLE=zim.merge(STYLE,obj);return zim.Style;},addType:function(typeName,obj){if(!STYLE)STYLE={};if(!STYLE.type)STYLE.type={};STYLE.type[typeName]=obj;return zim.Style;},addGroup:function(groupName,obj){if(!STYLE)STYLE={};if(!STYLE.group)STYLE.group={};STYLE.group[groupName]=obj;return zim.Style;},remove:function(styleName){if(!STYLE)STYLE={};delete STYLE[styleName];return zim.Style;},removeType:function(typeName){if(!STYLE)STYLE={};if(!STYLE.type)return zim.Style;delete STYLE.type[typeName];return zim.Style;},removeGroup:function(groupName){if(!STYLE)STYLE={};if(!STYLE.group)return zim.Style;delete STYLE.group[groupName];return zim.Style;}};zim.TIME="seconds";zim.TIMECHECK=false;zim.ANIMATE=true;zim.OPTIMIZE=false;zim.ACTIONEVENT="mousedown";zim.DEFAULTWIRE="currentValue";zim.KEYFOCUS=null;zim.POSREG=false;zim.DRAGALL=false;zim.MOBILE="default";zim.Ticker={stages:null,myUpdate:null,alwaysList:new zim.Dictionary(),list:new zim.Dictionary(),wire:new zim.Dictionary(),setFPS:function(m,d){if(zot(m)&&zot(d)){m=60;d=60;}else if(zot(m)){m=60;}else if(zot(d)){d=m;}
zim.Ticker.framerate=createjs.Ticker.framerate=(zim.mobile())?m:d;},setTimingMode:function(mode){createjs.Ticker.timingMode=createjs.Ticker.RAF;if(mode=="synched")createjs.Ticker.timingMode=createjs.Ticker.RAF_SYNCHED;if(mode=="timeout")createjs.Ticker.timingMode=createjs.Ticker.TIMEOUT;},add:function(f,s,w){z_d("30");var t=zim.Ticker;if(t.has(f,s))return f;if(zot(s)||!s.update)s=zdf.stage;if(zot(f)||typeof f!=='function'){zog("zim.Ticker.add() - only add functions");return;}
if(t.list.at(s)){t.list.at(s).push(f);}else{t.list.add(s,[f]);}
if(!t.ticker)t.ticker=createjs.Ticker.on("tick",t.call);if(!t.framerate)t.setFPS();return f;},addWire:function(obj,data){z_d("30");if(zot(data[0]))return obj;var t=zim.Ticker;t.wire.add(obj,data);var current=data[0][data[1]];if(data[4])current=data[4](current,"from");if(data[3])obj[data[6]]=data[7]=current;if(!t.ticker)t.ticker=createjs.Ticker.on("tick",t.call);if(!t.framerate)t.setFPS();return obj;},rawID:{},raw:function(f){z_d("30");var id=zim.makeID(7,"letters");-function raw(t){f(t);zim.Ticker.rawID[id]=requestAnimationFrame(raw);}();return id;},removeRaw:function(id){cancelAnimationFrame(zim.Ticker.rawID[id]);delete zim.Ticker.rawID[id];},call:function(e){var t=zim.Ticker;var s,functions;var stages=[];for(var i=0;i<t.list.length;i++){s=t.list.objects[i];functions=t.list.values[i];for(var j=0;j<functions.length;j++){functions[j](e);}
var u=false;if(t.alwaysList.at(s)){u=true;}else if(functions.length>0){if(zot(t.update)&&(!zim.OPTIMIZE&&(zns||!OPTIMIZE))){u=true;}else if(t.update){u=true;}}
if(u&&stages.indexOf(s)<0)stages.push(s);}
for(var i=t.wire.length-1;i>=0;i--){var obj=t.wire.objects[i];var data=t.wire.values[i];if(data){var current=obj[data[6]];if(current!=data[7]){if(data[4])current=data[4](current,"to",data[7]);data[0][data[1]]=data[7]=current;if(data[5])data[5](current);s=data[0].stage;if(s&&stages.indexOf(s)<0)stages.push(s);}
if(data[2]&&data[0]){current=data[0][data[1]];if(data[7]!=current){if(data[4])current=data[4](current,"from",data[7]);obj[data[6]]=data[7]=current;if(data[5])data[5](current);s=obj.stage;if(s&&stages.indexOf(s)<0)stages.push(s);}}}}
if(t.list.length==0){for(i=0;i<t.alwaysList.length;i++){s=t.alwaysList.objects[i];if(stages.indexOf(s)<0)stages.push(s);}}
var l=stages.length;for(var i=0;i<l;i++){stages[i].update();}},always:function(s){z_d("30");var t=zim.Ticker;if(!t.framerate)t.setFPS();if(zot(s)||!s.update)s=zdf.stage;t.alwaysList.add(s,true);if(!t.ticker)t.ticker=createjs.Ticker.on("tick",t.call);},alwaysOff:function(s){var t=zim.Ticker;if(zot(s)||!s.update)s=zdf.stage;t.alwaysList.remove(s);},remove:function(f){var t=zim.Ticker;if(zot(f)||typeof f!=='function'){zog("zim.Ticker - only remove functions");return;}
var count=0;var s;for(var i=0;i<t.list.length;i++){s=t.list.objects[i];var index=t.list.values[i].indexOf(f);if(index>-1){t.list.values[i].splice(index,1);}
count+=t.list.values[i].length;}
if(t.alwaysList.length>0||t.list.length>0||t.wire.length>0)return;createjs.Ticker.off("tick",t.ticker);t.ticker=null;},removeAll:function(s){var t=zim.Ticker;var count=0;var st;for(var i=0;i<t.list.length;i++){st=t.list.objects[i];if(zot(s)||s===st){t.list.values[i]=[];}
count+=t.list.values[i].length;}
if(t.alwaysList.length>0||t.list.length>0||t.wire.length>0)return;createjs.Ticker.off("tick",t.ticker);t.ticker=null;},removeWire:function(obj,target,prop,input){var t=zim.Ticker;if(zot(obj)&&zot(target)&&zot(prop)&&zot(input)){t.wire.clear();}else{for(var i=t.wire.length-1;i>=0;i--){var o=t.wire.objects[i];var data=t.wire.values[i];if(!data)continue;if(obj&&o!=obj)continue;if(target&&data[0]!=target)continue;if(prop&&data[1]!=prop)continue;if(input&&data[6]!=input)continue;t.wire.objects.splice(i,1);t.wire.values.splice(i,1);}}
if(t.alwaysList.length>0||t.list.length>0||t.wire.length>0)return;createjs.Ticker.off("tick",t.ticker);t.ticker=null;},has:function(f,s){if(zot(s)||!s.update)s=zdf.stage;return zim.Ticker.list&&zim.Ticker.list.at(s)&&zim.Ticker.list.at(s).indexOf(f)>=0;},dispose:function(s){var t=zim.Ticker;var count=0;var st;for(var i=t.list.length-1;i>=0;i--){st=t.list.objects[i];if(zot(s)||s===st){t.list.remove(s);t.alwaysList.remove(s);}else{count+=t.list.values[i].length;}}
if(t.alwaysList.length>0)return;if(count==0){createjs.Ticker.off("tick",t.ticker);t.ticker=null;}
return true;}};zim.Ticker.setFPS();Object.defineProperty(zim.Ticker,'update',{get:function(){return zim.Ticker.myUpdate;},set:function(value){var t=zim.Ticker;if(typeof value!="boolean")value=null;t.myUpdate=value;if(t.myUpdate===false){cancelAnimationFrame(t.ticker);t.alwaysList=new zim.Dictionary();}}});zim.Pages=function(pages,transition,speed,transitionTable,holder,arrowDisableColor,style,group,inherit){var sig="pages, transition, speed, transitionTable, holder, arrowDisableColor, style, group, inherit";var duo;if(duo=zob(zim.Pages,arguments,sig,this))return duo;z_d("71");this.zimContainer_constructor(null,null,null,null,false);this.type="Pages";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);var timeType=getTIME(speed);if(zot(pages))pages=DS.pages!=null?DS.pages:[];this.pages=pages;if(zot(transition))transition=DS.transition!=null?DS.transition:"none";if(zot(speed))speed=DS.speed!=null?DS.speed:timeType=="s"?.2:200;if(zot(transitionTable))transitionTable=DS.transitionTable!=null?DS.transitionTable:[];this.transitionTable=transitionTable;if(zot(arrowDisableColor))arrowDisableColor=DS.arrowDisableColor!=null?DS.arrowDisableColor:zim.grey;this.arrowDisableColor=arrowDisableColor;if(zot(holder))holder=DS.holder!=null?DS.holder:null;if(zot(holder)&&zdf)holder=zdf.stage;if(!holder.getBounds||!holder.getBounds()){zog("zim controls - Pages():\nholder object must have bounds set");return;}
this.speed=speed;this.active=true;var that=this;that.transitioning=false;var hW=holder.getBounds().width;var hH=holder.getBounds().height;var black;var white;if(transition!="none"||transitionTable!=[])makeTransitionAssets();function makeTransitionAssets(){black=new createjs.Shape();black.graphics.f("black").r(0,0,hW,hH+1);white=new createjs.Shape();white.graphics.f("white").r(0,0,hW,hH+1);}
var directions=["left","right","up","down"];var data;var page;var defaultSwipeCheck=true;for(var i=0;i<pages.length;i++){data=pages[i];if(data.constructor!={}.constructor)data=pages[i]={page:pages[i]};if(data.swipe)defaultSwipeCheck=false;}
for(var i=0;i<pages.length;i++){data=pages[i];if(data.constructor!=={}.constructor)data=pages[i]={page:pages[i]};if(defaultSwipeCheck){var last=pages[i-1];var next=pages[i+1];data.swipe=[last?last.page:null,next?next.page:null];}
preparePage(data.page,data.swipe);}
var currentPage=this.page=pages[0]?pages[0].page:null;if(!zot(this.page))this.index=0;this.addChild(currentPage);addHTML(currentPage);this.swipe=new zim.Swipe(holder);var pauseInfo;var paused=false;var swipeEvent=this.swipe.on("swipe",function(e){if(!that.active)return;var direction=e.currentTarget.direction;if(direction=="none")return;var newDirection="";if(direction=="left")newDirection="right";else if(direction=="right")newDirection="left";else if(direction=="up")newDirection="down";else if(direction=="down")newDirection="up";direction=newDirection;var dirIndex=directions.indexOf(direction);page=currentPage.zimSwipeArray[dirIndex];pauseInfo=[page,direction,null,null,true];that.page=currentPage;that.nextPage=page;that.direction=direction;that.dispatchEvent("swipe");setTimeout(function(){if(!paused){that.go(page,direction,null,null,true);}},50);});function preparePage(p,s){p.zimHTMLList=new zim.Dictionary();removeHTML(p);p.zimSwipeArray=s?s:[];p.zimOriginalAlpha=p.alpha;if(p.parent)p.parent.removeChild(data.page);}
function addHTML(p){if(zot(p))return;for(var i=0;i<p.zimHTMLList.length;i++){p.addChildAt(p.zimHTMLList.values[i].obj,p.zimHTMLList.values[i].depth);}}
function removeHTML(p){p.zimHTMLList.clear();for(var i=0;i<p.numChildren;i++){var ch=p.getChildAt(i);if(ch.type=="TextArea"||ch.type=="Loader"||ch.type=="Tag"){var obj={obj:ch,depth:p.getChildIndex(ch)};p.zimHTMLList.add(ch,obj);}}
for(var i=p.numChildren-1;i>=0;i--){var ch=p.getChildAt(i);if(ch.type=="TextArea"||ch.type=="Loader"||ch.type=="Tag"){p.removeChild(ch);}}}
this.addPage=function(page,swipeArray){preparePage(page,swipeArray);that.pages.push({page:page});if(!currentPage){currentPage=that.page=page;that.addChild(currentPage);}else{if(page.parent)page.parent.removeChild(page);}};this.removePage=function(page){removeHTML(page);if(that.currentPage==page){that.removeChild(page);if(holder.stage)holder.stage.update();}
zim.loop(that.pages,function(p,i){if(p.page==page||p==page)that.pages.splice(i,1);},true);page.zimSwipeArray=null;};this.setSwipeArray=function(page,swipeArray){if(zot(swipeArray))swipeArray=[];var data={page:page,swipe:swipeArray};data.page.zimSwipeArray=(data.swipe)?data.swipe:[];};this.pause=function(){paused=true;};this.unpause=function(){if(paused)that.go(pauseInfo[0],pauseInfo[1],pauseInfo[2],pauseInfo[3],pauseInfo[4]);};var goCheck=true;this.go=function(newPage,direction,trans,speed,fromSwipe){if(typeof newPage=="number"){var np=that.pages[newPage];if(zot(np))return;newPage=np.page;}
setTimeout(function(){paused=false;},200);var slides=[{x:hW},{x:-hW},{y:hH},{y:-hH}];var slides2=[{x:0},{x:0},{y:0},{y:0}];var reveals=[{x:hW/2,alpha:0},{x:-hW/2,alpha:0},{y:hH/2,alpha:0},{y:-hH/2,alpha:0}];var emitters=[{y:hH/2},{y:hH/2},{x:hW/2},{x:hW/2}];var tempTransition=transition;var tempMs=that.speed;for(var i=0;i<that.transitionTable.length;i++){if(that.transitionTable[i][0]==currentPage&&that.transitionTable[i][1]==newPage){tempTransition=that.transitionTable[i][2];if(!zot(that.transitionTable[i][3]))tempMs=that.transitionTable[i][3];break;}}
if(zot(trans))trans=tempTransition;if(zot(speed))speed=tempMs;that.speed=speed;that.direction=direction;if(newPage==""||newPage==null){that.page=currentPage;that.dispatchEvent("nothing");}else if(typeof newPage==='string'){that.page=currentPage;that.dispatchEvent(newPage);}else{if(newPage==currentPage)return;if(zot(direction))direction="right";var dirIndex=directions.indexOf(direction);if(!goCheck)return;goCheck=false;function transEnd(pages){pages[0].uncache();pages[1].uncache();that.transitioning=false;that.dispatchEvent("pagetransitioned");that.removeChild(that.lastPage);if(trans=="fan"){if(direction=="right"||direction=="down"){that.lastPage.rotation=0;that.lastPage.regY=0;that.lastPage.mov(0,-that.lastPage.height);}else{that.page.rotation=0;that.page.regY=0;that.page.mov(0,-that.lastPage.height);}}
that.removeChild(black);that.removeChild(white);addHTML(currentPage);goCheck=true;}
function transEndHalf(pages){that.removeChild(that.lastPage);zim.animate(pages.shift(),{alpha:0},that.speed/2,null,transEnd,pages);}
newPage.x=0;newPage.y=0;newPage.alpha=newPage.zimOriginalAlpha;var emitter;var slideEmitters=["pixelDark","pixelLight","pixelZIM","bubbleDark","bubbleLight","bubbleZIM","lineDark","lineLight","lineZIM"];if(slideEmitters.indexOf(trans)>=0){var slideTrans=trans;emitter=true;trans="slide";}
var fadeEmitters=["explodeDark","explodeLight","explodeZIM",];if(fadeEmitters.indexOf(trans)>=0){var fadeTrans=trans;emitter=true;trans="fade";}
if(trans.type=="Emitter"){emitter=trans;if(trans.horizontal||trans.vertical){trans="slide";}else{trans="fade";}}
that.transitioning=true;if(trans=="slide"){newPage.x=-(slides[dirIndex].x|0);newPage.y=-(slides[dirIndex].y|0);newPage.cache(0,0,(hW+1)/newPage.scaleX,(hH+1)/newPage.scaleY);currentPage.cache(0,0,(hW+1)/currentPage.scaleX,(hH+1)/currentPage.scaleY);that.addChild(newPage);that.addChild(currentPage);zim.animate(currentPage,slides[dirIndex],that.speed,null,transEnd,[currentPage,newPage]);zim.animate(newPage,slides2[dirIndex],that.speed);}else if(trans=="reveal"){newPage.cache(0,0,(hW+1)/newPage.scaleX,(hH+1)/newPage.scaleY);currentPage.cache(0,0,(hW+1)/currentPage.scaleX,(hH+1)/currentPage.scaleY);that.addChild(newPage);that.addChild(currentPage);zim.animate(currentPage,reveals[dirIndex],that.speed,null,transEnd,[currentPage,newPage]);}else if(trans=="fade"){newPage.cache(0,0,(hW+1)/newPage.scaleX,(hH+1)/newPage.scaleY);currentPage.cache(0,0,(hW+1)/currentPage.scaleX,(hH+1)/currentPage.scaleY);newPage.alpha=1;that.addChild(newPage);that.addChild(currentPage);zim.animate(currentPage,{alpha:0},that.speed,null,transEnd,[currentPage,newPage]);}else if(trans=="black"){newPage.cache(0,0,(hW+1)/newPage.scaleX,(hH+1)/newPage.scaleY);currentPage.cache(0,0,(hW+1)/currentPage.scaleX,(hH+1)/currentPage.scaleY);newPage.alpha=1;that.addChild(newPage);that.addChild(currentPage);black.alpha=0;that.addChild(black);zim.animate(black,{alpha:1},that.speed/2,null,transEndHalf,[black,currentPage,newPage]);}else if(trans=="clear"){newPage.cache(0,0,(hW+1)/newPage.scaleX,(hH+1)/newPage.scaleY);currentPage.cache(0,0,(hW+1)/currentPage.scaleX,(hH+1)/currentPage.scaleY);newPage.alpha=0;that.addChild(newPage);that.addChild(currentPage);zim.animate(currentPage,{alpha:0},that.speed/2);zim.animate(newPage,{alpha:1},that.speed/2,null,transEnd,[currentPage,newPage],that.speed/2);}else if(trans=="white"){newPage.cache(0,0,(hW+1)/newPage.scaleX,(hH+1)/newPage.scaleY);currentPage.cache(0,0,(hW+1)/currentPage.scaleX,(hH+1)/currentPage.scaleY);newPage.alpha=1;that.addChild(newPage);that.addChild(currentPage);white.alpha=0;that.addChild(white);zim.animate(white,{alpha:1},that.speed/2,null,transEndHalf,[white,currentPage,newPage]);}else if(trans=="fan"){newPage.cache(0,0,(hW+1)/newPage.scaleX,(hH+1)/newPage.scaleY);currentPage.cache(0,0,(hW+1)/currentPage.scaleX,(hH+1)/currentPage.scaleY);newPage.alpha=1;if(direction=="right"||direction=="down"){that.addChild(newPage);that.addChild(currentPage);currentPage.regY=currentPage.height;currentPage.mov(0,currentPage.height);zim.animate(currentPage,{rotation:-90},that.speed,null,transEnd,[currentPage,newPage]);}else{that.addChild(currentPage);that.addChild(newPage);newPage.regY=currentPage.height;newPage.mov(0,currentPage.height);newPage.rotation=-90;zim.animate(newPage,{rotation:0},that.speed,null,transEnd,[currentPage,newPage]);}}else{that.transitioning=false;that.addChild(newPage);that.removeChild(currentPage);goCheck=true;}
if(emitter){var horiz=(dirIndex<2);var obj;var emi;if(slideTrans||trans=="slide"){if(slideTrans){if(slideTrans=="lineDark"||slideTrans=="lineLight")obj=new zim.Rectangle(horiz?30:hW+5,horiz?hH+5:30,(slideTrans=="lineDark"?zim.dark:zim.white)).alp(.2);else if(slideTrans=="lineZIM")obj=new zim.Rectangle(horiz?50:hW+5,horiz?hH+5:50,[zim.green,zim.yellow,zim.orange,zim.pink,zim.blue]).alp(.5);else if(slideTrans=="pixelDark"||slideTrans=="pixelLight")obj=new zim.Rectangle(40,40,zim.clear,(slideTrans=="pixelDark"?zim.dark:zim.white),2).alp(.7);else if(slideTrans=="pixelZIM")obj=new zim.Rectangle(40,40,[zim.green,zim.yellow,zim.orange,zim.pink,zim.blue]).alp(.7);else if(slideTrans=="bubbleDark"||slideTrans=="bubbleLight")obj=new zim.Circle(30,zim.clear,(slideTrans=="bubbleDark"?zim.dark:zim.white),2).alp(.7);else if(slideTrans=="bubbleZIM")obj=new zim.Circle(30,[zim.green,zim.yellow,zim.orange,zim.pink,zim.blue]).alp(.7);obj.centerReg({add:false});if(slideTrans=="lineDark"||slideTrans=="lineLight"||slideTrans=="lineZIM"){emi=new zim.Emitter({obj:obj,life:.5,decayTime:.5,shrink:false,force:0,gravity:0,width:0,startPaused:true});}else{emi=new zim.Emitter({obj:obj,num:6,life:.5,decayTime:.5,width:horiz?0:hW,height:horiz?hH:0,vertical:horiz,horizontal:!horiz,startPaused:true});}}else{emi=emitter;}
var emitters1=[{x:0,y:hH/2},{x:hW,y:hH/2},{x:hW/2,y:0},{x:hW/2,y:hH}];var emitters2=[{x:hW,y:hH/2},{x:0,y:hH/2},{x:hW/2,y:hH},{x:hW/2,y:0}];emi.centerReg(holder).spurt(null,that.speed);emi.x=emitters1[dirIndex].x;emi.y=emitters1[dirIndex].y;zim.animate(emi,emitters2[dirIndex],that.speed,null,function(){if(slideTrans)emi.dispose();});}else if(fadeTrans||trans=="fade"){if(fadeTrans){if(fadeTrans=="explodeDark"||fadeTrans=="explodeLight")obj=new zim.Circle(150,(fadeTrans=="explodeDark"?zim.dark:zim.white)).alp(.5);else if(fadeTrans=="explodeZIM")obj=new zim.Circle(130,[zim.green,zim.yellow,zim.orange,zim.pink,zim.blue]).alp(.7);emi=new zim.Emitter({obj:obj,num:5,gravity:0,force:{min:20,max:40},life:.5,shrink:false,decayTime:.5,startPaused:true});}else{emi=emitter;}
emi.centerReg(holder).spurt(null,that.speed*.35);emi.on("fizzed",function(){if(fadeTrans)emi.dispose();});}}
removeHTML(currentPage);that.lastPage=currentPage;that.page=newPage;that.index=-1;for(var i=0;i<that.pages.length;i++){var p=that.pages[i].page;if(p==that.page){that.index=i;}}
if(trans=="none")addHTML(newPage);if(zot(fromSwipe))fromSwipe=false;that.fromSwipe=fromSwipe;that.dispatchEvent("page");currentPage=newPage;that.setArrows(pages.index);if(holder.stage)holder.stage.update();}};this.resize=function(){hW=holder.getBounds().width;hH=holder.getBounds().height;if(transition!="none"||transitionTable!=[])makeTransitionAssets();};this.puff=function(time){for(var i=0;i<pages.length;i++){that.addChild(pages[i].page);}
that.addChild(currentPage);if(time>0){setTimeout(function(){that.settle();},time*(timeType=="s"?1000:1));}};this.settle=function(){that.removeAllChildren();that.addChild(currentPage);that.dispatchEvent("puffed");};this.disable=function(){that.active=false;};this.enable=function(){that.active=true;};this.arrows={};this.setArrows=function(index){if(zim.isEmpty(that.arrows))return;var current=that.pages[that.index];if(!current||!current.swipe)return;var swipe=current.swipe;var directions=[LEFT,RIGHT,DOWN,UP];zim.loop(directions,function(d,i){if(!swipe[i]){zim.loop(that.arrows[d],function(b){if(b.setDisabled===false){b.activate(true,b.arrowBackgroundColor);b.setDisabled=null;return;}
if(!b.enabled)return;b.activate(false,that.arrowDisableColor);});}else{zim.loop(that.arrows[d],function(b){if(b.setDisabled===true){b.activate(false,that.arrowDisableColor);b.setDisabled=null;return;}
if(b.enabled)return;b.activate(true,b.arrowBackgroundColor);});}});if(that.stage)that.stage.update();}
if(style!==false)zim.styleTransforms(this,DS);this.dispose=function(a,b,disposing){that.swipe.off("swipe",swipeEvent);that.swipe.dispose();if(!disposing)this.zimContainer_dispose(true);return true;};};zim.extend(zim.Pages,zim.Container,["clone","dispose"],"zimContainer",false);zim.Arrow=function(backgroundColor,rollBackgroundColor,pages,direction,type,newPage,trans,speed,style,group,inherit){var sig="backgroundColor, rollBackgroundColor, pages, direction, type, newPage, trans, speed, style, group, inherit";var duo;if(duo=zob(zim.Arrow,arguments,sig,this))return duo;z_d("71.2");this.group=group;var DS=style===false?{}:zim.getStyle("Arrow",this.group,inherit);if(zot(direction))direction=DS.direction!=null?DS.direction:"right";if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:zim.blue;this.arrowBackgroundColor=backgroundColor;if(zot(rollBackgroundColor))rollBackgroundColor=DS.rollBackgroundColor!=null?DS.rollBackgroundColor:zim.blue.lighten(.2);if(zot(type))type=DS.type!=null?DS.type:"triangle";if(zot(newPage))newPage=DS.newPage!=null?DS.newPage:null;if(zot(trans))trans=DS.trans!=null?DS.trans:null;if(zot(speed))speed=DS.speed!=null?DS.speed:null;var icon;var rollIcon;var iconColor;if(type=="triangle"){icon=new zim.Triangle(45,45,45,backgroundColor,null,null,null,-7).rot(90);rollIcon=new zim.Triangle(45,45,45,rollBackgroundColor,null,null,null,-7).rot(90);}else if(type=="thick"){icon=new zim.Shape();iconColor=icon.graphics.f(backgroundColor).command;var ps="AhFBdIiWAAIAAi4ICWAAIAAh7IEhDWIkhDXg";icon.p(ps).reg(-4);rollIcon=new zim.Shape().f(rollBackgroundColor).p(ps).reg(-4);}else if(type=="thin"){icon=new zim.Shape();iconColor=icon.graphics.f(backgroundColor).command;var ps="AhBCIIBZhbIjWAAIAAhVIDaAAIhdhfIA9g+IDDDFIAAAAIAAAAIjDDGg";icon.p(ps).reg(-4);rollIcon=new zim.Shape().f(rollBackgroundColor).p(ps).reg(-4);}else if(type=="angle"){icon=new zim.Shape();iconColor=icon.graphics.f(backgroundColor).command;var ps="AiNC5IC4i5Ii4i5IAxgxIDqDqIjqDrg";icon.p(ps).reg(-3);rollIcon=new zim.Shape().f(rollBackgroundColor).p(ps).reg(-3);}
this.zimButton_constructor(50,50,"",clear,clear,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,icon,rollIcon);this.type="Arrow";if(zot(pages)||pages.type!="Pages")return;var eventType=(!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click";var that=this;if(zot(pages.arrows))pages.arrows={};if(zot(pages.arrows[direction]))pages.arrows[direction]=[];pages.arrows[direction].push(this);this.activate=function(state,offColor){if(zot(state))state=true;if(zot(offColor))offColor=zim.grey();if(offColor===false)return;if(state){that.enabled=true;if(offColor!==false){if(type=="triangle")that.icon.color=that.arrowBackgroundColor;else iconColor.style=that.arrowBackgroundColor;}}else{that.enabled=false;if(offColor!==false){if(type=="triangle")that.icon.color=offColor;else iconColor.style=offColor;}}}
var next=getNext();if(!next){this.activate(false,pages.arrowDisableColor);}
function getNext(){var current=pages.pages[pages.index];if(!current||!current.swipe)return;var swipe=current.swipe;if(direction=="left")return swipe[0];else if(direction=="right")return swipe[1];else if(direction=="up")return swipe[2];else if(direction=="down")return swipe[3];}
var s=80
this.expand();this.on(eventType,function(){if(pages.transitioning)return;var next=getNext();if(!next)return;pages.go(next,direction,trans,speed);});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Arrow(backgroundColor,rollBackgroundColor,pages,direction,type,newPage,trans,speed,style,this.group,inherit));};};zim.extend(zim.Arrow,zim.Button,"clone","zimButton",false);zim.HotSpots=function(spots,local,mouseDowns){var sig="spots, local, mouseDowns";var duo;if(duo=zob(zim.HotSpots,arguments,sig,this))return duo;z_d("72");this.zimContainer_constructor(null,null,null,null,false);this.type="HotSpots";if(zot(local))local=true;if(zot(mouseDowns))mouseDowns=false;var eventType=(!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click";var that=this;var data;var hs;var hotSpots=that.hotSpots=[];if(zot(spots))spots=[];for(var i=0;i<spots.length;i++){addSpot(spots[i]);}
function addSpot(data){var button=null;if(!Array.isArray(data.rect)){button=data.rect;if(!button){zog("zim controls - HotSpots(): HotSpot "+data.page+" "+data.rect+" button does not exist");return;}
data.rect=[button.x,button.y,button.width||1,button.height||1];}
hs=new zim.HotSpot(data.page,data.rect[0],data.rect[1],data.rect[2],data.rect[3],data.call,data.callOver,data.callOut,local,data.talk);hs.zimHSpage=data.page;hs.button=button;hotSpots.push(hs);hs.on(eventType,hsEvent);if(button&&zot(data.callOver)&&zot(data.callOut)){hs.spot.mouseEnabled=false;hs.spot.mouseChildren=false;button.zimHScall=data.call;button.zimHSEvent=button.on(eventType,hsEvent,true);if(!mouseDowns){button.zimHSMDEvent=button.on("mousedown",function(e){e.stopImmediatePropagation();});}
button.cursor="pointer";}}
function hsEvent(e){if(e.stopImmediatePropagation)e.stopImmediatePropagation();if(window.event)window.event.cancelBubble=true;if(typeof(e.currentTarget.zimHScall)=="function"){e.currentTarget.zimHScall(e);}}
this.add=this.addHotSpot=function(page,rect,call,callOver,callOut,talk){data={page:page,rect:rect,call:call,callOver:callOver,callOut:callOut,talk:talk};spots.push(data);addSpot(data);};this.show=function(){for(var i=0;i<hotSpots.length;i++){hs=hotSpots[i];if(!hs.button)hs.spot.alpha=.2;}};this.hide=function(){for(var i=0;i<hotSpots.length;i++){hs=hotSpots[i];hs.spot.alpha=0;}};this.remove=this.removeHotSpots=function(page,rect){for(var i=spots.length-1;i>=0;i--){data=spots[i];hs=hotSpots[i];if(rect&&!Array.isArray(rect)){rect=[rect.x,rect.y,rect.getBounds().width,rect.getBounds().height];}
if((zot(page)&&zot(rect))||(zot(rect)&&page==data.page)||(zot(page)&&zim.arraysEqual(rect,data.rect))||(page==data.page&&zim.arraysEqual(rect,data.rect))){spots.splice(i,1);if(hs.button){hs.button.off(eventType,hs.button.zimHSEvent);hs.button.zimHSEvent=null;if(!mouseDowns){hs.button.off("mousedown",hs.button.zimHSMDEvent);hs.button.zimHSMDEvent=null;}}
hs.off(eventType,hsEvent);hs.dispose();hotSpots.splice(i,1);}}};this.dispose=function(a,b,disposing){for(var i=0;i<hotSpots.length;i++){hs=hotSpots[i];if(hs.button){hs.button.off(eventType,hs.button.zimHSEvent);hs.button.zimHSCall=null;hs.button.zimHSEvent=null;if(!mouseDowns){hs.button.off("mousedown",hs.button.zimHSMDEvent);hs.button.zimHSMDEvent=null;}}
hs.off(eventType,hsEvent);hs.dispose();}
return true;};};zim.extend(zim.HotSpots,zim.Container,"dispose","zimContainer",false);zim.HotSpot=function(obj,x,y,width,height,call,callOver,callOut,local,talk){var sig="obj, x, y, width, height, call, callOver, callOut, local, talk";var duo;if(duo=zob(zim.HotSpot,arguments,sig,this))return duo;z_d("73");this.zimContainer_constructor(null,null,null,null,false);this.type="HotSpot";if(zot(obj)||!obj.addChild){zog("zim controls - HotSpot():\nPlease pass in container object for obj");return;}
if(obj instanceof createjs.Container==false){zog("zim controls - HotSpot():\nObjects passed in should be Containers");return;}
if(zot(x)||zot(y)||zot(width)||zot(height)){zog("zim controls - HotSpot():\nPlease pass in x, y, width, height");return;}
if(zot(local))local=true;var eventType=(!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click";var w=width;var h=height;var that=this;if(!local){var point=obj.globalToLocal(x,y);var point2=obj.globalToLocal(x+w,y+h);var newW=point2.x-point.x;var newH=point2.y-point.y;}else{var point=new zim.Point(x,y);var newW=width;var newH=height;}
var but=new zim.Shape(width,height);but.talk=zot(talk)?"HotSpot":talk;but.alpha=0;but.graphics.f("black").dr(0,0,newW,newH);but.x=point.x;but.y=point.y;but.cursor="pointer";but.expand(0);this.spot=but;if(typeof(call)=="function"){var butEvent=but.on(eventType,function(e){call(e);});}
if(typeof(callOver)=="function"){var butOverEvent=but.on("mouseover",function(e){callOver(e);});}
if(typeof(callOut)=="function"){var butOutEvent=but.on("mouseout",function(e){callOut(e);});}
obj.addChild(but);this.show=function(){but.alpha=.5;if(obj.stage)obj.stage.update();};this.hide=function(){but.alpha=0;if(obj.stage)obj.stage.update();};this.dispose=function(a,b,disposing){if(butEvent)but.off(eventType,butOverEvent);if(butOverEvent)but.off("mouseover",butOverEvent);if(butOutEvent)but.off("mouseout",butOutEvent);obj.removeChild(but);but=null;return true;};};zim.extend(zim.HotSpot,zim.Container,"dispose","zimContainer",false);zim.Guide=function(obj,vertical,percent,hideKey,pixelKey,style,group,inherit){var sig="obj, vertical, percent, hideKey, pixelKey, style, group, inherit";var duo;if(duo=zob(zim.Guide,arguments,sig,this))return duo;z_d("76");this.zimContainer_constructor(null,null,null,null,false);this.type="Guide";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);var size;if(zot(obj))size=DS.obj!=null?DS.obj:null;if(zot(obj)){if(zdf){obj=zdf.stage;}else{obj="stage";}}
if(zot(vertical))vertical=DS.vertical!=null?DS.vertical:true;if(obj!="stage"&&(!obj.addChild||!obj.getBounds||!obj.getBounds())){zog("zim controls - Guide(): Please provide container with bounds for the obj (setBounds())");return;}
if(zot(percent))percent=DS.percent!=null?DS.percent:true;if(zot(hideKey))hideKey=DS.hideKey!=null?DS.hideKey:"G";if(zot(pixelKey))pixelKey=DS.pixelKey!=null?DS.pixelKey:"P";var that=this;var stageEvent;var boxW=80;var boxH=26;var minX=boxW/6+boxW/2;var minY=boxH*2;var maxX;var maxY;var box;if(vertical){box=makeBox("#00c5af","white","white");box.shape.regX=boxW+boxW/6;box.shape.regY=boxH/2;box.label.x=-boxW/2-boxW/6;}else{box=makeBox("#d61fa0","white","white");box.shape.regX=boxW/2;box.shape.regY=boxH+boxH/4;box.label.y=-boxH*3/4;}
function makeBox(fill,stroke,color){var box=new zim.Container({style:false});box.shape=new zim.Shape();box.shape.graphics.s(stroke).ss(1).f(fill).r(0,0,boxW,boxH);box.shape.alpha=.9;box.addChild(box.shape);box.label=new createjs.Text("10","16px arial",color);box.label.textAlign="center";box.label.textBaseline="middle";box.addChild(box.label);box.mouseChildren=false;box.mouseEnabled=false;return box;}
var stage;if(obj!="stage")obj.addChild(that);var addedInterval=zim.added(that,added);var guideCheck=false;var objW;var objH;var line;var dragBounds;function added(){if(obj=="stage"){stage=that.stage;obj=stage;}else{stage=obj.stage;}
obj.addChild(that);objW=obj.getBounds().width;objH=obj.getBounds().height;if(vertical){box.y=objH/2;box.label.text="x:"+((!that.percent)?Math.round(objW*70/100):"70%");}else{box.x=objW/2;box.label.text="y:"+((!that.percent)?Math.round(objH*70/100):"70%");}
line=new zim.Shape();that.addChild(line);(vertical)?line.x=objW*.7:line.y=objH*.7;if(!guideCheck){obj.addChild(that);drawGuide();}
stage.off("stagemousemove",stageEvent);stageEvent=stage.on("stagemousemove",where);stage.update();}
var lastPoint={x:0,y:0};function where(e){var point;var diff;if(e){point=obj.globalToLocal(e.rawX/zim.scaX,e.rawY/zim.scaY);lastPoint=point;}else{point={x:lastPoint.x,y:lastPoint.y};}
if(!percent){if(vertical){diff=Math.round(Math.abs(point.x-line.x));box.label.text="x:"+Math.max(0,Math.min(diff,Math.round(objW)));box.y=Math.max(minY,Math.min(point.y,maxY));}else{diff=Math.round(Math.abs(point.y-line.y));box.label.text="y:"+Math.max(0,Math.min(diff,Math.round(objH)));box.x=Math.max(minX,Math.min(point.x,maxX));}}else{if(vertical){diff=Math.round(Math.abs(point.x-line.x)/objW*100);box.label.text="x:"+Math.max(0,Math.min(diff,100))+"%";box.y=Math.max(minY,Math.min(point.y,maxY));}else{diff=Math.round(Math.abs(point.y-line.y)/objH*100);box.label.text="y:"+Math.max(0,Math.min(diff,100))+"%";box.x=Math.max(minX,Math.min(point.x,maxX));}}
if(stage)stage.update();}
function drawGuide(){guideCheck=true;objW=obj.getBounds().width;objH=obj.getBounds().height;var pointer;if(vertical){pointer="ew-resize";dragBounds=new createjs.Rectangle(0,0,objW,0);}else{pointer="ns-resize";dragBounds=new createjs.Rectangle(0,0,0,objH);}
zim.noDrag(line);setTimeout(function(){zim.drag(line,dragBounds,pointer,pointer,null,null,true);},500);stage.mouseMoveOutside=true;stage.enableMouseOver(10);maxX=objW-boxW*2/3;maxY=objH-boxH-boxH;line.uncache();var g=line.graphics;if(vertical){g.c().s("rgba(0,255,255,.1)").ss(20).mt(0,0).lt(0,objH);g.f().s("white").ss(2).mt(0,0).lt(0,objH);g.s("#00c5af").sd([20,20]).mt(0,0).lt(0,objH).sd();line.cache(-10,0,20,objH);}else{g.c().s("rgba(255,0,255,.1)").ss(20).mt(0,0).lt(objW,0);g.f().s("white").ss(2).mt(0,0).lt(objW,0);g.s("#d61fa0").sd([20,20]).mt(0,0).lt(objW,0).sd();line.cache(0,-10,objW,20);}
(vertical)?box.x=objW:box.y=objH;that.addChild(box);}
Object.defineProperty(this,'pixels',{get:function(){return!percent;},set:function(value){percent=!value;that.resize();}});window.addEventListener("keydown",keyEvent);function keyEvent(e){if(!e)e=event;if(!stage)return;if(String.fromCharCode(e.keyCode)==hideKey.toUpperCase()){that.toggle();}
if(String.fromCharCode(e.keyCode)==pixelKey.toUpperCase()){that.pixels=!that.pixels;}}
this.toggled=true;this.toggle=function(type){if(type===true){that.visible=that.toggled=true;}else if(type===false){that.visible=that.toggled=false;}else{that.visible=!that.visible;that.toggled=that.visible;}
if(stage){stage.off("stagemousemove",stageEvent);if(that.visible){stageEvent=stage.on("stagemousemove",where,that);}
stage.update();}
return that;};this.resize=function(){if(!that)return false;if(stage){drawGuide();where();}
return true;};if(style!==false)zim.styleTransforms(this,DS);this.dispose=function(a,b,disposing){if(!that)return false;zim.noDrag(line);clearInterval(addedInterval);that.removeAllChildren();window.removeEventListener("keydown",keyEvent);if(that.parent)that.parent.removeChild(that);that=null;return true;};};zim.extend(zim.Guide,zim.Container,"clone","zimContainer",false);zim.Grid=function(obj,color,percent,hideKey,pixelKey,allowToggle,cache,numbers,style,group,inherit){var sig="obj, color, percent, hideKey, pixelKey, allowToggle, cache, numbers, style, group, inherit";var duo;if(duo=zob(zim.Grid,arguments,sig,this))return duo;z_d("78");this.zimContainer_constructor(null,null,null,null,false);this.type="Grid";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);var size;if(zot(obj))size=DS.obj!=null?DS.obj:null;if(zot(obj)){if(zdf){obj=zdf.stage;}else{obj="stage";}}
if(zot(color))color=DS.color!=null?DS.color:"black";if(obj!="stage"&&(!obj.addChild||!obj.getBounds||!obj.getBounds())){zog("zim controls - Grid(): Please provide container with bounds for the obj (setBounds())");return;}
if(zot(percent))percent=DS.percent!=null?DS.percent:true;if(zot(hideKey))hideKey=DS.hideKey!=null?DS.hideKey:"G";if(zot(pixelKey))pixelKey=DS.pixelKey!=null?DS.pixelKey:"P";if(zot(allowToggle))allowToggle=DS.allowToggle!=null?DS.allowToggle:true;if(zot(cache))cache=DS.cache!=null?DS.cache:true;if(zot(numbers))numbers=DS.numbers!=null?DS.numbers:true;var that=this;var pixels=10;var stageEvent;this.mouseChildren=false;this.mouseEnabled=false;var boxW=80;var boxH=26;var top=that.numbersX=makeBox("#dddddd",color,"#333333");top.shape.regX=boxW/2;top.shape.regY=-boxH/4;top.label.y=boxH*3/4;var left=that.numbersY=makeBox("#dddddd",color,"#333333");left.shape.regX=-boxW/6;left.shape.regY=boxH/2;left.label.x=boxW/2+boxW/6;if(!numbers){top.visible=false;left.visible=false;}
function makeBox(fill,stroke,color){var box=new zim.Container({style:false});box.shape=new createjs.Shape();box.shape.graphics.s(stroke).ss(1).f(fill).r(0,0,boxW,boxH);box.shape.alpha=.9;box.addChild(box.shape);box.label=new createjs.Text("10","16px arial",color);box.label.textAlign="center";box.label.textBaseline="middle";box.addChild(box.label);box.mouseChildren=false;box.mouseEnabled=false;return box;}
var minX=boxW/6+boxW/2;var minY=boxH*2;var maxX;var maxY;top.x=minX;left.y=minY;top.label.text="x:0";left.label.text="y:0";var stage;if(obj!="stage")obj.addChild(that);var addedInterval=zim.added(that,added);var gridCheck=false;function added(){if(obj=="stage"){stage=that.stage;obj=stage;}else{stage=obj.stage;}
if(!gridCheck){drawGrid();obj.addChild(that);}
stage.off("stagemousemove",stageEvent);stageEvent=stage.on("stagemousemove",where);stage.update();}
var lastPoint={x:0,y:0};function where(e){var point;if(e){point=obj.globalToLocal(e.rawX/zim.scaX,e.rawY/zim.scaY);lastPoint=point;}else{point={x:lastPoint.x,y:lastPoint.y};}
if(!percent){top.label.text="x:"+Math.max(0,Math.min(Math.round(point.x),Math.round(objW)));top.x=Math.max(minX,Math.min(point.x,maxX));left.label.text="y:"+Math.max(0,Math.min(Math.round(point.y),Math.round(objH)));left.y=Math.max(minY,Math.min(point.y,maxY));}else{top.label.text="x:"+Math.max(0,Math.min(Math.round(point.x/objW*100),100))+"%";top.x=Math.max(minX,Math.min(point.x,maxX));left.label.text="y:"+Math.max(0,Math.min(Math.round(point.y/objH*100),100))+"%";left.y=Math.max(minY,Math.min(point.y,maxY));}
if(stage)stage.update();}
var objW;var objH;var cached;function drawGrid(){gridCheck=true;if(obj&&obj.getBounds){objW=obj.getBounds().width;objH=obj.getBounds().height;}
if(stage){stage.mouseMoveOutside=true;stage.enableMouseOver(10);}
maxX=objW-boxW*2/3;maxY=objH-boxH-boxH;cached=that.grid=new zim.Container({style:false});that.addChild(cached);var grid=new createjs.Shape();cached.addChild(grid);var g=grid.graphics;g.s(color).ss(1);var grid2=new createjs.Shape();cached.addChild(grid2);if(!percent){for(var i=0;i<objW/pixels;i++){g.mt(i*pixels,0).lt(i*pixels,objH);}
for(var i=0;i<objH/pixels;i++){g.mt(0,i*pixels).lt(objW,i*pixels);}
grid.alpha=.3;g=grid2.graphics;g.s(color).ss(1);for(var i=0;i<objW/(pixels*10);i++){g.mt(i*(pixels*10),0).lt(i*(pixels*10),objH);}
for(var i=0;i<objH/(pixels*10);i++){g.mt(0,i*(pixels*10)).lt(objW,i*(pixels*10));}}else{for(var i=1;i<20+1;i++){g.mt(i*objW/20,0).lt(i*objW/20,objH);}
for(var i=1;i<20;i++){g.mt(0,i*objH/20).lt(objW,i*objH/20);}
grid.alpha=.3;g=grid2.graphics;g.s(color).ss(1);for(var i=1;i<10;i++){g.mt(i*objW/10,0).lt(i*objW/10,objH);}
for(var i=1;i<10;i++){g.mt(0,i*objH/10).lt(objW,i*objH/10);}}
var crossSize=80;g.s("#FFFFFF").ss(8);g.mt(objW/2,objH/2-crossSize/2).lt(objW/2,objH/2+crossSize/2);g.mt(objW/2-crossSize/2,objH/2).lt(objW/2+crossSize/2,objH/2);g.s("#000000").ss(4);g.mt(objW/2,objH/2-crossSize/2).lt(objW/2,objH/2+crossSize/2);g.mt(objW/2-crossSize/2,objH/2).lt(objW/2+crossSize/2,objH/2);g.s(color).ss(cache?3:2);g.dr(0,0,objW,objH);grid2.alpha=.5;if(cache)cached.cache(0,0,objW,objH);that.addChild(top);that.addChild(left);if(stage)stage.update();}
Object.defineProperty(this,'pixels',{get:function(){return!percent;},set:function(value){percent=!value;that.resize();}});window.addEventListener("keydown",keyEvent);function keyEvent(e){if(!e)e=event;if(!stage||!allowToggle)return;if(String.fromCharCode(e.keyCode)==hideKey.toUpperCase()){that.toggle();}
if(String.fromCharCode(e.keyCode)==pixelKey.toUpperCase()){that.removeChild(cached);cached=null;that.pixels=!that.pixels;}}
this.toggled=true;this.toggle=function(type){if(type===true){that.visible=that.toggled=true;}else if(type===false){that.visible=that.toggled=false;}else{that.visible=!that.visible;that.toggled=that.visible;}
stage.off("stagemousemove",stageEvent);if(that.visible){stageEvent=stage.on("stagemousemove",where,that);}
if(stage)stage.update();return that;};this.resize=function(){if(!that)return false;that.removeChild(cached);cached=null;if(stage){drawGrid();where();setTimeout(function(){that.removeChild(cached);cached=null;drawGrid();},200);}
return true;};if(style!==false)zim.styleTransforms(this,DS);this.dispose=function(a,b,disposing){clearInterval(addedInterval);that.removeAllChildren();window.removeEventListener("keydown",keyEvent);if(that.parent)that.parent.removeChild(that);that=null;return true;};};zim.extend(zim.Grid,zim.Container,"clone","zimContainer",false);zim.Wrapper=function(items,width,spacingH,spacingV,wrapperType,align,valign,alignInner,valignInner,flip,reverse,bottomFull,colSize,rowSize,height,minSpreadNum,minStretchNum,percentVoidH,offsetVoidH,percentVoidV,offsetVoidV,style,group,inherit){var sig="items, width, spacingH, spacingV, wrapperType, align, valign, alignInner, valignInner, flip, reverse, bottomFull, colSize, rowSize, height, minSpreadNum, minStretchNum, percentVoidH, offsetVoidH, percentVoidV, offsetVoidV, style, group, inherit";var duo=null;if(duo=zob(zim.Wrapper,arguments,sig,this))return duo;z_d("78.5");this.group=group;var DS=style===false?{}:zim.getStyle("Wrapper",this.group,inherit);if(zot(width))width=DS.width!=null?DS.width:300;if(zot(height))height=DS.height!=null?DS.height:null;if(zot(spacingH))spacingH=DS.spacingH!=null?DS.spacingH:null;if(zot(spacingV))spacingV=DS.spacingV!=null?DS.spacingV:null;if(zot(wrapperType))wrapperType=DS.wrapperType!=null?DS.wrapperType:"spacing";if(zot(align))align=DS.align!=null?DS.align:"left";if(zot(valign))valign=DS.valign!=null?DS.valign:"top";if(zot(alignInner))alignInner=DS.alignInner!=null?DS.alignInner:"left";if(zot(valignInner))valignInner=DS.valignInner!=null?DS.valignInner:"bottom";if(zot(flip))flip=DS.flip!=null?DS.flip:false;if(zot(reverse))reverse=DS.reverse!=null?DS.reverse:false;if(zot(bottomFull))bottomFull=DS.bottomFull!=null?DS.bottomFull:false;if(zot(colSize))colSize=DS.colSize!=null?DS.colSize:100;if(zot(rowSize))rowSize=DS.rowSize!=null?DS.rowSize:null;if(zot(spacingH))spacingH=0;if(zot(spacingV))spacingV=0;if(zot(minSpreadNum))minSpreadNum=DS.minSpreadNum!=null?DS.minSpreadNum:2;if(zot(minStretchNum))minStretchNum=DS.minStretchNum!=null?DS.minStretchNum:3;if(zot(percentVoidH))percentVoidH=DS.percentVoidH!=null?DS.percentVoidH:0;if(zot(offsetVoidH))offsetVoidH=DS.offsetVoidH!=null?DS.offsetVoidH:0;if(zot(percentVoidV))percentVoidV=DS.percentVoidV!=null?DS.percentVoidV:0;if(zot(offsetVoidV))offsetVoidV=DS.offsetVoidV!=null?DS.offsetVoidV:0;var buildHeight=200;var totalSpacing=0;var averageSpacing=0;var lastSpacing=0;var widthVoid=width;this.items=[];var spread;var stretch;if(wrapperType=="spread")spread=true;else if(wrapperType=="stretch")stretch=true;this.zimContainer_constructor(width,buildHeight);this.type="Wrapper";if(align=="middle")align="center";if(valign=="middle")valign="center";if(alignInner=="middle")alignInner="center";if(valignInner=="middle")valignInner="center";var that=this;this.add=function(obj){this.addAt(obj,this.numChildren-1);return that;};this.addAt=function(obj,index){if(zot(obj))return that;if(zot(index)||index<0)index=0;if(!Array.isArray(obj))obj=[obj];zim.loop(obj,function(o,i){that.addChildAt(o,index+i);});that.resize();return that;};this.remove=function(obj){if(!Array.isArray(obj))obj=[obj];zim.loop(obj,function(o){if(o&&o.removeFrom)o.removeFrom();},true);that.resize();return that;};this.convert=function(container,cache){var all=[];container.loop(function(child){all.push(child);if(cache)child.cache();});that.add(all);container.removeFrom();return that;};this.resize=function(w,h){if(that.preventResize)return;if(!zot(w))width=w;if(!zot(h))height=h;this.items2D=[];this.items=[];totalSpacing=0;averageSpacing=0;lastSpacing=0;if(zot(percentVoidH))percentVoidH=0;if(zot(offsetVoidH))offsetVoidH=0;var pv=zim.Pick.choose(percentVoidH);var ov=zim.Pick.choose(offsetVoidH);widthVoid=width*(100-pv)/100;this.setBounds(widthVoid,buildHeight);var totalX=0;var totalY=0;var maxY=0;that.cols=0;that.rows=0;var currentCols=[];var heights=[0];var lastPoint=null;var lineObjectWidths=0;var b=null;var co=zim.Pick.choose(colSize);if(wrapperType!="column")co=null;var ro=zim.Pick.choose(rowSize);var colCount=0;zim.loop(this,function(o,i,t){if(bottomFull||flip){o.pos(totalX+(o.marginRight?o.marginRight:0),totalY+(o.marginTop?o.marginTop:0),zim.RIGHT,flip?zim.TOP:zim.BOTTOM);}else{o.pos(totalX+(o.marginLeft?o.marginLeft:0),totalY+(o.marginTop?o.marginTop:0));}
colCount++;b=o.boundsToGlobal();var pointTL=that.globalToLocal(b.x,b.y);var pointBR=that.globalToLocal(b.x+b.width,b.y+b.height);if(bottomFull||flip){var point=that.globalToLocal(b.x,b.y);}else{var point=that.globalToLocal(b.x+b.width,b.y+b.height);}
o.wrapHeight=pointBR.y-pointTL.y;o.wrapWidth=pointBR.x-pointTL.x;if(pv){var point2=that.globalToLocal(b.x+o.wrapWidth/2,b.y+o.wrapHeight/2);o.centerX=point2.x;o.centerY=point2.y;point2=null;}
if(co){var newX=co*colCount;}else{if(bottomFull||flip){var newX=widthVoid-point.x+(o.marginLeft?o.marginLeft:0)+spacingH;}else{var newX=point.x+(o.marginRight?o.marginRight:0)+spacingH;}}
if(Math.round(newX)-spacingH>widthVoid){alignObjects(currentCols,lastPoint,maxY,lineObjectWidths,co,pv,ov,false);lineObjectWidths=0;if(that.cols==0)that.cols=i;totalX=0;totalY+=maxY+(ro?0:zim.Pick.choose(spacingV));maxY=0;ro=zim.Pick.choose(rowSize);pv=zim.Pick.choose(percentVoidH);ov=zim.Pick.choose(offsetVoidH);colCount=0;that.items2D.push(zim.copy(currentCols));that.rows++;heights.push(totalY);currentCols=[];if(bottomFull||flip){o.pos(totalX+(o.marginRight?o.marginRight:0),totalY+(o.marginTop?o.marginTop:0),zim.RIGHT,flip?zim.TOP:zim.BOTTOM);}else{o.pos(totalX+(o.marginLeft?o.marginLeft:0),totalY+(o.marginTop?o.marginTop:0));}
if(pv){b=o.boundsToGlobal();point2=that.globalToLocal(b.x+o.wrapWidth/2,b.y+o.wrapHeight/2);o.centerX=point2.x;o.centerY=point2.y;point2=null;}
colCount++;if(co){newX=0;}else{newX=(o.marginLeft?o.marginLeft:0)+o.wrapWidth+(o.marginRight?o.marginRight:0)+zim.Pick.choose(spacingH);if(bottomFull||flip){point.x=widthVoid-((o.marginRight?o.marginRight:0)+o.wrapWidth);}else{point.x=(o.marginLeft?o.marginLeft:0)+o.wrapWidth;}}}
currentCols.push(o);lineObjectWidths+=o.wrapWidth;totalX=newX;if(ro){maxY=ro;}else{maxY=Math.max(maxY,o.wrapHeight+(o.marginTop?o.marginTop:0)+(o.marginBottom?o.marginBottom:0));}
lastPoint=new zim.Point(point.x,totalY+maxY);},(reverse&&bottomFull?false:reverse||bottomFull));if(that.numChildren>0){if(that.cols==0)that.cols=that.numChildren;that.items2D.push(zim.copy(currentCols));heights.push(totalY);alignObjects(currentCols,lastPoint,maxY,lineObjectWidths,co,pv,ov,true);that.rows+=1;}
var va=zim.Pick.choose(valign);if(zot(va))va="top";if(bottomFull){var diff=(totalY+maxY)-buildHeight;zim.loop(this,function(obj){obj.mov(0,diff);});that.items2D.reverse();zim.loop(that.items2D,function(rr){rr.reverse();});}
var perV=zim.Pick.choose(percentVoidV);var offV=zim.Pick.choose(offsetVoidV);if(!zot(perV)){if(zot(offV))offV=0;var totalHeight=totalY+maxY;var splitRowSize=totalHeight*perV/100;var splitRowStart=totalHeight/2+offV/100*totalHeight;zim.loop(heights,function(hh,i){if(hh>=splitRowStart){zim.loop(that.items2D,function(rr,j){zim.loop(rr,function(obj){obj.mov(0,splitRowSize);});},null,1,i);return"break";}});}
if(!zot(height)){if(valign=="bottom"){var diff=height-(totalY+maxY);zim.loop(this,function(obj){obj.mov(0,diff);});}else if(valign=="center"||valign=="middle"){var diff=(height-(totalY+maxY))/2;zim.loop(this,function(obj){obj.mov(0,diff);});}}
that.setBounds(null);var b=that.getBounds();if(b)that.setBounds(0,b.y,width,b.height);zim.loop(that.items2D,function(item){zim.loop(item,function(i){that.items.push(i);});});if(this.stage)this.stage.update();return that;};function alignObjects(objects,lastPoint,maxY,lineObjectWidths,co,pv,ov,dataEnd){var al=zim.Pick.choose(align);var sp=zim.Pick.choose(spread);var st=zim.Pick.choose(stretch);var fl=zim.Pick.choose(flip);var ai=zim.Pick.choose(alignInner);var vi=zim.Pick.choose(valignInner);if(zot(al))al="left";if(zot(vi))vi="top";if(zot(ai))ai="left";if(fl)objects.reverse();var voidThresh=((100-pv)/100/2+ov/100)*width;var voidMove=width*pv/100;var voidCheck=false;var am=0;var alignCheck=false;if(co){if(bottomFull||flip)objects.reverse();var gap=widthVoid%co;var voidLoc=widthVoid/2+ov/100*widthVoid;var added=0;var posit=0;var firstObjectsLength=Math.floor(widthVoid/co);if(that.rows!=0&&dataEnd)alignCheck=true;zim.loop(objects,function(obj,i){am=0;if(ai=="right")posit=co*i+added+co-obj.wrapWidth;else if(ai=="center"||ai=="middle")posit=co*i+added+(co-obj.wrapWidth)/2;else posit=co*i+added;var lastX=obj.x;obj.pos(posit);diffX=obj.x-lastX;obj.centerX+=diffX;if(obj.marginLeft)am+=obj.marginLeft;if(obj.marginRight)am-=obj.marginRight;if(al=="center"||al=="middle"){var missing=Math.floor(widthVoid/co)-objects.length;am+=(gap+(missing?missing*co:0))/2;}else if(al=="right"){var missing=Math.floor(widthVoid/co)-objects.length;am+=gap+(missing?missing*co:0);}
obj.mov(am);obj.centerX+=am;});if(al=="center"){if(alignCheck&&(objects.length+firstObjectsLength)%2!=0){am=(voidLoc<=widthVoid/2?-1:1)*co/2;zim.loop(objects,function(obj,i){obj.mov(am);obj.centerX+=am;});}}}else if(sp||st){if(sp)var spacing=objects.length?((widthVoid-lineObjectWidths)/(objects.length+1)):0;else if(st)var spacing=objects.length-1>0?((widthVoid-lineObjectWidths)/(objects.length-1)):0;if(objects.length<minStretchNum&&that.rows!=0&&dataEnd){spacing=lastSpacing;alignCheck=true;}
lastSpacing=spacing;var widthTotal=0;if(bottomFull||flip)objects.reverse();zim.loop(objects,function(obj,i,t){am=0;var lastX=obj.x;obj.pos(spacing*(i+(sp?1:0))+widthTotal);diffX=obj.x-lastX;obj.centerX+=diffX;if(!alignCheck){if(obj.marginLeft)am+=obj.marginLeft;if(obj.marginRight)am-=obj.marginRight;obj.mov(am);obj.centerX+=am;}
widthTotal+=obj.wrapWidth;});if(alignCheck){am=0;var totalShift=(sp?spacing:0);var diffX=0;zim.loop(objects,function(obj,i){if(al=="right"){var lastX=obj.x;obj.pos(totalShift,null,zim.RIGHT);diffX=obj.x-lastX;totalShift+=obj.wrapWidth+spacing;}else if(al=="center"){var centerShift=(widthVoid-(widthTotal+(objects.length-1)*spacing))/2-(sp?spacing:0);var lastX=obj.x;obj.pos(totalShift+centerShift,null,zim.RIGHT);diffX=obj.x-lastX;totalShift+=obj.wrapWidth+spacing;}
if(obj.marginLeft)am+=obj.marginLeft;if(obj.marginRight)am-=obj.marginRight;obj.mov(am);obj.centerX+=diffX+am;},true);}}else{if(al=="center"){zim.loop(objects,function(obj){am=((bottomFull||flip?0:width)-lastPoint.x)/2;if(sp||st){if(obj.marginLeft)am+=obj.marginLeft;if(obj.marginRight)am-=obj.marginRight;}
obj.mov(am);obj.centerX+=am;});}else if((bottomFull||flip)&&al=="left"){var extra=objects[objects.length-1].marginLeft;zim.loop(objects,function(obj){am=-lastPoint.x+(extra?extra:0);if(sp){am+=averageSpacing;}
obj.mov(am);obj.centerX+=am;});}else if(!(bottomFull||flip)&&al=="right"){var extra=objects[objects.length-1].marginRight;zim.loop(objects,function(obj){am=width-lastPoint.x-(extra?extra:0);if(sp){am-=averageSpacing;}
obj.mov(am);obj.centerX+=am;});}else if(sp){if(sp){zim.loop(objects,function(obj){am=averageSpacing*(al=="right"?-1:1);obj.mov(am);obj.centerX+=am;});}}}
if(pv){var voidThresh=(1/2+ov/100)*widthVoid;var voidMove=width*pv/100;zim.loop(objects,function(obj){if(co||st||sp){if(al=="right"){if(obj.centerX>widthVoid-voidThresh)obj.mov(voidMove);}else if(al=="center"){if(Math.round(obj.centerX)==Math.round(widthVoid/2+ov/100*widthVoid))obj.mov(voidMove/2);else if(Math.round(obj.centerX)>Math.round(widthVoid/2+ov/100*widthVoid))obj.mov(voidMove);}else{if(obj.centerX>voidThresh)obj.mov(voidMove);}}else if(!(bottomFull||flip)&&al=="right"){if(obj.centerX<width-voidThresh)obj.mov(-voidMove);}else if(!(bottomFull||flip)&&al=="center"){if(obj.centerX>width/2+ov/100*widthVoid)obj.mov(voidMove/2);else obj.mov(-voidMove/2);}else if((bottomFull||flip)&&al=="right"){if(obj.centerX>widthVoid-voidThresh)obj.mov(voidMove);}else if((bottomFull||flip)&&al=="center"){if(obj.centerX>widthVoid/2+ov/100*widthVoid)obj.mov(voidMove);}else{if(obj.centerX>voidThresh)obj.mov(voidMove);}});}
if(sp){totalSpacing+=spacing;averageSpacing=totalSpacing/(that.rows+1);}
if(vi=="center"){zim.loop(objects,function(obj){obj.mov(0,(maxY-obj.wrapHeight)/2*(bottomFull?-1:1));});}else if(!bottomFull&&vi=="bottom"){zim.loop(objects,function(obj){obj.mov(0,(maxY-obj.wrapHeight)-(obj.marginBottom?obj.marginBottom:0));});}else if(bottomFull&&vi=="top"){zim.loop(objects,function(obj){obj.mov(0,-(maxY-obj.wrapHeight)+(obj.marginTop?obj.marginTop:0));});}}
Object.defineProperty(that,'spacingH',{get:function(){return spacingH;},set:function(value){spacingH=value;this.resize();}});Object.defineProperty(that,'spacingV',{get:function(){return spacingV;},set:function(value){spacingV=value;this.resize();}});Object.defineProperty(that,'wrapperType',{get:function(){return wrapperType;},set:function(value){if(value=="spread")spread=true;else spread=false;if(value=="stretch")stretch=true;else stretch=false;wrapperType=value;this.resize();}});Object.defineProperty(that,'align',{get:function(){return align;},set:function(value){align=value;if(align=="middle")align="center";this.resize();}});Object.defineProperty(that,'valign',{get:function(){return valign;},set:function(value){valign=value;if(valign=="middle")valign="center";this.resize();}});Object.defineProperty(that,'alignInner',{get:function(){return alignInner;},set:function(value){alignInner=value;if(alignInner=="middle")alignInner="center";this.resize();}});Object.defineProperty(that,'valignInner',{get:function(){return valignInner;},set:function(value){valignInner=value;if(valignInner=="middle")valignInner="center";this.resize();}});Object.defineProperty(that,'colSize',{get:function(){return colSize;},set:function(value){colSize=value;if(wrapperType=="column")this.resize();}});Object.defineProperty(that,'rowSize',{get:function(){return rowSize;},set:function(value){rowSize=value;this.resize();}});Object.defineProperty(that,'flip',{get:function(){return flip;},set:function(value){flip=value;this.resize();}});Object.defineProperty(that,'reverse',{get:function(){return reverse;},set:function(value){reverse=value;this.resize();}});Object.defineProperty(that,'bottomFull',{get:function(){return bottomFull;},set:function(value){bottomFull=value;this.resize();}});Object.defineProperty(that,'percentVoidH',{get:function(){return percentVoidH;},set:function(value){percentVoidH=value;this.resize();}});Object.defineProperty(that,'offsetVoidH',{get:function(){return offsetVoidH;},set:function(value){offsetVoidH=value;this.resize();}});Object.defineProperty(that,'percentVoidV',{get:function(){return percentVoidV;},set:function(value){percentVoidV=value;this.resize();}});Object.defineProperty(that,'offsetVoidV',{get:function(){return offsetVoidV;},set:function(value){offsetVoidV=value;this.resize();}});if(!zot(items))that.add(items);if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){var r=that.cloneProps(new zim.Wrapper(items,width,spacingH,spacingV,wrapperType,align,valign,alignInner,valignInner,flip,reverse,bottomFull,colSize,rowSize,height,minSpreadNum,minStretchNum,percentVoidH,offsetVoidH,percentVoidV,offsetVoidV,this.style,this.group));return r;};};zim.extend(zim.Wrapper,zim.Container,"clone","zimContainer",false);zim.Tile=function(obj,cols,rows,spacingH,spacingV,unique,width,height,squeezeH,squeezeV,colSize,rowSize,align,valign,count,mirrorH,mirrorV,snapToPixel,clone,events,group,style,inherit){var sig="obj, cols, rows, spacingH, spacingV, unique, width, height, squeezeH, squeezeV, colSize, rowSize, align, valign, count, mirrorH, mirrorV, snapToPixel, clone, events, group, style, inherit";var duo;if(duo=zob(zim.Tile,arguments,sig,this))return duo;z_d("66.5");this.zimContainer_constructor(null,null,null,null,false);this.type="Tile";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(obj))obj=DS.obj!=null?DS.obj:new zim.Circle();if(zot(cols))cols=DS.cols!=null?DS.cols:1121;if(zot(rows))rows=DS.rows!=null?DS.rows:1121;var defaultFlag;if(cols==1121&&rows==1121)cols=rows=defaultFlag=3;else if(cols==1121)cols=1;else if(rows==1121)rows=1;if(zot(unique))unique=DS.unique!=null?DS.unique:false;if(zot(width))width=DS.width!=null?DS.width:null;if(zot(height))height=DS.height!=null?DS.height:null;if(zot(colSize))colSize=DS.colSize!=null?DS.colSize:null;if(zot(rowSize))rowSize=DS.rowSize!=null?DS.rowSize:null;if(!zot(width))colSize=null;if(!zot(height))rowSize=null;if(zot(spacingH))spacingH=DS.spacingH!=null?DS.spacingH:defaultFlag?3:null;if(zot(spacingV))spacingV=DS.spacingV!=null?DS.spacingV:defaultFlag?3:null;if(zot(spacingH)||!zot(colSize))spacingH=0;if(zot(spacingV)||!zot(rowSize))spacingV=0;if(zot(squeezeH))squeezeH=DS.squeezeH!=null?DS.squeezeH:false;if(zot(squeezeV))squeezeV=DS.squeezeV!=null?DS.squeezeV:false;if(zot(align))align=DS.align!=null?DS.align:"left";if(zot(valign))valign=DS.valign!=null?DS.valign:"top";if(zot(count))count=DS.count!=null?DS.count:(unique&&Array.isArray(obj))?obj.length:null;if(count===0){count=null;if(zon){zog("ZIM Tile() - count parameter of 0 is ignored - see docs");}}
if(zot(mirrorH))mirrorH=DS.mirrorH!=null?DS.mirrorH:false;if(zot(mirrorV))mirrorV=DS.mirrorV!=null?DS.mirrorV:false;if(zot(snapToPixel))snapToPixel=DS.snapToPixel!=null?DS.snapToPixel:true;if(snapToPixel){if(obj&&obj.stage)obj.stage.snapToPixelEnabled=true;else if(typeof(elem)!=='undefined'&&zdf)zdf.stage.snapToPixelEnabled=true;}
if(zot(clone))clone=DS.clone!=null?DS.clone:unique?false:true;if(zot(events))events=DS.events!=null?DS.events:true;var that=this;that.cols=cols=Math.round(cols);that.rows=rows=Math.round(rows);that.spacingH=spacingH;that.spacingV=spacingV;that.squeezeH=squeezeH;that.squeezeV=squeezeV;var VEEAlign=(typeof align=="function");var VEEVAlign=(typeof valign=="function");that.align=VEEAlign?"left":align;that.valign=VEEVAlign?"top":valign;that.mirrorH=mirrorH;that.mirrorV=mirrorV;that.items=[];var tile;var currentCount=0;outer:for(var j=0;j<rows;j++){for(var i=0;i<cols;i++){currentCount++;if(!zot(count)&&currentCount>count)break outer;tile=unique?obj[currentCount-1]:zim.Pick.choose(obj);if(typeof tile=="string")tile=window.asset(tile).centerReg({add:false}).clone();if(zot(tile)){tile=new zim.Container(0,0,0,0);}
if(clone){if((j!=0||i!=0))tile=tile.clone();}
if(events){tile.on("change",function(e){var evt=new createjs.Event("change");evt.item=e.currentTarget;that.dispatchEvent(evt);});}
that.items.push(tile);tile.tileNum=currentCount-1;tile.tileCol=i;tile.tileRow=j;}}
var objects;var widthTotals;var heightTotals;var widthMax;var heightMax;var widthTotalMax;var heightTotalMax;var widthUncompressedMax;var heightUncompressedMax;var scalesX;var scalesY;var rowCounts;var finalAlign;var widthHeights;function makeTile(){that.removeAllChildren();objects=[];widthTotals=[];heightTotals=[];widthMax=[];heightMax=[];widthTotalMax=0;heightTotalMax=0;widthUncompressedMax=0;heightUncompressedMax=0;scalesX=[];scalesY=[];rowCounts=[];widthHeights=[];finalAlign=[];if(!that.items||!that.items.length)that.items=[];count=that.items.length;var currentCount=0;var tile;var j=0;var k=0;var h;var w;for(var i=0;i<count;i++){j=Math.floor(i/that.cols);k=i%that.cols;if(zot(objects[j]))objects[j]=[];if(zot(that.items[i]))that.items[i]=new zim.Container(0,0,0,0);objects[j][k]=that.items[i];}
that.rows=Math.max(1,objects.length);that.cols=Math.max(1,!zot(objects[0])?objects[0].length:0);outer2:for(var j=0;j<that.rows;j++){scalesX.push([]);scalesY.push([]);widthHeights.push([]);if(rowSize&&zot(height))h=zim.Pick.choose(rowSize);for(var i=0;i<that.cols;i++){currentCount++;if(!zot(count)&&currentCount>count)break outer2;tile=objects[j][i];tile.snapToPixel=snapToPixel;that.addChild(tile);scalesX[j].push(tile.scaleX);scalesY[j].push(tile.scaleY);if(j==0&&(colSize&&zot(width)))w=zim.Pick.choose(colSize);if(j==0)finalAlign.push(zim.Pick.choose(align));if(!colSize||!zot(width))w=Math.abs(tile.width);if(!rowSize||!zot(height))h=Math.abs(tile.height);widthHeights[j][i]=[w,h];if(zot(widthMax[i]))widthMax[i]=0;if(zot(heightMax[j]))heightMax[j]=0;if(w>widthMax[i])widthMax[i]=w;if(h>heightMax[j])heightMax[j]=h;if(zot(widthTotals[j]))widthTotals[j]=0;if(zot(heightTotals[i]))heightTotals[i]=0;widthTotals[j]+=w;heightTotals[i]+=h;if(widthTotals[j]>widthTotalMax)widthTotalMax=widthTotals[j];if(heightTotals[i]>heightTotalMax)heightTotalMax=heightTotals[i];if(zot(rowCounts[i]))rowCounts[i]=0;rowCounts[i]++;}}
if(that.squeezeH===false){for(var i=0;i<widthMax.length;i++){var val=widthMax[i];widthUncompressedMax+=val;}}
if(that.squeezeV===false){for(var i=0;i<heightMax.length;i++){var val=heightMax[i];heightUncompressedMax+=val;}}}
makeTile();var overallWidth;var overallHeight;var rowTotals;var rowSpacings;function resize(width,height){if(width<=0)width=null;if(height<=0)height=null;if(!zot(width)&&that.squeezeH=="full"){overallWidth=width;}else if(!zot(width)){overallWidth=Math.max(widthTotalMax+(that.cols-1)*that.spacingH,width);}else{if(widthUncompressedMax>0)overallWidth=widthUncompressedMax+(that.cols-1)*that.spacingH;else overallWidth=widthTotalMax+(that.cols-1)*that.spacingH;}
if(!zot(height)&&that.squeezeV=="full"){overallHeight=height;}else if(!zot(height)){overallHeight=Math.max(heightTotalMax+(that.rows-1)*that.spacingV,height);}else{if(heightUncompressedMax>0)overallHeight=heightUncompressedMax+(that.rows-1)*that.spacingV;else overallHeight=heightTotalMax+(that.rows-1)*that.spacingV;}
that.setBounds(0,0,overallWidth,overallHeight);var rowObjects;var colTotal;rowTotals=[];rowSpacings=[];var rowTops=[];var rowTilesTotalWidth;for(j=0;j<objects.length;j++){rowObjects=objects[j];colTotal=0;if(!zot(width)){rowTilesTotalWidth=0;}
for(i=0;i<rowObjects.length;i++){tile=rowObjects[i];var b;var left;var top;var spreadXspacing;var spreadYspacing;if(j==0){rowTotals[i]=0;if(!zot(height)){if(that.squeezeV=="full"){rowSpacings[i]=rowCounts[i]>1?((height-heightTotals[i])/(rowCounts[i]-1)):0;}else if(that.squeezeV){rowSpacings[i]=rowCounts[i]>1?Math.max(that.spacingV,(height-heightTotals[i])/(rowCounts[i]-1)):0;}else{rowSpacings[i]=rowCounts[i]>1?Math.max(that.spacingV,(overallHeight-heightTotals[i])/(rowCounts[i]-1)):0;}}
if(that.squeezeV){if(that.valign=="center"||that.valign=="middle"){rowTops[i]=(overallHeight-(heightTotals[i]+(rowCounts[i]-1)*(!zot(height)?rowSpacings[i]:that.spacingV)))/2;}else if(that.valign=="bottom"){rowTops[i]=overallHeight-(heightTotals[i]+(rowCounts[i]-1)*(!zot(height)?rowSpacings[i]:that.spacingV));}else{rowTops[i]=0;}}else{rowTops[i]=0;}}
b=tile.getBounds();if(i==0){if(!zot(width)){if(that.squeezeH=="full"){spreadXspacing=rowObjects.length>1?((width-widthTotals[j])/(rowObjects.length-1)):0;}else if(that.squeezeH){spreadXspacing=rowObjects.length>1?Math.max(that.spacingH,(width-widthTotals[j])/(rowObjects.length-1)):0;}else{spreadXspacing=rowObjects.length>1?Math.max(that.spacingH,(overallWidth-widthTotals[j])/(rowObjects.length-1)):0;}}
if(that.squeezeH){if(that.align=="center"||that.align=="middle"){left=(overallWidth-(widthTotals[j]+(rowObjects.length-1)*(!zot(width)?spreadXspacing:that.spacingH)))/2;}else if(that.align=="right"){left=overallWidth-(widthTotals[j]+(rowObjects.length-1)*(!zot(width)?spreadXspacing:that.spacingH));}else{left=0;}}else{left=0;}
var finalVAlign=zim.Pick.choose(valign);}
align=finalAlign[i];var w=widthHeights[j][i][0];var h=widthHeights[j][i][1];if(that.mirrorH&&i%2==1){tile.scaleX=-scalesX[j][i];}else{}
tile.pos(colTotal,null);if(!that.squeezeH&&VEEAlign){if(zot(width)&&(align=="center"||align=="middle")){tile.x+=(widthMax[i]-tile.width)/2;}else if(zot(width)&&align=="right"){tile.x+=widthMax[i]-tile.width;}}else if(!that.squeezeH){if(zot(width)&&(that.align=="center"||that.align=="middle")){tile.x+=(widthMax[i]-tile.width)/2;}else if(zot(width)&&that.align=="right"){tile.x+=widthMax[i]-tile.width;}}else{if(zot(width)&&(that.align=="center"||that.align=="middle")){tile.x+=(w-tile.width)/2;}else if(zot(width)&&that.align=="right"){tile.x+=w-tile.width;}}
if(that.mirrorV&&j%2==1){tile.scaleY=-scalesY[j][i];}else{}
tile.pos(null,rowTotals[i]);if(!that.squeezeV&&VEEVAlign){if(zot(height)&&(finalVAlign=="center"||finalVAlign=="middle")){tile.y+=(heightMax[j]-tile.height)/2;}else if(zot(height)&&finalVAlign=="bottom"){tile.y+=heightMax[j]-tile.height;}}else if(!that.squeezeV){if(zot(height)&&(that.valign=="center"||that.valign=="middle")){tile.y+=(heightMax[j]-tile.height)/2;}else if(zot(height)&&that.valign=="bottom"){tile.y+=heightMax[j]-tile.height;}}else{if(zot(height)&&(that.valign=="center"||that.valign=="middle")){tile.y+=(h-tile.height)/2;}else if(zot(height)&&that.valign=="bottom"){tile.y+=h-tile.height;}}
if(that.squeezeH===true||!zot(width)){colTotal+=w+(!zot(width)?spreadXspacing:that.spacingH);}else{colTotal+=widthMax[i]+(!zot(width)?spreadXspacing:that.spacingH);}
tile.x+=left;tile.y+=rowTops[i];if(that.squeezeV===true||!zot(height)){rowTotals[i]+=h+(!zot(height)?rowSpacings[i]:that.spacingV);}else{rowTotals[i]+=heightMax[j]+(!zot(height)?rowSpacings[i]:that.spacingV);}}}}
resize(width,height);this.itemUnderPoint=function(x,y,ignoreSpacing){if(zot(ignoreSpacing))ignoreSpacing=true;if(zot(x)||zot(y))return;var point=that.globalToLocal(x,y);x=point.x;y=point.y;var wT=0;var co=zim.loop(widthMax,function(w,i){wT+=w+that.spacingH;if(!ignoreSpacing||ignoreSpacing=="vertical"){if(x>wT-that.spacingH&&x<wT)return false;}
if(x<wT-that.spacingH/2)return i;});if(co===false)return;if(co===true)co=cols-1;if(x<0||x>overallWidth||y<0||y>overallHeight)return;var hT=0;var ro=zim.loop(heightMax,function(h,j){var ss=!zot(height)?rowSpacings[i]:that.spacingV;if(!ignoreSpacing||ignoreSpacing=="horizontal"){if(y>hT-ss&&y<hT)return false;}
hT+=h+ss;if(y<hT-ss/2)return j;});if(ro===false)return;if(ro===true)ro=rows-1;return that.items2D[ro][co];};this.remake=function(items){if(!zot(items))that.items=items;makeTile();resize(width,height);return that;};this.resize=function(w,h){if(zot(w))w=width;if(zot(h))h=height;width=w;height=h;resize(w,h);return that;};function get2D(array){var nested=[];var inner;for(var i=0;i<array.length;i++){if(i%that.cols==0){inner=[];nested.push(inner);}
inner.push(array[i]);}
return nested;}
function get2DCols(array){var nested=[];var inner;for(var i=0;i<that.cols;i++){nested.push([]);}
for(var i=0;i<array.length;i++){nested[i%that.cols][Math.floor(i/that.cols)]=array[i];}
return nested;}
Object.defineProperty(this,"items2D",{get:function(){return get2D(that.items);},set:function(val){if(zon)zogy("Tile() - items2D is read only");}});Object.defineProperty(this,"items2DCols",{get:function(){return get2DCols(that.items);},set:function(val){if(zon)zogy("Tile() - items2DCols is read only");}});Object.defineProperty(this,"current",{get:function(){var items=[];var tileWidth=(that.width-(that.cols-1)*that.spacingH)/that.cols;var tileHeight=(that.height-(that.rows-1)*that.spacingV)/that.rows;zim.loop(that.items,function(t){var b=t.getBounds();var x=t.x-t.regX+b.x+b.width/2;var y=t.y-t.regY+b.y+b.height/2;var index=that.hitTestGrid(that.width,that.height,that.cols,that.rows,x,y,null,null,that.spacingH,that.spacingV,true,"open");if(index!=null)items[index[0]]=t;});return items;},set:function(val){if(zon)zogy("Tile() - current is read only");}});Object.defineProperty(this,"current2D",{get:function(){return get2D(that.current);},set:function(val){if(zon)zogy("Tile() - current2D is read only");}});Object.defineProperty(this,"current2DCols",{get:function(){return get2DCols(that.current);},set:function(val){if(zon)zogy("Tile() - current2DCols is read only");}});if(style!==false)zim.styleTransforms(this,DS);this.clone=function(exact){if(exact){var exactItems=[];for(var i=0;i<that.items.length;i++){exactItems.push(that.items[i].clone(true));}}
return that.cloneProps(new zim.Tile(exact?zim.series(exactItems):(obj.clone?obj.clone():obj),that.cols,that.rows,that.spacingH,that.spacingV,unique,width,height,that.squeezeH,that.squeezeV,colSize,rowSize,align,valign,that.items.length,that.mirrorH,that.mirrorV,snapToPixel,exact?false:clone,events,this.style,this.group));};};zim.extend(zim.Tile,zim.Container,"clone","zimContainer",false);zim.Beads=function(path,obj,count,angle,startPercent,endPercent,percents,onTop,showControls,visible,interactive,clone,group,style,inherit){var sig="path, obj, count, angle, startPercent, endPercent, percents, onTop, showControls, visible, interactive, clone, group, style, inherit";var duo;if(duo=zob(zim.Beads,arguments,sig,this))return duo;z_d("66.7");this.zimContainer_constructor(null,null,null,null,false);this.type="Beads";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(onTop))onTop=DS.onTop!=null?DS.onTop:false;if(zot(showControls))showControls=DS.showControls!=null?DS.showControls:false;if(zot(visible))visible=DS.visible!=null?DS.visible:true;if(zot(interactive))interactive=DS.interactive!=null?DS.interactive:true;if(zot(path))path=DS.path!=null?DS.path:new zim.Blob({color:null,borderWidth:3,borderColor:zim.blue});path.visible=visible;path.interactive=interactive;path.toggle(showControls);path.onTop=onTop;if(zot(obj))obj=DS.obj!=null?DS.obj:new zim.Circle(10);if(zot(count))count=DS.count!=null?DS.count:10;if(zot(angle))angle=DS.angle!=null?DS.angle:null;if(zot(startPercent))startPercent=DS.startPercent!=null?DS.startPercent:0;if(zot(endPercent))endPercent=DS.endPercent!=null?DS.endPercent:100;if(zot(percents))percents=DS.percents!=null?DS.percents:null;var projectedEndPercent=endPercent;if(endPercent<startPercent)projectedEndPercent=100+endPercent;if(zot(percents)){var percent;if(path.type=="Squiggle"){percent=(projectedEndPercent-startPercent)/(count-1);}else{percent=(projectedEndPercent-startPercent)/(count-(startPercent!=projectedEndPercent%100?1:0));}
percents=[];var lastPercent=startPercent-percent;for(var i=0;i<count;i++){percents.push(lastPercent+percent);lastPercent+=percent;if(lastPercent>100)lastPercent-=100;}}
if(zot(clone))clone=DS.clone!=null?DS.clone:true;var that=this;that.count=count;that.percents=percents;that.items=[];var item;for(var i=0;i<count;i++){item=zim.Pick.choose(obj);if(clone){if(i!=0)item=item.clone();}
item.beadNum=i;item.startPercent=percents[i];that.items.push(item);}
that.path=path.addTo(that);that.beads=new zim.Container().addTo(that,onTop?0:null);that.beads.type="BeadsContainer";this.resize=function(){var segmentRatios=path.segmentRatios;var segmentPoints=path.segmentPoints;for(var i=0;i<that.count;i++){var point=path.getCurvePoint(Math.max(0,Math.min(.9999,percents[i]/100)),segmentRatios,segmentPoints,true);if(!point)continue;var locPoint=that.beads.globalToLocal(point.x,point.y);if(!locPoint)continue;that.items[i].loc(locPoint,null,that.beads).rot((zot(angle)?(point.angle>180?(point.angle-360):point.angle):angle)+that.items[i].rotation);}
return this;};that.resize();if(interactive){path.on("pressmove",that.resize);path.on("update",that.resize);}
if(style!==false)zim.styleTransforms(this,DS);this.dispose=function(disposing){if(!disposing)this.zimContainer_dispose(true);that.items=[];return true;}
this.clone=function(exact){if(exact){var exactItems=[];for(var i=0;i<that.items.length;i++){exactItems.push(that.items[i].clone(true));}}
return that.cloneProps(new zim.Beads(path.clone(),exact?zim.series(exactItems):(obj.clone?obj.clone():obj),that.count,angle,startPercent,endPercent,percents,onTop,showControls,visible,interactive,clone,this.style,this.group));};};zim.extend(zim.Beads,zim.Container,["clone","dispose"],"zimContainer",false);zim.Layout=function(holder,regions,lastMargin,lastMarginMin,backgroundColor,vertical,showRegions,scalingObject,hideKey,style,group,inherit){var sig="holder, regions, lastMargin, lastMarginMin, backgroundColor, vertical, showRegions, scalingObject, hideKey, style, group, inherit";var duo;if(duo=zob(zim.Layout,arguments,sig,this))return duo;z_d("80");this.cjsEventDispatcher_constructor();this.type="Layout";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(holder))holder=DS.holder!=null?DS.holder:null;if(zot(scalingObject))scalingObject=DS.scalingObject!=null?DS.scalingObject:null;if(zot(holder)||!holder.getBounds){zog("zim controls - Layout(): please provide an object with bounds set that holds the objects being laid out");return;}
scalingObject=(zot(scalingObject))?holder:scalingObject;if(!scalingObject.getBounds||!scalingObject.getBounds()){zog("zim controls - Layout(): holder must have bounds set or provide a scalingObject with bounds");return;}
var bounds=scalingObject.getBounds();holder.setBounds(0,0,bounds.width,bounds.height);if(zot(lastMargin))lastMargin=DS.lastMargin!=null?DS.lastMargin:0;if(zot(lastMarginMin))lastMarginMin=DS.lastMarginMin!=null?DS.lastMarginMin:0;if(zot(vertical))vertical=DS.vertical!=null?DS.vertical:true;if(zot(backgroundColor))backgroundColor=DS.backgroundColor!=null?DS.backgroundColor:"";if(zot(hideKey))hideKey=DS.hideKey!=null?DS.hideKey:"B";if(zot(showRegions))showRegions=DS.showRegions!=null?DS.showRegions:null;var regionShape;if(showRegions)regionShape=new zim.Shape();var backing=this.backing=new zim.Shape();var that=this;this.active=true;if(zot(regions))regions=DS.regions!=null?zim.copy(DS.regions):null;if(zot(regions))return;zim.loop(regions,function(r,i){if(r instanceof createjs.DisplayObject)regions[i]={object:r};});this.regions=regions;var r;var totalAbsolute=0;var minPrimary="minWidth";var primary="width";var secondary="height";var marginPrimary="marginLeft";var marginMinPrimary="marginMinLeft";var maxSecondary="maxHeight";var axisPrimary="x";var axisSecondary="y";if(vertical){minPrimary="minHeight";primary="height";secondary="width";marginPrimary="marginTop";marginMinPrimary="marginMinTop";maxSecondary="maxWidth";axisPrimary="y";axisSecondary="x";}
var autoMargins=[];var autoCount=0;for(var i=0;i<regions.length;i++){r=regions[i];if(!r.object||!r.object.getBounds()){zogy("Layout(): each region object must have an object with setBounds() set");return;}
if(!r[minPrimary])r[minPrimary]=0;if(!r[primary])r[primary]=0;if(!r.backgroundColor)r.backgroundColor="";r.given=0;r.maxGiven=0;if(r[marginPrimary]=="auto"){autoMargins[i]=true;autoCount++;if(r[marginMinPrimary])r[marginPrimary]=r[marginMinPrimary];else delete r[marginPrimary];}else if(r[marginPrimary]&&r[marginMinPrimary]&&r[marginPrimary]<r[marginMinPrimary]){r[marginPrimary]=r[marginMinPrimary];}
if(zot(r[marginPrimary]))r[marginPrimary]=.0001;if(!r[maxSecondary])r[maxSecondary]=100;if(vertical){if(!r.align)r.align="middle";if(!r.valign){if(i==0){r.valign="top";}
else if(i==regions.length-1){r.valign="bottom";}
else{r.valign="middle";}
if(regions.length==1){r.valign="middle";}}}else{if(!r.valign)r.valign="top";if(!r.align){if(i==0){r.align="left";}
else if(i==regions.length-1){r.align="right";}
else{r.align="middle";}
if(regions.length==1){r.align="middle";}}}
if(r[primary])r[minPrimary]=0;totalAbsolute+=r[primary]+r[marginPrimary];}
if(lastMargin=="auto"){autoMargins[regions.length]=true;lastMargin=lastMarginMin?lastMarginMin:0}else{if(lastMargin&&lastMarginMin&&lastMargin<lastMarginMin)lastMargin=lastMarginMin;}
totalAbsolute+=lastMargin;if(totalAbsolute>100){zogy("Layout(): cannot fit regions into 100% bounds");return;}
var leftOverPrimary=100-totalAbsolute;distribute();function distribute(){var totalPrimaries=0;for(var i=0;i<regions.length;i++){r=regions[i];r.given=0;if(r[primary]==0)totalPrimaries+=r.object.getBounds()[primary];}
for(var i=0;i<regions.length;i++){r=regions[i];if(r[primary]==0)r.given=r.object.getBounds()[primary]/totalPrimaries*leftOverPrimary;}}
this.resize=function(){if(!that.active)return;bounds=scalingObject.getBounds();holder.setBounds(0,0,bounds.width,bounds.height);backing.graphics.clear();if(backgroundColor!=""){processColor(backing,backgroundColor);backing.graphics.r(0,0,bounds.width,bounds.height);}
for(var i=0;i<regions.length;i++){r=regions[i];r.maxGiven=0;r.marginGiven=0;}
var keepGoing=true;var allCheck;var giveBack;var p;var s;var boundsP;var boundsS;var maxGiven;var leftOverPrimary2=leftOverPrimary;while(keepGoing){giveBack=0;keepGoing=false;allCheck=true;for(var i=0;i<regions.length;i++){r=regions[i];if(r.given>0&&r.maxGiven==0){p=r.object.getBounds()[primary];s=r.object.getBounds()[secondary];boundsP=r.given*bounds[primary]/100;boundsS=r[maxSecondary]*bounds[secondary]/100;maxGiven=s/p*boundsP;if(maxGiven>boundsS&&r.object.type!="Window"){r.maxGiven=p/s*boundsS*100/bounds[primary];giveBack+=r.given-r.maxGiven;leftOverPrimary2-=r.maxGiven;}else{allCheck=false;}}}
if(allCheck)break;var totalPrimaries=0;for(var i=0;i<regions.length;i++){r=regions[i];if(r[primary]==0&&r.maxGiven==0)totalPrimaries+=r.object.getBounds()[primary];}
for(var i=0;i<regions.length;i++){r=regions[i];if(r[primary]==0&&r.maxGiven==0)r.given=r.object.getBounds()[primary]/totalPrimaries*leftOverPrimary2;}}
var scaleCheck=true;r=regions[0];if(r.maxGiven>0){if(r.maxGiven<r[minPrimary]){r[primary]=r[minPrimary];scaleCheck=false;}}else if(r.given>0){if(r.given<r[minPrimary]){r[primary]=r[minPrimary];scaleCheck=false;}}
r=regions[regions.length-1];if(r.maxGiven>0){if(r.maxGiven<r[minPrimary]){r[primary]=r[minPrimary];scaleCheck=false;}}else if(r.given>0){if(r.given<r[minPrimary]){r[primary]=r[minPrimary];scaleCheck=false;}}
if(!scaleCheck){totalAbsolute=0;for(var i=0;i<regions.length;i++){r=regions[i];totalAbsolute+=r[primary]+r[marginPrimary];}
totalAbsolute+=lastMargin;if(totalAbsolute>100){zog("zim display - Layout(): cannot fit regions into 100% bounds");return;}
leftOverPrimary=100-totalAbsolute;distribute();that.resize();return;}
var allHeights=true;var marginTotal=0;var primaryTotal=0;for(var i=0;i<regions.length;i++){r=regions[i];marginTotal+=r[marginPrimary];if(r[primary]>0)primaryTotal+=r[primary];else if(r.maxGiven>0)primaryTotal+=r.maxGiven;else if(r.given>0)primaryTotal+=r.given;if(r[primary]==0){allHeights=false;}}
if(allHeights||allCheck){marginTotal+=lastMargin;var extra=100-primaryTotal-marginTotal;marginTotal-=(lastMargin+regions[0][marginPrimary]);if(extra!=0&&marginTotal!=0){for(var i=0;i<regions.length;i++){if(i==0)continue;r=regions[i];r.marginGiven=r[marginPrimary]/marginTotal*(marginTotal+extra);}}}
if(autoCount>0){var totP=0;var tot=0;for(var i=0;i<regions.length;i++){r=regions[i];if(r.marginGiven>0)tot+=r.marginGiven;else tot+=r[marginPrimary];r.marginGiven=0;totP+=r[marginPrimary]>.05?r[marginPrimary]:0}
var diff=(tot-totP)/autoCount;for(i=0;i<autoMargins.length;i++){if(autoMargins[i]&&regions[i]){r=regions[i];r.marginGiven=(r[marginMinPrimary]?r[marginMinPrimary]:0)+diff;}}}
var pPos=0;var sPos=0;var p;var s;var f;var addedW;var addedH;if(regionShape&&regionShape.graphics){var g=regionShape.graphics;g.c();}
for(var i=0;i<regions.length;i++){r=regions[i];if(r.marginGiven>0)pPos+=r.marginGiven*bounds[primary]/100;else pPos+=r[marginPrimary]*bounds[primary]/100;if(r[primary]>0){p=r[primary];}
else if(r.maxGiven>0){p=r.maxGiven;}
else if(r.given>0){p=r.given;}
else{p=0;}
p=p*bounds[primary]/100;s=r[maxSecondary]*bounds[secondary]/100;sPos=(bounds[secondary]-s)/2;if(vertical){if(r.object.type=="Wrapper")r.object.resize(s);if(r.object.type=="Window")r.object.resize(s,p);if(r.object.type=="Region")r.object.setBounds(s,p);f=zim.fit(r.object,sPos,pPos,s,p);}else{if(r.object.type=="Wrapper")r.object.resize(p);if(r.object.type=="Window")r.object.resize(p,s);if(r.object.type=="Region")r.object.setBounds(p,s);f=zim.fit(r.object,pPos,sPos,p,s);}
if(r.valign=="top")r.object.y=f.bY;else if(r.valign=="bottom")r.object.y=f.bY+f.bHeight-f.height;if(r.align=="left")r.object.x=f.bX;else if(r.align=="right")r.object.x=f.bX+f.bWidth-f.width;if(regionShape&&regionShape.graphics){g.s("white").ss(2).r(f.bX,f.bY,f.bWidth,f.bHeight);g.s("#ff8203").sd([20,20]).r(f.bX,f.bY,f.bWidth,f.bHeight).sd();}
addedH=addedW=0;if(pPos==0||(pPos+p)==bounds[primary])if(vertical){addedH=1;}else{addedW=1;}
if(s==bounds[secondary])if(vertical){addedW=1;}else{addedH=1;}
if(r.backgroundColor!=""){processColor(backing,r.backgroundColor);backing.graphics.r(f.bX,f.bY,f.bWidth+addedW,f.bHeight+addedH);}
pPos+=p;if(r.object.ZIMoutlineShape)r.object.outline();}};function processColor(shape,co){if(co.type=="GradientColor")shape.graphics.lf(co.colors,co.ratios,co.x0,co.y0,co.x1,co.y1);else if(co.type=="GradientColor")shape.graphics.rf(co.colors,co.ratios,co.x0,co.y0,co.r0,co.x1,co.y1,co.r1);else if(co.type=="BitmapColor")shape.graphics.bf(co.image,co.repetition,co.matrix);else shape.graphics.f(r.backgroundColor);}
this.resize();if(regionShape)holder.addChild(regionShape);holder.addChildAt(backing,0);window.addEventListener("keydown",keyEvent);function keyEvent(e){if(!e)e=event;if(regionShape){if(String.fromCharCode(e.keyCode)==hideKey.toUpperCase()){that.toggle();if(regionShape.stage)regionShape.stage.update();}}}
this.disable=function(){that.active=false;window.removeEventListener("keydown",keyEvent);if(regionShape)regionShape.alpha=0;};this.enable=function(){that.active=true;window.addEventListener("keydown",keyEvent);that.resize();if(regionShape)regionShape.alpha=1;};this.removeShape=function(){if(regionShape){regionShape.graphics.clear();regionShape.dispose();regionShape=null;regionShape=false;}
window.removeEventListener("keydown",keyEvent);};this.toggled=true;this.toggle=function(type){if(type===true){regionShape.visible=true;}else if(type===false){regionShape.visible=false;}else{regionShape.visible=!regionShape.visible;}
that.toggled=regionShape.visible;return that;};this.addShape=function(shape,target){that.removeShape();regionShape=shape;window.addEventListener("keydown",keyEvent);holder.addChild(regionShape);that.resize();};if(style!==false)zim.styleTransforms(this,DS);this.dispose=function(){that.resize=null;if(that.backing)that.backing.dispose();that.backing=null;that.removeShape();return true;};};zim.extend(zim.Layout,createjs.EventDispatcher,null,"cjsEventDispatcher",false);zim.Accessibility=function(appName,tabOrder,tabIndex,cycle,decimals,frame,application,alwaysHighlight,AHTime,AHColor,AHBorderWidth,AHBorderPadding,AHAlpha,AHObject,AHObjectScale){var sig="appName, tabOrder, tabIndex, cycle, decimals, frame, application, alwaysHighlight, AHTime, AHColor, AHBorderWidth, AHBorderPadding, AHAlpha, AHObject, AHObjectScale";var duo;if(duo=zob(zim.Accessibility,arguments,sig,this))return duo;z_d("30.5");this.cjsEventDispatcher_constructor();this.type="Accessibility";if(zot(appName))appName="application";if(zot(cycle))cycle=false;if(zot(decimals))decimals=2;if(zot(frame))frame=zdf;if(zot(application))application=zim.mobile()?false:true;if(zot(alwaysHighlight))alwaysHighlight=false;var timeType=getTIME(AHTime);if(zot(AHTime))AHTime=timeType=="s"?.7:700;if(zot(AHColor))AHColor="brown";if(zot(AHBorderWidth))AHBorderWidth=3;if(zot(AHBorderPadding))AHBorderPadding=5;if(zot(AHAlpha))AHAlpha=.8;if(zot(AHObjectScale))AHObjectScale=.8;if(zot(AHObject)){var alwaysHighlightShape=new zim.Shape({style:false});alwaysHighlightShape.mouseEnabled=false;}else{if(AHObject.mouseEnabled)AHObject.mouseEnabled=false;}
var frame=zdf;if(zot(frame)){if(zon)zogy("Accessibility - needs a Frame");return;}
var pRatio=frame.retina?(window.devicePixelRatio||1):1;var that=this;that.cycle=cycle;that.decimals=decimals;that.alwaysHighlight=alwaysHighlight;that.AHTime=AHTime;that.AHColor=AHColor;that.AHBorderWidth=AHBorderWidth;that.AHBorderPadding=AHBorderPadding;that.AHAlpha=AHAlpha;that.AHObjectScale=AHObjectScale;var _tabOrder=-1;var _tabIndex=-1;var tabTags=[];var tabEvents=[];var phrases={RadioButtons:"option",Tabs:"tab",Pad:"key"};var currentHighlight;var canvasID=frame.canvas.id;var mobile=zim.mobile();var ariaCheck=false;var _aria=null;var ariaEvents=[];var prefixTab;var suffixTab;var talkTag;var noAriaTabPrefix;var noAriaTabSuffix;var noAriaTabPrefix2;var noAriaTabSuffix2;var firstDelay=100;var secondDelay=150;var lastAriaTag;var lastMadeTag;Object.defineProperty(this,'tabOrder',{get:function(){return _tabOrder;},set:function(array){if(prefixTab)prefixTab.removeEventListener("focus",clearAlert);if(suffixTab)suffixTab.removeEventListener("focus",clearAlert);for(var i=0;i<tabTags.length;i++){if(tabTags[i].parentElement)tabTags[i].outerHTML="";}
tabTags=[];var item;var obj;for(i=0;i<tabEvents.length;i++){item=_tabOrder[i];if(item)tabEvents[i][0].off("mousedown",tabEvents[i][1]);}
tabEvents=[];_tabOrder=[];var finalTabs=[];lastMadeTag=frame.shim?document.body:frame.canvas;talkCheck=false;var subtotal=0;for(var i=0;i<array.length;i++){item=array[i];if(item.type=="HotSpots"){array.splice.apply(array,[i,1].concat(item.hotSpots));item=item.hotSpots[0];}
if(item.type=="HotSpot")item=item.spot;if(item.constructor=={}.constructor){obj=item.obj;if(!obj||!obj.getStage)continue;if(!item.title)item.title=getText(obj,i+subtotal);}else{obj=item;item={obj:item,title:getText(item,i+subtotal)};}
if(obj.type=="RadioButtons"||obj.type=="Tabs"||obj.type=="Pad"){var splitAdd=[];subtotal--;for(var j=0;j<obj.buttons.length;j++){subtotal++;var but=obj.buttons[j];var splitItem={obj:but,title:item.title+" - "+phrases[obj.type]+": "+((but.text=="a"||but.text=="A")?"eh":but.text)};splitAdd.push(splitItem);but.zimTabParent=obj;but.zimTabParent.zimAccessibility=that;but.zimTabIndex=i+subtotal;but.tabIndex=j;but.zimAccessibility=that;addExtraTitle(splitItem);lastMadeTag=makeTabTag(canvasID+"Tab"+(i+subtotal),splitItem.title,lastMadeTag,splitItem);tabEvents.push([but,but.on("mousedown",setTabFocus)]);if(!ariaCheck)ariaEvents.push([but,but.on("mousedown",ariaCheckEvent)]);}
finalTabs=finalTabs.concat(splitAdd);}else{obj.zimTabIndex=i+subtotal;obj.zimTabParent=obj;addExtraTitle(item);obj.zimAccessibility=that;tabEvents.push([obj,obj.on("mousedown",setTabFocus)]);if(!ariaCheck)ariaEvents.push([obj,obj.on("mousedown",ariaCheckEvent)]);finalTabs.push(item);lastMadeTag=makeTabTag(canvasID+"Tab"+(i+subtotal),item.title,lastMadeTag,item);}}
prefixTab=that.startAppTag=makeTabTag(canvasID+"PrefixTab",appName+" start",frame.shim?document.body:frame.canvas,null,"before");prefixTab.addEventListener("focus",clearAlert);if(!ariaCheck){prefixTab.addEventListener("focus",removeAriaEvent);noAriaTabPrefix=makeTabTag(canvasID+"noAriaTab","",prefixTab,null,"before");noAriaTabPrefix.setAttribute("aria-hidden",true);noAriaTabPrefix.focusTab=prefixTab;noAriaTabPrefix.addEventListener("focus",ariaFalseEvent);noAriaTabPrefix2=makeTabTag(canvasID+"noAriaTab","",prefixTab);noAriaTabPrefix2.setAttribute("aria-hidden",true);noAriaTabPrefix2.focusTab=prefixTab;noAriaTabPrefix2.addEventListener("focus",ariaFalseEvent);}
lastMadeTag=makeTabTag(canvasID+"BufferTab","",lastMadeTag);if(mobile)lastMadeTag.setAttribute("aria-hidden",true);lastMadeTag=suffixTab=that.endAppTag=makeTabTag(canvasID+"SuffixTab",appName+" end",lastMadeTag);suffixTab.addEventListener("focus",clearAlert);if(!ariaCheck){suffixTab.addEventListener("focus",removeAriaEvent);lastMadeTag=noAriaTabSuffix=makeTabTag(canvasID+"noAriaTab","",suffixTab);noAriaTabSuffix.setAttribute("aria-hidden",true);noAriaTabSuffix.focusTab=suffixTab;noAriaTabSuffix.addEventListener("focus",ariaFalseEvent);noAriaTabSuffix2=makeTabTag(canvasID+"noAriaTab","",suffixTab,null,"before");noAriaTabSuffix2.setAttribute("aria-hidden",true);noAriaTabSuffix2.focusTab=suffixTab;noAriaTabSuffix2.addEventListener("focus",ariaFalseEvent);}
_tabOrder=finalTabs;}});function removeOuterTags(){if(prefixTab){prefixTab.removeEventListener("focus",clearAlert);prefixTab.removeEventListener("focus",removeAriaEvent);if(prefixTab.parentNode)prefixTab.outerHTML="";}
if(noAriaTabPrefix){noAriaTabPrefix.removeEventListener("focus",ariaFalseEvent);if(noAriaTabPrefix.parentNode)noAriaTabPrefix.outerHTML="";}
if(noAriaTabPrefix2){noAriaTabPrefix2.removeEventListener("focus",ariaFalseEvent);if(noAriaTabPrefix2.parentNode)noAriaTabPrefix2.outerHTML="";}
if(lastMadeTag){if(lastMadeTag.parentNode)lastMadeTag.outerHTML="";}
if(suffixTab){suffixTab.removeEventListener("focus",clearAlert);suffixTab.removeEventListener("focus",removeAriaEvent);if(suffixTab.parentNode)suffixTab.outerHTML="";}
if(noAriaTabSuffix){noAriaTabSuffix.removeEventListener("focus",ariaFalseEvent);if(noAriaTabSuffix.parentNode)noAriaTabSuffix.outerHTML="";}
if(noAriaTabSuffix2){noAriaTabSuffix2.removeEventListener("focus",ariaFalseEvent);if(noAriaTabSuffix2.parentNode)noAriaTabSuffix2.outerHTML="";}}
Object.defineProperty(this,'tabIndex',{get:function(){return _tabIndex;},set:function(num){if(!_state)return;if(num<0||num>=_tabOrder.length){clearTab();}else{if(num!=_tabIndex)clearOld();var obj=_tabOrder[num].obj;if(obj.stage){_tabIndex=num;obj.focus=true;tabFocus=true;tabFirstCheck=false;that.changeTitle(obj);obj.zimTabTag.focus();setTimeout(function(){obj.zimTabTag.focus();var readerEvent=new createjs.Event("change");readerEvent.title=obj.zimTabTag.getAttribute("aria-label");that.dispatchEvent(readerEvent);},secondDelay);if(that.alwaysHighlight&&(!_aria||!mobile)){if(!that.AHObject){currentHighlight=alwaysHighlightShape;var oB=obj.getBounds();var pTL=obj.localToGlobal(oB.x-5,oB.y-5);var pTR=obj.localToGlobal(oB.x+oB.width+5,oB.y-5);var pBR=obj.localToGlobal(oB.x+oB.width+5,oB.y+oB.height+5);var pBL=obj.localToGlobal(oB.x-5,oB.y+oB.height+5);var g=alwaysHighlightShape.graphics;g.clear();g.s(that.AHColor).ss(that.AHBorderWidth).mt(pTL.x-that.AHBorderPadding,pTL.y-that.AHBorderPadding).lt(pTR.x+that.AHBorderPadding,pTR.y-that.AHBorderPadding).lt(pBR.x+that.AHBorderPadding,pBR.y+that.AHBorderPadding).lt(pBL.x-that.AHBorderPadding,pBL.y+that.AHBorderPadding).lt(pTL.x-that.AHBorderPadding,pTL.y-that.AHBorderPadding).cp();alwaysHighlightShape.alpha=that.AHAlpha;if(that.AHTime>0)tabTimeout=setTimeout(function(){frame.stage.removeChild(alwaysHighlightShape);frame.stage.update();},that.AHTime*(timeType=="s"?1000:1));}else{currentHighlight=that.AHObject;var b=zim.boundsToGlobal(obj);that.AHObject.alp(that.AHAlpha).addTo(frame.stage,null,false);that.AHObject.fit(b.x,b.y,b.width,b.height);that.AHObject.sca(that.AHObject.scaleX*that.AHObjectScale);if(that.AHTime>0)tabTimeout=setTimeout(function(){frame.stage.removeChild(that.AHObject);frame.stage.update();},that.AHTime*(timeType=="s"?1000:1));}
frame.stage.addChild(currentHighlight);frame.stage.update();}}else{clearTab();}}
function clearOld(){if(_tabIndex&&_tabIndex>-1){if(_tabOrder&&_tabOrder[_tabIndex])_tabOrder[_tabIndex].obj.focus=false;}else{for(var i=0;i<_tabOrder.length;i++){_tabOrder[i].obj.focus=false;}}}
function clearTab(){clearOld();tabFocus=false;if(that.AHObject)frame.stage.removeChild(that.AHObject);if(that.alwaysHighlightShape)frame.stage.removeChild(that.alwaysHighlightShape);frame.stage.update();_tabIndex=-1;}}});Object.defineProperty(this,'aria',{get:function(){return _aria;},set:function(val){_aria=val;if(_aria)setAriaTrue();}});function ariaCheckEvent(e){var obj=e.currentTarget;var bounds=obj.boundsToGlobal();var cX=bounds.x+bounds.width/2;var cY=bounds.y+bounds.height/2;var delta=5;if(e.stageX/zim.scaX<cX-delta||e.stageX/zim.scaX>cX+delta||e.stageY/zim.scaY<cY-delta||e.stageY/zim.scaY>cY+delta){setAriaFalse();}else{setAriaTrue();}}
function clearAlert(){if(talkTag)talkTag.innerHTML="";}
if(mobile=="android"){zim.ACTIONEVENT="click";if(!zns)ACTIONEVENT="click";}
function setAriaTrue(){_aria=true;removeAriaCheck();if(talkTag)talkTag.setAttribute("aria-hidden",false);zim.ACTIONEVENT="click";if(!zns)ACTIONEVENT="click";frame.stage.removeChild(currentHighlight);if(mobile)that.alwaysHighlight=false;frame.stage.update();var item;var obj;var tag;for(var i=0;i<_tabOrder.length;i++){item=_tabOrder[i];obj=item.obj;tag=obj.zimTabTag;tag.disabled=false;item.title=item.title.replace(/\s\(use arrow keys\)/,"");tag.setAttribute("aria-label",item.title);tag.addEventListener("focus",ariaTagFocusEvent);}}
function setAriaFalse(){_aria=false;var item;var obj;var tag;for(var i=0;i<_tabOrder.length;i++){item=_tabOrder[i];obj=item.obj;tag=obj.zimTabTag;tag.disabled=false;}
removeAriaCheck();if(alwaysHighlight)moveTagsOffstage();}
function ariaTagFocusEvent(e){var tag=e.currentTarget;var obj=tag.zimObject;_tabIndex=obj.zimTabIndex;obj.focus=true;var readerEvent=new createjs.Event("change");readerEvent.title=tag.getAttribute("aria-label");that.dispatchEvent(readerEvent);}
function ariaFalseEvent(e){_aria=false;e.target.focusTab.focus();}
function removeAriaEvent(){if(zot(_aria)||_aria)setAriaTrue();else setAriaFalse();}
function removeAriaCheck(){ariaCheck=true;prefixTab.removeEventListener("focus",removeAriaEvent);suffixTab.removeEventListener("focus",removeAriaEvent);noAriaTabPrefix.removeEventListener("focus",ariaFalseEvent);noAriaTabSuffix.removeEventListener("focus",ariaFalseEvent);if(noAriaTabPrefix.parentNode){noAriaTabPrefix.parentNode.removeChild(noAriaTabPrefix);noAriaTabSuffix.parentNode.removeChild(noAriaTabSuffix);}
noAriaTabPrefix2.removeEventListener("focus",ariaFalseEvent);noAriaTabSuffix2.removeEventListener("focus",ariaFalseEvent);if(noAriaTabPrefix2.parentNode){noAriaTabPrefix2.parentNode.removeChild(noAriaTabPrefix2);noAriaTabSuffix2.parentNode.removeChild(noAriaTabSuffix2);}
for(var i=0;i<ariaEvents.length;i++){ariaEvents[i][0].off("mousedown",ariaEvents[i][1]);}}
function moveTagsOffstage(){for(var i=0;i<tabTags.length;i++){var t=tabTags[i];if(t.zimObject&&(t.zimObject.type=="Loader"||t.zimObject.type=="TextArea"||t.zimObject.type=="Tag"))continue;tabTags[i].style.left="-2000px";}}
if(!zot(tabOrder)){_tabOrder=[];that.tabOrder=tabOrder;if(!zot(tabIndex))that.tabIndex=tabIndex;}else{setTimeout(function(){if(_tabOrder==-1){_tabOrder=[];var tabTemp=[];zim.loop(frame.stage,function(obj){if(obj.type)tabTemp.push(obj);});that.tabOrder=tabTemp;if(!zot(tabIndex))that.tabIndex=tabIndex;}},50);}
function setTabFocus(e){var obj=e.currentTarget;if(obj.type=="RadioButton"||obj.type=="TabsButton"||obj.type=="PadButton"){for(var j=0;j<obj.zimTabParent.buttons.length;j++){var but=obj.zimTabParent.buttons[j];but.zimTabTag.setAttribute("aria-label",but.zimTabTag.getAttribute("aria-label").split(" - currently")[0]+(obj.zimTabParent.selectedIndex==but.tabIndex?" - currently selected.":" - currently not selected."));}}
that.tabIndex=e.currentTarget.zimTabIndex;that.activatedObject=obj;}
function getText(obj){if(obj.talk)return obj.talk;if(obj.type=="TextArea"||obj.type=="RadioButtons"||obj.type=="Tabs"||obj.type=="Pad")return obj.type;if(obj.type=="Waiter")return"Waiter active - please wait";return obj.text?obj.type+" - "+((obj.text=="a"||obj.text=="A")?"eh":obj.text):obj.type+((obj.type=="Dial"||obj.type=="Slider"||obj.type=="ColorPicker"||obj.type=="Stepper")?" (use arrow keys)":"")+((obj.type=="TextArea")?" (press ENTER to edit)":"");}
function addExtraTitle(item){var obj=item.obj;item.title=item.title.replace(/\.$/,"");if(obj.type=="RadioButton"||obj.type=="TabsButton"||obj.type=="PadButton")item.title=item.title+(obj.tabIndex==obj.zimTabParent.selectedIndex?" - currently selected":" - currently not selected");else if(obj.type=="CheckBox")item.title=item.title+(obj.checked?" - currently checked":" - currently not checked");else if(obj.type=="Stepper")item.title=item.title+" - currently displaying "+obj.currentValue;else if(obj.type=="Slider"||obj.type=="Dial")item.title=item.title+" - currently at "+zim.decimals(obj.currentValue,that.decimals);else if(obj.type=="ColorPicker")item.title=item.title+" - currently at "+obj.selectedColor;else if(obj.type=="TextArea")item.title=item.title+(obj.tag.value!=""?"":" - placeholder: "+obj.tag.placeholder);else if(obj.type=="Indicator")item.title=item.title+" - currently "+(obj.selectedIndex>=0?"at "+(obj.selectedIndex+1)+" of "+obj.num:"not indicating");item.title+=".";}
function makeTabTag(id,title,targetTag,item,place){var obj;var tabTag;if(item)obj=item.obj;if(item&&(obj.type=="TextArea"||obj.type=="Loader")){var tabTag=obj.tag;tabTag.setAttribute("aria-label",title);if(obj)tabTag.setAttribute("aria-hidden",!obj.stage);if(place=="before"){targetTag.parentNode.insertBefore(tabTag,targetTag);}else{targetTag.parentNode.insertBefore(tabTag,targetTag.nextSibling);}
tabTag.style.zIndex=-5;tabTag.zimObject=obj;item.obj.zimTabTag=tabTag;tabTags.push(tabTag);return tabTag;}
if(item&&(obj.type=="Dial"||obj.type=="Slider"||obj.type=="Stepper"||obj.type=="ColorPicker")){var stepArray=[];if(obj.type=="Dial"||obj.type=="Slider"){var step=(obj.step<=0?(obj.max-obj.min)/20:obj.step);for(var i=obj.min;i<obj.max;i=i+step){stepArray.push(obj.min+i);}}else if(obj.type=="Stepper"){stepArray=obj.stepperArray;}else if(obj.type=="ColorPicker"){stepArray=obj.colors;}
tabTag=document.createElement("select");tabTag.disabled=true;tabTag.zimObject=obj;tabTag.addEventListener("change",function(e){if(!_aria&&!mobile=="android")return;e.currentTarget.zimObject.zimTabParent.currentValueEvent=e.target.value;frame.stage.update();});tabTag.size=1;var el;var op;for(var i=0;i<stepArray.length;i++){el=stepArray[i];op=document.createElement("option");op.setAttribute("aria-label",el);op.innerHTML=el;tabTag.add(op);if(el==obj.zimTabParent.currentValue)op.setAttribute("selected","selected");}
tabTag.setAttribute("role","button");}else{tabTag=document.createElement("div");if(obj)tabTag.zimObject=obj;tabTag.innerHTML="tag";tabTag.setAttribute("role",application?"application":"button");if(mobile=="android"){tabTag.addEventListener("click",function(e){obj.dispatchEvent("click");});}}
tabTag.setAttribute("id",id);tabTag.setAttribute("tabindex",0);tabTag.setAttribute("aria-label",title);if(obj)tabTag.setAttribute("aria-hidden",!obj.stage);if(place=="before"){targetTag.parentNode.insertBefore(tabTag,targetTag);}else{targetTag.parentNode.insertBefore(tabTag,targetTag.nextSibling);}
tabTag.style.position="absolute";if(item){var obj=item.obj;var bounds=obj.boundsToGlobal();if(frame.retina){tabTag.style.left=(frame.x+bounds.x*frame.scale/pRatio)+"px";tabTag.style.top=(frame.y+bounds.y*frame.scale/pRatio)+"px";tabTag.style.width=(bounds.width*frame.scale/pRatio)+"px";tabTag.style.height=(bounds.height*frame.scale/pRatio)+"px";}else{tabTag.style.left=(frame.x+bounds.x*frame.scale)+"px";tabTag.style.top=(frame.y+bounds.y*frame.scale)+"px";tabTag.style.width=(bounds.width*frame.scale)+"px";tabTag.style.height=(bounds.height*frame.scale)+"px";}
item.obj.zimTabTag=tabTag;}else{tabTag.style.left=-1000+"px";tabTag.style.top=frame.y+"px";}
tabTag.style.overflow="hidden";tabTag.style.zIndex=-5;tabTag.style.fontSize="20px";tabTag.style.color="rgba(0,0,0,.01)";tabTags.push(tabTag);return tabTag;}
var tabFocus=false;var tabFirstCheck=true;var tabFrameEvent=frame.on("keydown",function(e){if(e.keyCode==9){if(!checkTabs()){tabFocus=false;if(that.tabIndex!=-1)that.tabIndex=-1;}
if(tabFocus){goTabs(e);}else{setTabs(e);}}
if(tabFocus&&_tabOrder.length>0&&that.tabIndex>=0){if(e.keyCode==13){var item=_tabOrder[that.tabIndex];var obj=item.obj;if(item&&obj.stage){var downEvent=new createjs.Event("mousedown");var clickEvent=new createjs.Event("click");downEvent.fromEnter=clickEvent.fromEnter=true;if(obj.type=="Pane"){obj.backdrop.dispatchEvent(downEvent);obj.backdrop.dispatchEvent(clickEvent);}else{obj.dispatchEvent(downEvent);obj.dispatchEvent(clickEvent);}}}}});function checkTabs(){var frameTagFocus=false;for(var i=0;i<tabTags.length;i++){if(document.activeElement==tabTags[i]){frameTagFocus=true;break;}}
if(document.activeElement==frame.canvas||frameTagFocus)return true;return false;}
function setTabs(e){if(!frame.shiftKey&&(zid(canvasID+"PrefixTab")==document.activeElement||frame.canvas==document.activeElement)){if(_tabOrder.length>0)_tabOrder[_tabOrder.length-1].obj.focus=true;tabFirstCheck=true;tabFocus=true;goTabs(e);}else if(frame.shiftKey&&(zid(canvasID+"SuffixTab")==document.activeElement||zid(canvasID+"BufferTab")==document.activeElement)){if(_tabOrder.length>0)_tabOrder[0].obj.focus=true;tabFirstCheck=true;tabFocus=true;goTabs(e);}}
function goTabs(e){if(e.ctrlKey){focusToDoc(e.shiftKey?-1:1);return;}
if(e.shiftKey)that.tab(-1);else that.tab(1);e.preventDefault();}
var tabTimeout;this.tab=function(dir){clearTimeout(tabTimeout);if(currentHighlight)frame.stage.removeChild(currentHighlight);if(zot(dir))dir=1;if(_tabOrder.length==0){focusToDoc(dir);return;}
for(var i=0;i<_tabOrder.length;i++){var obj=_tabOrder[i].obj;if(obj.focus){obj.focus=false;var index=i+dir;var normalizedIndex=(index+_tabOrder.length*10000)%_tabOrder.length;var tabData=_tabOrder[normalizedIndex];obj=tabData.obj;var attempts=0;var badTabs=false;while(!(obj.stage&&((!obj.zimTabParent&&(zot(obj.enabled)||obj.enabled))||(obj.zimTabParent&&(zot(obj.zimTabParent.enabled)||obj.zimTabParent.enabled))))){attempts++;index=index+dir;normalizedIndex=(index+_tabOrder.length*100)%_tabOrder.length;tabData=_tabOrder[normalizedIndex];obj=tabData.obj;if(attempts==_tabOrder.length){badTabs=true;break;}}
if(badTabs||(!that.cycle&&index!=normalizedIndex&&!tabFirstCheck)){focusToDoc(dir);return;}
tabFirstCheck=false;that.tabIndex=normalizedIndex;break;}}};function focusToDoc(dir){tabFocus=false;zid(canvasID+(dir==1?"SuffixTab":"PrefixTab")).focus();frame.stage.removeChild(AHObject);frame.stage.update();that.tabIndex=-1;}
this.changeTitle=function(target,title,activate){if(typeof target!="number")target=target.zimTabIndex;if(zot(target))return;if(activate&&zot(title)){that.tabIndex=target;return;}
var item=_tabOrder[target];var obj=item.obj;if(zot(title))title=obj.zimTabTag.getAttribute("aria-label").split(" - currently")[0];item.title=title;addExtraTitle(item);obj.zimTabTag.setAttribute("aria-label",item.title);if(activate)that.tabIndex=target;};var talkCheck=false;this.talk=function(words){if(!talkCheck){talkTag=makeTabTag(canvasID+"TalkTab","",suffixTab);talkTag.setAttribute("role","alert");talkCheck=true;}
talkTag.removeAttribute("role");talkTag.setAttribute("aria-label",words);talkTag.setAttribute("role","alert");var readerEvent=new createjs.Event("change");readerEvent.title=words;that.dispatchEvent(readerEvent);};this.resize=function(target){if(!zot(target)){if(typeof target!="number")target=target.zimTabIndex;if(target<0)return;var item=_tabOrder[target];var obj=item.obj;if(!obj.stage&&currentHighlight&&obj==that.currentObject){frame.stage.removeChild(currentHighlight);frame.stage.update();}
resizeObj(obj);}else{for(var i=0;i<_tabOrder.length;i++){resizeObj(_tabOrder[i].obj);}}
function resizeObj(obj){if(obj.type=="TextArea"||obj.type=="Loader"){obj.resize();return;}else{var bounds=obj.boundsToGlobal();var tabTag=obj.zimTabTag;if(frame.retina){tabTag.style.left=(frame.x+bounds.x*frame.scale/pRatio)+"px";tabTag.style.top=(frame.y+bounds.y*frame.scale/pRatio)+"px";tabTag.style.width=(bounds.width*frame.scale/pRatio)+"px";tabTag.style.height=(bounds.height*frame.scale/pRatio)+"px";}else{tabTag.style.left=(frame.x+bounds.x*frame.scale/pRatio/pRatio)+"px";tabTag.style.top=(frame.y+bounds.y*frame.scale/pRatio/pRatio)+"px";tabTag.style.width=(bounds.width*frame.scale/pRatio/pRatio)+"px";tabTag.style.height=(bounds.height*frame.scale/pRatio/pRatio)+"px";}}
tabTag.setAttribute("aria-hidden",!obj.stage);tabTag.hidden=!obj.stage;}};Object.defineProperty(this,'currentObject',{get:function(){if(_tabOrder[_tabIndex]&&_tabOrder[_tabIndex].obj)return _tabOrder[_tabIndex].obj;else return null;},set:function(obj){for(var i=0;i<_tabOrder.length;i++){if(_tabOrder[i].obj==obj){that.tabIndex=i;break;}}}});var _state=true;Object.defineProperty(this,'enabled',{get:function(){return _state;},set:function(state){_state=state;}});this.dispose=function(a,b,disposing){if(alwaysHighlightShape)alwaysHighlightShape.graphics.clear();that.tabOrder=[];for(var i=0;i<tabTags.length;i++)if(tabTags[i].parentElement)tabTags[i].outerHTML="";removeOuterTags();that.removeAllEventListeners();frame.off("keydown",tabFrameEvent);};};zim.extend(zim.Accessibility,createjs.EventDispatcher,null,"cjsEventDispatcher",false);zim.Manager=function(type){z_d("75");var that=this;this.type=type;this.items=[];this.add=function(obj){if(Array.isArray(obj))that.items=that.items.concat(obj);else that.items.push(obj);return that;};this.remove=function(obj){if(!that)return;if(!obj){that.items=[];}else{if(!Array.isArray(obj))obj=[obj];for(var i=obj.length-1;i>=0;i--){o=obj[i];var index=that.items.indexOf(o);if(index!=-1)that.items.splice(index,1);}}
return that;};this.resize=function(obj){if(!that)return;if(!obj){for(var i=that.items.length-1;i>=0;i--){if(!that.items[i].resize)that.items.splice(i,1);else that.items[i].resize();}}else{if(!Array.isArray(obj))obj=[obj];for(var i=obj.length-1;i>=0;i--){o=obj[i];if(!o.resize&&that.items.indexOf(o)!=-1)that.items.splice(that.items.indexOf(o),1);else o.resize();}}
return that;};this.toggle=function(state,obj){if(!that)return;if(!obj){for(var i=that.items.length-1;i>=0;i--){if(!that.items[i].resize)that.items.splice(i,1);else that.items[i].toggle(state);}}else{if(!Array.isArray(obj))obj=[obj];for(var i=obj.length-1;i>=0;i--){o=obj[i];if(!o.resize&&that.items.indexOf(o)!=-1)that.items.splice(that.items.indexOf(o),1);else o.toggle(state);}}
return that;};this.dispose=function(obj){if(!that)return;that.resize=null;if(!obj){for(var i=that.items.length-1;i>=0;i--){if(!that.items[i].resize)that.items.splice(i,1);else that.items[i].dispose();}
that.items=null;}else{if(!Array.isArray(obj))obj=[obj];for(var i=obj.length-1;i>=0;i--){o=obj[i];if(that.items.indexOf(o)!=-1)that.items.splice(that.items.indexOf(o));if(o.dispose)o.dispose();}}
return true;};};zim.ResizeManager=function(){z_d("75.5");zim.Manager.call(this,"ResizeManager");};zim.ResizeManager.prototype=new zim.Manager();zim.ResizeManager.prototype.constructor=zim.ResizeManager;zim.TransformManager=function(objects,persistID){z_d("75.7");var that=this;this.type="TransformManager";this.persistID=persistID;this.items=[];function setPersist(e){if(!localStorage||(e&&!e.pressup))return;that.savePersist(e);}
var tmChangeEvent;this.add=function(obj){var newObj=[];if(Array.isArray(obj)){newObj=obj;}else{newObj=[obj];}
var o;var firstEver=false;for(var i=0;i<newObj.length;i++){o=newObj[i];if(o.transformControls)o.originalVisible=o.transformControls.visible;if(o.toggle)o.toggle(false);if(that.items.length==0&&i==0)firstEver=true;if(o.type=="Blob"||o.type=="Squiggle"){if(!that.persistID){if(firstEver){firstEver=false;o.controlsVisible=true;that.currentObject=o;}}
o.on("change",function(e){var ev=new createjs.Event("transformed");ev.transformObject=e.target;ev.transformType=e.controlType;that.dispatchEvent(ev);});o.on("controlsshow",function(e){var ev=new createjs.Event("transformshow");that.currentObject=ev.transformObject=e.target;that.dispatchEvent(ev);});o.on("controlshide",function(e){var ev=new createjs.Event("transformhide");ev.transformObject=e.target;that.currentObject=null;that.dispatchEvent(ev);});o.on("update",function(e){var ev=new createjs.Event("transformed");ev.transformObject=e.target;ev.transformType=e.controlType;that.dispatchEvent(ev);});}else{var transObj=o.transformControls;if(!that.persistID){if(firstEver&&o.type!="Layer"){firstEver=false;if(o.originalVisible){transObj.show();that.currentObject=o;}}}
o.on("transformed",function(e){var ev=new createjs.Event("transformed");ev.transformObject=e.target;ev.transformType=e.transformType;that.dispatchEvent(ev);});o.on("transformshow",function(e){var ev=new createjs.Event("transformshow");that.currentObject=ev.transformObject=e.target;that.dispatchEvent(ev);});o.on("transformhide",function(e){var ev=new createjs.Event("transformhide");ev.transformObject=e.target;that.currentObject=null;that.dispatchEvent(ev);});}}
that.items=that.items.concat(obj);if(that.persist&&!zot(that.persistID))that.persist(that.persistID);};this.remove=function(obj){if(zot(obj)){that.items=[];return;}
if(!Array.isArray(obj))obj=[obj];var o;for(var i=0;i<obj.length;i++){o=obj[i];if(that.currentObject==o)that.currentObject=null;if(o.transformedEvent){o.off("transformed",o.transformedEvent);o.transformedEvent=null;}
if(o.type=="Blob"||o.type=="Squiggle")o.controlsVisible=false;else o.transformControls.remove();var index=that.items.indexOf(o);if(index!=-1)that.items.splice(index,1);}
if(persistID){that.savePersist();}};this.show=function(obj){if(zot(obj))return;if(obj.type=="Blob"||obj.type=="Squiggle"){if(!obj.controlsVisible)obj.controlsVisible=true;}else{var transObj=obj.transformControls;if(!transObj||transObj.visible)return;transObj.show();}
that.currentObject=obj;};this.hide=function(obj){if(zot(obj))return;if(that.currentObject==obj)that.currentObject=null;if(obj.type=="Blob"||obj.type=="Squiggle"){if(obj.controlsVisible)obj.controlsVisible=false;}else{var transObj=obj.transformControls;if(!transObj||transObj.visible)return;transObj.hide();}};this.hideAll=function(exception){var transObj;var o;for(var i=0;i<that.items.length;i++){o=that.items[i];if(!o||!(o.transformControls||o.update)){that.items.splice(i);}else{if(that.items[i]==exception)continue;if(o.type=="Blob"||o.type=="Squiggle"){if(o.controlsVisible)o.controlsVisible=false;}else{transObj=that.items[i].transformControls;if(transObj.visible)transObj.hide();}}}
that.currentObject=null;};this.resize=function(){if(!that)return;var o;for(var i=0;i<that.items.length;i++){o=that.items[i];if(!o||!(o.transformControls||o.update)){that.items.splice(i);}else{if(o.type=="Blob"||o.type=="Squiggle"){o.update();}else{o.transformControls.resize();}}}
if(persistID)that.savePersist();};if(!zot(objects))that.add(objects);var sorry="TransformManager persist(persistID) - sorry, must provide id";this.persist=function(persistID){var it;if(zot(persistID)){if(zon){zog(sorry);return;}}
that.persistID=persistID;var dispatchNum=0;if(localStorage&&localStorage[persistID]){var data=that.persistData=JSON.parse(localStorage[persistID]);if(data.length==that.items.length){for(var i=0;i<that.items.length;i++){if(data[i].controls){that.currentObject=that.items[i];}
if(data[i]&&(data[i].type=="Blob"||data[i].type=="Squiggle")){if(that.items[i].points.length!=data[i].points.length){that.items[i].points=data[i].points;}
that.items[i].setData(data[i]);if(that.items[i]==that.currentObject)that.currentObject.toggle(true);}else if(data[i]){if(zot(that.items[i].transformControls)){-function(){it=that.items[i];var da=data[i];zim.interval(50,function(o){if(it.transformControls){it.transformControls.setData(da);it.dispatchEvent("persistset");dispatchNum++;if(dispatchNum==data.length){setTimeout(function(){if(it==that.currentObject)that.currentObject.toggle(true);that.dispatchEvent("persistcomplete");},100);o.clear();}}},20,null,null,"ms");}();}else{that.items[i].transformControls.setData(data[i]);-function(){it=that.items[i];zim.interval(50,function(o){it.dispatchEvent("persistset");dispatchNum++;if(dispatchNum==data.length){setTimeout(function(){if(it==that.currentObject)that.currentObject.toggle(true);that.dispatchEvent("persistcomplete");},100);o.clear();}},20,null,null,"ms");}();}}}}}
for(var i=0;i<that.items.length;i++){it=that.items[i];if(!it.transformedEvent){if(it.type=="Blob"||it.type=="Squiggle"){it.transformedEvent=it.on("change",function(e){e.pressup=true;setPersist(e);});it.transformedEvent=it.on("update",function(e){e.pressup=true;setPersist(e);});it.transformedEvent=it.on("controlsshow",function(e){e.pressup=true;setPersist(e);});it.transformedEvent=it.on("controlshide",function(e){e.pressup=true;setPersist(e);});}else{it.transformedEvent=it.on("transformed",setPersist);it.transformedEvent=it.on("transformshow",setPersist);it.transformedEvent=it.on("transformhide",setPersist);}}}};this.savePersist=function(e){var data=[];for(var i=0;i<that.items.length;i++){var it=that.items[i];if(it.type=="Blob"||it.type=="Squiggle"){if(it.recordData)data.push(it.recordData());}else{if(it.transformControls&&it.transformControls.recordData)data.push(it.transformControls.recordData());}}
that.persistData=data;localStorage[that.persistID]=JSON.stringify(data);};this.clearPersist=function(id){if(zot(id)){if(zon){zog(sorry);return;}}
that.persistData=null;if(localStorage)localStorage.removeItem(id);};this.stopPersist=function(){for(var i=0;i<that.items.length;i++){var it=that.items[i];if(it.transformedEvent){if(it.type=="Blob"||it.type=="Squiggle"){it.off("change",it.transformedEvent);}else{it.off("transformed",it.transformedEvent);}
it.transformedEvent=null;}}
that.persistData=null;};if(!zot(persistID))that.persist(persistID);this.dispose=function(removePersist,removeControls,disposing){if(zot(removePersist))removePersist=true;that.removeAllEventListeners();if(that.persistID&&removePersist)that.stopPersist();if(removeControls){for(var i=0;i<that.items.length;i++){var o=that.items[i];if(o.type=="Blob"||o.type=="Squiggle")o.dispose();else o.transformControls.dispose();}}};};zim.extend(zim.TransformManager,createjs.EventDispatcher,null,"cjsEventDispatcher",false);zim.GuideManager=function(){z_d("77");zim.Manager.call(this,"GuideManager");};zim.GuideManager.prototype=new zim.Manager();zim.GuideManager.prototype.constructor=zim.GuideManager;zim.GridManager=function(){z_d("79");zim.Manager.call(this,"GridManager");};zim.GridManager.prototype=new zim.Manager();zim.GridManager.prototype.constructor=zim.GridManager;zim.LayoutManager=function(){z_d("81");zim.Manager.call(this,"LayoutManager");};zim.LayoutManager.prototype=new zim.Manager();zim.LayoutManager.prototype.constructor=zim.LayoutManager;zim.SelectionSet=function(selections){z_d("81.5");this.type="SelectionSet";if(zot(selections))selections=[];this.selections=selections;this.clear=function(){this.selections=[];};this.isSelected=function(item){return this.selections.indexOf(item)>=0;};this.add=function(item,multiple,match,unmatch){if(zot(item))return;if(zot(multiple)){if(!zot(this.selectionManager))multiple=this.selectionManager.multiple;}
if(!zot(this.selectionManager)){this.selectionManager.setCurrent(this);if(!multiple&&this.selectionManager.multipleSets)this.selectionManager.clear();}
if(!multiple)this.clear();var ind=this.selections.indexOf(item);if(ind>=0)return;this.selections.push(item);if(!zot(match)){if(!Array.isArray(match))match=[match];for(var i=0;i<=match.length;i++){match[i].add(item,multiple);}}
if(!zot(unmatch)){if(!Array.isArray(unmatch))unmatch=[unmatch];for(i=0;i<=unmatch.length;i++){unmatch[i].remove(item,multiple);}}};this.remove=function(item,multiple,match,unmatch){if(zot(item))return;if(zot(multiple)){if(!zot(this.selectionManager))multiple=this.selectionManager.multiple;}
if(!zot(this.selectionManager))this.selectionManager.setCurrent(this);if(!multiple)this.clear();var ind=this.selections.indexOf(item);if(!zot(this.selectionManager)){this.selectionManager.setCurrent(this);if(!multiple&&this.selectionManager.multipleSets)this.selectionManager.clear();}
if(!multiple)this.clear();if(!multiple)this.clear();else if(ind>=0)this.selections.splice(ind,1);if(!zot(match)){if(!Array.isArray(match))match=[match];for(var i=0;i<=match.length;i++){match[i].remove(item,multiple);}}
if(!zot(unmatch)){if(!Array.isArray(unmatch))unmatch=[unmatch];for(i=0;i<=unmatch.length;i++){unmatch[i].add(item,multiple);}}};this.toggle=function(item,multiple,match,unmatch){if(this.isSelected(item))this.remove(item,multiple,match,unmatch);else this.add(item,multiple,match,unmatch);};this.dispose=function(a,b,disposing){this.clear();this.selections=null;return true;};};zim.SelectionManager=function(sets,multipleKey,multipleSets){z_d("81.6");this.cjsEventDispatcher_constructor();this.type="SelectionManager";if(zot(sets))sets=[];if(zot(multipleSets))multipleSets=true;if(!Array.isArray(sets))sets=[sets];this.sets=sets;this.multipleKey=multipleKey;this.multipleSets=multipleSets;this.multiple=false;var that=this;for(var i=0;i<sets.length;i++){sets[i].selectionManager=this;}
this.clear=function(){this.currentSet=null;for(var i=0;i<sets.length;i++){sets[i].clear();}};this.setCurrent=function(set){this.currentSet=set;for(var i=0;i<sets.length;i++){if(sets[i]==set)continue;if(!this.multipleSets)sets[i].clear();}};var eDown=new createjs.Event("keydown");this.eventRemove=eDown.remove;this.keydownEvent=function(e){e.remove=that.eventRemove;if(that.multipleKey)that.multiple=e[that.multipleKey+"Key"];that.ctrlKey=e.ctrlKey;that.shiftKey=e.shiftKey;that.metaKey=e.metaKey;that.dispatchEvent(e);if(e.keyCode==90&&(that.ctrlKey||that.metaKey)){that.dispatchEvent("undo");}};window.addEventListener("keydown",this.keydownEvent);this.keyupEvent=function(e){if(that.multipleKey)that.multiple=e[that.multipleKey+"Key"];that.ctrlKey=e.ctrlKey;that.shiftKey=e.shiftKey;that.metaKey=e.metaKey;e.remove=that.eventRemove;that.dispatchEvent(e);}
window.addEventListener("keyup",this.keyupEvent);this.dispose=function(){this.clear();window.removeEventListener("keydown",this.keydownEvent);window.removeEventListener("keyup",this.keyupEvent);};};zim.extend(zim.SelectionManager,createjs.EventDispatcher,null,"cjsEventDispatcher",false);if(typeof zimDefaultBind=="undefined")var zimDefaultBind;zim.Bind=function(connection,bindType,master,masterFilter,couple,smartDecimals,report,setDefault){var sig="connection, bindType, master, masterFilter, couple, smartDecimals, report, setDefault";var duo;if(duo=zob(zim.Bind,arguments,sig,this))return duo;z_d("81.8");this.type="Bind";var that=this;if(zot(connection)&&localStorage&&zot(zimDefaultBind)&&(zot(bindType)||bindType==LOCALSTORAGE)){connection="zimBind";bindType=LOCALSTORAGE;}else if(connection&&connection.match(/\/|\./)){if(zot(bindType))bindType=GET;if(!connection.match(/\?/))connection+="?";else connection+="&";}else if(connection&&zot(bindType)){bindType=LOCALSTORAGE;}
if(zot(smartDecimals))smartDecimals=true;if(bindType==LOCALSTORAGE&&!localStorage){if(zon)zogy("Bind() - no localStorage");that.error="error - no localStorage";}
this.connection=connection;this.bindType=bindType;this.master=master;this.masterFilter=masterFilter;this.smartDecimals=smartDecimals;if(zot(report))report=false;if(!zimDefaultBind||setDefault){zimDefaultBind=this;}
Object.defineProperty(that,'default',{get:function(){return that==zimDefaultBind;},set:function(value){if(!value&&zimDefaultBind==that)zimDefaultBind=null;else if(value)zimDefaultBind=that;}});if(this.bindType==POST){that.ajax=new zim.Ajax();}
this.bindings={};this.ids=[];this.data={};this.objIDs=new zim.Dictionary(true);this.toIDs={};this.fromIDs={};this.add=function(id,obj,props,extra,filter){if(zot(props)||zot(obj)||zot(id))return that;if(that.bindings[id]){if(that.bindings[id].obj!=obj){if(zon)zogy("Bind() - id can be used with only one object");return that;}}else{if(that.ids.indexOf(id)<=0)that.ids.push(id);that.bindings[id]={obj:obj,props:[]};if(!zot(filter)&&typeof filter=="function")that.bindings[id].filter=filter;var list=that.objIDs.at(obj);if(list){if(list.indexOf(id)<0)list.push(id);}else{that.objIDs.add(obj,[id]);}}
if(!Array.isArray(props)&&props.constructor!={}.constructor){props=[props];}
var dataProps=that.bindings[id].props;if(Array.isArray(props)){zim.loop(props,function(prop){addTo(that.toIDs,prop,id);addTo(that.fromIDs,prop,id);if(dataProps.indexOf(prop)<0)dataProps.push(prop);});}else{zim.loop(props,function(key,val){if(val==zim.BOTH||val==zim.TO){addTo(that.toIDs,key,id);}
if(val==zim.BOTH||val==zim.FROM){addTo(that.fromIDs,key,id);}
if(dataProps.indexOf(key)<0)dataProps.push(key);});}
function addTo(arr,prop,id){if(zot(arr[prop]))arr[prop]=[id];else if(arr[prop].indexOf(id)<0)arr[prop].push(id);}
if(report)sendReport("Bind Report: ADD ["+id+"]",(props?" "+props:"")+(extra?" "+extra:""));if(that.bindType==LOCALSTORAGE){that.from(null,id,props,extra);if(!that.data||zim.isEmpty(that.data))that.to(id,props);}else{applyFilters("bind",null,[filter],that.data,extra);that.applyData();}
return that;};this.updatefilter=function(id,func){var idObj=that.bindings[id];if(idObj){if(zot(func)){if(idObj.filter)delete idObj.filter;}else{if(typeof func=="function")idObj.filter=func;}}
return that;};this.remove=function(targets,props,extra,filter,removeConnectionData,call){if(!zot(targets)&&!Array.isArray(targets))targets=[targets];if(!zot(targets)){var ids=[];var objs=[];zim.loop(targets,function(target){if(typeof target=="string")ids.push(target);else objs.push(target);});}
if(!zot(props)&&!Array.isArray(props))props=[props];if(zot(removeConnectionData))removeConnectionData=true;var targets=ids.concat(objs);if(targets.length==0)targets=null;var filtered=filterData("from",targets,props,false);var filteredFunctions=filtered[0];filtered=filtered[1];var f=applyFilters("remove",filter,filteredFunctions,filtered,extra);if(f=="stop")return;var rememberdFiltered=zim.copy(filtered);if(zot(props)||props.length==0){if(ids.length>0){zim.loop(ids,function(id){clearID(id,true);});}
if(objs.length>0){zim.loop(objs,function(obj){ids=that.objIDs.at(obj);if(ids.length>0){zim.loop(ids,function(id){clearID(id,false);});}
that.objIDs.remove(obj);});}}else{var ids=[];zim.loop(filtered,function(id,props){var data=that.bindings[id];var arr=data.props;zim.loop(props,function(p){var ind=arr.indexOf(p);if(ind>=0)arr.splice(ind,1);removeToFrom(p,id);});if(arr.length==0)ids.push(id);});if(ids.length>0)that.remove(ids);}
if(removeConnectionData){var conType="type="+that.bindType+"&";if(that.bindType==LOCALSTORAGE){that.to();callbackRemove("success");}else if(that.bindType==GET){var f=JSON.stringify(rememberdFiltered);if(couple)f=zim.couple(f);zim.async(that.connection+conType+"remove="+f,callbackRemove,"callbackRemove");}else if(that.bindType==POST){that.ajax.post(that.connection+conType,rememberdFiltered,callbackRemove,"remove");}else if(that.bindType==SOCKET){}
function callbackRemove(result){if(call&&typeof call=="function"){if(couple)result=zim.couple(result);call(result);}
if(report)sendReport("Bind Report: REMOVE"+(extra?" ["+extra+"]":""),result);}}
function removeToFrom(p,id){var arr,ind;arr=that.fromIDs[p];if(arr){ind=arr.indexOf(id);if(ind>=0)arr.splice(ind,1);if(arr.length==0)delete that.fromIDs[p];}
arr=that.toIDs[p];if(arr){ind=arr.indexOf(id);if(ind>=0)arr.splice(ind,1);if(arr.length==0)delete that.toIDs[p];}}
function clearID(id,checkEmpty){var object=that.bindings[id].obj;var properties=that.bindings[id].props;var arr=that.objIDs.at(object);var ind=arr.indexOf(id);if(ind>=0)arr.splice(ind,1);if(checkEmpty&&arr.length==0)objs.push(object);ind=that.ids.indexOf(id);if(ind>=0)that.ids.splice(ind,1);zim.loop(properties,function(p){removeToFrom(p,id);});delete that.bindings[id];}
return that;};function filterData(type,targets,props,smartDecimals){var filteredFunctions=[];if(zot(targets)&&zot(props)){if(type=="from"&&that.bindType!=LOCALSTORAGE){zim.loop(that.bindings,function(b){if(b.filter)filteredFunctions.push(b.filter);});return[filteredFunctions,"full"];}
var ids=that.ids;}else{if(!zot(targets)&&!Array.isArray(targets))targets=[targets];if(!zot(props)&&!Array.isArray(props))props=[props];if(targets){var ids=[];zim.loop(targets,function(target){if(typeof target=="string"){if(ids.indexOf(target)<0)ids.push(target);}else{var idList=that.objIDs.at(target);if(idList){zim.loop(idList,function(id){if(ids.indexOf(id)<0)ids.push(id);});}}});}}
var filtered={};if(ids)addIDs(props);else if(props)addProps();return[filteredFunctions,filtered];function addIDs(props){zim.loop(ids,function(id){var b=that.bindings[id];if(!b)return;if(b.filter)filteredFunctions.push(b.filter);var o=b.obj;zim.loop(props?props:b.props,function(prop){var p=that.toIDs[prop];if(p&&p.indexOf(id)>=0){if(type=="from"){if(!filtered[id])filtered[id]=[];filtered[id].push(prop);}else{if(!filtered[id])filtered[id]={};var v=o[prop];if(typeof v=="number"&&that.smartDecimals){if(v>1)v=zim.decimals(v,1);else v=zim.decimals(v,2);}
filtered[id][prop]=zim.copy(v);}}});});}
function addProps(){var ids=[];zim.loop(props,function(prop){zim.loop(that.toIDs[prop],function(id){var b=that.bindings[id];if(ids.indexOf(id)<0){if(b.filter)filteredFunctions.push(b.filter);ids.push(id);}
var o=b.obj;if(type=="from"){if(!filtered[id])filtered[id]=[];filtered[id].push(prop);}else{if(!filtered[id])filtered[id]={};var v=o[prop];if(typeof v=="number"&&that.smartDecimals){if(v>1)v=zim.decimals(v,1);else v=zim.decimals(v,2);}
filtered[id][prop]=zim.copy(v);}});});}}
this.stopProcess=false;this.stop=function(){that.stopped=true;};var Process=function(){var that=this;that.stop=function(){that.stopped=true;};};function applyFilters(command,filter,filteredFunctions,filtered,extra){var process=new Process();var dataCheck=(filtered!=null&&!zim.isEmpty(filtered)&&that.data);if(checkStop(process,extra))return["stop",filtered];if(that.masterFilter&&typeof that.masterFilter=="function"){filtered=that.data=that.masterFilter(filtered,command,extra,process);}
var result=zim.loop(filteredFunctions,function(f){if(typeof f=="function"){if(checkStop(process,extra))return"stop";filtered=that.data=f(filtered,command,extra,process);}});if(result=="stop"||checkStop(process,extra))return["stop",filtered];if(filter&&typeof filter=="function"){filtered=that.data=filter(filtered,command,extra,process);}
if(checkStop(process,extra))return["stop",filtered];if(dataCheck&&!that.data&&zon)zogy("Bind()"+(command?" ["+command+"]":"")+(extra?" ["+extra+"]":"")+" - warning, a filter may not have returned data");return["go",filtered];}
function checkStop(process,extra){if(that.stopped||process.stopped){sendReport("STOP"+(extra?" ["+extra+"]":""),process.stopped?"process stopped":"bind stopped");if(process.stopped)process.stop=null;else that.stopped=false;return true;}}
this.to=function(targets,props,extra,filter,smartDecimals,call,lock,unique){var sig="targets, props, extra, filter, smartDecimals, call, lock, unique";var duo;if(duo=zob(that.to,arguments,sig))return duo;var filtered=filterData("to",targets,props,smartDecimals);var filteredFunctions=filtered[0];filtered=filtered[1];var resp=applyFilters("to",filter,filteredFunctions,filtered,extra);filtered=resp[1];if(resp[0]=="stop")return;if(that.bindType==LOCALSTORAGE){localStorage[that.connection]=JSON.stringify(filtered);callbackTo(filtered);}else{var conType="type="+that.bindType+"&";if(!filtered||zim.isEmpty(filtered))return that;if(that.bindType==GET){var f=filtered;if(!zim.isJSON(f))f=JSON.stringify(f);if(couple)f=zim.couple(f);if(report)sendReport("Bind Report: TO [bindings]",f);f=zim.urlEncode(f);var addMaster=!zot(that.master)?"&master="+zim.urlEncode(master):"";var addLock=!zot(lock)?"&lock="+zim.urlEncode(lock):"";var addUnique=!zot(unique)?"&unique="+zim.urlEncode(unique):"";var addExtra=!zot(extra)?"&extra="+zim.urlEncode(extra):"";var fLine=that.connection+conType+"command=to&data="+f+addMaster+addLock+addUnique+addExtra;if(report)sendReport("Bind Report: TO [url]",fLine);zim.async(fLine,callbackTo,"callbackTo");}else if(that.bindType==POST){that.ajax.master=master;that.ajax.couple=couple;that.ajax.lock=lock;that.ajax.unique=unique;if(report)sendReport("Bind Report: TO [bindings]",filtered);that.ajax.post(that.connection+conType,filtered,"to",extra,callbackTo);}else if(that.bindType==SOCKET){}}
function callbackTo(result){if(couple)result=zim.decouple(result);if(call&&typeof call=="function")call(result);if(report)sendReport("Bind Report: TO"+(extra?" ["+extra+"]":" -"),result);}
return that;};this.toLock=function(targets,props,extra,filter,smartDecimals,call){var sig="targets, props, extra, filter, smartDecimals, call";var duo;if(duo=zob(that.toLock,arguments,sig))return duo;if(that.bindType.toLowerCase()=="localstorage"){that.to(targets,props,extra,filter,smartDecimals,call);return that;}
var lock=zim.makeID();that.from(returnCall,targets,props,extra,filter,lock);function returnCall(data){that.to(targets,props,extra,filter,smartDecimals,call,lock);}};this.toUnique=function(targets,props,extra,filter,smartDecimals,call){var sig="targets, props, extra, filter, smartDecimals, call";var duo;if(duo=zob(that.toUnique,arguments,sig))return duo;that.to(targets,props,extra,filter,smartDecimals,call,null,true);};this.toggleReport=function(state){if(!zot(state))report=state;else report=!report;return that;};if(report)sendReport("Bind Report: CREATE ["+bindType.toUpperCase()+"]",connection+(master?" "+master:""));function sendReport(t,m){if(that==zimDefaultBind)zogl(t,m);else zogd(t,m);}
this.report=function(){var t="Bind {DATA} Report:";var m=zim.copy(that.data);if(that==zimDefaultBind)zogl(t,m);else zogd(t,m);var t="Bind {BINDINGS} Report:";var m=zim.copy(that.bindings);if(that==zimDefaultBind)zogl(t,m);else zogd(t,m);};this.from=function(call,targets,props,extra,filter,lock){var sig="call, targets, props, extra, filter, lock";var duo;if(duo=zob(that.from,arguments,sig))return duo;var filtered=filterData("from",targets,props,smartDecimals);var filteredFunctions=filtered[0];filtered=filtered[1];var resp=applyFilters("fromTo",filter,filteredFunctions,filtered,extra);filtered=resp[1];if(resp[0]=="stop")return;var conType="type="+that.bindType+"&";if(that.bindType==LOCALSTORAGE){if(!localStorage[that.connection]||localStorage[that.connection]==undefined)localStorage[that.connection]='{}';that.data=JSON.parse(localStorage[that.connection]);callbackFrom(that.data);}else{if(that.bindType==GET){var f=filtered;if(!zim.isJSON(f))f=JSON.stringify(f);if(couple)f=zim.couple(f);if(report)sendReport("Bind Report: FROM [bindings]",f);f=zim.urlEncode(f);var addMaster=!zot(that.master)?"&master="+zim.urlEncode(master):"";var addLock=!zot(lock)?"&lock="+zim.urlEncode(lock):"";var addExtra=!zot(extra)?"&extra="+zim.urlEncode(extra):"";var fLine=that.connection+conType+"data="+f+"&command=from"+addMaster+addLock+addExtra;if(report)sendReport("Bind Report: FROM [url]",fLine);zim.async(fLine,callbackFrom,"callbackFrom");}else if(that.bindType==POST){that.ajax.master=master;that.ajax.couple=couple;that.ajax.lock=lock;if(report)sendReport("Bind Report: FROM [bindings]",filtered);that.ajax.post(that.connection+conType,filtered,"from",extra,callbackFrom);}else if(that.bindType==SOCKET){}}
function callbackFrom(data){that.data=data;if(couple)that.data=zim.decouple(that.data);if(!zot(lock))var origData=JSON.stringify(that.data);var resp=applyFilters("from",filter,filteredFunctions,that.data,extra);if(resp[0]=="stop")return;var appliedCheck=false;if(zot(lock)||origData!=JSON.stringify(that.data)){appliedCheck=true;that.applyData();}
if(report)sendReport("Bind Report: FROM"+(extra?" ["+extra+"]":" -"),appliedCheck?that.data:"data not applied in toLock()");if(call&&typeof call=="function")call(that.data);}
return that;};this.applyData=function(){zim.loop(that.data,function(id,props){var binding=that.bindings[id];if(binding){var obj=that.bindings[id].obj;zim.loop(props,function(prop,val){obj[prop]=val;});}});return that;};this.clear=function(){if(that.bindType==LOCALSTORAGE)localStorage[that.connection]=null;return that;};this.removeAllBindings=function(removeConnectionData,call){if(zot(removeConnectionData))removeConnectionData=true;this.bindings={};this.ids=[];this.data={};this.objIDs=new zim.Dictionary(true);this.toIDs={};this.fromIDs={};if(removeConnectionData){var conType="type="+that.bindType+"&";if(that.bindType==LOCALSTORAGE){that.clear();callbackRemoveAll("success");}else if(that.bindType==GET){var addMaster=!zot(that.master)?"&master="+encodeURI(master):"";zim.async(that.connection+conType+"command=removeAll"+addMaster,callbackRemoveAll,"callbackRemoveAll");}else if(that.bindType==POST){that.ajax.master=master;that.ajax.post(that.connection+conType,{},"removeAll",null,callbackRemoveAll,"removeAll");}else if(that.bindType==SOCKET){}
function callbackRemoveAll(result){if(call&&typeof call=="function")(call)(result);if(report)sendReport("Bind Report: REMOVEALL",result);}}
return that;};return that;};zim.Swipe=function(obj,distance,duration,isometric,overrideNoSwipe){var sig="obj, distance, duration, isometric, overrideNoSwipe";var duo;if(duo=zob(zim.Swipe,arguments,sig,this))return duo;z_d("70");this.cjsEventDispatcher_constructor();this.type="Swipe";if(zot(obj)||!obj.on){zog("zim controls - Swipe():\nPlease pass in object");return;}
if(zot(distance))distance=30;var timeType=getTIME(duration);if(zot(duration))duration=timeType=="s"?.08:80;this.distance=distance;this.duration=duration;this.active=true;var startX;var startY;var downCheck;var mouseX;var mouseY;var downCheck;var timer;var that=this;var stage;var pmEvent;var puEvent;var mdEvent=obj.on("mousedown",function(e){if(!that.active||(!overrideNoSwipe&&e.target.zimNoSwipe))return;that.obj=e.target;stage=e.target.stage;mouseX=startX=e.stageX/zim.scaX;mouseY=startY=e.stageY/zim.scaY;downCheck=true;that.dispatchEvent("swipedown");clearTimeout(timer);timer=setTimeout(function(){if(downCheck){checkSwipe();downCheck=false;}},that.duration*(timeType=="s"?1000:1));pmEvent=obj.on("pressmove",function(e){mouseX=e.stageX/zim.scaX;mouseY=e.stageY/zim.scaY;});puEvent=obj.on("pressup",function(e){if(downCheck){checkSwipe();downCheck=false;clearTimeout(timer);}});function checkSwipe(){var swipeCheck=false;var ev=new createjs.Event("swipe");ev.obj=that.obj;ev.stageX=e.stageX/zim.scaX;ev.stageY=e.stageY/zim.scaY;ev.rawX=e.rawX/zim.scaX;ev.rawY=e.rawY/zim.scaY;ev.swipeX=ev.swipeY=0;that.direction="none";if(isometric){if(Math.abs(mouseX-startX)>that.distance||Math.abs(mouseY-startY)>that.distance){var angle=Math.atan2((mouseY-startY),(mouseX-startX))*180/Math.PI;angle=(angle+360)%360;if(angle>=270&&angle<360){ev.swipeY=-1;that.direction="up";}
else if(angle>=0&&angle<90){ev.swipeX=1;that.direction="right";}
else if(angle>=90&&angle<180){ev.swipeY=1;that.direction="down";}
else if(angle>=180&&angle<270){ev.swipeX=-1;that.direction="left";}}}else{if(Math.abs(mouseX-startX)>Math.abs(mouseY-startY)){if(mouseX-startX>that.distance){ev.swipeX=1;that.direction="right";}
if(startX-mouseX>that.distance){ev.swipeX=-1;that.direction="left";}}else{if(mouseY-startY>that.distance){ev.swipeY=1;that.direction="down";}
if(startY-mouseY>that.distance){ev.swipeY=-1;that.direction="up";}}}
that.dispatchEvent(ev);}});this.disable=function(){that.active=false;};this.enable=function(){that.active=true;};this.dispose=function(){if(mdEvent)obj.off("mousedown",mdEvent);if(pmEvent)obj.off("pressmove",pmEvent);if(puEvent)obj.off("pressup",puEvent);};};zim.extend(zim.Swipe,createjs.EventDispatcher,null,"cjsEventDispatcher",false);zim.Swiper=function(swipeOn,target,property,sensitivity,swiperType,min,max,damp,integer,factor,loop,pauseTime){var sig="swipeOn, target, property, sensitivity, swiperType, min, max, damp, integer, factor, loop, pauseTime";var duo;if(duo=zob(zim.Swiper,arguments,sig,this))return duo;z_d("69.5");this.cjsEventDispatcher_constructor();this.type="Swiper";if(zot(swipeOn)||!swipeOn.getStage||!swipeOn.stage){zog("zim.Swiper() - please provide container on stage");return;}
if(zot(target))return;if(zot(sensitivity))sensitivity=1;if(zot(swiperType))swiperType="horizontal";if(zot(damp))damp=.1;if(zot(integer))integer=false;if(zot(factor))factor=1;if(zot(loop))loop=false;var timeType=getTIME(pauseTime);if(zot(pauseTime))pauseTime=timeType=="s"?.2:200;var that=this;var container=swipeOn;var startPos;var startVal;var desiredVal=that.desiredValue=target[property];var stage;this.target=target;this.property=property;this.sensitivity=sensitivity;var downEvent;var moveEvent;var upEvent;var downCheck=false;if(container.canvas){downEvent=container.on("stagemousedown",function(e){downCheck=true;downHandler(e);moveEvent=container.on("stagemousemove",pressHandler);upEvent=container.on("stagemouseup",function(){downCheck=false;container.off("stagemousemove",moveEvent);container.off("stagemouseup",upEvent);that.dispatchEvent("swipeup");});});stage=container;}else{stage=container.stage;offMouseEvents();downEvent=container.on("mousedown",downHandler);moveEvent=container.on("pressmove",pressHandler);upEvent=container.on("pressup",function(){downCheck=false;that.dispatchEvent("swipeup");});}
var stage;var a1,a2,cent;var maxR=Math.sqrt(Math.pow(container.width,2)+Math.pow(container.height,2));function downHandler(e){stage=e.target.stage;cent=(container.parent?container.parent:container).localToGlobal(container.x,container.y);downCheck=true;if(swiperType=="radial"){startPosX=e.stageX/zim.scaX;startPosY=e.stageY/zim.scaY;a1=Math.atan2(startPosY-cent.y,startPosX-cent.x)*DEG;}else{startPos=swiperType=="horizontal"?e.stageX/zim.scaX:e.stageY/zim.scaY;}
startVal=that.target[that.property];that.dispatchEvent("swipedown");}
function pressHandler(e){if(swiperType=="radial"){if(!downCheck)return;var diff=zim.dist(startPosX,startPosY,e.stageX/zim.scaX,e.stageY/zim.scaY);a2=Math.atan2(e.stageY/zim.scaY-cent.y,e.stageX/zim.scaX-cent.x)*DEG;var si=zim.sign(a1-a2);if(Math.abs(a2-a1)>180){downCheck=false;return;}
diff=diff*si;var radialDist=Math.max(10,zim.dist(cent.x,cent.y,e.stageX/zim.scaX,e.stageY/zim.scaY));diff*=(maxR-radialDist)/maxR}else{var diff=startPos-(swiperType=="horizontal"?e.stageX/zim.scaX:e.stageY/zim.scaY);}
if(Math.abs(diff)>0)that.swiperMoving=true;desiredVal=startVal-diff*that.sensitivity*factor;if(!zot(min)&&!zot(max)&&loop){var lastDesiredVal=desiredVal;desiredVal=(desiredVal+(max-min)*10000-min)%(max-min)+min;if(Math.abs(lastDesiredVal-desiredVal)>Math.abs(max-min)*.8){that.immediate(desiredVal);startPos=swiperType=="horizontal"?e.stageX/zim.scaX:e.stageY/zim.scaY;startVal=that.target[that.property];}}else{if(!zot(min))desiredVal=Math.max(desiredVal,min);if(!zot(max))desiredVal=Math.min(desiredVal,max);}
that.desiredValue=desiredVal;that.dispatchEvent("swipemove");}
var swiperDamp=new zim.Damp(that.target[that.property],damp);var lastValue=that.target[that.property];var lastDesiredVal=desiredVal;var lastPausedVal=desiredVal;that.target.swiperTicker=zim.Ticker.add(function(){if(desiredVal==lastDesiredVal){if(desiredVal!=lastPausedVal){if(that.pauseTimeout)that.pauseTimeout.clear();lastPausedVal=desiredVal;that.pauseTimeout=zim.timeout(pauseTime,function(){if(downCheck)that.dispatchEvent("swipepause");that.pauseTimeout=null;});}}else{lastPausedVal=null;lastDesiredVal=desiredVal;if(that.pauseTimeout)that.pauseTimeout.clear();}
if(!that.swiperMoving)return;that.target[that.property]=integer?Math.round(swiperDamp.convert(desiredVal)):swiperDamp.convert(desiredVal);if(!downCheck&&Math.abs(that.target[that.property]-desiredVal)<((!zot(max)&&!zot(min))?Math.abs(max-min)/1000:.5)){that.swiperMoving=false;that.target[that.property]=desiredVal;that.immediate(that.target[that.property]);that.dispatchEvent("swipestop");}else{lastValue=that.target[that.property];}},stage);this.immediate=function(val){swiperDamp.immediate(val);that.target[that.property]=integer?Math.round(val):val;that.desiredValue=desiredVal=val;};var _enabled=true;Object.defineProperty(that,'enabled',{get:function(){return _enabled;},set:function(value){if(_enabled==value)return;if(value){enable();}else{disable();}
_enabled=Boolean(value);}});Object.defineProperty(that,'desiredValue',{get:function(){return desiredVal;},set:function(value){desiredVal=value;}});Object.defineProperty(that,'damp',{get:function(){return damp;},set:function(value){damp=value;swiperDamp.damp=damp;}});function offStageEvents(){container.off("stagemousedown",downEvent);container.off("stagemousemove",moveEvent);container.off("stagemouseup",upEvent);}
function offMouseEvents(){container.off("mousedown",downEvent);container.off("pressmove",moveEvent);container.off("pressup",upEvent);}
function disable(){if(container.canvas)offStageEvents();else offMouseEvents();zim.Ticker.remove(that.target.swiperTicker);}
function enable(){if(container.canvas){downEvent=container.on("stagemousedown",downEvent);}else{downEvent=container.on("mousedown",downEvent);moveEvent=container.on("pressmove",moveEvent);upEvent=container.on("pressup",upEvent);}
that.immediate(that.target[that.property]);that.target.swiperTicker=zim.Ticker.add(that.target.swiperTicker,stage);}
this.dispose=function(a,b,disposing){disable();swiperDamp=null;};};zim.extend(zim.Swiper,createjs.EventDispatcher,null,"cjsEventDispatcher",false);zim.MotionController=function(target,type,speed,axis,boundary,map,diagonal,damp,flip,orient,constant,firstPerson,turnSpeed,moveThreshold,stickThreshold,container,localBounds,mouseMoveOutside,mousedownIncludes,minPercentSpeed,maxPercentSpeed,dampKeyup,rotate){var sig="target, type, speed, axis, boundary, map, diagonal, damp, flip, orient, constant, firstPerson, turnSpeed, moveThreshold, stickThreshold, container, localBounds, mouseMoveOutside, mousedownIncludes, minPercentSpeed, maxPercentSpeed, dampKeyup, rotate";var duo;if(duo=zob(zim.MotionController,arguments,sig,this))return duo;z_d("69.7");this.cjsEventDispatcher_constructor();this.type="MotionController";var that=this;var stage;var message="zim MotionController(): Please pass in a reference to the stage or a container on the stage";if(zot(container)){if(zdf){stage=container=zdf.stage;}else{zog(message);return;}}else if(zot(container.stage)){if(zdf){stage=zdf.stage;}else{zog(message);return;}}else{stage=container.stage;}
var frame=stage.frame;if(!zot(orient))rotate=orient;if(zot(target)){target=new zim.Container(1,1,null,null,false);}
var accelerator=target.type=="Accelerator";if(zot(speed))speed=7;if(!zot(type)&&type.type=="DPad"){var dPad=type;type="manual";if(zot(axis))axis=dPad.axis;if(axis=="all")axis="both";var dPadStartX=target.x;var dPadStartY=target.y;dPad.on("change",function(){that.convert(target.x+dPad.dirX*speed,target.y+dPad.dirY*speed);});}
if(zot(type)||(type!="mousemove"&&type!="pressmove"&&type!="pressdrag"&&type!="keydown"&&type!="gamebutton"&&type!="gamestick"&&type!="swipe"&&type!="follow"&&type!="manual"))type="mousedown";if(zot(axis))axis=accelerator?"horizontal":"both";if(type=="keydown"&&zot(map))map=[[65,37],[68,39],[87,38],[83,40]];if(type=="gamebutton"&&zot(map)){if(firstPerson){map=[14,15,zim.GamePad.RT,zim.GamePad.LT];}else{map=[14,15,12,13];}}
if(type=="gamestick"&&zot(map)){if(firstPerson){map=[[0,2],[0,2],[1],[1]];}else{map=[0,0,1,1];}}
if(type=="gamestick"&&zot(map))map=[0,0,1,1];if(zot(diagonal))diagonal=true;if(axis=="horizontal"||axis=="vertical")diagonal=false;if(zot(damp))damp=(type=="keydown"||type=="gamebutton")?1:(type=="pressmove"?.2:.1);if(zot(firstPerson))firstPerson=false;if(zot(turnSpeed))turnSpeed=speed*.4;if(zot(moveThreshold))moveThreshold=4;if(zot(stickThreshold))stickThreshold=.2;if(zot(mouseMoveOutside))mouseMoveOutside=false;stage.mouseMoveOutside=mouseMoveOutside;if(zot(mousedownIncludes))mousedownIncludes=[];if(!Array.isArray(mousedownIncludes))mousedownIncludes=[mousedownIncludes];if(target.type=="Pen"&&!target.move){mousedownIncludes.push(target,target.paper);}else{mousedownIncludes.push(target);}
target.motionController=this;this.mousedownIncludes=mousedownIncludes;if(zot(dampKeyup))dampKeyup=.3;that.dampKeyup=dampKeyup;this.dirX=0;this.dirY=0;this.speed=speed;this.turnSpeed=turnSpeed;this.axis=axis;this.target=target;this.moveThreshold=moveThreshold;this.stickThreshold=stickThreshold;this.boundary=boundary;target.zimMCStartAngle=target.rotation;var speedX=that.speed;var speedY=that.speed;var flipRotation=0;that.rotation=target.zimMCStartAngle;var proportion;var bb;if(accelerator){bb=container.getBounds();var dist;if(!bb||(axis=="vertical"&&!bb.height)||(axis!="vertical"&&!bb.width))dist=1000;else dist=axis=="vertical"?bb.height:bb.width;if(zot(minPercentSpeed))minPercentSpeed=0;if(zot(maxPercentSpeed))maxPercentSpeed=100;if(zot(this.target.percentSpeed))this.target.percentSpeed=(maxPercentSpeed-minPercentSpeed)/2;that.x=dist/2;that.y=dist/2;proportion=new zim.Proportion(0,dist,minPercentSpeed,maxPercentSpeed);}else{that.x=this.target.x;that.y=this.target.y;}
var originalScaleX=that.scaleX=target.scaleX;var originalScaleY=that.scaleY=target.scaleY;var mouseEvent;var mouseEvent2;var mouseEvent3;var mouseEvent4;var pressing=false;var moveCheck=false;if(type=="keydown"||type=="gamebutton"){for(var i=0;i<4;i++){if(!Array.isArray(map[i]))map[i]=[map[i]];}
var down=[0,0,0,0];var ord=[];var way=["X","X","Y","Y"];var dir=[-1,1,-1,1];var names=["left","right","up","down"];var rots=[-180,0,-90,90];var d={dirX:0,dirY:0};if(type=="keydown"){var keydownEvent=frame.on("keydown",doDown);}else{var gamepad=that.gamepad=new zim.GamePad();var buttondownEvent=gamepad.on("buttondown",doDown);}
function doDown(e){var key=type=="keydown"?e.keyCode:e.buttonCode;var inOrd;for(i=0;i<4;i++){if(map[i].indexOf(key)>-1){if(!diagonal&&that.axis=="both")d.dirX=d.dirY=0;d["dir"+way[i]]=dir[i];down[i]=1;inOrd=ord.indexOf(i);if(inOrd==0)return;if(inOrd>0)ord.splice(inOrd,1);ord.unshift(i);return;}}}
if(zot(constant)){if(type=="keydown"){var keyupEvent=frame.on("keyup",doUp);}else{var buttonupEvent=gamepad.on("buttonup",doUp);}}
function doUp(e){var key=type=="keydown"?e.keyCode:e.buttonCode;var inOrd;for(i=0;i<4;i++){if(map[i].indexOf(key)>-1){down[i]=0;inOrd=ord.indexOf(i);if(inOrd>=0)ord.splice(inOrd,1);if(that.axis!="both"||diagonal){d["dir"+way[i]]=-down[Math.floor(i/2)*2]+down[Math.floor(i/2)*2+1];}else{if(ord.length>0){d["dir"+way[i]]=0;var iOrd=ord[0];d["dir"+way[iOrd]]=dir[iOrd];}else{d.dirX=d.dirY=0;}}
return;}}}
var first={rotation:0,speedX:that.speed,speedY:that.speed};var keyTicker=zim.Ticker.add(function(){if(firstPerson){doFirstPerson(d);return;}
var sX=that.speed;var sY=that.speed;if(that.axis=="both"&&d.dirX!=0&&d.dirY!=0){var trig=doTrig(d.dirX,d.dirY);sX=trig.speedX;sY=trig.speedY;}
if(that.axis=="horizontal"||that.axis=="both"){that.x+=sX*d.dirX;}
if(that.axis=="vertical"||that.axis=="both"){that.y+=sY*d.dirY;}
calculate();},stage);}else if(type=="mousedown"||type=="mousemove"){mouseEvent=stage.on("stage"+type,function(e){stage=e.target.stage;if(type=="mousedown"){if(!Array.isArray(that.mousedownIncludes))that.mousedownIncludes=[that.mousedownIncludes];if(that.mousedownIncludes.indexOf(container)<0){for(var i=0;i<container.numChildren;i++){var child=container.getChildAt(i);if(that.mousedownIncludes.indexOf(child)==-1&&child.mouseEnabled&&child.hitTestPoint&&child.hitTestPoint(e.stageX/zim.scaX,e.stageY/zim.scaY))return;}}
that.dispatchEvent("mousedown");}
var p=container.globalToLocal(mouseMoveOutside?e.rawX/zim.scaX:e.stageX/zim.scaX,mouseMoveOutside?e.rawY/zim.scaY:e.stageY/zim.scaY);that.x=p.x;that.y=p.y;calculate();});}else if(type=="pressmove"||type=="pressdrag"||type=="follow"){if(target.type=="Pen")target.write=false;mouseEvent=stage.on("stagemousedown",function(e){if(target.type=="Pen"&&that.boundary){var pp={x:e.stageX/zim.scaX,y:e.stageY/zim.scaY};if(pp.x<that.boundary.x||pp.x>that.boundary.x+that.boundary.width||pp.y<that.boundary.y||pp.y>that.boundary.y+that.boundary.height)return;}
if(type=="pressdrag"&&!target.hitTestPoint(e.stageX/zim.scaX,e.stageY/zim.scaY))return;moveCheck=false;if(!Array.isArray(that.mousedownIncludes))that.mousedownIncludes=[that.mousedownIncludes];var inCheck=false;var under;if(that.mouseDownIncludes)under=stage.getObjectUnderPoint(e.stageX,e.stageY,1);for(var i=0;i<that.mousedownIncludes.length;i++){if(under&&that.mousedownIncludes[i].hitTestPoint&&that.mousedownIncludes[i].hitTestPoint(e.stageX/zim.scaX,e.stageY/zim.scaY)&&that.mousedownIncludes[i].contains(under)){inCheck=true;}}
if(!inCheck){for(var i=0;i<container.numChildren;i++){var child=container.getChildAt(i);if(that.mousedownIncludes.indexOf(child)==-1&&child.mouseEnabled&&child.hitTestPoint&&child.hitTestPoint(e.stageX/zim.scaX,e.stageY/zim.scaY))return;}}
var p=container.globalToLocal(mouseMoveOutside?e.rawX/zim.scaX:e.stageX/zim.scaX,mouseMoveOutside?e.rawY/zim.scaY:e.stageY/zim.scaY);if(type!="follow"&&type!="pressdrag")that.immediate(((axis=="both"||axis=="horizontal")?p.x:null),((axis=="both"||axis=="vertical")?p.y:null));calculate();that.dispatchEvent("mousedown");pressing=true;that.moveX=mouseMoveOutside?e.rawX/zim.scaX:e.stageX/zim.scaX;that.moveY=mouseMoveOutside?e.rawY/zim.scaY:e.stageY/zim.scaY;mouseEvent2=stage.on("stagemousemove",function(e){that.moveX=mouseMoveOutside?e.rawX/zim.scaX:e.stageX/zim.scaX;that.moveY=mouseMoveOutside?e.rawY/zim.scaY:e.stageY/zim.scaY;if(type!="follow")moveMe();});if(mouseEvent4)zim.Ticker.remove(mouseEvent4);if(type=="follow")mouseEvent4=zim.Ticker.add(moveMe);if(target.type=="Pen"){target.write=true;target.zimDragCheck=true;}});mouseEvent3=stage.on("stagemouseup",function(e){if(target.type=="Pen"){target.write=false;target.zimDragCheck=false;if(moveCheck)target.stopCheck();}
if(mouseEvent4)zim.Ticker.remove(mouseEvent4);stage.off("stagemousemove",mouseEvent2);pressing=false;});function moveMe(){var p=container.globalToLocal(that.moveX,that.moveY);that.x=p.x;that.y=p.y;calculate();if(target.type=="Pen"&&!moveCheck&&target.drawing)moveCheck=true;}}else if(type=="gamestick"){var gamepad=this.gamepad=new zim.GamePad();for(var i=0;i<4;i++){if(!Array.isArray(map[i]))map[i]=[map[i]];}
var first={rotation:target.zimMCStartAngle,speedX:that.speed,speedY:that.speed};var stickEvent=gamepad.on("data",function(e){d={dirX:0,dirY:0};for(var i=0;i<map[0].length;i++){var a=e.axes[map[0][i]];if(Math.abs(a)>that.stickThreshold){d.dirX=a;break;}}
for(var i=0;i<map[2].length;i++){var a=e.axes[map[2][i]];if(Math.abs(a)>that.stickThreshold){d.dirY=a;break;}}
if(firstPerson){doFirstPerson(d);return;}
that.x+=that.speed*d.dirX;that.y+=that.speed*d.dirY;calculate();});}else if(type=="swipe"){var swiperX=new zim.Swiper(stage,that,"x",.8);var swiperY=new zim.Swiper(stage,that,"y",.8,false);var swiperEvent=swiperX.on("swipemove",function(){calculate();});}
function doFirstPerson(d){first.rotation+=d.dirX*that.turnSpeed;that.rotation=first.rotation;first.speedX=Math.sin(first.rotation*Math.PI/180)*that.speed* -d.dirY;first.speedY=-Math.cos(first.rotation*Math.PI/180)*that.speed* -d.dirY;that.x+=first.speedX;that.y+=first.speedY;return;}
function calculate(){var diffX=that.x-(accelerator?that.target.percentSpeed:that.target.x);var diffY=that.y-(accelerator?that.target.percentSpeed:that.target.y);var trig=doTrig(diffX,diffY);speedX=trig.speedX;speedY=trig.speedY;if(!rotate)return;if(!zot(trig.angle))that.rotation=trig.angle+target.zimMCStartAngle;if(zot(that.rotation)){that.rotation=that.target.rotation;return;}
that.rotation+=flipRotation;var newR=normalizeAngle(that.rotation);var oldR=that.target.rotation=normalizeAngle(that.target.rotation);if(Math.abs(newR-oldR)>180){if(oldR>newR){oldR-=360;}else{newR-=360;}}
that.dampR.immediate(oldR);that.target.rotation=oldR;that.rotation=newR;}
function normalizeAngle(a){return(a%360+360)%360;}
function doTrig(diffX,diffY){var sX=that.speed;var sY=that.speed;var sA;var hyp=Math.sqrt(Math.pow(diffX,2)+Math.pow(diffY,2));if(hyp>0){sX=Math.abs(diffX)/hyp*that.speed;sY=Math.abs(diffY)/hyp*that.speed;sA=90-Math.atan2(diffX,diffY)*180/Math.PI;}
return{speedX:sX,speedY:sY,angle:sA};}
var lastX=this.x;var lastY=this.y;var tempX=this.x=accelerator?dist/2:this.target.x;var tempY=this.y=accelerator?dist/2:this.target.y;this.dampX=new zim.Damp(tempX,damp);this.dampY=new zim.Damp(tempY,damp);this.dampR=new zim.Damp(this.target.rotation,damp);var lastDirX=0;var lastDirY=0;var mainTicker=zim.Ticker.add(function(){if(type=="manual")calculate();if(that.boundary&&that.boundary.type!="Blob"){that.x=zim.constrain(that.x,that.boundary.x,that.boundary.x+that.boundary.width);that.y=zim.constrain(that.y,that.boundary.y,that.boundary.y+that.boundary.height);}
if(that.axis=="horizontal"||that.axis=="both"){that.dirX=zim.sign(that.x-tempX);if(Math.abs(that.x-tempX)<speedX){tempX=that.x;}else{tempX+=that.dirX*speedX;}
if(d&&d.dirX==0){var desired=that.boundary?that.boundary.width/2:stage.width/2;var newTempX=that.x-(that.x-desired)*(accelerator?that.dampKeyup:0);tempX=newTempX;that.x=tempX;}
if(accelerator&&bb&&bb.width)that.target.percentSpeed=proportion.convert((that.dampX.convert(tempX)));else that.target.x=that.dampX.convert(tempX);}
if(that.axis=="vertical"||that.axis=="both"){that.dirY=zim.sign(that.y-tempY);if(Math.abs(that.y-tempY)<speedY){tempY=that.y;}else{tempY+=zim.sign(that.y-tempY)*speedY;}
if(d&&d.dirY==0){var desired=that.boundary?that.boundary.height/2:stage.height/2;var newTempY=that.y-(that.y-desired)*(accelerator?that.dampKeyup:0);tempY=newTempY;that.y=tempY;}
if(accelerator&&bb&&bb.height)that.target.percentSpeed=proportion.convert(that.dampY.convert(tempY));else that.target.y=that.dampY.convert(tempY);}
if(that.boundary&&that.boundary.type=="Blob"){if(that.boundary.shape.hitTestPoint(that.target.x,that.target.y)){lastX=that.target.x;lastY=that.target.y;}else{that.target.x=that.x=lastX;that.target.y=that.y=lastY;that.immediate(lastX,lastY);}}
if(type=="pressmove"&&pressing)that.dispatchEvent("pressing");that.movingX=Math.abs(tempX-(accelerator?that.target.percentSpeed:that.target.x))>that.moveThreshold;that.movingY=Math.abs(tempY-(accelerator?that.target.percentSpeed:that.target.y))>that.moveThreshold;if(that.moving&&!(that.movingX||that.movingY)){that.dispatchEvent("stopmoving");}else if(!that.moving&&(that.movingX||that.movingY)){that.dispatchEvent("startmoving");}
that.moving=that.movingX||that.movingY;if(that.moving)that.dispatchEvent("moving");if(that.dirX!=lastDirX||that.dirY!=lastDirY){var e=new createjs.Event("change");if(that.dirX!=lastDirX){var options=["left",null,"right"];e.dir=options[that.dirX+1];lastDirX=that.dirX;if(!target.zimMCStartAngle&&(flip=="horizontal"||flip=="both")){that.scaleX=target.scaleX=that.dirX?Math.abs(target.scaleX)*that.dirX:target.scaleX;if(originalScaleX!=0&&Math.round(that.scaleX/originalScaleX)==-1){flipRotation=180;}else{flipRotation=0;}}}else{var options=["up",null,"down"];e.dir=options[that.dirY+1];lastDirY=that.dirY;if(!target.zimMCStartAngle&&(flip=="vertical"||flip=="both")){that.scaleY=target.scaleY=that.dirY?Math.abs(target.scaleY)*that.dirY:target.scaleY;if(originalScaleY!=0&&Math.round(that.scaleY/originalScaleY)==-1){flipRotation=180;}else{flipRotation=0;}}}
that.dispatchEvent(e);}
if(rotate&&!zot(that.rotation)){that.target.rotation=that.dampR.convert(that.rotation);}},stage);this.immediate=function(x,y,r){if(!zot(x)&&that.dampX){that.dampX.immediate(x);if(accelerator)that.x=that.target.percentSpeed=tempX=x;else that.x=that.target.x=tempX=x;if(swiperX)swiperX.immediate(x);}
if(!zot(y)&&that.dampY){that.dampY.immediate(y);if(accelerator)that.y=that.target.percentSpeed=tempY=y;else that.y=that.target.y=tempY=y;if(swiperY)swiperY.immediate(y);}
if(!zot(r)&&that.dampR){that.dampR.immediate(r);that.rotation=that.target.rotation=r;}
lastX=that.x;lastY=that.y;return that;};this.convert=function(x,y){if(!zot(x))that.x=x;if(!zot(y))that.y=y;calculate();};Object.defineProperty(that,'pausingSpeed',{get:function(){return that.speed;},set:function(amount){that.speed=amount;}});this.paused=false;var lastSpeed;this.pause=function(state,time,reset){var pausing;if(zot(state))state=true;if(zot(time))time=0;if(zot(reset))reset=false;if(state){lastSpeed=that.speed;if(time>0){pausing=true;zim.animate({target:that,obj:{pausingSpeed:0},ticker:false,time:time,call:function(){that.speed=0;that.paused=true;pausing=false;that.enabled=false;that.immediate(that.target.x,that.target.y);that.dispatchEvent("pause");}});if(reset){pressing=false;if(mouseEvent2)stage.off("stagemousemove",mouseEvent2);if(mouseEvent4)zim.Ticker.remove(mouseEvent4);if(target.type=="Pen"){target.write=false;target.zimDragCheck=false;}
if(mouseEvent3)stage.off("stagemouseup",mouseEvent3);if(moveCheck)target.stopCheck();if(type=="keydown"){if(keyupEvent)frame.off("keyup",keyupEvent);}else{if(buttonupEvent)gamepad.off("buttonup",buttonupEvent);}}}else{pausing=false;that.speed=0;that.paused=true;that.enabled=false;that.immediate(that.target.x,that.target.y);setTimeout(function(){that.dispatchEvent("pause");},10);}}else{pausing=false;that.enabled=true;if(time>0){zim.animate({target:that,obj:{pausingSpeed:lastSpeed},ticker:false,time:time,call:function(){that.speed=lastSpeed;that.paused=false;pausing=false;}});}else{that.speed=lastSpeed;that.paused=false;}}
return that;};var _enabled=true;Object.defineProperty(that,'enabled',{get:function(){return _enabled;},set:function(value){if(_enabled==value)return;if(value){enable();that.paused=false;}else{disable();that.paused=true;}
_enabled=Boolean(value);}});function enable(){if(type=="keydown"){keydownEvent=frame.on("keydown",keydownEvent);if(keyupEvent)keyupEvent=frame.on("keyup",keyupEvent);keyTicker=zim.Ticker.add(keyTicker,stage);}else if(type=="gamebutton"){buttondownEvent=gamepad.on("buttondown",buttondownEvent);if(buttonupEvent)buttonupEvent=gamepad.on("buttonup",buttonupEvent);keyTicker=zim.Ticker.add(keyTicker,stage);}else if(type=="gamestick"){stickEvent=gamepad.on("data",stickEvent);}else if(type=="swipe"){swiperX.enabled=true;swiperY.enabled=true;if(swiperEvent)swiperEvent=swiperX.on("swipemove",swiperEvent);}else if(type=="mousedown"||type=="mousemove"){mouseEvent=stage.on("stage"+type,mouseEvent);}else if(type=="pressmove"){mouseEvent=stage.on("stagemousedown",mouseEvent);if(mouseEvent2)mouseEvent2=stage.on("stagemousemove",mouseEvent2);if(mouseEvent3)mouseEvent3=stage.on("stagemouseup",mouseEvent3);}
mainTicker=zim.Ticker.add(mainTicker,stage);}
function disable(){if(type=="keydown"){frame.off("keydown",keydownEvent);frame.off("keyup",keyupEvent);zim.Ticker.remove(keyTicker);}else if(type=="gamebutton"){gamepad.off("buttondown",buttondownEvent);gamepad.off("buttonup",buttonupEvent);zim.Ticker.remove(keyTicker);}else if(type=="gamestick"){gamepad.off("data",stickEvent);}else if(type=="swipe"){swiperX.enabled=false;swiperY.enabled=false;swiperX.off("swipemove",swiperEvent);}else if(type=="mousedown"||type=="mousemove"){stage.off("stage"+type,mouseEvent);}else if(type=="pressmove"){stage.off("stagemousedown",mouseEvent);stage.off("stagemousemove",mouseEvent2);stage.off("stagemouseup",mouseEvent3);}
zim.Ticker.remove(mainTicker);}
this.dispose=function(a,b,disposing){disable();if(gamepad)gamepad.dispose();if(swiperX)swiperX.dispose();if(swiperY)swiperX.dispose();};};zim.extend(zim.MotionController,createjs.EventDispatcher,"enabled","cjsEventDispatcher");zim.GamePad=function(){z_d("69.8");this.type="GamePad";this.cjsEventDispatcher_constructor();if(!navigator.getGamepads){this.error=true;if(zon){zog("zim.GamePad() - no browswer support");}return;}
var processPad;window.addEventListener("gamepadconnected",init);this.currentIndex=0;var that=this;function init(eventObject){that.connected=true;dispatch("gamepadconnected",eventObject);var startData=navigator.getGamepads()[that.currentIndex];that.lastData=[];for(var i=0;i<startData.buttons.length;i++){that.lastData[i]=startData.buttons[i].pressed;}
function doPad(){processPad=requestAnimationFrame(doPad);that.data=navigator.getGamepads()[that.currentIndex];if(!that.data)return;var pressed=false;var currentData=that.buttons=[];for(var i=0;i<that.data.buttons.length;i++){currentData[i]=that.data.buttons[i].pressed;if(currentData[i]!=that.lastData[i]){that.lastData[i]=currentData[i];if(currentData[i]){var e=new createjs.Event("buttondown");}else{var e=new createjs.Event("buttonup");}
e.buttonCode=i;e.button=gamePadButtons[i];that.dispatchEvent(e);}}
var e=new createjs.Event("data");e.axes=that.axes=that.data.axes;e.buttons=that.buttons;that.dispatchEvent(e);}
doPad();}
var gamepadCheck=setInterval(function(){if(navigator.getGamepads&&navigator.getGamepads()[0]){if(!that.connected)init();clearInterval(gamepadCheck);}},500);function dispatch(type,eventObject){var e=new createjs.Event(type);e.index=eventObject.gamepad.index;e.id=eventObject.gamepad.id;e.buttons=eventObject.gamepad.buttons;e.axes=eventObject.gamepad.axes;that.dispatchEvent(e);}
var disconnectEvent=function(e){if(e.gamepad.index==that.currentIndex){cancelAnimationFrame(processPad);that.connected=false;that.dispatchEvent("gamepaddisconnected");}}
window.addEventListener("gamepaddisconnected",disconnectEvent);this.dispose=function(a,b,disposing){window.removeEventListener("gamepadconnected",init);window.removeEventListener("gamepaddisconnected",disconnectEvent);cancelAnimationFrame(processPad);clearInterval(gamepadCheck);that.connected=false;};};var gamePadButtons=["A","B","X","Y","LB","RB","LT","RT","BACK","START","LS","RS","DPAD_UP","DPAD_DOWN","DPAD_LEFT","DPAD_RIGHT"];for(var i=0;i<gamePadButtons.length;i++)zim.GamePad[gamePadButtons[i]]=i;var gamePadAxes=["LSX","LSY","RSX","RSY"];for(i=0;i<gamePadAxes.length;i++)zim.GamePad[gamePadAxes[i]]=i;zim.extend(zim.GamePad,createjs.EventDispatcher,null,"cjsEventDispatcher");zim.Portal=function(obj,lands){var sig="obj, lands";var duo;if(duo=zob(zim.Portal,arguments,sig,this))return duo;z_d("69.96");if(zot(obj)||!obj.stage)return;this.type="Portal";var that=this;var landCheck=(lands&&lands.numChildren&&lands.numChildren>0);if(landCheck){var currentLand=lands.getChildAt(lands.numChildren-1);var nextLand=lands.getChildAt(lands.numChildren-2);lands.setChildIndex(nextLand,lands.numChildren-1);nextLand.setMask(obj);}
function setPortal(){lands.setChildIndex(currentLand,0);currentLand=nextLand;nextLand=lands.getChildAt(lands.numChildren-2);lands.setChildIndex(nextLand,lands.numChildren-1);currentLand.setMask(null);nextLand.setMask(obj);obj.stage.update();}
obj.on(zim.mobile()?"mousedown":"mouseover",function(){if(!that._enabled)return;if(landCheck)setPortal();that.dispatchEvent("enter");});obj.on(zim.mobile()?"pressup":"mouseout",function(){if(!that._enabled)return;that.dispatchEvent("exit");});Object.defineProperty(this,'portal',{get:function(){return obj;},set:function(s){if(zot(s)||!s.stage){if(zon){zog("zim.Portal() - please provide a Display Object to act as the portal");return;}}
nextLand.setMask(obj);}});Object.defineProperty(this,'currentLand',{get:function(){return currentLand;},set:function(land){if(!lands.contains(land))return;while(land!=currentLand){setPortal();}}});Object.defineProperty(this,'nextLand',{get:function(){return nextLand;},set:function(land){if(zon){zog("zim.Portal() - nextLand is read only - remake Portal to change");return;}}});this._enabled=true;Object.defineProperty(that,'enabled',{get:function(){return that._enabled;},set:function(value){that._enabled=value;}});this.dispose=function(a,b,disposing){};};zim.extend(zim.Portal,createjs.EventDispatcher,null,"cjsEventDispatcher",false);window.zimContactListener=null;var zimContactBeginList;var zimContactEndList;function setPhysics(obj,dynamic,contract,shape,friction,linear,angular,density,restitution,maskBits,categoryBits){z_d("69.97");if(zot(contract))contract=0;if(shape=="rectangle")obj.body=obj.physics.makeRectangle(obj.width-contract,obj.height-contract,dynamic,friction,angular,density,restitution,maskBits,categoryBits,linear);else if(shape=="circle")obj.body=obj.physics.makeCircle(obj.width/2-contract,dynamic,friction,angular,density,restitution,maskBits,categoryBits,linear);else if(shape=="triangle"){if(zot(obj.a)){obj.a=obj.width;obj.b=obj.c=Math.sqrt(Math.pow(obj.a/2,2)+Math.pow(obj.height,2));}
obj.body=obj.physics.makeTriangle(obj.a-contract,obj.b-contract,obj.c-contract,dynamic,friction,angular,density,restitution,maskBits,categoryBits,linear);}
obj.body.x=obj.x;obj.body.y=obj.y;obj.body.rotation=obj.rotation;obj.physics.addMap(obj.body,obj);obj.impulse=function(x,y,targetX,targetY){if(zot(x))x=0;if(zot(y))y=0;var defaultTarget=obj.body.GetWorldCenter();if(zot(targetX))targetX=defaultTarget.x*obj.physics.scale;if(zot(targetY))targetY=defaultTarget.y*obj.physics.scale;obj.body.ApplyImpulse(new b2Vec2(x,y),new b2Vec2(targetX/obj.physics.scale,targetY/obj.physics.scale));return obj;};obj.force=function(x,y,targetX,targetY){if(zot(x))x=0;if(zot(y))y=0;var defaultTarget=obj.body.GetWorldCenter();if(zot(targetX))targetX=defaultTarget.x*obj.physics.scale;if(zot(targetY))targetY=defaultTarget.y*obj.physics.scale;obj.body.ApplyForce(new b2Vec2(x,y),new b2Vec2(targetX/obj.physics.scale,targetY/obj.physics.scale));return obj;};obj.setLinearVelocity=function(x,y){obj.body.SetLinearVelocity(new b2Vec2(x,y));return obj;};obj.setAngularVelocity=function(amount){obj.body.SetAngularVelocity(amount);return obj;};obj.spin=function(amount){if(zot(amount))amount=10;obj.body.ApplyTorque(amount*1000);return obj;};obj.torque=function(amount){if(zot(amount))amount=10;obj.body.ApplyTorque(amount);return obj;};obj.follow=function(damp,dampY,leftOffset,rightOffset,upOffset,downOffset,offsetDamp,offsetDampY,horizontal,vertical,borderLock,borderOriginal){var sig="damp, dampY, leftOffset, rightOffset, upOffset, downOffset, offsetDamp, offsetDampY, horizontal, vertical, borderLock, borderOriginal";var duo;if(duo=zob(obj.follow,arguments,sig))return duo;obj.physics.follow(obj,damp,dampY,leftOffset,rightOffset,upOffset,downOffset,offsetDamp,offsetDampY,horizontal,vertical,borderLock,borderOriginal);return obj;};obj.noFollow=function(){obj.physics.follow(null);return obj;};obj.control=function(type,speed,speedY,horizontal,vertical){var sig="type, speed, speedY, horizontal, vertical";var duo;if(duo=zob(obj.control,arguments,sig))return duo;obj.physics.control(obj,type,speed,speedY,horizontal,vertical);return obj;};obj.noControl=function(){obj.physics.noControl(obj);return obj;};obj.sleep=function(){zog(obj.body);obj.body.SetAwake(false);return obj;};obj.wake=function(){obj.body.SetAwake(true);return obj;};function makeContact(){zimContactListener=new b2ContactListener();zimContactBeginList=new zim.Dictionary(true);zimContactEndList=new zim.Dictionary(true);zimContactListener.BeginContact=beginContact;zimContactListener.EndContact=endContact;function beginContact(e){var match=zimContactBeginList.at(e.m_fixtureB.GetBody());if(match)match(e.m_fixtureA.GetBody().zimObj,e.m_fixtureA.GetBody());match=zimContactBeginList.at(e.m_fixtureA.GetBody());if(match)match(e.m_fixtureB.GetBody().zimObj,e.m_fixtureB.GetBody());}
function endContact(e){var match=zimContactEndList.at(e.m_fixtureB.GetBody());if(match)match(e.m_fixtureA.GetBody().zimObj,e.m_fixtureA.GetBody());match=zimContactEndList.at(e.m_fixtureB.GetBody().zimObj,e.m_fixtureB.GetBody());if(match)match(e.m_fixtureB.GetBody());}
obj.physics.world.SetContactListener(zimContactListener);}
obj.contact=function(f){if(!zimContactListener)makeContact();zimContactBeginList.add(obj.body,f);return obj;};obj.noContact=function(){zimContactBeginList.remove(obj.body);return obj;};obj.contactEnd=function(f){if(!zimContactListener)makeContact();zimContactEndList.add(obj.body,f);return obj;};obj.noContactEnd=function(){zimContactEndList.remove(obj.body);return obj;};Object.defineProperty(obj,'dynamic',{get:function(){return obj.body.GetType()==2;},set:function(val){obj.body.SetType(val==true?2:0);}});}
zim.BlurEffect=function(blurX,blurY,quality,style,group,inherit){var sig="blurX, blurY, quality, style, group, inherit";var duo;if(duo=zob(zim.BlurEffect,arguments,sig,this))return duo;z_d("69.972");this.group=group;var DS=style===false?{}:zim.getStyle("BlurEffect",group,inherit);if(zot(blurX))blurX=DS.blurX!=null?DS.blurX:10;if(zot(blurY))blurY=DS.blurY!=null?DS.blurY:10;if(zot(quality))quality=DS.quality!=null?DS.quality:1;var oa=remember(blurX,blurY,quality);function remember(){return arguments;}
blurX=zik(blurX);blurY=zik(blurY);quality=zik(quality);this.createjsBlurFilter_constructor(blurX,blurY,quality);this.type="BlurEffect";this.clone=function(exact){return new zim.BlurEffect((exact||!zim.isPick(oa[0]))?blurX:oa[0],(exact||!zim.isPick(oa[1]))?blurY:oa[1],(exact||!zim.isPick(oa[2]))?quality:oa[2],style,this.group,inherit);};}
zim.extend(zim.BlurEffect,createjs.BlurFilter,"clone","createjsBlurFilter",false);zim.GlowEffect=function(color,alpha,blurX,blurY,strength,quality,inner,knockout,hideObject,style,group,inherit){var sig="color, alpha, blurX, blurY, strength, quality, inner, knockout, hideObject, style, group, inherit";var duo;if(duo=zob(zim.GlowEffect,arguments,sig,this))return duo;z_d("69.9725");this.group=group;var DS=style===false?{}:zim.getStyle("GlowEffect",group,inherit);if(zot(color))color=DS.color!=null?DS.color:"white";if(zot(alpha))alpha=DS.alpha!=null?DS.alpha:1;if(zot(blurX))blurX=DS.blurX!=null?DS.blurX:30;if(zot(blurY))blurY=DS.blurY!=null?DS.blurY:30;if(zot(strength))strength=DS.strength!=null?DS.strength:1;if(zot(quality))quality=DS.quality!=null?DS.quality:1;if(zot(inner))inner=DS.inner!=null?DS.inner:false;if(zot(knockout))knockout=DS.knockout!=null?DS.knockout:false;if(zot(hideObject))hideObject=DS.hideObject!=null?DS.hideObject:false;var oa=remember(color,alpha,blurX,blurY,strength,quality,inner,knockout,hideObject);function remember(){return arguments;}
blurX=zik(blurX);blurY=zik(blurY);quality=zik(quality);color=zik(color);this.alpha=zik(alpha);this.strength=zik(strength);this.inner=zik(inner);this.knockout=zik(knockout);this.hideObject=zik(hideObject);this.createjsBlurFilter_constructor(blurX,blurY,quality);this.type="GlowEffect";this.usesContext=true;this.applyFilter=function(ctx,x,y,width,height,targetCtx,targetX,targetY){if((this.alpha<=0||this.strength<=0)&&!this.knockout){return true;}
targetCtx=targetCtx||ctx;if(targetX===undefined)targetX=x;if(targetY===undefined)targetY=y;var tImgData=targetCtx.getImageData(targetX,targetY,width,height);var tData=tImgData.data;var dCvs=document.createElement("canvas");dCvs.width=width;dCvs.height=height;var dCtx=dCvs.getContext("2d");var dImgData=dCtx.getImageData(0,0,width,height);var dData=dImgData.data;var inner=this.inner;var red=this._red;var green=this._green;var blue=this._blue;for(var i=0,l=dData.length;i<l;i+=4){var ia=i+3;var alpha=tData[ia];if(!inner){if(alpha!==0){dData[i]=red;dData[i+1]=green;dData[i+2]=blue;dData[ia]=alpha;}}else{if(alpha!==255){dData[i]=red;dData[i+1]=green;dData[i+2]=blue;dData[ia]=255-alpha;}}}
dCtx.putImageData(dImgData,0,0);var strength=this.strength;if(0<strength){this.createjsBlurFilter_applyFilter(dCtx,0,0,width,height);if(255<strength)strength=255;for(var j=1;j<strength;j++){dCtx.drawImage(dCvs,0,0);}}
var ga=this.alpha;if(ga<0)ga=0;else if(1<ga)ga=1;var gco;if(this.knockout){if(inner)gco="source-in";else gco="source-out";}else{if(this.hideObject){zog("hdfd")
if(inner)gco="source-in";else gco="copy";}else{if(inner)gco="source-atop";else gco="destination-over";}}
targetCtx.save();targetCtx.setTransform(1,0,0,1,0,0);targetCtx.globalAlpha=ga;targetCtx.globalCompositeOperation=gco;targetCtx.drawImage(dCvs,targetX,targetY);targetCtx.restore();return true;};Object.defineProperty(this,"color",{get:function(){return this._red<<16|this._green<<8|this._blue;},set:function(value){value=zim.convertColor(value,"hexNumber");this._red=value>>16&0xFF;this._green=value>>8&0xFF;this._blue=value&0xFF;}});this.color=color;this.clone=function(exact){return new zim.GlowFilter((exact||!zim.isPick(oa[0]))?color:oa[0],(exact||!zim.isPick(oa[1]))?alpha:oa[1],(exact||!zim.isPick(oa[2]))?blurX:oa[2],(exact||!zim.isPick(oa[3]))?blurY:oa[3],(exact||!zim.isPick(oa[4]))?quality:oa[4],(exact||!zim.isPick(oa[5]))?strength:oa[5],(exact||!zim.isPick(oa[6]))?inner:oa[6],(exact||!zim.isPick(oa[7]))?knockout:oa[7],(exact||!zim.isPick(oa[8]))?knockout:oa[8],style,this.group,inherit);};}
zim.extend(zim.GlowEffect,createjs.BlurFilter,["clone","applyFilter"],"createjsBlurFilter",false);zim.ShadowEffect=function(distance,angle,color,alpha,blurX,blurY,strength,quality,inner,knockout,hideObject,style,group,inherit){var sig="distance, angle, color, alpha, blurX, blurY, strength, quality, inner, knockout, hideObject, style, group, inherit";var duo;if(duo=zob(zim.ShadowEffect,arguments,sig,this))return duo;z_d("69.973");this.group=group;var DS=style===false?{}:zim.getStyle("ShadowEffect",group,inherit);if(zot(distance))distance=DS.distance!=null?DS.distance:10;if(zot(angle))angle=DS.angle!=null?DS.angle:45;if(zot(color))color=DS.color!=null?DS.color:black;if(zot(alpha))alpha=DS.alpha!=null?DS.alpha:.4;if(zot(blurX))blurX=DS.blurX!=null?DS.blurX:15;if(zot(blurY))blurY=DS.blurY!=null?DS.blurY:15;if(zot(strength))strength=DS.strength!=null?DS.strength:1;if(zot(quality))quality=DS.quality!=null?DS.quality:1;if(zot(inner))inner=DS.inner!=null?DS.inner:false;if(zot(knockout))knockout=DS.knockout!=null?DS.knockout:false;if(zot(hideObject))hideObject=DS.hideObject!=null?DS.hideObject:false;var oa=remember(distance,angle,color,alpha,blurX,blurY,strength,quality,inner,knockout,hideObject);function remember(){return arguments;}
blurX=zik(blurX);blurY=zik(blurY);quality=zik(quality);color=zik(color);distance=zik(distance);angle=zik(angle);var that=this;this.alpha=zik(alpha);this.strength=zik(strength);this.inner=zik(inner);this.knockout=zik(knockout);this.hideObject=zik(hideObject);this.createjsBlurFilter_constructor(blurX,blurY,quality);this.type="ShadowEffect";this.usesContext=true;Object.defineProperty(this,"angle",{get:function(){return angle;},set:function(value){angle=value=(value%360+360)%360;setOffset(distance,value);}});this.angle=angle;Object.defineProperty(this,"distance",{get:function(){return distance;},set:function(value){distance=value;setOffset(value,angle);}});this.distance=distance;function setOffset(distance,angle){var r=angle*zim.RAD;that._offsetX=Math.cos(r)*distance;that._offsetY=Math.sin(r)*distance;};Object.defineProperty(this,"color",{get:function(){return this._red<<16|this._green<<8|this._blue;},set:function(value){value=zim.convertColor(value,"hexNumber");this._red=value>>16&0xFF;this._green=value>>8&0xFF;this._blue=value&0xFF;}});this.color=color;this.applyFilter=function(ctx,x,y,width,height,targetCtx,targetX,targetY){if((this.alpha<=0||this.strength<=0)&&(!this.knockout&&!this.hideObject)){return true;}
targetCtx=targetCtx||ctx;if(targetX===undefined)targetX=x;if(targetY===undefined)targetY=y;var tImgData=targetCtx.getImageData(targetX,targetY,width,height);var tData=tImgData.data;var dCvs=document.createElement("canvas");dCvs.width=width;dCvs.height=height;var dCtx=dCvs.getContext("2d");var dImgData=dCtx.getImageData(0,0,width,height);var dData=dImgData.data;var inner=this.inner;var red=this._red;var green=this._green;var blue=this._blue;for(var i=0,l=dData.length;i<l;i+=4){var ia=i+3;var alpha=tData[ia];if(!inner){if(alpha!==0){dData[i]=red;dData[i+1]=green;dData[i+2]=blue;dData[ia]=alpha;}}else{if(alpha!==255){dData[i]=red;dData[i+1]=green;dData[i+2]=blue;dData[ia]=255-alpha;}}}
dCtx.putImageData(dImgData,0,0);var strength=this.strength;if(0<strength){this.createjsBlurFilter_applyFilter(dCtx,0,0,width,height);if(255<strength)strength=255;for(var j=1;j<strength;j++){dCtx.drawImage(dCvs,0,0);}}
var ga=this.alpha;if(ga<0)ga=0;else if(1<ga)ga=1;var gco;if(this.knockout){if(inner)gco="source-in";else gco="source-out";}else{if(this.hideObject){if(inner)gco="source-in";else gco="copy";}else{if(inner)gco="source-atop";else gco="destination-over";}}
targetCtx.save();targetCtx.setTransform(1,0,0,1,0,0);targetCtx.globalAlpha=ga;targetCtx.globalCompositeOperation=gco;targetCtx.drawImage(dCvs,targetX+this._offsetX,targetY+this._offsetY);targetCtx.restore();return true;};this.getBounds=function(rect){var bounds=this.createjsBlurFilter_getBounds(rect);var ox=this._offsetX;var oy=this._offsetY;if(ox!==0){if(ox<0){bounds.x+=ox;bounds.width+=-ox;}else{bounds.width+=ox;}}
if(oy!==0){if(oy<0){bounds.y+=oy;bounds.height+=-oy;}else{bounds.height+=oy;}}
return bounds;};this.clone=function(exact){return new zim.ShadowFilter((exact||!zim.isPick(oa[0]))?distance:oa[0],(exact||!zim.isPick(oa[1]))?angle:oa[1],(exact||!zim.isPick(oa[2]))?color:oa[2],(exact||!zim.isPick(oa[3]))?alpha:oa[3],(exact||!zim.isPick(oa[4]))?blurX:oa[4],(exact||!zim.isPick(oa[5]))?blurY:oa[5],(exact||!zim.isPick(oa[6]))?quality:oa[6],(exact||!zim.isPick(oa[7]))?strength:oa[7],(exact||!zim.isPick(oa[8]))?inner:oa[8],(exact||!zim.isPick(oa[9]))?knockout:oa[9],(exact||!zim.isPick(oa[10]))?hideObject:oa[10],style,this.group,inherit);};}
zim.extend(zim.ShadowEffect,createjs.BlurFilter,["clone","getBounds","applyFilter"],"createjsBlurFilter",false);zim.ColorEffect=function(redMultiplier,greenMultiplier,blueMultiplier,alphaMultiplier,redOffset,greenOffset,blueOffset,alphaOffset,style,group,inherit){var sig="redMultiplier, greenMultiplier, blueMultiplier, alphaMultiplier, redOffset, greenOffset, blueOffset, alphaOffset, style, group, inherit";var duo;if(duo=zob(zim.ColorEffect,arguments,sig,this))return duo;z_d("69.9735");this.group=group;var DS=style===false?{}:zim.getStyle("ColorEffect",group,inherit);if(zot(redMultiplier))red=DS.redMultiplier!=null?DS.redMultiplier:1;if(zot(greenMultiplier))green=DS.greenMultiplier!=null?DS.greenMultiplier:1;if(zot(blueMultiplier))blue=DS.blueMultiplier!=null?DS.blueMultiplier:1;if(zot(alphaMultiplier))alpha=DS.alphaMultiplier!=null?DS.alphaMultiplier:1;if(zot(redOffset))redOffset=DS.redOffset!=null?DS.redOffset:0;if(zot(greenOffset))greenOffset=DS.greenOffset!=null?DS.greenOffset:0;if(zot(blueOffset))blueOffset=DS.blueOffset!=null?DS.blueOffset:0;if(zot(alphaOffset))alphaOffset=DS.alphaOffset!=null?DS.alphaOffset:0;var oa=remember(redMultiplier,greenMultiplier,blueMultiplier,alphaMultiplier,redOffset,greenOffset,blueOffset,alphaOffset);function remember(){return arguments;}
redMultiplier=zik(redMultiplier);greenMultiplier=zik(greenMultiplier);blueMultiplier=zik(blueMultiplier);alphaMultiplier=zik(alphaMultiplier);redOffset=zik(redOffset);greenOffset=zik(greenOffset);blueOffset=zik(blueOffset);alphaOffset=zik(alphaOffset);this.createjsColorFilter_constructor(redMultiplier,greenMultiplier,blueMultiplier,alphaMultiplier,redOffset,greenOffset,blueOffset,alphaOffset);this.type="ColorEffect";this.clone=function(exact){return new zim.ColorEffect(redMultiplier,greenMultiplier,blueMultiplier,alphaMultiplier,redOffset,greenOffset,blueOffset,alphaOffset
(exact||!zim.isPick(oa[0]))?redMultiplier:oa[0],(exact||!zim.isPick(oa[1]))?greenMultiplier:oa[1],(exact||!zim.isPick(oa[2]))?blueMultiplier:oa[2],(exact||!zim.isPick(oa[2]))?alphaMultiplier:oa[3],(exact||!zim.isPick(oa[2]))?redOffset:oa[4],(exact||!zim.isPick(oa[2]))?greenOffset:oa[5],(exact||!zim.isPick(oa[2]))?blueOffset:oa[6],(exact||!zim.isPick(oa[2]))?alphaOffset:oa[7],style,this.group,inherit);};}
zim.extend(zim.ColorEffect,createjs.ColorFilter,"clone","createjsColorFilter",false);zim.MultiEffect=function(hue,saturation,brightness,contrast,style,group,inherit){var sig="hue, saturation, brightness, contrast, style, group, inherit";var duo;if(duo=zob(zim.MultiEffect,arguments,sig,this))return duo;z_d("69.974");this.group=group;var DS=style===false?{}:zim.getStyle("MultiEffect",group,inherit);if(zot(hue))hue=DS.hue!=null?DS.hue:0;if(zot(saturation))saturation=DS.saturation!=null?DS.saturation:0;if(zot(brightness))brightness=DS.brightness!=null?DS.brightness:0;if(zot(contrast))contrast=DS.contrast!=null?DS.contrast:0;var oa=remember(hue,saturation,brightness,contrast);function remember(){return arguments;}
hue=zik(hue);this.createjsColorMatrixFilter_constructor(new createjs.ColorMatrix().adjustColor(brightness,contrast,saturation,hue));this.type="MultiEffect";this.adjustColor=function(h,s,b,c){if(!zot(hue))hue=zik(h);if(!zot(saturation))saturation=zik(s);if(!zot(brightness))brightness=zik(b);if(!zot(contrast))contrast=zik(c);this.matrix.reset().adjustColor(h,s,b,c);}
Object.defineProperty(this,"brightness",{get:function(){return brightness;},set:function(value){brightness=zik(value);this.matrix.reset().adjustColor(brightness,contrast,saturation,hue);}});Object.defineProperty(this,"contrast",{get:function(){return contrast;},set:function(value){contrast=zik(value);this.matrix.reset().adjustColor(brightness,contrast,saturation,hue);}});Object.defineProperty(this,"saturation",{get:function(){return saturation;},set:function(value){saturation=zik(value);this.matrix.reset().adjustColor(brightness,contrast,saturation,hue);}});Object.defineProperty(this,"hue",{get:function(){return hue;},set:function(value){hue=zik(value);this.matrix=new createjs.ColorMatrix().adjustColor(brightness,contrast,saturation,hue)
this.applyFilter();}});this.clone=function(exact){return new zim.MultiEffect((exact||!zim.isPick(oa[0]))?hue:oa[0],(exact||!zim.isPick(oa[0]))?saturation:oa[0],(exact||!zim.isPick(oa[0]))?brightness:oa[0],(exact||!zim.isPick(oa[0]))?contrast:oa[0],style,this.group,inherit);};}
zim.extend(zim.MultiEffect,createjs.ColorMatrixFilter,"clone","createjsColorMatrixFilter",false);zim.AlphaEffect=function(mask,style,group,inherit){var sig="mask, style, group, inherit";var duo;if(duo=zob(zim.AlphaEffect,arguments,sig,this))return duo;z_d("69.9745");this.group=group;var DS=style===false?{}:zim.getStyle("AlphaEffect",group,inherit);if(zot(mask))mask=DS.mask!=null?DS.mask:null;var oa=remember(mask);function remember(){return arguments;}
mask=zik(mask);if(mask.type=="Bitmap")mask=mask.image;else if(mask.cache)mask=mask.cache().cacheCanvas
this.createjsAlphaMaskFilter_constructor(mask);this.type="AlphaEffect";this.clone=function(exact){return new zim.AlphaEffect((exact||!zim.isPick(oa[0]))?mask:oa[0],style,this.group,inherit);};}
zim.extend(zim.AlphaEffect,createjs.AlphaMaskFilter,"clone","createjsAlphaMaskFilter",false);zim.Parallax=function(layers,damp,auto,stage,startPaused,mouseMoveOutside,clamp){var sig="layers, damp, auto, stage, startPaused, mouseMoveOutside, clamp";var duo;if(duo=zob(zim.Parallax,arguments,sig,this))return duo;z_d("68");this.type="Parallax";if(zot(stage)){if(layers&&layers[0]&&layers[0].obj&&layers[0].obj.stage){stage=layers[0].obj.stage;}else if(zdf){stage=zdf.stage;}else{return;}}
if(zot(auto))auto=true;else auto=false;if(zot(startPaused))startPaused=false;if(zot(mouseMoveOutside))mouseMoveOutside=false;var stageW=stage.getBounds().width;var stageH=stage.getBounds().height;stage.mouseMoveOutside=mouseMoveOutside;var that=this;that.stageEvent=stage.on("stagemousemove",function(e){that.mouseX=e.rawX/zim.scaX;that.mouseY=e.rawY/zim.scaY;});var _damp=(zot(damp))?.1:damp;this.addLayer=function(layer){if(zot(layer.obj)||zot(layer.prop)||zot(layer.propChange))return;var obj={obj:layer.obj,prop:layer.prop};obj[obj.prop]=layer.propChange;if(zot(layer.input))layer.input="mouseX";obj.input=layer.input;obj.split=zot(layer.split)?((layer.input=="mouseX"&&auto)?true:false):layer.split;var inMin=(zot(layer.inMin))?0:layer.inMin;var inMax=(zot(layer.inMax))?((layer.input=="mouseX"||layer.input=="scrollX")?stageW:stageH):layer.inMax;var factor=(zot(layer.factor))?1:layer.factor;var integer=(zot(layer.integer))?false:layer.integer;obj["p_"+obj.prop]=new zim.ProportionDamp(inMin,inMax,0,obj[obj.prop],_damp,factor,integer,clamp);if(obj.prop=="scale"){obj["s_"+obj.prop]=obj.obj.scaleX;}else if(obj.prop=="frame"){obj["s_"+obj.prop]=obj.obj.currentFrame;}else{obj["s_"+obj.prop]=obj.obj[obj.prop];}
if(!zot(layer.immediate))obj["p_"+obj.prop].immediate(layer.immediate);myLayers.push(obj);return that;};this.removeLayer=function(index){if(zot(index))return;var layer=myLayers[index];layer["p_"+layer.prop].dispose();myLayers.splice(index,1);return that;};this.immediate=function(array){var o;for(var i=0;i<myLayers.length;i++){o=myLayers[i];o["p_"+o.prop].immediate(array[i]);}
return that;};this.dispose=function(a,b,disposing){stage.off("stagemousemove",that.stageEvent);myLayers=null;if(auto)zim.Ticker.remove(zimTicker);return true;};layers=(zot(layers))?[]:layers;var myLayers=[];for(var i=0;i<layers.length;i++){this.addLayer(layers[i]);}
if(auto){var zimTicker=zim.Ticker.add(animate,stage);if(startPaused)zim.Ticker.remove(zimTicker);}
function animate(e){that.step();}
this.step=function(custom){var o;var input;for(var i=0;i<myLayers.length;i++){o=myLayers[i];if(zot(custom)){if(o.input=="mouseX")input=that.mouseX;else if(o.input=="mouseY")input=that.mouseY;else if(o.input=="scrollX")input=zim.scrollX();else if(o.input=="scrollY")input=zim.scrollY();}else{input=custom;}
if(o.prop=="scale"){o.obj.scaleX=o.obj.scaleY=o["s_"+o.prop]+o["p_"+o.prop].convert(input);}else if(o.prop=="frame"){o.obj.gotoAndStop(o["s_"+o.prop]+o["p_"+o.prop].convert(input));}else{o.obj[o.prop]=o["s_"+o.prop]+o["p_"+o.prop].convert(input);if(o.split)o.obj[o.prop]-=o[o.prop]/2;}}
return that;};that.paused=startPaused;that.pause=function(state){if(zot(state))state=true;if(that.paused!=state){that.paused=state;if(zimTicker){if(!state)zimTicker=zim.Ticker.add(zimTicker);else zim.Ticker.remove(zimTicker);}}
return that;};Object.defineProperty(that,'damp',{get:function(){return _damp;},set:function(value){_damp=value;var o;for(var i=0;i<myLayers.length;i++){o=myLayers[i];o["p_"+o.prop].damp=_damp;}}});};zim.Flipper=function(front,back,interactive,time,vertical,flipped,easeRoot,frontPress,backPress,style,group,inherit){var sig="front, back, interactive, time, vertical, flipped, easeRoot, frontPress, backPress, style, group, inherit";var duo;if(duo=zob(zim.Flipper,arguments,sig,this))return duo;z_d("68.5");this.group=group;var DS=style===false?{}:zim.getStyle("Flipper",this.group,inherit);if(zot(front))front=DS.front!=null?DS.front:zimDefaultFrame.makeIcon().sca(2);if(zot(back))back=DS.back!=null?DS.back:new zim.Page(front.width,front.height,zim.dark);this.front=front;this.back=back;if(flipped){var temp=front;front=back;back=temp;}
var w=Math.max(front.width,back.width);var h=Math.max(front.height,back.height);this.zimContainer_constructor(w,h);this.type="Flipper";if(zot(time))time=DS.time!=null?DS.time:.2;if(zot(vertical))vertical=DS.vertical!=null?DS.vertical:false;if(zot(interactive))interactive=DS.interactive!=null?DS.interactive:false;if(zot(flipped))flipped=DS.flipped!=null?DS.flipped:false;if(zot(easeRoot))easeRoot=DS.easeRoot!=null?DS.easeRoot:"quad";if(zot(frontPress))frontPress=DS.frontPress!=null?DS.frontPress:true;if(zot(backPress))backPress=DS.backPress!=null?DS.backPress:true;this.flipped=flipped;var that=this;front.centerReg(this);if((frontPress&&!flipped)||(backPress&&flipped)){var obj=(interactive&&front.backing)?front.backing:front;obj.on("mousedown",function(){spin(front,back);});obj.cur();}
if((backPress&&!flipped)||(frontPress&&flipped)){var obj=(interactive&&back.backing)?back.backing:back;obj.on("mousedown",function(){spin(back,front,-1);});obj.cur();}
front.oScale=front.scale;back.oScale=back.scale;front.flipper=that;front.other=back;back.flipper=that;back.other=front;if(!interactive)front.mouseChildren=back.mouseChildren=false;this.flip=function(state,time){if(state==that.flipped)return;if(!that.flipped)spin(front,back,1,time);else spin(back,front,-1,time);};function spin(f,b,d,t){if(zot(d))d=1;if(zot(t))t=time;that.flipped=!that.flipped;that.dispatchEvent("flip");if(t==0){that.removeAllChildren();b.scale=b.oScale;b.skewX=b.skewY=0;b.centerReg(that);that.dispatchEvent("flipped");return;}
if(vertical){var props1={skewX:-90*d,scaleY:f.oScale/2};var props2={skewX:0,scaleY:b.oScale};b.ske(90*d,0).sca(b.oScale,b.oScale/2);}else{var props1={skewY:-90*d,scaleX:f.oScale/2};var props2={skewY:0,scaleX:b.oScale};b.ske(0,90*d).sca(b.oScale/2,b.oScale);}
f.animate({props:props1,time:time,ease:easeRoot+"In",call:function(){f.removeFrom();b.centerReg(that).animate({props:props2,time:time,ease:easeRoot+"Out",call:function(){that.dispatchEvent("flipped");}});}});}
if(style!==false)zim.styleTransforms(this,DS);this.clone=function(){return that.cloneProps(new zim.Flipper(front.clone(),back.clone(),interactive,time,vertical,flipped,easeRoot,frontPress,backPress,style,this.group,inherit));};};zim.extend(zim.Flipper,zim.Container,"clone","zimContainer");zim.Book=function(width,height,pages,startPage,rollUp,radius,backgroundColor,arrows){var sig="width, height, pages, startPage, rollUp, radius, backgroundColor, arrows";var duo;if(duo=zob(zim.Book,arguments,sig,this))return duo;z_d("68.7");if(zot(width))width=zdf?zdf.stage.width:1024;if(zot(height))height=zdf?zdf.stage.height:768;this.zimContainer_constructor(width,height);this.type="Book";if(zot(pages))pages=[];if(zot(startPage))startPage=0;if(zot(rollUp))rollUp=true;if(zot(backgroundColor))backgroundColor=zim.darker;if(zot(arrows))arrows=true;var timeType=getTIME();var that=this;if(pages.length==0)return;that.backing=new Rectangle(width-2,height-2,backgroundColor);zim.loop(pages,function(p,i){if(typeof p=="string"){pages[i]=zim.asset(p);}});that.added(init);var stage;function init(s){stage=s;var frame=stage.frame;var peel=new Shape();var leftPage;var pageFore;var pagePrev;var firstPage;var rightPage
var pageBack;var pageNext;var lastPage;that._currentPage=startPage;function toPage(num){that._currentPage=num;that.removeAllChildren();that.backing.loc(1,1,that);that.setMask(that.backing);peel.addTo(that);peel.c().f(black).dr(0,0,0,0);that.moving=false;if(pages[num-1]){leftPage=pages[num-1].reg(0,0).rot(0).loc(0,0,that);}else if(num>0){lastPage.reg(0,0).rot(0).loc(0,0,that).setMask(null);}
if(pages[num-2]){pageFore=pages[num-2].reg(width/2,height).loc(0,height,that).rot(-90);}else{pageFore=new Rectangle(width/2,height,backgroundColor).reg(width/2,height).loc(0,height,that).rot(-90);firstPage=pageFore;}
if(pages[num-3]){pagePrev=pages[num-3].rot(0).loc(0,0,that).setMask(peel);}else{pagePrev=new Rectangle(width/2,height,backgroundColor).loc(0,0,that).setMask(peel);}
if(pages[num]){rightPage=pages[num].rot(0).reg(0,0).pos(0,0,RIGHT,TOP,that);}else{stage.update();return;}
if(pages[num+1]){pageBack=pages[num+1].reg(0,height).loc(width,height,that).rot(90);}else{pageBack=new Rectangle(width/2,height,backgroundColor).reg(0,height).loc(width,height,that).rot(90);lastPage=pageBack;}
if(pages[num+2]){pageNext=pages[num+2].rot(0).pos(0,0,RIGHT,TOP,that).setMask(peel);}else{pageNext=new Rectangle(width/2,height,backgroundColor).pos(0,0,RIGHT,TOP,that).setMask(peel);}
stage.update();}
toPage(startPage);Object.defineProperty(that,'directPage',{get:function(){return that._currentPage;},set:function(num){if(startPage%2==1){num=Math.ceil(num/2)*2-1}else{num=Math.ceil(num/2)*2}
toPage(num)}});var turningCheck=false;that.currentW=0;that.currentH=0;that.moving=false;function setStageEvent(){that.stageEvent=stage.on("stagemousedown",function(){var w;var h;if(that.moving)return;var point=that.globalToLocal(frame.mouseX,frame.mouseY);if(point.x<0||point.x>width||point.y<0||point.y>height)return;if(radius>0){if(dist(point,new Point(0,height))>radius&&dist(point,new Point(width,height))>radius)return;}
var side=point.x>width/2?"right":"left";if(side=="right"&&that._currentPage>=pages.length-1)return;if(side=="left"&&that._currentPage<=1)return;that.moving=true;if(side=="right"){rightPage.addTo(that);pageBack.addTo(that);pageNext.addTo(that);}else{leftPage.addTo(that);pageFore.addTo(that);pagePrev.addTo(that);if(that.rolledUp)setPeel(0,0,"right");}
that.moveEvent=stage.on("stagemousemove",function(){if(rollUpTimeout){rollUpTimeout.clear();rollUpTimeout=null;}
var point=that.globalToLocal(frame.mouseX,frame.mouseY);if(side=="right"){w=width-frame.mouseX;}else{w=frame.mouseX}
h=height-frame.mouseY+w;that.currentW=w=constrain(w,0,width/2);that.currentH=h=constrain(h,0,height);setPeel(w,h,side);});that.upEvent=stage.on("stagemouseup",function(){stage.off("stagemousemove",that.moveEvent);if(turningCheck)return;rollDown(w,h,side);},null,true);});}
setStageEvent();that.rollUp=function(w,h,side,time,ease){if(that.moving)return;if(side=="right"&&that._currentPage>=pages.length-1)return;if(side=="left"&&that._currentPage<=1)return;if(side=="right"){rightPage.addTo(that);pageBack.addTo(that);pageNext.addTo(that);}else{if(that.rolledUp)setPeel(0,0,"right");leftPage.addTo(that);pageFore.addTo(that);pagePrev.addTo(that);}
that.moving=true;if(zot(time))time=timeType=="s"?.5:.5/1000;if(zot(ease))ease=null;that.animate({props:{currentW:w,currentH:h},time:time,ease:ease,call:function(){Ticker.remove(ticker);that.moving=false;setPeel(w,h,side);}});var ticker=Ticker.add(function(){setPeel(that.currentW,that.currentH,side);});}
if(rollUp!==false){that.rolledUp=true;if(rollUp===true)rollUp=timeType=="s"?1:1/1000;var rollUpTimeout=timeout(rollUp,function(){that.rollUp(60,130,"right",.5);that.dispatchEvent("rollup");});}
that.rollDown=function(w,h,side,time){if(that.moving)return;if(side=="right"&&that._currentPage>=pages.length-1)return;if(side=="left"&&that._currentPage<=1)return;rollDown(w,h,side,time);}
function rollDown(w,h,side,time){that.moving=true;that.rolledUp=false;if(zot(time))time=timeType=="s"?.7:.7/1000;that.animate({props:{currentW:0,currentH:0},time:time,call:function(){Ticker.remove(ticker);setPeel(0,0,side);that.moving=false;}});var ticker=Ticker.add(function(){setPeel(that.currentW,that.currentH,side);});}
function setPeel(w,h,side){if(side=="right"){peel.c().mt(width,height).lt(width-w,height).lt(width,height-h).cp();var a=Math.atan2(w,h);pageBack.loc(width-(w+w*Math.cos(2*a)),height-w*Math.sin(2*a)).rot(a*2*DEG);if(!turningCheck&&w>=width/2&&h>=height)nextPage();}else{peel.c().mt(0,height).lt(w,height).lt(0,height-h).cp();var a=Math.atan2(w,h);pageFore.loc(w+w*Math.cos(2*a),height-w*Math.sin(2*a)).rot(-a*2*DEG);if(!turningCheck&&w>=width/2&&h>=height)prevPage();}
stage.update()}
function nextPage(){turningCheck=true;that.moving=true;if(that.moveEvent)stage.off("stagemousemove",that.moveEvent);if(that.upEvent)stage.off("stagemouseup",that.upEvent);that.currentW=0;that.currentH=0;that.lastPage=zim.constrain(that._currentPage);that.direction="right";that.dispatchEvent("pageanimate");that.animate({ease:"quadOut",props:{currentW:width/2},time:.3,timeUnit:"s",call:function(){Ticker.remove(ticker);pageBack.reg(0,0);pageNext.setMask(null);toPage(that._currentPage+2);that.moving=false;turningCheck=false;that.currentW=0;that.currentH=0;that.dispatchEvent("page");}});var ticker=Ticker.add(function(){peel.c().mt(width,height).lt(width/2,height).lt(width-that.currentW,0).lt(width,0).cp();});pageBack.reg(width/2,height).loc(width/2,height,that).animate({props:{rotation:0},time:.3,ease:"quadOut",timeUnit:"s"});}
function prevPage(){turningCheck=true;that.moving=true;if(that.moveEvent)stage.off("stagemousemove",that.moveEvent);if(that.upEvent)stage.off("stagemouseup",that.upEvent);that.currentW=0;that.currentH=0;that.lastPage=zim.constrain(that._currentPage);that.direction="left";that.dispatchEvent("pageanimate");that.animate({ease:"quadOut",props:{currentW:width/2},time:.3,timeUnit:"s",call:function(){Ticker.remove(ticker);pageFore.reg(0,0);pagePrev.setMask(null);toPage(that._currentPage-2);that.moving=false;turningCheck=false;that.currentW=0;that.currentH=0;that.dispatchEvent("page");}});var ticker=Ticker.add(function(){peel.c().mt(0,height).lt(width/2,height).lt(that.currentW,0).lt(0,0).cp();});pageFore.reg(0,height).loc(width/2,height,that).animate({props:{rotation:0},time:.3,timeUnit:"s",ease:"quadOut"});}
if(arrows){if(arrows===true)arrows=.2;that.keydown=frame.on("keydown",function(e){if(e.keyCode==39)that.nextPage(arrows);else if(e.keyCode==37)that.prevPage(arrows);});}
that.changeFrame=function(f){if(that.stageEvent)stage.off("stagemousedown",that.stageEvent);if(that.moveEvent)stage.off("stagemousemove",that.moveEvent);if(that.upEvent)stage.off("stagemouseup",that.upEvent);frame=f;stage=f.stage;setStageEvent();return that;}}
that.nextPage=function(speed){if(zot(that.rollUp)){timeout(.01,function(){that.nextPage(speed);});return that;}
if(that.moving)return;that.rollUp(width/2+.1,height+.1,"right",speed,"quadIn");}
that.prevPage=function(speed){if(zot(that.rollUp)){timeout(.01,function(){that.prevPage(speed);});return that;}
if(that.moving)return;that.rollUp(width/2+.1,height+.1,"left",speed,"quadIn");}
that.gotoPage=function(num,speed){if(zot(that.rollUp)){timeout(.01,function(){that.gotoPage(num,speed);});return that;}
num=constrain(num,0,that.pages.length-1);if(zot(speed))speed=timeType=="s"?.3:300;var t=speed+(timeType=="s"?.35:350);that.pageInterval=interval(t,function(obj){var imm=false;if(that._currentPage<num)that.nextPage(speed);else if(that._currentPage>num)that.prevPage(speed);else imm=true;that.dispatchEvent("pageturn");if(obj.count==obj.total-1){if(imm)that.dispatchEvent("pagedone");else{timeout(t,function(){that.dispatchEvent("pagedone");});}}},Math.floor(Math.abs(num-that._currentPage)/2+1),true);}
Object.defineProperty(that,'page',{get:function(){return that._currentPage;},set:function(num){that.gotoPage(num,timeType=="s"?.1:100);}});Object.defineProperty(that,'pages',{get:function(){return pages;},set:function(num){if(zon)zogy("Book() - pages is read only");}});this.dispose=function(a,b,disposing){if(that.stageEvent)stage.off("stagemousedown",that.stageEvent);if(that.moveEvent)stage.off("stagemousemove",that.moveEvent);if(that.upEvent)stage.off("stagemouseup",that.upEvent);if(that.keydown)frame.off("keydown",that.keydown);that.removeFrom();if(!disposing)this.zimContainer_dispose(true);return true;};}
zim.extend(zim.Book,zim.Container,["clone","dispose"],"zimContainer");zim.Scroller=function(backing,speed,direction,horizontal,gapFix,stage,container,style,group,inherit){var sig="backing, speed, direction, horizontal, gapFix, stage, container, style, group, inherit";var duo;if(duo=zob(zim.Scroller,arguments,sig,this))return duo;z_d("69");this.cjsEventDispatcher_constructor();this.type="Scroller";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(backing))backing=DS.backing!=null?DS.backing:null;if(zot(backing))return;var b1=this.backing1=backing;if(zot(b1)||!b1.getBounds)return;var b2=this.backing2=backing.clone();if(zot(horizontal))horizontal=DS.horizontal!=null?DS.horizontal:true;if(zot(gapFix))gapFix=DS.gapFix!=null?DS.gapFix:0;if(zot(container))container=DS.container!=null?DS.container:null;if(zot(stage))stage=DS.stage!=null?DS.stage:null;var that=this;if(zot(speed))speed=DS.speed!=null?DS.speed:1;this.speed=speed;var lastSpeed=this.baseSpeed=this.speed;if(zot(direction))direction=DS.direction!=null?DS.direction:1;this.direction=direction;var scale=horizontal?b1.scaleX:b1.scaleY;if(!b1.getBounds()){zog("zim display - Scroller(): please setBounds() on backing objects");return;}
if(!stage&&!b1.stage){zog("zim display - Scroller(): please pass in stage parameter or add backing objects to stage to start");return;}
if(!b1.parent){zog("zim display - Scroller(): please add object to container or stage before adding to Scroller");return;}
b1.parent.addChildAt(b2,b1.parent.getChildIndex(b1));stage=stage||b1.stage;if(zot(container))container=stage;if(!container.getBounds()){zog("zim display - Scroller(): please setBounds() on container or stage if no container");return;}
var w=b1.getBounds().width*scale-gapFix;var h=b1.getBounds().height*scale-gapFix;var viewW;var viewH;if(horizontal){b2.x=w;}else{b2.y=h;}
var pausing=false;var zimTicker=zim.Ticker.add(animate,stage);function animate(e){if(!viewW){viewW=container.getBounds().width;viewH=container.getBounds().height;}
if(that.speed==0||that.direction==0){return;}
if(horizontal){b1.x-=that.speed*that.direction;if(b1.x<b2.x){b2.x=b1.x+w;}else{b2.x=b1.x-w;}
if(that.direction*that.speed>0){if(b2.x<0&&b1.x<b2.x){b1.x=b2.x+w;}else if(b1.x<0&&b2.x<b1.x){b2.x=b1.x+w;}}else{if(b2.x>viewW&&b2.x>b1.x){b2.x=b1.x-w;}else if(b1.x>viewW&&b1.x>b2.x){b1.x=b2.x-w;}}}else{b1.y-=that.speed*that.direction;if(b1.y<b2.y){b2.y=b1.y+h;}else{b2.y=b1.y-h;}
if(that.direction*that.speed>0){if(b2.y<0&&b1.y<b2.y){b1.y=b2.y+h;}else if(b1.y<0&&b2.y<b1.y){b2.y=b1.y+h;}}else{if(b2.y>viewH&&b2.y>b1.y){b2.y=b1.y-h;}else if(b1.y>viewH&&b1.y>b2.y){b1.y=b2.y-h;}}}}
this.paused=false;this.pause=function(state,time){if(zot(state))state=true;if(zot(time))time=0;if(state){lastSpeed=that.speed;if(time>0){pausing=true;zim.animate({target:that,obj:{pausingSpeed:0},ticker:false,time:time,call:function(){that.speed=0;that.paused=true;pausing=false;that.dispatchEvent("pause");}});}else{pausing=false;that.speed=0;that.paused=true;setTimeout(function(){that.dispatchEvent("pause");},10);}}else{pausing=false;if(time>0){zim.animate({target:that,obj:{pausingSpeed:lastSpeed},ticker:false,time:time,call:function(){that.speed=lastSpeed;that.paused=false;pausing=false;}});}else{that.speed=lastSpeed;that.paused=false;}}
return that;};Object.defineProperty(that,'percentSpeed',{get:function(){if(that.baseSpeed==0)return NaN;return that.speed/that.baseSpeed*100;},set:function(percent){if(pausing||that.paused)return;that.speed=that.baseSpeed*percent/100;}});Object.defineProperty(that,'pausingSpeed',{get:function(){if(that.baseSpeed==0)return NaN;return that.speed/that.baseSpeed*100;},set:function(percent){that.speed=that.baseSpeed*percent/100;}});if(style!==false)zim.styleTransforms(this,DS);this.dispose=function(a,b,disposing){zim.Ticker.remove(zimTicker);return true;};};zim.extend(zim.Scroller,createjs.EventDispatcher,null,"cjsEventDispatcher");zim.Dynamo=function(sprite,speed,label,startFrame,endFrame,update,reversible,flip,flipVertical,style,group,inherit){var sig="sprite, speed, label, startFrame, endFrame, update, reversible, flip, flipVertical, style, group, inherit";var duo;if(duo=zob(zim.Dynamo,arguments,sig,this))return duo;z_d("69.2");this.cjsEventDispatcher_constructor();this.type="Dynamo";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(sprite))sprite=DS.sprite!=null?DS.sprite:null;if(zot(sprite))return;var frames=this.frames=sprite.parseFrames(label,startFrame,endFrame,true);if(frames.length==0)return;this.totalFrames=frames.length;var _frame=0;if(zot(speed))speed=DS.speed!=null?DS.speed:30;if(zot(reversible))reversible=DS.reversible!=null?DS.reversible:true;var lastSpeed=this.baseSpeed=this.speed=speed;if(zot(update))update=DS.update!=null?DS.update:false;if(zot(flip))flip=DS.flip!=null?DS.flip:null;if(zot(flip)&&reversible==false)flip=true;var that=this;var requestID;var speedFactor;var lastTime=Date.now();var currentTime;var wait;var endFrameRequest;var pausing=false;that.scaleX=sprite.scaleX;that.scaleY=sprite.scaleY;function doDynamo(){requestID=requestAnimationFrame(doDynamo);speedFactor=frames[_frame].s;if(that.speed==0||speedFactor==0)return;wait=1000/Math.abs(that.speed)*speedFactor;currentTime=Date.now();if(currentTime-lastTime>wait){lastTime=currentTime;var nextFrame=that.frame+((that.speed>0||!reversible)?1:-1);var loopCheck=false;if(nextFrame>=frames.length){loopCheck=true;nextFrame=0;}
if(nextFrame<0){loopCheck=true;nextFrame=frames.length-1;}
that.frame=nextFrame;if(flip){if(that.speed<0)sprite.scaleX=-that.scaleX;else sprite.scaleX=that.scaleX;}
if(flipVertical){if(that.speed<0)sprite.scaleY=-that.scaleY;else sprite.scaleY=that.scaleY;}
if(loopCheck)that.dispatchEvent("loop");that.dispatchEvent("change");if(update&&sprite.stage)sprite.stage.update();if(!zot(endFrameRequest)&&endFrameRequest==that.frame){pausing=false;that.speed=0;that.paused=true;that.dispatchEvent("pause");}}}
doDynamo();this.paused=false;this.pause=function(state,time,frame){if(zot(state))state=true;if(state==that.paused)return;if(zot(time))time=0;if(state){lastSpeed=that.speed;if(zot(frame)){if(time>0){pausing=true;zim.animate({target:that,obj:{pausingSpeed:0},ticker:false,time:time,call:function(){pausing=false;that.speed=0;that.paused=true;that.dispatchEvent("pause");}});}else{pausing=false;that.speed=0;that.paused=true;setTimeout(function(){that.dispatchEvent("pause");},10);}}else{pausing=true;endFrameRequest=frame;}}else{endFrameRequest=null;if(time>0){pausing=true;zim.animate({target:that,obj:{pausingSpeed:lastSpeed},ticker:false,time:time,call:function(){pausing=false;that.speed=lastSpeed;that.paused=false;}});}else{pausing=false;that.speed=lastSpeed;that.paused=false;}}
return that;};Object.defineProperty(that,'frame',{get:function(){return _frame;},set:function(frame){_frame=Math.round(frame)%frames.length;var f=frames[_frame];if(zot(f))return;sprite.frame=f.f;}});Object.defineProperty(that,'percentSpeed',{get:function(){if(that.baseSpeed==0)return NaN;if(pausing||that.paused){return lastSpeed/that.baseSpeed*100;}else{return that.speed/that.baseSpeed*100;}},set:function(percent){if(pausing||that.paused){lastSpeed=that.baseSpeed*percent/100;return;}
that.speed=that.baseSpeed*percent/100;}});Object.defineProperty(that,'pausingSpeed',{get:function(){if(that.baseSpeed==0)return NaN;return that.speed/that.baseSpeed*100;},set:function(percent){that.speed=that.baseSpeed*percent/100;}});if(style!==false)zim.styleTransforms(this,DS);this.dispose=function(a,b,disposing){cancelAnimationFrame(requestID);};};zim.extend(zim.Dynamo,createjs.EventDispatcher,null,"cjsEventDispatcher");zim.Accelerator=function(objects){z_d("69.3");this.cjsEventDispatcher_constructor();var that=this;this.type="Accelerator";this.paused=false;this.items=[];this.paused=false;this._percentSpeed=100;this.add=function(objects){var list;if(Array.isArray(objects)){list=objects;}else{list=[objects];}
var ind;for(var i=0;i<list.length;i++){ind=that.items.indexOf(list[i]);if(ind<0)that.items.push(list[i]);}
return that;};if(objects)this.add(objects);this.remove=function(objects){var list;if(Array.isArray(objects)){list=objects;}else{list=[objects];}
var ind;for(var i=0;i<list.length;i++){ind=that.items.indexOf(list[i]);if(ind>=0)that.items.splice(ind,1);}
return that;};this.pause=function(state,time,frameNumber){if(zot(state))state=true;if(state==that.paused)return;var pausingItems=[];if(state){if(!zot(frameNumber))time=null;var waiting=false;for(var i=0;i<that.items.length;i++){if((!zot(time)&&zot(frameNumber)&&!that.items[i].totalFrames)||that.items[i].totalFrames&&(!zot(time)||!zot(frameNumber))){that.items[i].pause(true,time,frameNumber);waiting=true;pausingItems[i]=1;that.items[i].on("pause",function(){if(!that.paused){pauseAll(true);that.paused=true;that.dispatchEvent("pause");}},null,true);}}
if(!waiting){pauseAll();that.paused=true;setTimeout(function(){that.dispatchEvent("pause");},10);}}else{that.paused=false;pauseAll();}
function pauseAll(fromDelay){for(var i=0;i<that.items.length;i++){if(pausingItems[i]!=1){that.items[i].pause(state);}}}};Object.defineProperty(that,'percentSpeed',{get:function(){return that._percentSpeed;},set:function(percent){that._percentSpeed=percent;for(var i=0;i<that.items.length;i++){that.items[i].percentSpeed=percent;}}});this.dispose=function(a,b,disposing){for(var i=0;i<that.items.length;i++){that.items[i].dispose();}
that.items=null;return true;};};zim.extend(zim.Accelerator,createjs.EventDispatcher,null,"cjsEventDispatcher");zim.Emitter=function(obj,width,height,interval,num,life,fade,shrink,decayTime,decayStart,trace,traceFadeTime,traceShiftX,traceShiftY,angle,force,gravity,wind,layers,animation,random,horizontal,vertical,sink,sinkForce,cache,events,startPaused,pool,poolMin,particles,style,group,inherit){var sig="obj, width, height, interval, num, life, fade, shrink, decayTime, decayStart, trace, traceFadeTime, traceShiftX, traceShiftY, angle, force, gravity, wind, layers, animation, random, horizontal, vertical, sink, sinkForce, cache, events, startPaused, pool, poolMin, particles, style, group, inherit";var duo;if(duo=zob(zim.Emitter,arguments,sig,this))return duo;z_d("69.9");this.type="Emitter";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(obj))obj=DS.obj!=null?DS.obj:[new zim.Circle(20,"#e472c4"),new zim.Circle(20,"#acd241"),new zim.Circle(20,"#50c4b7")];if(zot(width))width=DS.width!=null?DS.width:300;if(zot(height))height=DS.height!=null?DS.height:300;var timeType=getTIME(interval);if(zot(interval))interval=DS.interval!=null?DS.interval:timeType=="s"?.02:20;if(typeof interval=="number")interval=Math.max(timeType=="s"?.01:10,interval);if(zot(num))num=DS.num!=null?DS.num:1;if(zot(trace))trace=DS.trace!=null?trace.size:false;if(zot(traceFadeTime))traceFadeTime=DS.traceFadeTime!=null?DS.traceFadeTime:decayTime;if(zot(traceShiftX))traceShiftX=DS.traceShiftX!=null?DS.traceShiftX:0;if(zot(traceShiftY))traceShiftY=DS.traceShiftY!=null?DS.traceShiftY:0;checkTIME(life,timeType);if(zot(life))life=DS.life!=null?DS.life:timeType=="s"?1:1000;if(zot(fade))fade=DS.fade!=null?DS.fade:true;if(zot(shrink))shrink=DS.shrink!=null?DS.shrink:trace?false:true;checkTIME(decayTime,timeType);if(zot(decayTime))decayTime=DS.decayTime!=null?DS.decayTime:timeType=="s"?1:1000;if(zot(angle))angle=DS.angle!=null?DS.angle:{min:0,max:360};if(zot(force))force=DS.force!=null?DS.force:5;if(zot(gravity))gravity=DS.gravity!=null?DS.gravity:9.8;if(zot(wind))wind=DS.wind!=null?DS.wind:0;if(zot(layers))layers=DS.layers!=null?DS.layers:"top";if(zot(width))width=DS.width!=null?DS.width:100;if(zot(height))height=DS.height!=null?DS.height:100;if(zot(horizontal))horizontal=DS.horizontal!=null?DS.horizontal:false;if(zot(vertical))vertical=DS.vertical!=null?DS.vertical:false;if(zot(sink))sink=DS.sink!=null?DS.sink:null;if(!zot(sink)&&zot(sinkForce))sinkForce=DS.sinkForce!=null?DS.sinkForce:10;if(zot(events))events=DS.events!=null?DS.events:false;if(zot(startPaused))startPaused=DS.startPaused!=null?DS.startPaused:false;if(zot(pool))pool=DS.pool!=null?DS.pool:true;if(zot(poolMin))poolMin=DS.poolMin!=null?DS.poolMin:0;if(zot(particles))particles=DS.particles!=null?DS.particles:new zim.Container();if(zot(animation))animation=DS.animation!=null?DS.animation:null;particles.type="Particles";this.zimContainer_constructor(width,height,null,null,false);this.type="Emitter";var that=this;this.regX=width/2;this.regY=height/2;that.obj=obj;that.particles=particles;that.interval=interval;that.num=num;that.life=life;that.fade=fade;that.shrink=shrink;that.decayTime=decayTime;that.decayStart=decayStart;that.trace=trace;that.traceFadeTime=traceFadeTime,that.traceShiftX=traceShiftX;that.traceShiftY=traceShiftY;that.angle=angle,that.emitterForce=force;that.gravity=gravity;that.wind=wind;that.layers=layers;that.animation=animation;that.random=random;that.horizontal=horizontal;that.vertical=vertical;that.sink=sink;that.sinkForce=sinkForce;that.events=events;that.startEmitterPaused=that.emitterPaused=startPaused;that.pool=pool;that.poolMin=poolMin;that.particlesEmitted=0;var poolList=[];var poolIndex=0;var poolCount=0;var emitterTicker;var stage;zim.added(that,addedToStage);function addedToStage(s){that.emitterPaused=null;that.on("added",function(){that.particles.addTo(that.parent);});stage=s;if(zot(cache)){if(stage.isWebGL){cache=false;}else{cache=zim.mobile();}}
if(cache)stage.snapToPixelEnabled=true;if(stage){var myIndex=that.parent.getChildIndex(that);that.parent.addChildAt(particles,myIndex);if(!horizontal&&!vertical)that.centerReg(null,null,false);that.zimInterval=zim.interval(that.interval,function(){if(that.startEmitterPaused){that.pauseEmitter();return;}
obj=Array.isArray(that.obj)?that.obj:[that.obj];if(obj.length<=0)return;var minInterval;var maxNum;function sortNumber(a,b){return a-b;}
if(Array.isArray(that.interval)){that.interval.sort(sortNumber);minInterval=that.interval[0];}else if(that.interval.constructor=={}.constructor){minInterval=that.interval.min;}else{minInterval=that.interval;}
if(Array.isArray(that.num)){that.num.sort(sortNumber);maxNum=that.num[that.num.length-1];}else if(that.num.constructor=={}.constructor){maxNum=that.num.max;}else{maxNum=that.num;}
zim.loop(zim.Pick.choose(that.num),function(){if(that.decayTime>0){var decay={};if(that.shrink)decay.scale=0;if(that.fade)decay.alpha=0;}
if(that.pool&&poolList.length>0&&poolCount>=Math.max(that.poolMin,(that.life/minInterval+5)*maxNum)){var container=poolList[(poolIndex++)%poolList.length];container.visible=true;var particle=container.trace?container.getChildAt(0):container;if(particle.emitShape){var t=particle.template;particle.graphics.c().s(t.s?zim.Pick.choose(t.s):null).ss(t.ss?zim.Pick.choose(t.ss):null).sd(t.sd?zim.Pick.choose(t.sd):null,t.offset?zim.Pick.choose(t.offset):null);}
if(container.trace)container.updateCache();if(that.layers=="top"){if(particle.emitShape)container.addTo(particles,null,false);else container.centerReg(particles);}else{if(particle.emitShape)container.addTo(particles,that.layers=="bottom"?0:zim.rand(particles.numChildren),false);else container.centerReg(particles,that.layers=="bottom"?0:zim.rand(particles.numChildren));}
container.alpha=1;container.scaleX=1;container.scaleY=1;particle.alpha=particle.originalAlpha;particle.scaleX=particle.originalScaleX;particle.scaleY=particle.originalScaleY;particle.endSpurt=false;}else{poolCount++;var container;if(that.trace){container=new zim.Container(width,height,null,null,false);container.trace=true;}
var template=zim.Pick.choose(zim.shuffle(obj)[0]);if(template.type=="shape"){var t=template;var particle=new zim.Shape(1,1,null,null,null,false);particle.emitShape=true;particle.template=t;particle.graphics.s(t.s?zim.Pick.choose(t.s):null).ss(t.ss?zim.Pick.choose(t.ss):null).sd(t.sd?zim.Pick.choose(t.sd):null,t.offset?zim.Pick.choose(t.offset):null);if(that.trace){particle.addTo(container,null,false);}else{if(that.layers=="top"){particle.addTo(particles,null,false);}else{particle.addTo(particles,that.layers=="bottom"?0:zim.rand(particles.numChildren),null,false);}}}else{var particle=template.clone();if(!particle.centerReg)zimify(particle);if(that.trace){particle.centerReg(container).pos({x:-1000,y:-1000,reg:true});}else{if(that.layers=="top"){particle.centerReg(particles);}else{particle.centerReg(particles,that.layers=="bottom"?0:zim.rand(particles.numChildren));}}}
if(that.trace){if(that.layers=="top"){container.addTo(particles,null,false);}else{container.addTo(particles,that.layers=="bottom"?0:zim.rand(particles.numChildren),false);}
container.cache(traceShiftX,traceShiftY,width,height);}
if(!that.trace)container=particle;container.particle=particle;particle.originalAlpha=particle.alpha;particle.originalScaleX=particle.scaleX;particle.originalScaleY=particle.scaleY;}
that.currentParticle=particle;that.particlesEmitted++;container.particleNormal=true;container.particleDecaying=false;container.particleFizzing=false;var angle=zim.Pick.choose(that.angle);var speed=zim.Pick.choose(that.emitterForce);var speedX=speed*Math.cos(angle*Math.PI/180);var speedY=speed*Math.sin(angle*Math.PI/180);particle.info={position:{x:that.x,y:that.y},velocity:{x:speedX,y:speedY}};if(that.horizontal)particle.info.position={x:that.x-that.regX+zim.rand(0,width),y:that.y-that.regY+(that.vertical?height/2:0)};if(that.vertical)particle.info.position={x:that.x-that.regX+(that.horizontal?width/2:0),y:that.y-that.regY+zim.rand(0,height)};if(particle.emitShape){particle.graphics.mt(particle.info.position.x,particle.info.position.y);}else{particle.x=particle.info.position.x,particle.y=particle.info.position.y;}
if(that.random){zim.loop(that.random,function(property,options){var val=zim.Pick.choose(options);if(property=="scale"){particle.sca(val);}else{if(property=="x"){particle.info.position.x=(that.horizontal||that.vertical)?val:val+width/2;}else if(property=="y"){particle.info.position.y=(that.horizontal||that.vertical)?val:val+height/2;}
if((property=="x"||property=="y")&&particle.emitShape){particle.graphics.mt(particle.info.position.x,particle.info.position.y);}
particle[property]=val;if(particle.emitShape){particle.x=0;particle.y=0;}}});}
if(cache&&!particle.emitShape)particle.cache(particle.getBounds().x-10,particle.getBounds().y-10,particle.getBounds().width+20,particle.getBounds().height+20);var shrinkMe=particle.emitShape?false:that.shrink;if(that.decayTime>0&&(that.fade||shrinkMe||(that.trace&&that.traceFadeTime>0))){if(that.trace&&that.traceFadeTime>0){container.animate({obj:{alpha:0},time:that.traceFadeTime,wait:that.life-that.traceFadeTime,waitedCall:function(t){t.particleNormal=false;t.particleFizzing=true;},call:fizz,override:false,id:"decay"});}
if(that.fade||shrinkMe){var o={};if(that.fade)o.alpha=0;if(shrinkMe){o.scaleX=0;o.scaleY=0;}
particle.animate({obj:o,time:that.decayTime,wait:zot(that.decayStart)?that.life-that.decayTime:that.decayStart,waitedCall:function(t){if(t.parent!=that)t=t.parent;t.particleNormal=false;t.particleDecaying=true;},call:function(t){if(that.events)sendEvent("decayed",t);if(t.endSpurt)sendEvent("spurtdecayed",t);if(!(that.trace&&that.traceFadeTime>0)){if(zot(that.decayStart)||that.decayStart+that.decayTime>that.life){if(t.parent)fizz(t.parent.trace?t.parent:t);}else{-function(){var c=container;zim.timeout(that.life-(that.decayStart+that.decayTime),function(){fizz(c);});}();}}},override:false,id:"decay"});}}else{if(that.life>0){-function(){var c=container;c.timeOut=zim.timeout(that.life,function(){fizz(c);});}();}}
if(that.events)sendEvent("emitted",container);spurtCheck(particle);if(that.animation){var a=zim.Pick.choose(that.animation);if(zot(a.override))a.override=false;particle.animate(zim.copy(a));}});},null,true,true);var frameRate=0;emitterTicker=that.emitterTicker=zim.Ticker.add(function(){zim.loop(particles,function(particle){if(particle.trace){var particleContainer=particle;particle=particle.getChildAt(0);}
var p=particle.info;var sinkX=0;var sinkY=0;if(!zot(that.sink)){var b=that.particles.localToGlobal(p.position.x,p.position.y);var s;if(that.sink.parent&&that.sink.parent.localToGlobal){var s=that.sink.parent.localToGlobal(that.sink.x,that.sink.y);}else{s=new createjs.Point(zim.Pick.choose(that.sink.x),zim.Pick.choose(that.sink.y));}
var sinkAngle=zim.angle(b.x,b.y,s.x,s.y);var sinkX=that.sinkForce*Math.cos(sinkAngle*Math.PI/180);var sinkY=that.sinkForce*Math.sin(sinkAngle*Math.PI/180);}
var ax=that.wind+sinkX;var ay=that.gravity+sinkY;p.velocity.x+=ax*frameRate;p.velocity.y+=ay*frameRate;p.position.x+=p.velocity.x*frameRate*100;p.position.y+=p.velocity.y*frameRate*100;if(particle.emitShape){particle.graphics.lt(p.position.x,p.position.y);}else{particle.x=p.position.x;particle.y=p.position.y;}
if(that.trace&&particleContainer)particleContainer.updateCache(particle.emitShape?null:"source-over");});},stage);frameRate=1/zim.Ticker.framerate;}}
that.particles.noMouse();function fizz(p){if(that.events)sendEvent("fizzed",p);if(p.trace?p.getChildAt(0).endSpurt:p.endSpurt){sendEvent("spurtfizzed",p);that.spurting=false;}
if(that.pool){if(p.pooled=="end"){}else if(p.pooled){p.visible=false;return;}else{p.pooled=true;if(poolList)poolList.push(p);p.visible=false;return;}}
that.removeChild(p);if(that.trace)p.uncache();p=null;}
function sendEvent(type,object){if(zot(object))return;var e=new createjs.Event(type);e.particle=object.trace?object.getChildAt(0):object;that.dispatchEvent(e);}
function spurtCheck(p){if(zot(that.spurtCount)&&zot(that.spurtNum))return;that.spurtCount++;if(that.spurtCount>=that.spurtNum){lastSpurt(p);}}
function lastSpurt(p){that.pauseEmitter();that.spurtCount=that.spurtNum=null;if(zot(p))return;sendEvent("spurted",p);p.endSpurt=true;}
Object.defineProperty(that,'interval',{get:function(){return interval;},set:function(theInterval){interval=theInterval;if(that.zimInterval)that.zimInterval.time=interval;}});this.removeFrom=function(container){if(that.parent)that.parent.removeChild(that);that.particles.removeFrom();};this.spurting=false;this.spurt=function(num,time,restart){var sig="num, time, restart";var duo;if(duo=zob(that.spurt,arguments,sig))return duo;if(!zot(time)){zim.timeout(zim.Pick.choose(time),function(){lastSpurt(that.currentParticle);},true);that.spurting=true;}
if(!zot(num)){that.spurtNum=zim.Pick.choose(num);that.spurtCount=0;that.spurting=true;}
that.pauseEmitter(false,restart,null,true);return that;};this.clearPool=function(){zim.loop(that,function(p){p.pooled="end";if(!p.visible)that.removeChild(p);},true);poolCount=0;poolIndex=0;poolList=[];};if(!that.startEmitterPaused)this.emitterPaused=false;this.pauseEmitter=function(state,restart,freeze,immediate){that.startEmitterPaused=null;if(zot(state))state=true;if(zot(restart))restart=false;if(zot(freeze))freeze=false;if(state){if(that.emitterPaused)return that;if(freeze){if(emitterTicker)zim.Ticker.remove(emitterTicker);zim.loop(that,function(particle){particle.pauseAnimate();if(particle.trace)particle.getChildAt(0).pauseAnimate();if(particle.timeOut){particle.timeOut.pause();}});}
that.zimInterval.pause();that.emitterPaused=true;}else{if(!that.emitterPaused)return that;if(restart){zim.loop(that,function(particle){particle.stopAnimate();if(particle.timeOut)particle.timeOut.clear();if(particle.trace)particle.getChildAt(0).pauseAnimate();});that.removeAllChildren();}
if(stage&&emitterTicker&&!zim.Ticker.has(stage,emitterTicker)){zim.Ticker.add(emitterTicker,stage);zim.loop(that,function(particle){particle.pauseAnimate(false);if(particle.timeOut)particle.timeOut.pause(false);if(particle.trace)particle.getChildAt(0).pauseAnimate(false);});}
if(that.zimInterval)that.zimInterval.pause(false,immediate);that.emitterPaused=false;}
return that;};this.resize=function(w,h){if(!zot(w))width=w;if(!zot(h))height=h;that.setBounds(0,0,width,height);if(!horizontal&&!vertical)that.centerReg();that.clearPool();};if(style!==false)zim.styleTransforms(this,DS);this.clone=function(exact){var objClone;if(Array.isArray(that.obj)||that.obj.constructor=={}.constructor){objClone=zim.copy(that.obj);}else if(that.obj.clone){objClone=that.obj.clone(exact);}else{objClone=that.obj;}
return that.cloneProps(new zim.Emitter(objClone,width,height,that.interval,that.num,that.life,that.fade,that.shrink,that.decayTime,that.decayStart,that.trace,that.traceFadeTime,that.traceShiftX,that.traceShiftY,that.angle,that.emitterForce,that.gravity,that.wind,that.layers,that.animation,zim.copy(that.random),that.horizontal,that.vertical,that.sink,that.sinkForce,cache,that.events,startPaused,that.pool,that.poolMin,style,that.group,inherit));};this.dispose=function(a,b,disposing){if(that.zimInterval)that.zimInterval.clear();if(emitterTicker){zim.Ticker.remove(emitterTicker);}
zim.loop(poolList,function(particle){if(particle)particle.dispose();});if(particles&&particles.dispose)particles.dispose();if(that.currentParticle&&that.currentParticle.dispose)that.currentParticle.dispose();if(obj&&Array.isArray(obj)){zim.loop(obj,function(el){if(el.dispose)el.dispose();})}else{if(obj&&obj.dispose)obj.dispose();}
particles=that.currentParticle=that.particles=obj=that.obj=poolList=that.poolList=null;return true;};};zim.extend(zim.Emitter,zim.Container,"clone","zimContainer",false);zim.Generator=function(color,strokeColor,strokeWidth,draw,stamp,setup,maxCount,boundary,drawCount,drawPause,drawSpacebarPause,startX,startY,cache,recordLinePoints,frame,seed,style,group,inherit){var sig="color, strokeColor, strokeWidth, draw, stamp, setup, maxCount, boundary, drawCount, drawPause, drawSpacebarPause, startX, startY, cache, recordLinePoints, frame, seed, style, group, inherit";var duo;if(duo=zob(zim.Generator,arguments,sig,this))return duo;z_d("69.92");this.group=group;var DS=style===false?{}:zim.getStyle("Generator",this.group,inherit);if(zot(frame))frame=DS.frame!=null?DS.frame:zdf;var stage=frame.stage;if(zot(color))color=DS.color!=null?DS.color:null;if(zot(strokeColor))strokeColor=DS.strokeColor!=null?DS.strokeColor:zim.white;if(zot(strokeWidth))strokeWidth=DS.strokeWidth!=null?DS.strokeWidth:1;if(zot(maxCount))maxCount=DS.maxCount!=null?DS.maxCount:1000;if(zot(boundary))boundary=DS.boundary!=null?DS.boundary:new zim.Boundary(0,0,stage.width,stage.height);if(zot(drawCount))drawCount=DS.drawCount!=null?DS.drawCount:1;if(zot(drawPause))drawPause=DS.drawPause!=null?DS.drawPause:true;if(zot(drawSpacebarPause))drawSpacebarPause=DS.drawSpacebarPause!=null?DS.drawSpacebarPause:true;if(zot(startX))startX=DS.startX!=null?DS.startX:stage.width/2;if(zot(startY))startY=DS.startY!=null?DS.startY:stage.height/2;if(zot(cache))cache=DS.cache!=null?DS.cache:false;var drawing=this.drawing=new zim.Container(boundary.x,boundary.y,boundary.width,boundary.height).addTo(stage);var shape=this.shape=new zim.Shape(boundary.width,boundary.height).addTo(drawing);this.drawCount=drawCount;if(zot(drawPause))drawPause=true;if(cache)shape.cache(boundary.x,boundary.y,boundary.width,boundary.height);this.zimContainer_constructor(boundary.x,boundary.y,boundary.width,boundary.height);this.type="Generator";var that=this;that.draw=null;this.color=color;this.strokeColor=strokeColor;this.strokeWidth=strokeWidth;var cX=startX;var cY=startY;this.fill=function(color){that.color=color;that.currentColor=zik(that.color);shape.f(that.currentColor);return this;};this.stroke=function(color,size){if(!zot(color)){that.strokeColor=color;that.currentStrokeColor=zik(that.strokeColor);shape.s(that.currentStrokeColor);}
if(!zot(size)){that.strokeWidth=size;that.currentStrokeWidth=zik(that.strokeWidth);shape.ss(that.currentStrokeWidth);}
return this;};this.noStroke=function(){that.strokeColor=that.currentStrokeColor=null;that.strokeWidth=that.currentStrokeWidth=null;shape.s();shape.ss(1);return this;};shape.matrix=shape.getMatrix();this.translate=function(x,y){if(zot(x))x=0;if(zot(y))y=0;x=zik(x);y=zik(y);var point=shape.matrix.transformPoint(x,y);cX=point.x;cY=point.y;shape.mt(cX,cY);shape.matrix.translate(x,y);return this;};this.rotate=function(a){if(zot(a))a=0;a=zik(a);shape.matrix.rotate(a);return this;};this.scale=function(x,y){if(zot(x))x=1;if(zot(y))y=x;x=zik(x);y=zik(y);shape.matrix.scale(x,y);return this;};this.skew=function(x,y){if(zot(x))x=0;if(zot(y))y=0;x=zik(x);y=zik(y);shape.matrix.skew(x,y);return this;};if(recordLinePoints)that.linePoints=[];this.line=function(x1,y1,x2,y2){if(zot(x1))x1=0;if(zot(y1))y1=0;if(zot(x2))x2=0;if(zot(y2))y2=0;x1=zik(x1);y1=zik(y1);x2=zik(x2);y2=zik(y2);if(recordLinePoints=="zero"||(recordLinePoints=="nonzero"&&x1&&y1))that.linePoints.push([x1,y1]);that.translate(x1,y1);var point=shape.matrix.transformPoint(x2,y2);cX=point.x;cY=point.y;shape.lt(cX,cY);if(recordLinePoints)that.linePoints.push([cX,cY]);shape.matrix.translate(x2,y2);return this;};this.arc=function(x,y,radius,startAngle,endAngle,anticlockwise){if(zot(x))x=0;if(zot(y))y=0;if(zot(radius))radius=50;x=zik(x);y=zik(y);radius=zik(radius);radius=Math.abs(radius);if(zot(startAngle))startAngle=0;if(zot(endAngle))endAngle=180;startAngle=zik(startAngle);endAngle=zik(endAngle);if(zot(anticlockwise))anticlockwise=false;anticlockwise=zik(anticlockwise);that.translate(x,y);var center=shape.matrix.transformPoint(0,0);if(!shape.decomp)shape.decomp={};shape.matrix.decompose(shape.decomp);var s=(Math.abs(shape.decomp.scaleX)+Math.abs(shape.decomp.scaleY))/2;var ro=shape.decomp.rotation||0;var r=radius*s;shape.mt(center.x+r*Math.cos((startAngle+ro)*Math.PI/180),center.y+r*Math.sin((startAngle+ro)*Math.PI/180));shape.a(center.x,center.y,r,(startAngle+ro)*Math.PI/180,(endAngle+ro)*Math.PI/180,anticlockwise);return this;};this.curve=function(x1,y1,cpx,cpy,x2,y2){if(zot(x1))x1=0;if(zot(y1))y1=0;if(zot(cpx))cpx=50;if(zot(cpy))cpy=50;if(zot(x2))x2=100;if(zot(y2))y2=0;x1=zik(x1);y1=zik(y1);cpx=zik(cpx);cpy=zik(cpy);x2=zik(x2);y2=zik(y2);that.translate(x1,y1);var control=shape.matrix.transformPoint(cpx,cpy);var point=shape.matrix.transformPoint(x2,y2);var pX=point.x;var pY=point.y;shape.qt(control.x,control.y,pX,pY);shape.matrix.translate(x2,y2);return this;};this.bezier=function(x1,y1,cp1x,cp1y,cp2x,cp2y,x2,y2){if(zot(x1))x1=0;if(zot(y1))y1=0;if(zot(cp1x))cp1x=50;if(zot(cp1y))cp1y=50;if(zot(cp2x))cp2x=-50;if(zot(cp2y))cp2y=-50;if(zot(x2))x2=100;if(zot(y2))y2=0;x1=zik(x1);y1=zik(y1);cp1x=zik(cp1x);cp1y=zik(cp1y);cp2x=zik(cp2x);cp2y=zik(cp2y);x2=zik(x2);y2=zik(y2);that.translate(x1,y1);var control1=shape.matrix.transformPoint(cp1x,cp1y);var control2=shape.matrix.transformPoint(cp2x,cp2y);var point=shape.matrix.transformPoint(x2,y2);var pX=point.x;var pY=point.y;shape.bt(control1.x,control1.y,control2.x,control2.y,pX,pY);shape.matrix.translate(x2,y2);return this;};this.rectangle=function(x,y,w,h,rTL,rTR,rBR,rBL){if(zot(x))x=0;if(zot(y))y=0;if(zot(w))w=100;if(zot(h))h=w;x=zik(x);y=zik(y);w=zik(w);h=zik(h);if(!rTL&&!rTR&&!rBR&&!rBL){that.translate(x,y);var pTL=shape.matrix.transformPoint(0,0);var pTR=shape.matrix.transformPoint(w,0);var pBR=shape.matrix.transformPoint(w,h);var pBL=shape.matrix.transformPoint(0,h);shape.mt(pTL.x,pTL.y).lt(pTR.x,pTR.y).lt(pBR.x,pBR.y).lt(pBL.x,pBL.y).lt(pTL.x,pTL.y).lt(pTR.x,pTR.y);shape.mt(pTL.x,pTL.y);return this;}
if(zot(rTL))rTL=0;if(zot(rTR))rTR=rTL;if(zot(rBR))rBR=rTL;if(zot(rBL))rBL=rTL;rTL=zik(rTL);rTR=zik(rTR);rBR=zik(rBR);rBL=zik(rBL);var max=(w<h?w:h)/2;var mTL=0,mTR=0,mBR=0,mBL=0;max=Math.abs(max);if(rTL<0){rTL*=(mTL=-1);}
if(rTL>max){rTL=max;}
if(rTR<0){rTR*=(mTR=-1);}
if(rTR>max){rTR=max;}
if(rBR<0){rBR*=(mBR=-1);}
if(rBR>max){rBR=max;}
if(rBL<0){rBL*=(mBL=-1);}
if(rBL>max){rBL=max;}
that.translate(x,y);if(!shape.decomp)shape.decomp={};shape.matrix.decompose(shape.decomp);var s=(Math.abs(shape.decomp.scaleX)+Math.abs(shape.decomp.scaleY))/2;var signH=(w<0)?-1:1;var signV=(h<0)?-1:1;var a=shape.matrix.transformPoint(w-rTR*signH,0);var b=shape.matrix.transformPoint(w+rTR*mTR*signH,-rTR*mTR*signV);var c=shape.matrix.transformPoint(w,rTR*signV);var d=shape.matrix.transformPoint(w,h-rBR*signV);var e=shape.matrix.transformPoint(w+rBR*mBR*signH,h+rBR*mBR*signV);var f=shape.matrix.transformPoint(w-rBR*signH,h);var g=shape.matrix.transformPoint(rBL*signH,h);var i=shape.matrix.transformPoint(-rBL*mBL*signH,h+rBL*mBL*signV);var j=shape.matrix.transformPoint(0,h-rBL*signV);var k=shape.matrix.transformPoint(0,rTL*signV);var l=shape.matrix.transformPoint(-rTL*mTL*signH,-rTL*mTL*signV);var m=shape.matrix.transformPoint(rTL*signH,0);shape.mt(a.x,a.y).at(b.x,b.y,c.x,c.y,rTR*s).lt(d.x,d.y).at(e.x,e.y,f.x,f.y,rBR*s).lt(g.x,g.y).at(i.x,i.y,j.x,j.y,rBL*s).lt(k.x,k.y).at(l.x,l.y,m.x,m.y,rTL*s).cp();return this;};this.circle=function(x,y,radius,percent,percentClose){if(zot(x))x=0;if(zot(y))y=0;if(zot(radius))radius=50;if(zot(percent))percent=100;if(zot(percentClose))percentClose=true;x=zik(x);y=zik(y);radius=zik(radius);percent=zik(percent);radius=Math.abs(radius);that.translate(x,y);var center=shape.matrix.transformPoint(0,0);if(!shape.decomp)shape.decomp={};shape.matrix.decompose(shape.decomp);var s=(Math.abs(shape.decomp.scaleX)+Math.abs(shape.decomp.scaleY))/2;var ro=shape.decomp.rotation||0;var r=radius*s;that.circleHeight=r*2;if(typeof percent=="number"&&percent>=0&&percent<100){var p=360*percent/100/2;shape.mt(center.x+r*Math.cos((-p-90+ro)*Math.PI/180),center.y+r*Math.sin((-p-90+ro)*Math.PI/180));shape.a(center.x,center.y,r,(-p-90+ro)*Math.PI/180,(p-90+ro)*Math.PI/180,false);if(percentClose)shape.cp();that.circleHeight=r-Math.cos(p*Math.PI/180)*r;}else{shape.mt(center.x+r,center.y);shape.a(center.x,center.y,r,0,Math.PI*2);}
return this;};this.elipse=function(x,y,w,h){if(zot(x))x=0;if(zot(y))y=0;if(zot(w))w=100;if(zot(h))h=50;x=zik(x);y=zik(y);w=zik(w);h=zik(h);that.translate(x,y);var center=shape.matrix.transformPoint(-w/2,-h/2);if(!shape.decomp)shape.decomp={};shape.matrix.decompose(shape.decomp);var sX=shape.decomp.scaleX;var sY=shape.decomp.scaleY;shape.de(center.x,center.y,w*sX,h*sY);return this;};this.poly=function(x,y,radius,sides,pointSize,angle){if(zot(x))x=0;if(zot(y))y=0;if(zot(radius))radius=100;if(zot(sides))sides=5;if(zot(pointSize))pointSize=0;if(zot(angle))angle=0;x=zik(x);y=zik(y);radius=zik(radius);sides=zik(sides);pointSize=zik(pointSize);angle=zik(angle);radius=Math.abs(radius);that.translate(x,y);var center=shape.matrix.transformPoint(0,0);if(!shape.decomp)shape.decomp={};shape.matrix.decompose(shape.decomp);var s=(Math.abs(shape.decomp.scaleX)+Math.abs(shape.decomp.scaleY))/2;var ro=shape.decomp.rotation||0;var r=radius*s;shape.dp(center.x,center.y,r,sides,pointSize,ro);return this;};this.closePath=this.close=this.cp=function(){shape.cp();return this;};this._noise=new zim.Noise(seed);this.noise=function(){if(arguments.length==1)return(this._noise.simplex1D.apply(null,arguments)+1)/2;if(arguments.length==2)return(this._noise.simplex2D.apply(null,arguments)+1)/2;if(arguments.length==3)return(this._noise.simplex3D.apply(null,arguments)+1)/2;if(arguments.length==4)return(this._noise.simplex4D.apply(null,arguments)+1)/2;}
var startMatrix=shape.matrix.clone();this.stack=[];this.colorStrokeStack=[];this.push=function(){that.stack.push(shape.matrix.clone());that.colorStrokeStack.push([that.color,that.strokeColor,that.strokeWidth,that.currentColor,that.currentStrokeColor,that.currentStrokeWidth]);return this;};this.pop=function(){shape.matrix=that.stack.pop()||shape.matrix;var info=that.colorStrokeStack.pop()||[that.color,that.strokeColor,that.strokeWidth,that.currentColor,that.currentStrokeColor,that.currentStrokeWidth];that.color=info[0];that.strokeColor=info[1];that.strokeWidth=info[2];that.currentColor=info[3];that.currentStrokeColor=info[4];that.currentStrokeWidth=info[5];shape.f(that.currentColor).s(that.currentStrokeColor).ss(that.currentStrokeWidth);shape.mt(shape.matrix.x,shape.matrix.y);return this;};this.blit=function(){shape.updateCache("source-over");shape.c();return this;};this.step=function(){if(that.draw)innerDraw();return this;};if(!zot(that.color))this.fill(that.color);if(!zot(that.strokeColor)&&that.strokeWidth)this.stroke(that.strokeColor,that.strokeWidth);else that.noStroke();this.translate(cX,cY);if(typeof setup=="function"){this.setup=setup;zim.timeout(.01,function(){setup(0,that.count,that);if(cache)shape.updateCache();stage.update();});}
var _count=0;this.maxCount=maxCount;this.resetup=function(clear){if(zot(clear))clear=true;_count=0;if(clear)that.shape.c();if(!zot(that.color))this.fill(that.color);if(!zot(that.strokeColor)&&that.strokeWidth)this.stroke(that.strokeColor,that.strokeWidth);else that.noStroke();this.reset();if(this.setup){setup(0,that.count,that);if(cache)shape.updateCache();stage.update();}
return this;}
this.stampNum=0;if(typeof stamp=="function"){this.stamp=stamp;zim.timeout(.015,function(){setLoop(0);});}
this.restamp=function(clear,setup){if(zot(clear))clear=true;if(zot(setup))setup=true;_count=0;if(clear)that.shape.c();if(setup)that.resetup(clear);setLoop(0);return this;}
this.reset=function(){this.fill(color);if(!zot(strokeColor)&&strokeWidth)this.stroke(strokeColor,strokeWidth);else this.noStroke();shape.matrix.identity();this.translate(startX,startY);return this;}
this.clear=function(){this.shape.c();return this;}
function setLoop(start){this.stampNum++;var result=zim.loop(that.maxCount,function(i,t){if(that.paused){that.pausedCount=i;return false;}
if(that.changeCount){that.changeCount=false;return false;}
_count=i+1;var s=stamp(i+1,t,that,that.stampNum);that.currentColor=zik(that.color);shape.f(that.currentColor);that.currentStrokeColor=zik(that.strokeColor);shape.s(that.currentStrokeColor);that.currentStrokeWidth=zik(that.strokeWidth);shape.ss(that.currentStrokeWidth);if(s)return s;},null,null,start);if(cache)shape.updateCache();if(result)that.dispatchEvent("complete");stage.update();}
that.iterator=0;if(typeof draw=="function"){this.draw=draw;if(setup){setTimeout(function(){that.ticker=zim.Ticker.add(innerDraw);},100);}else{this.ticker=zim.Ticker.add(innerDraw);}
that.generatorPaused=false;if(drawPause){that.pauseEvent=stage.on("stagemousedown",function(){if(that.count>=that.maxCount)return;if(that.pauseTimeout)return;if(zim.Ticker.has(that.ticker)){zim.Ticker.remove(that.ticker);that.generatorPaused=true;that.dispatchEvent("generatorpaused");}else{that.ticker=zim.Ticker.add(that.ticker);that.generatorPaused=false;that.dispatchEvent("generatorunpaused");}});}
if(drawSpacebarPause){that.pauseSpacebarEvent=frame.on("keydown",function(e){if(that.count>=that.maxCount)return;if(that.pauseTimeout)return;if(e.keyCode==20){if(zim.Ticker.has(that.ticker)){zim.Ticker.remove(that.ticker);that.generatorPaused=true;that.dispatchEvent("generatorpaused");}else{that.ticker=zim.Ticker.add(that.ticker);that.generatorPaused=false;that.dispatchEvent("generatorunpaused");}}});}}
function innerDraw(){that.iterator++;if(that.iterator%Math.ceil(that.drawCount)==0){that.count++;that.draw(that.count,that.maxCount,that);if(cache)that.blit();that.currentColor=zik(that.color);shape.f(that.currentColor);that.currentStrokeColor=zik(that.strokeColor);shape.s(that.currentStrokeColor);that.currentStrokeWidth=zik(that.strokeWidth);shape.ss(that.currentStrokeWidth);that.dispatchEvent("drawing");stage.update();}
if(that.maxCount&&that.count>=that.maxCount){that.dispatchEvent("complete");zim.Ticker.remove(that.ticker);}}
this.redraw=function(clear,setup){if(zot(clear))clear=true;that.reset();if(zot(setup))setup=true;if(that.ticker)zim.Ticker.remove(that.ticker);that.iterator=0;that.count=0;if(clear)that.shape.c();if(setup){that.resetup(clear);setTimeout(function(){if(that.ticker)that.ticker=zim.Ticker.add(that.ticker);},100);}else{if(that.ticker)that.ticker=zim.Ticker.add(that.ticker);}
return this;}
this.paused=false;this.pause=function(state,time){if(zot(state))state=true;if(that.count>=that.maxCount)return;if(state==this.paused)return this;this.paused=state;if(this.pauseTimeout)this.pauseTimeout.clear();if(this.paused){if(that.ticker)zim.Ticker.remove(that.ticker);}else{if(that.ticker)that.ticker=zim.Ticker.add(that.ticker);else{setLoop(that.pausedCount,that.maxCount);}}
setTimeout(function(){stage.update();},20);if(time){this.pauseTimeout=zim.timeout(time,function(){that.pause(!that.paused);that.pauseTimeout=null;});}
that.dispatchEvent(that.paused?"paused":"unpaused");};this.outOfBounds=function(margin,marginY){if(zot(margin))margin=0;if(zot(marginY))marginY=margin;var stage=that.shape.stage;if(!stage)return;return(that.currentX>stage.width-margin||that.currentX<0+margin||that.currentY>stage.height-marginY||that.currentY<0+marginY);}
this.stop=function(){that.pause();if(that.pauseEvent)stage.off("stagemousedown",that.pauseEvent);if(that.pauseSpaceEvent)frame.off("keydown",that.pauseSpaceEvent);};Object.defineProperty(this,'count',{get:function(){return _count;},set:function(value){_count=value;if(that.stamp){that.changeCount=true;setTimeout(function(){setLoop(_count,that.maxCount);});}}});Object.defineProperty(this,'currentX',{get:function(){return cX;},set:function(value){if(zon)zogy("Generator() - currentX is read only");}});Object.defineProperty(this,'currentY',{get:function(){return cY;},set:function(value){if(zon)zogy("Generator() - currentY is read only");}});this.clone=function(){return that.cloneProps(new zim.Generator(color,strokeColor,strokeWidth,draw,stamp,setup,maxCount,boundary,drawCount,drawPause,drawSpacebarPause,startX,startY,cache,recordLinePoints,frame,seed,style,that.group,inherit));};that.dispose=function(a,b,disposing){that.pause();if(that.ticker)zim.Ticker.remove(that.ticker);if(that.pauseEvent)stage.off("stagemousedown",that.pauseEvent);if(that.pauseSpacebarEvent)frame.off("keydown",that.pauseSpacebarEvent);if(that._noise)that._noise=null;if(that.shape)that.shape.dispose();if(that.drawing)that.drawing.dispose();that.shape=that.drawing=null;if(!disposing)that.zimContainer_dispose();return true;};if(style!==false)zim.styleTransforms(this,DS);};zim.extend(zim.Generator,zim.Container,["clone","dispose"],"zimContainer",false);zim.Pen=function(size,color,penType,damp,spread,borderColor,borderWidth,end,paper,nib,cache,ctrlKey,cropScale,undo,undoKeys,move,onTop,deleteable,doubleClickDelete,immediateStop,lineAlpha,lineBlendMode,frame,style,group,inherit){var sig="size, color, penType, damp, spread, borderColor, borderWidth, end, paper, nib, cache, ctrlKey, cropScale, undo, undoKeys, move, onTop, deleteable, doubleClickDelete, immediateStop, lineAlpha, lineBlendMode, frame, style, group, inherit";var duo;if(duo=zob(zim.Pen,arguments,sig,this))return duo;z_d("69.93");this.zimContainer_constructor();this.type="Pen";this.group=group;var DS=style===false?{}:zim.getStyle(this.type,this.group,inherit);if(zot(penType))penType=DS.penType!=null?DS.penType:"line";var base={size:2,color:"#333",spread:{min:5,max:20},borderColor:"#111",borderWidth:0,};var defaults={line:{size:2},kitetail:{size:{min:5,max:20},color:zim.series(zim.pink,zim.blue,zim.green),borderColor:"rgba(0,0,0,.5)",borderWidth:1},grass:{color:"#acd241",size:3,spread:{min:10,max:30}},hair:{color:["#e472c4","#50c4b7"],size:3,spread:{min:20,max:50}},city:{size:{min:30,max:70},spread:{min:50,max:200},color:["#333","#111","#555"],},barbwire:{},splatter:{size:{min:5,max:20},color:"rgba(0,0,0,.5)"}};if(zot(defaults[penType]))penType="line";if(zot(size))size=DS.size!=null?DS.size:zot(defaults[penType].size)?base.size:defaults[penType].size;if(zot(color))color=DS.color!=null?DS.color:zot(defaults[penType].color)?base.color:defaults[penType].color;if(zot(damp))damp=DS.damp!=null?DS.damp:.1;if(damp===false)damp=1;if(zot(spread))spread=DS.spread!=null?DS.spread:zot(defaults[penType].spread)?base.spread:defaults[penType].spread;if(zot(borderColor))borderColor=DS.borderColor!=null?DS.borderColor:zot(defaults[penType].borderColor)?base.borderColor:defaults[penType].borderColor;if(zot(borderWidth))borderWidth=DS.borderWidth!=null?DS.borderWidth:zot(defaults[penType].borderWidth)?base.borderWidth:defaults[penType].borderWidth;if(zot(end))end=DS.end!=null?DS.end:"butt";if(zot(cropScale))cropScale=DS.cropScale!=null?DS.cropScale:1;if(zot(cache))cache=DS.cache!=null?DS.cache:true;if(zot(undo))undo=DS.undo!=null?DS.undo:0;if(zot(undoKeys))undoKeys=DS.undoKeys!=null?DS.undoKeys:true;if(zot(move))move=DS.move!=null?DS.move:true;if(zot(deleteable))deleteable=DS.deleteable!=null?DS.deleteable:true;if(zot(doubleClickDelete))doubleClickDelete=DS.doubleClickDelete!=null?DS.doubleClickDelete:true;if(zot(onTop))onTop=DS.onTop!=null?DS.onTop:true;if(zot(immediateStop))immediateStop=DS.immediateStop!=null?DS.immediateStop:"both";if(zot(lineAlpha))lineAlpha=DS.lineAlpha!=null?DS.lineAlpha:1;if(zot(lineBlendMode))lineBlendMode=DS.lineBlendMode!=null?DS.lineBlendMode:"normal";if(zot(paper))paper=DS.paper!=null?DS.paper:new zim.Container();if(zot(nib))nib=DS.nib!=null?DS.nib.clone():null;if(zot(frame))frame=DS.frame!=null?DS.frame:zdf;var that=this;this.dampX=new zim.Damp(null,damp);this.dampY=new zim.Damp(null,damp);var _draw=true;this.drawing=false;this.immediateStop=immediateStop;this.undoLevels=undo;this.undoKeys=undoKeys;this.move=move;this.draggable=true;this.lineAlpha=lineAlpha;this.lineBlendMode=lineBlendMode;var shape=that.shape=new zim.Shape();var w=frame.stage.width;var h=frame.stage.height;var startXCheck;var startYCheck;var startLayer;var endLayer;var draggingCheck=false;that.paperNum=0;that.sizeScale=1;that.spreadScale=1;that.sizeFactor=1;that.spreadFactor=1;that.stop=function(){};var stage;var w;var h;var stage;this.added(function(s){stage=s;that.paper=paper;w=that.stage.width;h=that.stage.height;if(!zot(nib)){if(that.zimDown){that.nib=nib.addTo(that);}else{that.nib=nib.addTo(that.parent,that.parent.getChildIndex(that));that.nib.x=that.x;that.nib.y=that.y;that.nib.mouseEnabled=false;that.stageDown=stage.on("stagemousedown",function(e){stage=e.target.stage;that.nibEvent=stage.on("stagemousemove",moveNib);});that.stageUp=stage.on("stagemouseup",function(e){stage.off("stagemousemove",that.nibEvent);});function moveNib(e){if(!that.drawing)return;that.nib.x=e.stageX/zim.scaX;that.nib.y=e.stageY/zim.scaY;}}}
that.zimDragCheck=false;that.stop=function(){that.stopCheck(true);};that.infinite=false;that.stopCheck=function(override){if(!override){if(that.infinite)return;if(that.zimDragCheck)return;if(!that.immediateStop&&that.drawing)return;}else{that.drawing=false;that.infinite=false;}
that.immediate(that.x,that.y);setTimeout(function(){if(that.drawing)return;if(cache){shape.cache(-(w*cropScale-w)/2,-(h*cropScale-h)/2,w*cropScale,h*cropScale);var line=paper.bitmap=new zim.Bitmap(shape.cacheCanvas).reg((w*cropScale-w)/2,(h*cropScale-h)/2).addTo(paper);shape.graphics.clear();shape.uncache();shape.top();}else{var line=shape;}
if(that.undoLevels>0){var data={paper:paper,line:line};undo.push(data);if(undo.length>that.undoLevels)undo.shift();that.dispatchEvent("recordUndo");}
if(!cache)shape=new zim.Shape().clone().addTo(paper);that.lastSegment=line;that.lastSelected=line;line.alpha=that.lineAlpha;line.blendMode=that.lineBlendMode;line.paper=paper;that.dispatchEvent("stop");that.dispatchEvent("change");},(that.immediateStop||override?0:50));};var count=0;that.dampX.immediate(that.x);that.dampY.immediate(that.y);that.lastX=that.lastMidX=that.x;that.lastY=that.lastMidY=that.y;that.ticker=zim.Ticker.add(function(){if(!that.parent)return;var newX=that.dampX.convert(_draw?that.x:that.finishX);var newY=that.dampY.convert(_draw?that.y:that.finishY);var newPoint=that.parent.localToLocal(newX,newY,shape);var pickedSize=zim.Pick.choose(size)*that.sizeScale*that.sizeFactor;var pickedSpread=zim.Pick.choose(spread)*that.spreadScale*that.spreadFactor;if(Math.abs(that.lastX-newX)+Math.abs(that.lastY-newY)<1){if(that.drawing){that.drawing=false;if(that.zimDown){that.x=that.lastX=that.lastMidX=_draw?that.x:that.finishX;that.y=that.lastY=that.lastMidY=_draw?that.y:that.finishY;that.dampX.immediate(that.x);that.dampY.immediate(that.y);}else{that.x=that.finishX=that.lastX=that.lastMidX=newX;that.y=that.finishY=that.lastY=that.lastMidY=newY;}
that.stopCheck();}
that.lastX=that.lastMidX=newX;that.lastY=that.lastMidY=newY;return;}else{if(!that.drawing){redo=[];if(paper.getChildIndex(shape)!=paper.numChildren-1)shape.top();}
that.drawing=true;that.dispatchEvent("drawing");}
var lastPoint=that.parent.localToLocal(that.lastX,that.lastY,shape);var lastMidPoint=that.parent.localToLocal(that.lastMidX,that.lastMidY,shape);if(penType=="splatter"){for(var i=0;i<=3;i++){var angle=zim.rand(360)*Math.PI/180;var d=pickedSpread;var loc={x:newX+d*Math.cos(angle),y:newY+d*Math.sin(angle)};var point=that.parent.localToLocal(loc.x,loc.y,shape);shape.graphics.mt(point.x,point.y).f(zim.Pick.choose(color)).dc(point.x,point.y,pickedSize/2);}}else if(penType=="grass"||penType=="hair"||penType=="city"){if(penType=="grass"||penType=="hair"){var midX=that.lastX+(newX-that.lastX)/2;var midY=that.lastY+(newY-that.lastY)/2;var midPoint=that.parent.localToLocal(midX,midY,shape);shape.graphics.s(zim.Pick.choose(color)).ss(pickedSize,end).mt(midPoint.x,midPoint.y).lt(midPoint.x+zim.rand(-pickedSpread/4,pickedSpread/4),penType=="hair"?midPoint.y+pickedSpread:midPoint.y-pickedSpread);}
if(penType=="grass"||penType=="hair"||(penType=="city"&&count%3==0)){shape.graphics.s(zim.Pick.choose(color)).ss(pickedSize,end).mt(newPoint.x,newPoint.y).lt(newPoint.x+(penType=="city"?0:zim.rand(-pickedSpread/4,pickedSpread/4)),penType=="hair"?midPoint.y+pickedSpread:newPoint.y-pickedSpread);}
count++;}else{if(penType=="kitetail"){shape.graphics.s(zim.Pick.choose(color)).ss(pickedSize,end);}
if(penType=="barbwire"){shape.graphics.s(zim.Pick.choose(color)).ss(pickedSize,end);var midX=that.lastX+(newX-that.lastX)/2+zim.rand(-pickedSpread,pickedSpread);var midY=that.lastY+(newY-that.lastY)/2+zim.rand(-pickedSpread,pickedSpread);}else{var midX=that.lastX+(newX-that.lastX)/2;var midY=that.lastY+(newY-that.lastY)/2;}
var midPoint=that.parent.localToLocal(midX,midY,shape);if(penType!="line"){shape.graphics.qt(lastPoint.x,lastPoint.y,midPoint.x,midPoint.y);}}
if(borderWidth>0&&penType!="line"){var midX=that.lastX+(newX-that.lastX)/2;var midY=that.lastY+(newY-that.lastY)/2;var midPoint=that.parent.localToLocal(midX,midY,shape);shape.graphics.s(zim.Pick.choose(borderColor)).ss(zim.Pick.choose(borderWidth)).mt(lastMidPoint.x,lastMidPoint.y).qt(lastPoint.x,lastPoint.y,midPoint.x,midPoint.y);if(penType=="splatter")shape.graphics.es();}
if(penType=="splatter"){shape.graphics.f(zim.Pick.choose(color));}else if(penType=="kitetail"){}else{shape.graphics.s(zim.Pick.choose(color)).ss(pickedSize,end);}
if(penType!="grass"&&penType!="hair"&&penType!="city"&&penType!="splatter"){shape.graphics.mt(lastMidPoint.x,lastMidPoint.y).qt(lastPoint.x,lastPoint.y,midPoint.x,midPoint.y);}
that.lastX=newX;that.lastY=newY;if(midPoint){that.lastMidX=midPoint.x;that.lastMidY=midPoint.y;}});that.upEvent=stage.on("stagemouseup",function(){draggingCheck=false;});});that.mouseChildren=false;var undo=[];var redo=[];this.saveState=function(obj,startLayer,endLayer){var t=obj.type=="Container"?"paper":"line";var data={paper:that.paper};data[t]=obj;data[t+"Transform"]={x:obj.x,y:obj.y,r:obj.rotation,a:obj.alpha,rX:obj.regX,rY:obj.regY,sX:obj.scaleX,sY:obj.scaleY,skX:obj.skewX,skY:obj.skewY,v:obj.visible};if(!zot(startLayer)&&!zot(endLayer)&&startLayer!=endLayer){data.startLayer=startLayer;data.endLayer=endLayer;}
undo.push(data);that.dispatchEvent("recordUndo");if(undo.length>that.undoLevels)undo.shift();};var defaultTransform={x:0,y:0,r:0,a:1,rX:0,rY:0,sX:1,sY:1,skX:0,skY:0,v:true};this.undo=function(){var data=undo.pop();if(data){redo.push(data);if(data.clear){for(var i=0;i<data.clear.length;i++){data.paper.addChild(data.clear[i]);}
data.paper.addChild(shape);}else if(data.line&&data.lineTransform){if(!zot(data.startLayer)){shape.top();data.paper.setChildIndex(data.line,startLayer);}
undoObjTransform("line",data.line);}else if(data.line){data.line.removeFrom();}else if(data.paperTransform){undoObjTransform("paper",data.paper);}
that.lastPaper=that.paper;if(data.paper!=that.paper){that.paper=data.paper;that.dispatchEvent("paperChange");}
that.dispatchEvent("change");if(!OPTIMIZE&&that.stage)that.stage.update();}};function undoObjTransform(type,obj){var d;for(var i=undo.length-1;i>=0;i--){if(undo[i][type]==obj&&undo[i][type+"Transform"]){d=undo[i][type+"Transform"];break;}}
if(!d)d=zim.copy(defaultTransform);obj.x=d.x;obj.y=d.y;obj.alpha=d.a;obj.rotation=d.r;obj.regX=d.rX;obj.regY=d.rY;obj.scaleX=d.sX;obj.scaleY=d.sY;obj.skewX=d.skX;obj.skewY=d.skY;obj.visible=d.v;if(type=="line"&&cache){obj.regX=(w*cropScale-w)/2;obj.regY=(h*cropScale-h)/2;}}
this.redo=function(){var data=redo.pop();var obj;if(data){undo.push(data);if(data.clear){data.paper.removeAllChildren();data.paper.addChild(shape);}else if(data.line&&data.lineTransform){if(!zot(data.endLayer)){shape.top();data.paper.setChildIndex(data.line,endLayer);}
var d=data.lineTransform;var obj=data.line;}else if(data.line){data.line.addTo(data.paper);}else if(data.paperTransform){var d=data.paperTransform;var obj=data.paper;}
if(obj){obj.x=d.x;obj.y=d.y;obj.alpha=d.a;obj.rotation=d.r;obj.regX=d.rX;obj.regY=d.rY;obj.scaleX=d.sX;obj.scaleY=d.sY;obj.skewX=d.skX;obj.skewY=d.skY;obj.visible=d.v;}
that.lastPaper=that.paper;if(data.paper!=that.paper){that.paper=data.paper;that.dispatchEvent("paperChange");}
that.dispatchEvent("change");if(!OPTIMIZE&&that.stage)that.stage.update();}};that.ctrlKey=false;that.shiftKey=false;that.ctrlKeyCheck=false;that.zimkeydownEvent=function(e){that.ctrlKey=e.ctrlKey;that.shiftKey=e.shiftKey;if(e.keyCode==17&&move&&!that.ctrlKeyCheck){that.ctrlKeyCheck=true;paper.noDrag();paper.drag({onTop:onTop,all:true});}
if(that.undoLevels<=0)return;if(!that.undoKeys)return;if(e.ctrlKey&&((e.shiftKey&&e.keyCode==90)||e.keyCode==89)){that.redo();}else if(e.ctrlKey&&e.keyCode==90){that.undo();}
if(frame&&frame.ctrlKey&&that.write){that.lastWrite=that.write;that.write=false;}}
window.addEventListener("keydown",that.zimkeydownEvent);that.zimkeyupEvent=function(e){if(e.keyCode==17&&move&&that.ctrlKeyCheck){that.ctrlKeyCheck=false;paper.noDrag();paper.drag({onTop:onTop});}
if(!e.ctrlKey)that.ctrlKey=false;if(!e.shiftKey)that.shiftKey=false;if(frame&&!frame.ctrlKey&&that.write==false){that.write=that.lastWrite;}}
window.addEventListener("keyup",that.zimkeyupEvent);Object.defineProperty(this,'paper',{get:function(){return paper;},set:function(value){if(value.type!="Container")return;paper=value;shape.addTo(paper,0,false);paper.shape=shape;that.dampX.immediate(that.x);that.dampY.immediate(that.y);that.lastX=that.lastMidX=that.finishX=that.x;that.lastY=that.lastMidY=that.finishY=that.y;if(penType=="barbwire"){shape.graphics.s(zim.Pick.choose(color)).ss(zim.Pick.choose(size)*that.sizeScale*that.sizeFactor,end);}
shape.graphics.mt(that.x,that.y);if(!paper.parent)paper.addTo(that.parent,that.parent.getChildIndex(that));if(zot(paper.paperNum)){paper.paperNum=++that.paperNum;if(deleteable){paper.on("mousedown",function(e){that.lastSelected=e.target;if(that.nibEvent)that.stage.off("stagemousemove",that.nibEvent);var currentPaper=e.target.paper;if(!currentPaper)return;if(currentPaper!=that.paper){that.paper=currentPaper;that.dispatchEvent("paperChange");}
if(that.shiftKey){if(that.ctrlKey){that.clear();}else{e.target.visible=false;if(that.undoLevels>0)that.saveState(e.target);that.dispatchEvent("change");}}});}
if(doubleClickDelete){paper.on("dblclick",function(e){e.target.visible=false;if(that.undoLevels>0)that.saveState(e.target);});}
if(move){paper.on("mousedown",function(e){stage=e.target.stage;draggingCheck=true;if(that.shiftKey&&deleteable)return;startXCheck=e.stageX/zim.scaX;startYCheck=e.stageY/zim.scaY;shape.top();startLayer=paper.getChildIndex(e.target);});paper.drag({onTop:onTop});paper.on("pressup",function(e){if(deleteable&&that.shiftKey)return;if(e.target.visible==false)return;if(that.undoLevels<=0)return;if(Math.abs(e.stageX/zim.scaX-startXCheck)<1&&Math.abs(e.stageY/zim.scaY-startYCheck)<1){if(onTop){shape.top();endLayer=paper.getChildIndex(e.target);if(startLayer!=endLayer)that.saveState(e.target,startLayer,endLayer);}
return;}
if(that.ctrlKey){that.saveState(paper);that.dispatchEvent("paperChange");}else{shape.top();endLayer=paper.getChildIndex(e.target);that.saveState(e.target,startLayer,endLayer);}
that.dispatchEvent("change");shape.top();});}}}});Object.defineProperty(this,'write',{get:function(){return _draw;},set:function(value){if(_draw&&value===false){that.finishX=that.x;that.finishY=that.y;}
if(!_draw&&value){shape.graphics.es();shape.graphics.ef();that.dampX.immediate(that.x);that.dampY.immediate(that.y);that.lastX=that.lastMidX=that.x;that.lastY=that.lastMidY=that.y;}
_draw=value;}});Object.defineProperty(this,'size',{get:function(){return size;},set:function(value){shape.graphics.es();shape.graphics.ef();size=value;if(penType!="splatter")shape.graphics.ss(zim.Pick.choose(size)*that.sizeScale*that.sizeFactor,end);}});Object.defineProperty(this,'color',{get:function(){return color;},set:function(value){color=value;shape.graphics.es();shape.graphics.ef();if(penType!="splatter")shape.graphics.s(zim.Pick.choose(color));}});Object.defineProperty(this,'penType',{get:function(){return penType;},set:function(value){penType=value;shape.graphics.ef().es();if(penType!="splatter"){shape.graphics.s(zim.Pick.choose(color));}else{shape.graphics.s(zim.Pick.choose(color)).ss(zim.Pick.choose(size)*that.sizeScale*that.sizeFactor,end);}}});Object.defineProperty(this,'damp',{get:function(){return damp;},set:function(value){damp=value;that.dampX.damp=damp;that.dampY.damp=damp;}});Object.defineProperty(this,'spread',{get:function(){return spread;},set:function(value){spread=value;}});var startColor;var endColor;this.setColorRange=function(color1,color2){if(zot(color2)){startColor=that.color;endColor=color1;}else if(zot(color1)){startColor=that.color;endColor=color2;}else{startColor=color1;endColor=color2;}
return that;};var _colorRange=0;Object.defineProperty(that,'colorRange',{get:function(){return _colorRange;},set:function(value){_colorRange=value;if(!zot(startColor)&&!zot(endColor)){that.color=zim.colorRange(startColor,endColor,value);}}});Object.defineProperty(this,'borderColor',{get:function(){return borderColor;},set:function(value){borderColor=value;}});Object.defineProperty(this,'borderWidth',{get:function(){return borderWidth;},set:function(value){borderWidth=value;}});that.setPen=function(newPen){that.dampX.immediate(that.x);that.dampY.immediate(that.y);that.lastX=that.lastMidX=that.finishX=that.x;that.lastY=that.lastMidY=that.finishY=that.y;if(zot(newPen))newPen=penType;if(zot(defaults[newPen]))newPen="line";that.penType=penType=newPen;var newDefaults=zim.merge(base,defaults[newPen]);for(var prop in newDefaults){if(that[prop]!=newDefaults[prop]){that[prop]=newDefaults[prop];}}
return that;};that.immediate=function(x,y){if(!zot(x)){that.x=x;that.dampX.immediate(that.x);that.lastX=that.lastMidX=that.finishX=that.x;}
if(!zot(y)){that.y=y;that.dampY.immediate(that.y);that.lastY=that.lastMidY=that.finishY=that.y;}
return that;};that.clear=function(){var data=[];var obj;for(var i=0;i<paper.numChildren-1;i++){data.push(paper.getChildAt(i));}
undo.push({paper:paper,clear:data});if(undo.length>that.undoLevels)undo.shift();that.dispatchEvent("recordUndo");paper.removeAllChildren();shape.graphics.clear();paper.addChild(shape);that.dispatchEvent("change");if(that.stage)that.stage.update();return that;};this.deleteSegment=function(segment){segment.visible=false;if(that.undoLevels>0)that.saveState(segment);};that.dispose=function(all,b,disposing){if(zot(all))all=true;window.removeEventListener("keydown",that.zimkeydownEvent);window.removeEventListener("keyup",that.zimkeyupEvent);if(stage&&that.nibEvent)stage.off("stagemousemove",that.nibEvent);if(stage&&that.stageDown)stage.off("stagemousedown",that.stageDown);if(stage&&that.stageUp)stage.off("stagemouseup",that.stageUp);if(stage&&that.upEvent)stage.off("stagemouseup",that.upEvent);zim.Ticker.remove(that.ticker);that.removeAllEventListeners();if(nib)nib.removeFrom();if(all){if(that.shape)that.shape.dispose();if(that.paper)that.paper.dispose();if(cache){if(that.bitmap)that.bitmap.dispose();that.bitmap=null;}
that.zimContainer_dispose(disposing);paper=shape=that.shape=null;}
return true;};if(style!==false)zim.styleTransforms(this,DS);};zim.extend(zim.Pen,zim.Container,"dispose","zimContainer",false);zim.SoundWave=function(num,input,include,smoothing,min,max,operation,baseline,magnify,reduce){var sig="num, input, include, smoothing, min, max, operation, baseline, magnify, reduce";var duo;if(duo=zob(zim.SoundWave,arguments,sig,this))return duo;z_d("69.95");this.type="SoundWave";if(zot(num))num=120;if(zot(input))input="mic";if(zot(include))include=120/1024;if(zot(smoothing))smoothing=.85;if(zot(min))min=input=="mic"?-80:input.oscillator?-100:-100;if(zot(max))max=input=="mic"?-40:input.oscillator?-10:-10;if(zot(operation))operation=function(amplitude,i){return amplitude*(.5+i*1/Math.pow(zim.SoundWave.bufferLength,.95));};if(zot(baseline))baseline=(input=="mic"?0:input.oscillator?30:30);if(zot(magnify))magnify=(input=="mic"?1:input.oscillator?5:10);if(zot(reduce))reduce=0;zim.SoundWave.bufferLength=1024;var _num=num;var that=this;that.baseline=baseline;that.magnify=magnify;that.reduce=reduce;that.input=input;if(input.type=="Tone"||input.type=="SynthSound")var audioContext=input.audioContext;else var audioContext=new(window.AudioContext||window.webkitAudioContext)();var analyser=that.analyser=audioContext.createAnalyser();analyser.minDecibels=min;analyser.maxDecibels=max;analyser.smoothingTimeConstant=smoothing;Object.defineProperty(this,'smoothing',{get:function(){return analyser.smoothingTimeConstant;},set:function(s){analyser.smoothingTimeConstant=s;}});Object.defineProperty(this,'num',{get:function(){return _num;},set:function(n){_num=n;steps=Math.floor(include*zim.SoundWave.bufferLength/_num);if(steps<1)zog("ZIM SoundWave: num is too big");}});this.setInput=function(input){that.input=input;if(input=="mic"){navigator.getUserMedia=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);if(navigator.getUserMedia){navigator.getUserMedia({audio:true},function(stream){var source=that.source=audioContext.createMediaStreamSource(stream);connectSource(source);},function(err){zog("ZIM SoundWave: Error occured: "+err);});}else{zog("ZIM SoundWave: Sorry, mic not supported");}
return;}else if(input.type=="Tone"){connectSource(input.compressor);}else if(input.type=="SynthSound"){connectSource(input.gain);}else{if(input.type&&input.type=="sound"){zog("ZIM SoundWave: pass in the result of a zim.asset('somesound').play() for the input");return;}
if(input.playbackResource){var audio=input.playbackResource;var source=audioContext.createMediaElementSource(audio);}else{var audio=input;var source=audioContext.createMediaElementSource(audio);}
connectSource(source);}};this.setInput(input);var steps;var lastSource;function connectSource(source){if(lastSource)lastSource.disconnect(analyser);lastSource=source;source.connect(analyser);if(input!="mic")analyser.connect(audioContext.destination);analyser.fftSize=zim.SoundWave.bufferLength*2;steps=Math.floor(include*zim.SoundWave.bufferLength/_num);if(steps<1){zog("ZIM SoundWave: include param is too small or num param is too big");return;}
var bufferLength=analyser.frequencyBinCount;var dataArray=new Uint8Array(bufferLength);that.calculate=function(){analyser.getByteFrequencyData(dataArray);var adjustedArray=dataArray.map(operation);if(steps==1)return adjustedArray;var array=[];var tot=0;for(var i=0;i<=include*zim.SoundWave.bufferLength;i++){tot+=adjustedArray[i];if(i==0)continue;if(i%steps==0){array.push(Math.max(0,(tot/steps-that.baseline)*that.magnify-that.reduce));tot=0;}}
if(input!="mic"){array[0]*=.75;array[1]*=.85;array[2]*=.9;array[array.length-2]*=.8;array[array.length-1]*=.75;}
array[array.length-1]*=1.3;array[array.length-2]*=1.2;array[array.length-3]*=1.1;return array;};setTimeout(function(){that.dispatchEvent("ready");},50);}
this.dispose=function(context){if(context&&audioContext)audioContext.close();if(analyser)analyser.disconnect();return true;};};zim.extend(zim.SoundWave,createjs.EventDispatcher,null,"cjsEventDispatcher",false);zim.Synth=function(volume,frequency){z_d("69.955");this.type="Synth";if(zot(volume))volume=.3;if(zot(frequency))frequency=220;this.volume=volume;this.frequency=frequency;var that=this;var zzfxX;this.play=function(volume,randomness,frequency,attackIn,sustainIn,releaseIn,shape,shapeCurve,slide,deltaSlide,pitchJump,pitchJumpTime,repeatTime,noise,modulation,bitCrush,delayIn,sustainVolume,decayIn,tremolo,place1,place2,place3,place4,place5,place6,sampleRate,attack,sustain,release,decay,delay,PI2,sign,length,startSlide,startFrequency,modPhase,t,tm,i,r,c,s,j,b,source,buffer){var args=Array.prototype.slice.call(arguments);if(!zzfxX&&(window.AudioContext||window.webkitAudioContext)){zzfxX=new(window.AudioContext||window.webkitAudioContext);zzfxX.z=zzfxX.createBufferSource;zzfxX.createBufferSource=function(s){if(s==null)s=zzfxX.z();return(s.start=s.start||(function(t){zzfxX.noteOn(t);}),s);};}
if(!zzfxX)return;volume=(volume!=null)?zik(volume):.3;randomness=(randomness!=null)?zik(randomness):.05;frequency=(frequency!=null)?zik(frequency):220;attackIn=(attackIn!=null)?zik(attackIn):0;sustainIn=(sustainIn!=null)?zik(sustainIn):0;releaseIn=(releaseIn!=null)?zik(releaseIn):.1;shape=(shape!=null)?zik(shape):0;shapeCurve=(shapeCurve!=null)?zik(shapeCurve):1;slide=(slide!=null)?zik(slide):0;deltaSlide=(deltaSlide!=null)?zik(deltaSlide):0;pitchJump=(pitchJump!=null)?zik(pitchJump):0;pitchJumpTime=(pitchJumpTime!=null)?zik(pitchJumpTime):0;repeatTime=(repeatTime!=null)?zik(repeatTime):0;noise=(noise!=null)?zik(noise):0;modulation=(modulation!=null)?zik(modulation):0;bitCrush=(bitCrush!=null)?zik(bitCrush):0;delayIn=(delayIn!=null)?zik(delayIn):0;tremolo=(tremolo!=null)?zik(tremolo):0;sustainVolume=(sustainVolume!=null)?zik(sustainVolume):1;decayIn=(decayIn!=null)?zik(decayIn):0;sampleRate=(sampleRate!=null)?zik(sampleRate):44100;if(attack==null)attack=99+attackIn*sampleRate;if(sustain==null)sustain=sustainIn*sampleRate;if(release==null)release=releaseIn*sampleRate;if(decay==null)decay=decayIn*sampleRate;if(delay==null)delay=delayIn*sampleRate;if(PI2==null)PI2=Math.PI*2;if(sign==null)sign=function(v){return v>0?1:-1;};if(length==null)length=attack+decay+sustain+release+delay;if(startSlide==null)startSlide=slide*=500*PI2/Math.pow(sampleRate,2);if(startFrequency==null)startFrequency=frequency*=(1+randomness*2*Math.random()-randomness)*PI2/sampleRate;if(modPhase==null)modPhase=sign(modulation)*PI2/4;if(t==null)t=0;if(tm==null)tm=0;if(i==null)i=0;if(r==null)r=0;if(c==null)c=0;if(s==null)s=0;if(j==null)j=1;if(b==null)b=[];if(source==null)source=zzfxX.createBufferSource();if(buffer==null)buffer=zzfxX.createBuffer(1,length,sampleRate);for(source.connect(zzfxX.destination);i<Math.floor(length);b[i++]=s)
{if(++c>bitCrush*100)
{c=0;s=t*frequency*Math.sin(tm*modulation*PI2/sampleRate-modPhase);s=shape?shape>1?shape>2?shape>3?Math.sin(Math.pow(s%PI2,3)):Math.max(Math.min(Math.tan(s),1),-1):1-(2*s/PI2%2+2)%2:1-4*Math.abs(Math.round(s/PI2)-s/PI2):Math.sin(s);s=(repeatTime?1-tremolo+tremolo*Math.sin(PI2*i/repeatTime):1)*sign(s)*Math.pow(Math.abs(s),shapeCurve)*volume*that.volume*(i<attack?i/attack:i<attack+decay?1-((i-attack)/decay)*(1-sustainVolume):i<attack+decay+sustain?sustainVolume:i<length-delay?(length-i-delay)/release*sustainVolume:0);s=delay?s/2+(delay>i?0:(i<length-delay?1:(i-length)/delay)*b[i-delay|0]/2):s;}
t+=1-noise+(Math.sin(i)+1)*1e9%2*noise;tm+=1-noise+(Math.pow(Math.sin(i),2)+1)*1e9%2*noise;frequency+=slide+=deltaSlide*500*PI2/Math.pow(sampleRate,3);if(j&&++j>pitchJumpTime*sampleRate)
{frequency+=pitchJump*PI2/sampleRate;startFrequency+=pitchJump*PI2/sampleRate;j=0;}
if(repeatTime&&++r>repeatTime*sampleRate)
{frequency=startFrequency;slide=startSlide;r=1;j=j||1;}}
buffer.getChannelData(0).set(b);source.buffer=buffer;var synthSound=new createjs.EventDispatcher();synthSound.type="SynthSound";synthSound.audioContext=zzfxX;synthSound.gain=zzfxX.createGain();source.connect(synthSound.gain);synthSound.gain.connect(zzfxX.destination);source.start();synthSound.duration=b.length/sampleRate;synthSound.playing=true;synthSound.stop=function(){clearTimeout(synthSound.completeID);clearInterval(synthSound.repeatID);synthSound.gain.gain.setTargetAtTime(0,zzfxX.currentTime,.1);synthSound.playing=false;setTimeout(function(){zzfxX.close();},.1*1000);};var repeatNum;synthSound.repeat=synthSound.loop=function(num,offset){repeatNum=0;if(num===true)num=null;if(zot(offset))offset=0;clearTimeout(synthSound.completeID);function adjust(){return(synthSound.duration+zik(offset));}
synthSound.repeatID=zim.interval(adjust,function(){repeatNum++;if(num&&repeatNum>=num){synthSound.dispatchEvent("complete");synthSound.repeatID.clear();synthSound.playing=false;}else{synthSound.dispatchEvent("loop");that.play.apply(that,args);}});return synthSound;};synthSound.play=function(){that.play.apply(that,args);synthSound.playing=true;return synthSound;};synthSound.completeID=setTimeout(function(){synthSound.dispatchEvent("complete");},(b.length/sampleRate+.1)*1000);return synthSound;};this.Tone=function(volume,note,shape,duration,attack,release,wahAmount,wahRate,wahShape,wahThroat,wahNote,vibratoAmount,vibratoRate,vibratoShape,tremeloAmount,tremeloRate,tremeloShape,startTime,pauseOnBlur){var sig="volume, note, shape, duration, attack, release, wahAmount, wahRate, wahShape, wahThroat, wahNote, vibratoAmount, vibratoRate, vibratoShape, tremeloAmount, tremeloRate, tremeloShape, startTime, pauseOnBlur";var duo;if(duo=zob(that.Tone,arguments,sig,this))return duo;this.type="Tone";var that2=this;var audioContext;if(zot(volume))volume=that.volume;if(zot(note))note=that.frequency;if(zot(shape))shape=zim.SINE;if(zot(attack))attack=.02;if(zot(release))release=.05;if(zot(startTime))startTime=0;if(window.AudioContext||window.webkitAudioContext){audioContext=this.audioContext=new(window.AudioContext||window.webkitAudioContext);}else{if(zon)zogy("Synth tone() needs AudioContext");}
volume=zik(volume);note=zik(note);shape=zik(shape);duration=zik(duration);attack=zik(attack);release=zik(release);wahAmount=zik(wahAmount);wahRate=zik(wahRate);wahShape=zik(wahShape);wahThroat=zik(wahThroat);wahNote=zik(wahNote);vibratoAmount=zik(vibratoAmount);vibratoRate=zik(vibratoRate);vibratoShape=zik(vibratoShape);tremeloAmount=zik(tremeloAmount);tremeloRate=zik(tremeloRate);tremeloShape=zik(tremeloShape);startTime=zik(startTime);var timeType=getTIME(duration);that.duration=duration;if(duration)duration=duration*(timeType=="s"?1:1/1000);if(startTime){getTIME(startTime);startTime=startTime*(timeType=="s"?1:1/1000);}
that.attack=attack;that.release=release;that.rampDuration=.02;that.hush=.1;var oscillator=this.note=this.oscillator=audioContext.createOscillator();oscillator.frequency.value=zim.Synth.note(note);zim.Synth.setShape(oscillator,shape);var filter=this.filter=audioContext.createBiquadFilter();filter.type="bandpass";filter.frequency.value=oscillator.frequency.value;filter.Q.value=0;var gain=this.gain=oscillator.gain=audioContext.createGain();gain.type="gain";gain.gain.setValueAtTime(0,audioContext.currentTime);var compressor=this.compressor=audioContext.createDynamicsCompressor();compressor.threshold.setValueAtTime(-50,audioContext.currentTime);compressor.knee.setValueAtTime(40,audioContext.currentTime);compressor.ratio.setValueAtTime(12,audioContext.currentTime);compressor.attack.setValueAtTime(0,audioContext.currentTime);compressor.release.setValueAtTime(0.25,audioContext.currentTime);oscillator.connect(filter);filter.connect(gain);gain.connect(compressor);compressor.connect(audioContext.destination);function start(time,attackTime){if(zot(time))time=audioContext.currentTime;if(zot(attackTime))attackTime=that.attack;oscillator.start(time);var del=(zdf&&new Date().getTime()-zdf.startTime<200)?.1:that.attack;gain.gain.setValueAtTime(0,audioContext.currentTime+.1);gain.gain.linearRampToValueAtTime(volume*that.hush,audioContext.currentTime+.1+del);}
start(startTime);this.stop=function(releaseTime){if(zot(releaseTime))releaseTime=that.release;if(gain){if(audioContext.currentTime<200){timeout(.2-audioContext.currentTime/1000,function(){ramp(gain.gain,0,true,releaseTime);});}else ramp(gain.gain,0,true,releaseTime);}
if(tremeloGain)ramp(tremeloGain.gain,0,true,releaseTime);if(vibratoGain)ramp(vibratoGain.gain,0,true,releaseTime);setTimeout(function(){that2.dispatchEvent("complete");},(.6+releaseTime+that.rampDuration)*1000);setTimeout(function(){if(audioContext&&!audioContext.iamClosed){audioContext.iamClosed=true;audioContext.close();}},(releaseTime+1)*1000);setTimeout(function(){if(wah)that2.removeWah();},(releaseTime+1)*1000);};if(duration)timeout(duration,function(){that2.stop();});var notes=this.notes=[oscillator];this.addNote=function(volume,note,shape,toWah,toVibrato,startTime){if(zot(toWah))toWah=true;if(zot(toVibrato))toVibrato=false;if(zot(volume))volume=.1;if(zot(startTime))startTime=0;var obj={type:"Note"};obj._volume=volume;obj._note=zim.Synth.note(note);notes.push(obj);var oscillator=obj.oscillator=audioContext.createOscillator();oscillator.frequency.value=obj._note;oscillator.type=zim.Synth.setShape(oscillator,shape);var noteGain=obj.gain=audioContext.createGain();ramp(noteGain.gain,obj._volume,true);noteGain.connect(toWah?filter:gain);oscillator.connect(noteGain);if(vibratoGain&&toVibrato)vibratoGain.connect(oscillator.frequency);oscillator.start(audioContext.currentTime+startTime);Object.defineProperty(obj,'volume',{get:function(){return obj._volume;},set:function(value){if(zot(value))return;obj._volume=zik(value);ramp(obj.gain.gain,obj._volume,true);}});Object.defineProperty(obj,'note',{get:function(){return obj._note;},set:function(value){if(zot(value))return;obj._note=zik(value);ramp(obj.oscillator.frequency,zim.Synth.note(obj._note));}});return obj;};this.removeNote=function(note){var index=notes.indexOf(note);if(index>=0)notes.splice(index,1);note.oscillator.disconnect();note=null;return this;};function ramp(obj,val,gain,duration){if(zot(val))val=0;if(zot(duration))duration=that.rampDuration;if(gain){obj.cancelScheduledValues(audioContext.currentTime);obj.linearRampToValueAtTime(obj.value=obj.value,audioContext.currentTime+.02);obj.linearRampToValueAtTime(val,audioContext.currentTime+.05+duration);}else{obj.cancelScheduledValues(audioContext.currentTime);obj.setTargetAtTime(val,audioContext.currentTime,duration);}}
this.ramp=function(volume,duration){ramp(gain.gain,volume*that.hush,true,duration);};this.animate=function(){if(arguments[0].props)arguments[0].target=this;else Array.prototype.unshift.call(arguments,this);zim.animate.apply(null,arguments);return this;};this.wiggle=function(){if(arguments[0].props)arguments[0].target=this;else Array.prototype.unshift.call(arguments,this);zim.wiggle.apply(null,arguments);return this;};zim.addWires(this);var wah;var wahNote;var wahAdjust;function makeWah(){if(zot(wahAmount))wahAmount=1000;if(zot(wahRate))wahRate=1;if(zot(wahShape))wahShape="sine";if(zot(wahThroat))wahThroat=5;if(zot(wahNote))wahNote=that2.oscillator.frequency.value;else wahNote=zim.Synth.note(wahNote);if(zot(wahAdjust))wahAdjust=200;that2.filter.Q.value=wahThroat;wah=that2.wah=that.oscillator(wahRate,wahAmount/2,wahShape,wahNote+wahAmount/2+wahAdjust);wah.ticker=zim.Ticker.add(function(){that2.filter.frequency.value=that2.wah.amplitude;});}
if(wahAmount||wahRate||!zot(wahShape)||!zot(wahThroat))makeWah();that2.removeWah=function(){zim.Ticker.remove(wah.ticker);wah.dispose();wah=that2.wah=null;that2.filter.Q.value=0;};var vibrato;var vibratoGain;function makeVibrato(){if(zot(vibratoRate))vibratoRate=5;if(zot(vibratoShape))vibratoShape="sine";if(zot(vibratoAmount))vibratoAmount=10;vibrato=that2.vibrato=audioContext.createOscillator();vibratoGain=that2.vibratoGain=audioContext.createGain();vibratoGain.gain.value=0;vibrato.frequency.value=vibratoRate;zim.Synth.setShape(vibrato,vibratoShape);vibrato.connect(vibratoGain);vibratoGain.connect(oscillator.frequency);vibrato.start(0);vibratoGain.gain.setValueAtTime(0,audioContext.currentTime+.1);vibratoGain.gain.linearRampToValueAtTime(vibratoAmount,audioContext.currentTime+.1+that.attack);}
if(vibratoAmount||vibratoRate||!zot(vibratoShape))makeVibrato();that2.removeVibrato=function(){ramp(vibratoGain.gain,0,true);setTimeout(function(){vibratoGain.disconnect();vibrato.disconnect();vibrato.stop();vibrato=null;},(that.rampDuration+1)*1000);};var tremelo;var tremeloGain;function makeTremelo(){if(zot(tremeloRate))tremeloRate=5;if(zot(tremeloShape))tremeloShape="sine";tremelo=that2.tremelo=audioContext.createOscillator();tremeloGain=that2.tremeloGain=audioContext.createGain();tremeloGain.gain.value=0;tremelo.frequency.value=tremeloRate;zim.Synth.setShape(tremelo,tremeloShape);tremelo.connect(tremeloGain);tremeloGain.connect(gain.gain);tremelo.start(0);var del=(zdf&&new Date().getTime()-zdf.startTime<200)?.1:that.attack;tremeloGain.gain.setValueAtTime(0,audioContext.currentTime+.1);tremeloGain.gain.linearRampToValueAtTime(volume*that.hush,audioContext.currentTime+.1+del);}
if(tremeloAmount||tremeloRate||!zot(tremeloShape))makeTremelo();that2.removeTremelo=function(){ramp(tremeloGain.gain,0,true);setTimeout(function(){tremeloGain.disconnect();tremelo.disconnect();tremelo.stop();tremelo=null;},(that.rampDuration+1)*1000);};Object.defineProperty(this,'volume',{get:function(){return volume;},set:function(value){if(zot(value))return;if(tremelo){if(gain.gain.value)var proportion=tremeloGain.gain.value/gain.gain.value;else var proportion=volume?tremeloAmount/volume:0;volume=zik(value);volume=zim.constrain(volume,.001);ramp(tremeloGain.gain,volume*proportion*that.hush,true);}else{volume=zik(value);}
ramp(gain.gain,volume*that.hush,false,that.rampDuration);}});this.paused=false;var rV=volume;this.pause=function(state){if(zot(state))state=true;if(state){rV=that2.volume;that2.volume=0;}else{that2.volume=rV;}}
if(pauseOnBlur){if(zot(zim.blurCheck))zim.setBlurDetect();zim.pauseOnBlur.push(this);}
Object.defineProperty(this,'frequency',{get:function(){return frequency;},set:function(value){if(zot(value))return;frequency=zik(value);ramp(oscillator.frequency,value);}});Object.defineProperty(this,'note',{get:function(){return note;},set:function(value){if(zot(value))return;note=zik(value);oscillator.frequency.value=zim.Synth.note(note);}});Object.defineProperty(this,'shape',{get:function(){return shape;},set:function(value){shape=zik(value);zim.Synth.setShape(oscillator,shape);}});Object.defineProperty(this,'currentTime',{get:function(){return audioContext.currentTime;},set:function(value){if(zon)zogy("Synth tone() - currentTime is read only");}});this.wahAmountMin=0;this.wahAmountMax=5000;Object.defineProperty(this,'wahAmount',{get:function(){return wahAmount;},set:function(value){if(zot(value))return;wahAmount=zik(value);wahAmount=zim.constrain(wahAmount,that.wahAmountMin,that.wahAmountMax);if(zot(wah))makeWah();else wah.gain=wahAmount/2;}});this.wahRateMin=0;this.wahRateMax=30;Object.defineProperty(this,'wahRate',{get:function(){return wahRate;},set:function(value){if(zot(value))return;wahRate=zik(value);wahRate=zim.constrain(wahRate,that.wahRateMin,that.wahRateMax);if(zot(wah))makeWah();else wah.frequency=wahRate;}});this.wahThroatMin=0;this.wahThroatMax=100;var startGain=gain.gain.value;Object.defineProperty(this,'wahThroat',{get:function(){return wahThroat;},set:function(value){wahThroat=zik(value);wahThroat=zim.constrain(wahThroat,that.wahThroatMin,that.wahThroatMax);if(zot(wah))makeWah();else filter.Q.value=wahThroat;}});Object.defineProperty(this,'wahNote',{get:function(){return wahNote;},set:function(value){if(zot(value))return;wahNote=zik(value);if(zot(wah))makeWah();else wah.offset=wahNote+wahAmount/2+wahAdjust;}});Object.defineProperty(this,'wahAdjust',{get:function(){return wahAdjust;},set:function(value){if(zot(value))return;wahAdjust=zik(value);if(zot(wah))makeWah();else wah.offset=wahNote+wahAmount/2+wahAdjust;}});Object.defineProperty(this,'wahShape',{get:function(){return wahShape;},set:function(value){wahShape=zik(value);if(zot(wah))makeWah();else wah.shape=wahShape;}});Object.defineProperty(this,'tremeloAmount',{get:function(){return tremeloAmount;},set:function(value){if(zot(value))return;tremeloAmount=zik(value);if(zot(tremelo))makeTremelo();else tremeloGain.gain.setValueAtTime(tremeloAmount,audioContext.currentTime);}});Object.defineProperty(this,'tremeloRate',{get:function(){return tremeloRate;},set:function(value){if(zot(value))return;tremeloRate=zik(value);if(zot(wah))makeTremelo();else tremelo.frequency.value=tremeloRate;}});Object.defineProperty(this,'tremeloShape',{get:function(){return tremeloShape;},set:function(value){tremeloShape=zik(value);if(zot(tremelo))makeTremelo();else zim.Synth.setShape(tremelo,tremeloShape);}});Object.defineProperty(this,'vibratoAmount',{get:function(){return vibratoAmount;},set:function(value){if(zot(value))return;vibratoAmount=zik(value);if(zot(vibrato))makeVibrato();else vibratoGain.gain.setValueAtTime(vibratoAmount,audioContext.currentTime);}});Object.defineProperty(this,'vibratoRate',{get:function(){return vibratoRate;},set:function(value){if(zot(value))return;vibratoRate=zik(value);if(zot(vibrato))makeVibrato();else vibrato.frequency.value=vibratoRate;}});Object.defineProperty(this,'vibratoShape',{get:function(){return vibratoShape;},set:function(value){vibratoShape=zik(value);if(zot(vibrato))makeVibrato();else zim.Synth.setShape(vibrato,vibratoShape);}});};zim.extend(this.Tone,createjs.EventDispatcher);this.tone=function(volume,note,shape,duration,attack,release,wahAmount,wahRate,wahShape,wahThroat,vibratoAmount,vibratoRate,vibratoShape,tremeloAmount,tremeloRate,tremeloShape,startTime,pauseOnBlur){Array.prototype.unshift.call(arguments,null);return new(Function.prototype.bind.apply(that.Tone,arguments));};this.Oscillator=function(frequency,gain,shape,offset){var sig="frequency, gain, shape, offset";var duo;if(duo=zob(that.Oscillator,arguments,sig,this))return duo;this.type="Oscillator";if(zot(frequency))frequency=1;if(zot(gain))gain=10;if(zot(shape))shape="sine";if(zot(offset))offset=0;this.frequency=zik(frequency);this.gain=zik(gain);this.shape=zik(shape);if(this.shape=="saw")this.shape="sawtooth";this.offset=zik(offset);this.paused=false;var that2=this;var counter=0;var sampleSize=zim.Ticker.framerate;this.ticker=zim.Ticker.add(function(){if(that2.paused)return;var a=0;if(that2.shape=="sine"){a=Math.sin(that2.frequency*(Math.PI*2*(counter/sampleSize)));}else if(that2.shape=="square"){var a=Math.sin(that2.frequency*(Math.PI*2*(counter/sampleSize)));a=(a<=0)?0:1;}else if(that2.shape=="triangle"){a=2/Math.PI*Math.asin(Math.sin(that2.frequency*Math.PI*2*counter/sampleSize));}else if(that2.shape=="sawtooth"||that2.shape=="saw"){a=-2/Math.PI*Math.atan(1/Math.tan(that2.frequency*Math.PI*counter/sampleSize));}else if(that2.shape=="zap"){a=2/Math.PI*Math.atan(1/Math.tan(that2.frequency*Math.PI*counter/sampleSize));}
that2.amplitude=a*that2.gain+that2.offset;counter++;});this.pause=function(state){that2.paused=state;};this.dispose=function(){zim.Ticker.remove(this.ticker);};};this.oscillator=function(frequency,gain,shape,offset){Array.prototype.unshift.call(arguments,null);return new(Function.prototype.bind.apply(that.Oscillator,arguments));};};zim.Synth.notes=["C",,"D",,"E","F",,"G",,"A",,"B"];zim.Synth.major=["C","D","E","F","G","A","B","C4"];zim.Synth.minor=["C","D","Eb","F","G","Ab","B","C4"];zim.Synth.shapes=["sine","triangle","sawtooth","tan","noise","square"];zim.Synth.setShape=function(oscillator,shape){if(zot(oscillator))return;if(zot(shape))shape="sine";if(shape=="saw")shape="sawtooth";if(typeof shape=="number"){shape=zim.Synth.shapes[shape];if(!shape)shape="sine";}else if(shape.real&&shape.imag){var wave=oscillator.context.createPeriodicWave(new Float32Array(shape.real),new Float32Array(shape.imag));}else if(shape.constructor==PeriodicWave){var wave=shape;}else if(typeof shape=="string"){var index=zim.Synth.shapes.indexOf(shape);if(index<0)shape="sine";if(shape=="noise"){var n=4096;var real=new Float32Array(n);var imag=new Float32Array(n);for(var x=1;x<n;x+=2)
imag[x]=zim.shuffle([0,.5,1])[0];var wave=oscillator.context.createPeriodicWave(real,imag);}else if(shape=="tan"){shape="sawtooth";}}else{shape="sine";}
if(wave){oscillator.setPeriodicWave(wave);shape="custom";}else{oscillator.type=shape;}};zim.Synth.getNote=function(frequency,semitoneOffset){if(zot(semitoneOffset))semitoneOffset=0;return frequency*Math.pow(2,(semitoneOffset/12));};zim.Synth.note=function(note){if(typeof note=="string"){var root=note.substr(0,1).toUpperCase();var octave=zim.loop(note,function(letter){if(!isNaN(letter))return Number(letter);});octave=octave!==true&&!isNaN(octave)?octave:3;var index=zim.Synth.notes.indexOf(root);if(index<0)index=9;var flats=note.match(/b/g);var sharps=note.match(/#/g);flats=flats?flats.length:0;sharps=sharps?sharps.length:0;var offset=(octave-3)*12+index+sharps-flats;return zim.Synth.getNote(zim.Synth.getNote(220,-9),offset);}else{if(typeof note!="number")note=220;return note;}};zim.Synth.wave=function(a,b){if(window.AudioContext||window.webkitAudioContext){var audioContext=new(window.AudioContext||window.webkitAudioContext);if(a.real){b=a.imag;a=a.real;}else{if(zot(b)){if(zon){zogy("Synth.wave() - pass in asset('wave.json') or real and imag properties");return;}}}
if(a.constructor!==Float32Array)a=new Float32Array(a);if(b.constructor!==Float32Array)b=new Float32Array(b);return audioContext.createPeriodicWave(a,b);}};zim.Synth.drawWave=function(shape,color,thickness,backgroundColor,borderColor,borderWidth,corner,padding,paddingVertical){var sig="shape, color, thickness, backgroundColor, borderColor, borderWidth, corner, padding, paddingVertical";var duo;if(duo=zob(zim.Synth.drawWave,arguments,sig))return duo;var w=45;var h=45;shape=zik(shape);if(zot(thickness))thickness=2;if(zot(color))color=zim.darker;if(zot(padding))padding=8;if(zot(paddingVertical))paddingVertical=padding;var px=padding;var py=paddingVertical;var wave=new zim.Container(w,h);wave.mouseChildren=false;if(!zot(backgroundColor)){var backing=wave.backing=new zim.Rectangle(w,h,backgroundColor,borderColor,borderWidth,corner).addTo(wave);}
wave.shape=new zim.Shape(w,h).addTo(wave).s(color).ss(thickness);var w2=w-px*2;var h2=h-py*2;if(shape=="square"){wave.shape.mt(px,h/2).lt(px,py+3).lt(w/2,py+3).lt(w/2,h-py-3).lt(w-px,h-py-3).lt(w-px,h/2);}else if(shape=="triangle"){wave.shape.mt(px,h/2).lt(px+w2/4,py+3).lt(px+w2*3/4,h-py-3).lt(w-px,h/2);}else if(shape=="sawtooth"||shape=="saw"){wave.shape.mt(px,h/2).lt(w/2,py+2).lt(w/2,h-py-2).lt(w-px,h/2);}else if(shape=="zap"){wave.shape.mt(px,h/2).lt(w/2,h-py-2).lt(w/2,py+2).lt(w-px,h/2);}else{wave.shape.mt(px,h/2).bt(w/2,0-15,w/2,h+15,w-px,h/2);}
wave.type=shape;return wave;};zim.VR=function(content,angle,distance,parallax,parallaxAngle,damp,parallaxDamp,startAngle,negativeParallax,boundaryMarkers,swiper,holder){var sig="content, angle, distance, parallax, parallaxAngle, damp, parallaxDamp, startAngle, negativeParallax, boundaryMarkers, swiper, holder";var duo;if(duo=zob(zim.VR,arguments,sig,this))return duo;z_d("69.98");this.type="VR";if(!zdf){if(zon)zogy("VR() - please use ZIM Frame");return;}
var frame=zdf;if(zot(holder)||!holder.getBounds||!holder.getBounds().width)var holder=frame.stage;if(zot(angle))angle=0;if(zot(distance))distance=100;if(zot(damp))damp=.5;if(zot(parallax))parallax=0;if(zot(parallaxAngle))parallaxAngle=60;if(zot(parallaxDamp))parallaxDamp=.1;if(zot(startAngle))startAngle=0;if(zot(negativeParallax))negativeParallax=false;if(zot(boundaryMarkers))boundaryMarkers=true;if(zot(swiper))swiper=true;this.angle=angle;this.currentAngle=startAngle;if(zim.mobile())swiper=false;var that=this;var holderW=holder.width;var holderH=holder.height;that.zimContainer_constructor();var left=that.left=new zim.Container(holderW/2,holderH,null,null,false);var backing=new zim.Rectangle(holderW/2,holderH,"rgba(0,0,0,.01)",null,null,null,null,null,false);left.addChild(backing);var right=that.right=left.clone();that.addChild(left,right);right.x=holderW/2;var contentLeft=that.contentLeft=that.content=content;var contentRight=that.contentRight=content.clone();if(startAngle!=0)var startAngleTimeout=setTimeout(addContent,100);else addContent();function addContent(){contentLeft.addTo(left,null,false).setMask(left.getChildAt(0)).pos({y:(holder.height-contentLeft.height)/2,reg:true});contentRight.addTo(right,null,false).setMask(right.getChildAt(0)).pos({y:(holder.height-contentLeft.height)/2,reg:true});}
var leftVR=[];var rightVR=[];function copyDepth(left,right,registerLeft,registerRight){left.vrMatch=right;right.vrMatch=left;if(left.cacheCanvas)right.cache();if(left.dep&&!zot(left.depth)){leftVR.push(left);rightVR.push(right);if(!zot(registerLeft))registerLeft.push(left);if(!zot(registerRight))registerRight.push(right);right.dep(left.depth);}
zim.loop(left,function(left,i){copyDepth(left,right.getChildAt(i),registerLeft,registerRight);});}
copyDepth(contentLeft,contentRight);function setDepth(list,channel){zim.loop(list,function(container){container.vrChannel=channel;container.vrStartX=container.x;if(angle!=0&&distance!=0){container.vrAngle=angle;container.vrDistance=distance;}
if(parallax!=0&&distance!=0){container.vrParallax=parallax/100;container.vrParallaxDistance=0;if(angle!=0)container.vrParallaxDamp=new zim.Damp(0,parallaxDamp);}
container.dep(container.depth);});}
setDepth(leftVR,"left");setDepth(rightVR,"right");if(angle!=0&&distance!=0){var pd=new zim.Damp(180+startAngle,damp);pd.immediate(180+startAngle);var minCheck=false;var maxCheck=false;frame.on("deviceorientation",function(e){moveVR(pd.convert((e.rotation.z>180?-180:180)+e.rotation.z+startAngle)-180);});function moveVR(a){that.currentAngle=a;var d=-that.currentAngle*distance/angle;that.contentLeft.x=d;that.contentRight.x=d;if(Math.round(that.currentAngle)<=-angle/2&&!minCheck){var ev=new createjs.Event("boundaryout");ev.boundary="left";minCheck=true;that.dispatchEvent(ev);}else if(Math.round(that.currentAngle)>=angle/2&&!maxCheck){var ev=new createjs.Event("boundaryout");ev.boundary="right";maxCheck=true;that.dispatchEvent(ev);}else if(Math.round(that.currentAngle)>-angle/2&&Math.round(that.currentAngle)<angle/2){var ev=new createjs.Event("boundaryin");if(minCheck){ev.boundary="left";that.dispatchEvent(ev);minCheck=false;}else if(maxCheck){ev.boundary="right";that.dispatchEvent(ev);maxCheck=false;}}}
zim.Ticker.always();function calculateDistance(container){var point=container.parent.localToLocal(container.vrStartX,0,holder);var d=container.vrParallaxDamp.convert(container.vrChannel=="left"?that.contentLeft.x+point.x-holderW/4:that.contentRight.x+point.x-holderW/2-holderW/4);if(container.depth<=0&&!negativeParallax)d=0;container.vrParallaxDistance=Math.max(-distance/angle*parallaxAngle/2,Math.min(distance/angle*parallaxAngle/2,d));container.dep(container.depth);}}
if(parallax!=0&&distance!=0){var parallaxPD=new zim.ProportionDamp(180-parallaxAngle/2,180+parallaxAngle/2,-parallaxAngle/2,parallaxAngle/2,parallaxDamp);parallaxPD.immediate(180);if(angle==0){function calculateDistance2(container,a){container.vrParallaxDistance=(container.depth<=0&&!negativeParallax)?0:a;container.dep(container.depth);}}
frame.on("deviceorientation",function(e){var a=0;if(angle==0&&parallax!=0&&distance!=0)a=parallaxPD.convert((e.rotation.z>180?-180:180)+e.rotation.z);doParallax(a);});function doParallax(a){if(angle!=0&&distance!=0){zim.loop(leftVR,calculateDistance);zim.loop(rightVR,calculateDistance);}else{zim.loop(leftVR,function(container){calculateDistance2(container,a);});zim.loop(rightVR,function(container){calculateDistance2(container,a);});}}
zim.Ticker.always();}
if(swiper&&distance!=0&&(angle!=0||parallax!=0)){that.added(function(){var swipeObject={swipeAngle:0};var swiper=that.swiper=new zim.Swiper({swipeOn:that,target:swipeObject,property:"swipeAngle",sensitivity:.2,damp:.05,factor:-1,min:-330,max:330});zim.Ticker.add(function(){if(angle!=0&&distance!=0)moveVR(swipeObject.swipeAngle);if(parallax!=0&&distance!=0)doParallax(parallaxPD.convert(swipeObject.swipeAngle+180));});});}
var eyeAdjust=localStorage&&localStorage.zimEyeAdjust?Number(localStorage.zimEyeAdjust):0;var lastEyeAdjust=eyeAdjust;var adjusterCheck=false;contentLeft.startRegX=contentLeft.regX;contentRight.startRegX=contentRight.regX;var adjuster=this.adjuster=new zim.Container(800,300,null,null,false);var backing=adjuster.backing=new zim.Rectangle(adjuster.width,adjuster.height,zim.lighter,null,null,null,null,null,false).center(adjuster).alp(1).sha("rgba(0,0,0,.2)",0,0,30);var backing2=adjuster.strip=new zim.Rectangle(adjuster.width,adjuster.height/3,zim.white,null,null,null,null,null,false).center(adjuster).alp(1);var label=adjuster.label=new zim.Label({text:"slide to adjust center of left and right",size:28,color:zim.dark,align:"center",valign:"center"}).center(adjuster).pos({y:50,reg:true});var close=adjuster.close=new zim.Rectangle(50,50,zim.light,null,null,null,null,null,false).addTo(adjuster).mov(adjuster.width-70,26);var ex=new zim.Shape(-40,-40,80,80,null,false);ex.graphics.f(zim.dark).p("AmJEVIEUkTIkXkWIB4h5IEWEYIETkTIB4B3IkTESIEQERIh4B4IkRkRIkSEVg");ex.center(close).sca(.3);close.cursor="pointer";close.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",function(){that.hideAdjuster();slider.currentValue=(slider.max-slider.min)/2+lastEyeAdjust;that.dispatchEvent("closed");});var dotLeft=new zim.Circle(30,zim.dark,null,null,null,null,null,null,false).center(adjuster).pos({x:adjuster.width/4,reg:true});dotLeft.shape.alpha=.2;new zim.Circle(12,zim.dark,null,null,null,null,null,false).center(dotLeft);var dotRight=new zim.Circle(30,zim.dark,null,null,null,null,null,false).center(adjuster).pos({x:adjuster.width/4*3,reg:true});dotRight.shape.alpha=.2;new zim.Circle(12,zim.dark,null,null,null,null,null,null,false).center(dotRight);var slider=adjuster.slider=new zim.Slider({min:0,max:30,step:1,useTicks:true,style:false}).centerReg(adjuster).pos({y:adjuster.height-40,reg:true});slider.currentValue=(slider.max-slider.min)/2+eyeAdjust;var leftP=new zim.Proportion(slider.min,slider.max,dotLeft.x-adjuster.width/4,dotLeft.x+adjuster.width/4,-1);var rightP=new zim.Proportion(slider.min,slider.max,dotRight.x-adjuster.width/4,dotRight.x+adjuster.width/4);slider.on("change",function(){dotLeft.x=leftP.convert(slider.currentValue);dotRight.x=rightP.convert(slider.currentValue);});new zim.Label("closer",24,null,zim.silver).centerReg(adjuster).pos({x:slider.x-220,y:slider.y,reg:true});new zim.Label("farther",24,null,zim.silver).centerReg(adjuster).pos({x:slider.x+220,y:slider.y,reg:true});var ok=that.ok=new zim.Button({label:"OK",width:90,height:60,corner:0,backgroundColor:zim.blue,rollBackgroundColor:zim.green,shadowColor:-1,style:false}).centerReg(adjuster).sca(.8).pos({x:adjuster.width-58,y:slider.y,reg:true});ok.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",function(){if(localStorage)localStorage.zimEyeAdjust=slider.currentValue-(slider.max-slider.min)/2;setReg();that.hideAdjuster();that.dispatchEvent("saved");that.dispatchEvent("closed");});var zero=that.zero=new zim.Button({label:">|<",width:90,height:60,corner:0,backgroundColor:zim.yellow,rollBackgroundColor:zim.green,shadowColor:-1,style:false}).centerReg(adjuster).sca(.8).pos({x:58,y:slider.y,reg:true});zero.on((!zns?ACTIONEVENT=="mousedown":zim.ACTIONEVENT=="mousedown")?"mousedown":"click",function(){slider.currentValue=(slider.max-slider.min)/2;dotLeft.x=leftP.convert(slider.currentValue);dotRight.x=rightP.convert(slider.currentValue);});var adjusterP=new zim.Proportion(0,30,-holder.width/4,holder.width/4);function setReg(){var change=adjusterP.convert(slider.currentValue);contentLeft.regX=contentLeft.startRegX+change;contentRight.regX=contentRight.startRegX-change;}
setReg();this.showAdjuster=function(){if(adjusterCheck)return that;adjusterCheck=true;dotLeft.x=leftP.convert(slider.currentValue);dotRight.x=rightP.convert(slider.currentValue);lastEyeAdjust=slider.currentValue-(slider.max-slider.min)/2;adjuster.scaleTo(holder).center(this);holder.stage.update();};this.hideAdjuster=function(){if(!adjusterCheck)return that;adjusterCheck=false;adjuster.removeFrom(this);holder.stage.update();};this.position=function(item,x,y){posit(item);posit(item.vrMatch);function posit(it){it.vrStartX=x;if(it.vrParallaxDamp)it.vrParallaxDamp.immediate(x);it.mov(x,y);}
return item;};this.register=function(item){if(!item.parent||!item.parent.vrMatch){if(zon){zog("ZIM VR() - please only register objects already inside content container");}
return item;}
var itemRight=item.clone().addTo(item.parent.vrMatch);var registerLeft=[];var registerRight=[];copyDepth(item,itemRight,registerLeft,registerRight);setDepth(registerLeft,"left");setDepth(registerRight,"right");return item;};if(angle!=0&&distance!=0&&boundaryMarkers){that.boundaryRight=new zim.Container({style:false});new zim.Circle(24,zim.light,null,null,null,null,null,null,false).addTo(that.boundaryRight).dep(-2);new zim.Triangle(16,16,16,zim.yellow,zim.grey,null,null,-3,null,null,false).rot(-90).center(that.boundaryRight).dep(-6);that.boundaryRight.center(content).mov(distance/2+24);that.boundaryLeft=new zim.Container({style:false});new zim.Circle(24,zim.light,null,null,null,null,null,null,false).addTo(that.boundaryLeft).dep(-2);new zim.Triangle(16,16,16,zim.yellow,zim.grey,null,null,-3,null,null,false).rot(90).center(that.boundaryLeft).dep(-6);that.boundaryLeft.center(content).mov(-distance/2-24);that.register(that.boundaryRight);that.register(that.boundaryLeft);}
function removeItem(item){var index=leftVR.indexOf(item);if(leftVR.indexOf(item)>=0){leftVR.splice(index,1);rightVR.splice(index,1);}
zim.loop(item,function(inside){removeItem(inside);});}
this.remove=function(items){zim.loop(arguments,function(index,item){if(!content.contains(item))return;removeItem(item);item.parent.removeChild(item);item.vrMatch.parent.removeChild(item.vrMatch);});return that;};this.resize=function(){holderW=holder.width;holderH=holder.height;left.getChildAt(0).widthOnly=right.getChildAt(0).widthOnly=holderW/2;left.getChildAt(0).heightOnly=right.getChildAt(0).heightOnly=holderH;right.x=holderW/2;left.setBounds(0,0,holderW/2,holderH);right.setBounds(0,0,holderW/2,holderH);if(startAngle!=0){clearTimeout(startAngleTimeout);startAngleTimeout=setTimeout(addContent,100);}
else addContent();adjuster.scaleTo(holder).center(this,null,false);};};zim.extend(zim.VR,zim.Container,"clone","zimContainer",false);zim.scaX=1;zim.scaY=1;zim.Frame=function(scaling,width,height,color,outerColor,assets,path,progress,rollover,touch,scrollTop,align,valign,canvasID,rollPerSecond,delay,canvasCheck,gpu,gpuObj,nextFrame,nextStage,allowDefault,loadFailObj,sensors,retina,mouseMoveOutside,captureMouse,shim,maxConnections){var sig="scaling, width, height, color, outerColor, assets, path, progress, rollover, touch, scrollTop, align, valign, canvasID, rollPerSecond, delay, canvasCheck, gpu, gpuObj, nextFrame, nextStage, allowDefault, loadFailObj, sensors, retina, mouseMoveOutside, captureMouse, shim, maxConnections";var duo;if(duo=zob(zim.Frame,arguments,sig,this))return duo;z_d("83");if(zon)zogg("ZIM FRAME");this.cjsEventDispatcher_constructor();this.type="Frame";this.startTime=new Date().getTime();var that=this;if(typeof zdf=='undefined'||zdf==null||!zdf.type)zimDefaultFrame=zdf=this;if(zot(canvasCheck))canvasCheck=true;var canvasSupported=!!window.HTMLCanvasElement;if(!canvasSupported&&canvasCheck){setTimeout(function(){that.dispatchEvent("failed");},100);return;}
var mobile=zim.mobile();if(zot(scaling))scaling="full";if(scaling=="outside")scaling="fill";if(zot(rollover))rollover=!mobile;if(zot(touch))touch=true;if(zot(scrollTop))scrollTop=false;if(zot(align))align="center";if(zot(valign))valign="center";var randomCanvas="";if(zot(canvasID)){if(zdf!=this){randomCanvas=zim.makeID(5);canvasID="myCanvas"+randomCanvas;}else{canvasID="myCanvas";}}
var timeType=getTIME(delay);if(zot(rollPerSecond))rollPerSecond=20;if(zot(delay))delay=mobile?(timeType=="s"?1:1000):(timeType=="s"?.03:30);if(zot(gpu))gpu=false;if(zot(allowDefault))allowDefault=false;if(zot(loadFailObj))loadFailObj="circles";this.loadFailObj=loadFailObj;if(zot(sensors))sensors=false;if(zot(retina))retina=true;this.retina=retina;if(zot(mouseMoveOutside))mouseMoveOutside=false;if(zot(captureMouse))captureMouse=true;if(zot(shim))shim=false;if(zot(maxConnections))maxConnections=10;var defaultMaxConnections=maxConnections;if(gpu)retina=false;this.retina=retina;var readyToDispatch=false;var oldLeft=false;this.leftMouseDown=false;function leftEvent(e){that.leftMouseDown=e.buttons===undefined?e.which===1:e.buttons===1;if(oldLeft&&!that.leftMouseDown)that.dispatchEvent("mouseupplus");oldLeft=that.leftMouseDown;}
var types=["fit","fill","full"];if(shim){this.shim=true;shim.stage.frame=this;var canvas=this.canvas=shim.canvas;this.scale=shim.stage.scaleX;var shimTime;var shimResizeEvent;setTimeout(function(){setFrameShim();shimResizeEvent=function(){setFrameShim();if(shimTime)clearTimeout(shimTime);shimTime=setTimeout(setFrameShim,50);}
window.addEventListener('resize',shimResizeEvent);},20);var stage=shim.stage;var stageW=stage.getBounds()?stage.getBounds().width:canvas.width/stage.scaleX;var stageH=stage.getBounds()?stage.getBounds().height:canvas.height/stage.scaleY;if(!stage.getBounds())stage.setBounds(0,0,stageW,stageH);color=canvas.style.backgroundColor;setMousemove();function setFrameShim(){that.scale=shim.stage.scaleX;var bRect=canvas.getBoundingClientRect();that.x=bRect.x+zim.scrollX();that.y=bRect.y+zim.scrollY();zim.scaX=createjs.stageTransformable?1:shim.stage.scaleX;zim.scaY=createjs.stageTransformable?1:shim.stage.scaleY;}
setFrameShim();}else{this.scale=1;this.x=0;this.y=0;var stage;var stageW;var stageH;}
var largest;var appOrientation;var lastOrientation;var appReady=false;var tagID;var tag;var resizeReady=false;var assetsReady=false;var initCheck=false;if(!shim){if(document.readyState==='interactive'||document.readyState==='complete'){setTimeout(function(){init();},200);}else{document.addEventListener('DOMContentLoaded',init);}}
var lastTicker;var pauseTicker=false;var checkResize=(scaling=="full"&&typeof InstallTrigger!=='undefined');this.swapRotation=false;if(mobile&&!window.parent){var mw=isNaN(window.innerWidth)?window.clientWidth:window.innerWidth;var mh=isNaN(window.innerHeight)?window.clientHeight:window.innerHeight;this.swapRotation=((window.orientation==0||window.orientation==180)&&mw>mh)||(Math.abs(window.orientation)==90&&mh>mw);}
window.addEventListener('resize',windowResizeEvent);var checkTime;function windowResizeEvent(){if(shim){var bbb=stage.getBounds();stageW=bbb.width;stageH=bbb.height;that.dispatchEvent("resize");return;}
checkTime=Date.now()+delay*(timeType=="s"?1000:1);if(checkResize){if(!pauseTicker){pauseTicker=true;lastTicker=zim.Ticker.update;if(!zim.tickerFrame){zim.Ticker.update=false;zim.tickerFrame=that;}
sizeCanvas();dispatchResize();clearInterval(that.frameTime);that.frameTime=setInterval(function(){if(Date.now()>checkTime){clearInterval(that.frameTime);pauseTicker=false;if(that==zim.tickerFrame)zim.Ticker.update=lastTicker;return;}
sizeCanvas();dispatchResize();},50);}}else{sizeCanvas();dispatchResize();clearInterval(that.frameTime);that.frameTime=setInterval(function(){if(Date.now()>checkTime){clearInterval(that.frameTime);return;}
sizeCanvas();dispatchResize();},delay*(timeType=="s"?1000:1)<50?delay*(timeType=="s"?1000:1)+5:50);}}
that.loadAssetsCount=0;if(zot(zim.assets)){zim.assets={};zim.assetIDs={};}
var preExistingCanvas=false;function init(){if(initCheck)return;initCheck=true;if(types.indexOf(scaling)==-1){tagID=scaling;if(zot(zid(tagID))){zogy("Frame - scaling: HTML tag with id="+scaling+" must exist");return;}
tag=that.tag=zid(tagID);that.scaling=scaling=(zot(width)||zot(height))?"tag":"inline";if(canvasID.indexOf("myCanvas")==0)canvasID=tagID+"Canvas";if(tag.tagName.toLowerCase()=="canvas"){preExistingCanvas=true;canvasID=tagID;}}else{that.scaling=scaling;}
that.canvasID=canvasID;if(zot(width))width=500;if(zot(height))height=500;stageW=width;stageH=height;if(!zot(outerColor))that.outerColor=outerColor;makeCanvas();makeStage();if(mobile){function getResize(){sizeCanvas();resizeReady=true;checkDispatch();dispatchResize();if(stage)stage.update();}
if(scrollTop){setTimeout(function(){window.scrollTo(0,0);},50);}
setTimeout(getResize,100);if(delay*(timeType=="s"?1000:1)!=100)setTimeout(getResize,delay*(timeType=="s"?1000:1));}else{resizeReady=true;checkDispatch();}
if(!zot(assets)){var q;if(assets.constructor=={}.constructor&&!(assets.audioSprite||assets.id||assets.data||assets.src)){q=that.loadAssets(zim.merge(assets,{progress:progress,queueOnly:true}));}else{q=that.loadAssets({assets:assets,path:path,progress:progress,queueOnly:true});}
if(zot(q)||!q.on){if(zon)zogy("Frame() - load failed");assetsReady=true;checkDispatch();}else{q.on("complete",function(){assetsReady=true;checkDispatch();});}}else{assetsReady=true;checkDispatch();}}
function checkDispatch(){if(resizeReady&&assetsReady&&!appReady){if(!zot(progress)&&progress.show)progress.hide();that.dispatchEvent("ready");appReady=true;dispatchResize();}}
function makeCanvas(){if(preExistingCanvas){var canvas=that.canvas=that.tag;}else{var canvas=that.canvas=document.createElement("canvas");canvas.setAttribute("id",canvasID);}
canvas.setAttribute("tabindex",0);var w=zim.windowWidth();var h=zim.windowHeight();var pRatio=window.devicePixelRatio||1;if(scaling=="full"||scaling=="tag"){if(retina){that.scale=pRatio;canvas.setAttribute("width",w*that.scale);canvas.setAttribute("height",h*that.scale);if(scaling=="full"){canvas.style.width=w+'px';canvas.style.height=h+'px';}}else{canvas.setAttribute("width",w);canvas.setAttribute("height",h);}}else{canvas.setAttribute("width",stageW);canvas.setAttribute("height",stageH);}
var alternative=zid(canvasID+"Alternative");if(alternative)canvas.appendChild(alternative);if(!preExistingCanvas){if(scaling=="tag"||scaling=="inline"){tag.appendChild(canvas);}else{document.body.appendChild(canvas);}}
if(!zot(color))canvas.style.backgroundColor=color;if(scaling=="full"||scaling=="fit"||scaling=="fill"){canvas.style.position="absolute";if(!allowDefault)document.body.style.overflow="hidden";}else{if(getComputedStyle(canvas.parentElement).position=="static")canvas.parentElement.style.position="relative";}}
function setMousemove(){if(captureMouse){that.mouseX=0;that.mouseY=0;that.mousedownEvent=stage.on("stagemousedown",function(e){that.mouseX=e.stageX/zim.scaX;that.mouseY=e.stageY/zim.scaY;});that.mousemoveEvent=stage.on("stagemousemove",function(e){that.mouseX=e.stageX/zim.scaX;that.mouseY=e.stageY/zim.scaY;});}
window.removeEventListener("mousedown",leftEvent,true);window.removeEventListener("mousemove",leftEvent,true);window.removeEventListener("mouseup",leftEvent);window.addEventListener("mousedown",leftEvent,true);window.addEventListener("mousemove",leftEvent,true);window.addEventListener("mouseup",leftEvent);}
function makeStage(){sizeCanvas();if(types.indexOf(scaling)!=-1&&!allowDefault){that.zil=zil();}
if(that.mousedownEvent&&stage)stage.off("stagemousedown",that.mousedownEvent);if(that.mousemoveEvent&&stage)stage.off("stagemousemove",that.mousemoveEvent);stage=gpu?new zim.StageGL(canvasID,gpuObj):new zim.Stage(canvasID);stage.frame=that;stage.mouseMoveOutside=mouseMoveOutside;if(!zot(color)&&gpu)stage.setClearColor(zim.convertColor(color));stage.setBounds(0,0,stageW,stageH);stage.width=stageW;stage.height=stageH;if(retina)sizeCanvas();if(rollover)stage.enableMouseOver(rollPerSecond);if(touch)createjs.Touch.enable(stage,false,allowDefault);if(allowDefault)stage.preventSelection=false;if(nextFrame)stage.nextStage=nextFrame.stage;if(nextStage)stage.nextStage=nextStage;setMousemove();}
function sizeCanvas(){if(!that)return;var can=zid(canvasID);var w=zim.windowWidth();var h=zim.windowHeight();var newW;var newH;appOrientation=that.orientation=(w>h)?"horizontal":"vertical";if(appOrientation!=lastOrientation){lastOrientation=appOrientation;that.dispatchEvent("orientation");}
if(mobile&&scrollTop){setTimeout(function(){window.scrollTo(0,0);},100);}
if(!can)return;if(scaling=="fit"){that.scale=(w/h>=stageW/stageH)?h/stageH:w/stageW;}else if(scaling=="fill"){that.scale=(w/h>=stageW/stageH)?w/stageW:h/stageH;}else if(scaling=="full"){can.style.left=can.style.top="0px";can.width=stageW=w;can.height=stageH=h;if(stage){stage.setBounds(0,0,stageW,stageH);if(retina){var pRatio=window.devicePixelRatio||1;can.width=w*pRatio;can.height=h*pRatio;can.style.width=w+'px';can.style.height=h+'px';that.scale=pRatio;stage.scaleX=stage.scaleY=that.scale;}else{stage.scaleX=stage.scaleY=1;}
stage.tickOnUpdate=false;stage.update();stage.tickOnUpdate=true;stage.width=stageW;stage.height=stageH;if(gpu)stage.updateViewport(stageW/stage.scaleX,stageH/stage.scaleY);zim.scaX=createjs.stageTransformable?1:stage.scaleX;zim.scaY=createjs.stageTransformable?1:stage.scaleY;}
if(!allowDefault){zim.scrollX(0);zim.scrollY(0);}
setVisible();return;}else if(scaling=="tag"){stageW=tag.style.width==""?(tag.getAttribute("width")||tag.offsetWidth):tag.style.width;stageH=tag.style.height==""?(tag.getAttribute("height")||tag.offsetHeight):tag.style.height;if(retina){can.width=stageW*that.scale;can.height=stageH*that.scale;can.style.width=stageW+"px";can.style.height=stageH+"px";if(stage){stage.scaleX=stage.scaleY=that.scale;}}else{if(stage)stage.scaleX=stage.scaleY=1;can.width=stageW;can.height=stageH;}
if(stage){stage.tickOnUpdate=false;stage.update();stage.tickOnUpdate=true;stage.setBounds(0,0,stageW,stageH);stage.width=stageW;stage.height=stageH;if(gpu)stage.updateViewport(stageW/stage.scaleX,stageH/stage.scaleY);zim.scaX=createjs.stageTransformable?1:stage.scaleX;zim.scaY=createjs.stageTransformable?1:stage.scaleY;}
tag.style.overflow="hidden";can.style.left=can.style.top="0px";var bRect=can.getBoundingClientRect();that.x=bRect.x+zim.scrollX();that.y=bRect.y+zim.scrollY();setVisible();return;}else if(scaling=="inline"){if(retina){if(document.styleSheets[0]){try{var rules=document.styleSheets[0].rules||document.styleSheets[0].cssRules;for(var i=0;i<rules.length;i++){var rule=rules[i];if(rule.selectorText=="#"+canvasID){var ww=rule.style.getPropertyValue("width");if(ww){var www=zum(can.style.width);var hhh=zum(can.style.height);can.style.width=ww;}}}}catch(e){}}
var comp=window.getComputedStyle(can);var wid=zum(comp.getPropertyValue('width'));if(www){can.style.height=(hhh*wid/www)+"px";comp=window.getComputedStyle(can);}
var hei=zum(comp.getPropertyValue('height'));var pRatio=window.devicePixelRatio||1;that.scale=wid/width*pRatio;can.width=stageW*that.scale;can.height=stageH*that.scale;can.style.width=wid+'px';can.style.height=hei+'px';if(stage){stage.scaleX=stage.scaleY=that.scale;}}else{if(stage)stage.scaleX=stage.scaleY=1;}
if(stage){stage.tickOnUpdate=false;stage.update();stage.tickOnUpdate=true;stage.setBounds(0,0,stageW,stageH);stage.width=stageW;stage.height=stageH;if(gpu)stage.updateViewport(stageW/stage.scaleX,stageH/stage.scaleY);zim.scaX=createjs.stageTransformable?1:stage.scaleX;zim.scaY=createjs.stageTransformable?1:stage.scaleY;}
can.style.left=can.style.top="0px";var bRect=can.getBoundingClientRect();that.x=bRect.x+zim.scrollX();that.y=bRect.y+zim.scrollY();setVisible();return;}
newH=stageH*that.scale;newW=stageW*that.scale;if(retina){var pRatio=window.devicePixelRatio||1;that.scale*=pRatio;can.width=stageW*that.scale;can.height=stageH*that.scale;can.style.width=(stageW*that.scale/pRatio)+'px';can.style.height=(stageH*that.scale/pRatio)+'px';if(stage){stage.scaleX=stage.scaleY=that.scale;}}else{if(stage)stage.scaleX=stage.scaleY=1;can.style.width=newW+"px";can.style.height=newH+"px";}
if(stage){stage.tickOnUpdate=false;stage.update();stage.tickOnUpdate=true;}
if(align=="left")that.x=0;else if(align=="right")that.x=(w-newW);else that.x=((w-newW)/2);if(valign=="top")that.y=0;else if(valign=="bottom")that.y=(h-newH);else that.y=((h-newH)/2);can.style.left=that.x+"px";can.style.top=that.y+"px";if(!allowDefault){zim.scrollX(0);zim.scrollY(0);}
setVisible();if(stage){zim.scaX=createjs.stageTransformable?1:stage.scaleX;zim.scaY=createjs.stageTransformable?1:stage.scaleY;}}
this.update=function(){sizeCanvas();that.dispatchEvent("update");};function setVisible(){if(scaling=="fill"){var beside=(zum(that.canvas.style.width)-zim.windowWidth())/2;if(align=="left"){that.visibleLeft=0;that.visibleRight=zim.windowWidth()/(zim.windowWidth()+beside*2)*stageW;}else if(align=="right"){that.visibleLeft=beside*2/(zim.windowWidth()+beside*2)*stageW;that.visibleRight=stageW;}else{that.visibleLeft=beside/(zim.windowWidth()+beside*2)*stageW;that.visibleRight=(zim.windowWidth()+beside)/(zim.windowWidth()+beside*2)*stageW;}
var above=(zum(that.canvas.style.height)-zim.windowHeight())/2;if(valign=="top"){that.visibleTop=0;that.visibleBottom=zim.windowHeight()/(zim.windowHeight()+above*2)*stageH;}else if(valign=="bottom"){that.visibleTop=above*2/(zim.windowHeight()+above*2)*stageH;that.visibleBottom=stageH;}else{that.visibleTop=above/(zim.windowHeight()+above*2)*stageH;that.visibleBottom=(zim.windowHeight()+above)/(zim.windowHeight()+above*2)*stageH;}}else{that.visibleLeft=that.visibleTop=0;that.visibleRight=stageW;that.visibleBottom=stageH;}}
function dispatchResize(){if(!appReady||!that)return;that.dispatchEvent("resize");var lastTime=new Date().getTime();setTimeout(function(){if(new Date().getTime()-lastTime>80){sizeCanvas();setTimeout(function(){that.dispatchEvent("resize");if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&stage&&(scaling=="full"||scaling=="tag"))stage.update();},100);}},100);if((!zim.OPTIMIZE&&(zns||!OPTIMIZE))&&stage&&(scaling=="full"||scaling=="tag"))stage.update();}
this.loadAssets=function(assets,path,progress,xhr,time,loadTimeout,outputAudioSprite,crossOrigin,fileType,queueOnly,maxConnections){if(zot(assets))return endEarly();if(zot(assets.src)){var sig="assets, path, progress, xhr, time, loadTimeout, outputAudioSprite, crossOrigin, fileType, queueOnly, maxConnections";var duo;if(duo=zob(that.loadAssets,arguments,sig))return duo;}
var timeType=getTIME(time?time:null);if(!zot(progress)&&progress.type=="ProgressBar"&&zot(xhr))xhr=true;if(!Array.isArray(assets))assets=[assets];if(assets.length==0)return endEarly();function endEarly(){var queue=new zim.Queue();queue.isLoading=false;queue.loadAssetsCount=0;setTimeout(function(){queue.dispatchEvent("complete");that.dispatchEvent("complete");},10);return queue;}
if(zot(time))time=0;if(zot(loadTimeout))loadTimeout=timeType=="s"?8:8000;if(zot(outputAudioSprite))outputAudioSprite=false;if(zot(crossOrigin))crossOrigin="anonymous";if(zot(queueOnly))queueOnly=false;if(zot(maxConnections))maxConnections=defaultMaxConnections;var soundCheck=false;var manifest=[];var a;var ext;var i;var j;var re=/\.([^.]+)$/i;var fonts=[];var googleFonts=[];var imagesNoCORS=[];var mainCount=0;var firstSoundCheck=true;for(i=0;i<assets.length;i++){a=assets[i];if(a.assets){var assetMulti=[];assets.splice(i,1);if(!Array.isArray(a.assets))a.assets=[a.assets];for(var j=0;j<a.assets.length;j++){if(zim.assetIDs[a.assets[j]]){assetMulti.push({id:a.path+a.assets[j],src:a.path+a.assets[j],path:null,loadTimeout:a.loadTimeout,maxNum:a.maxNum,noCORSonImage:a.noCORSonImage});}else{assetMulti.push({id:a.assets[j],src:a.assets[j],path:a.path,loadTimeout:a.loadTimeout,maxNum:a.maxNum,noCORSonImage:a.noCORSonImage});}}
for(var k=assetMulti.length-1;k>=0;k--){assets.splice(i,0,assetMulti[k]);}
a=assetMulti[0];}
if(a.constructor=={}.constructor){if(a.audioSprite){var obj=zim.copy(a);a=obj.src;prepareLoad(a);var replacement=[];var r;for(j=0;j<obj.audioSprite.length;j++){r=obj.audioSprite[j];replacement.push({id:r[0],startTime:Math.round(r[1]*1000),duration:Math.round((r[2]-r[1])*1000)});}
delete(obj.audioSprite);obj.data={audioSprite:replacement};manifest.push(obj);}else if(a.data&&a.data.audioSprite){var obj=zim.copy(a);a=obj.src;prepareLoad(a);manifest.push(obj);}else if(a.id){if(a.path){if(a.path.match(/http/i)){a.src=a.path+a.src;}else if(a.path.match(/^\//)){var url=window.location.href;var found=url.match(/(.*?)([^\/])\/[^\/]/);url=found[1]+found[2];a.src=url+a.src;}else{var pname=window.location.pathname;var url=window.location.href;var fileOnly=url.split(pname)[0]+pname;var found=fileOnly.match(/(.*)\//);a.src=found[1]+"/"+a.path+a.src;}
delete a.path;}
if(a.noCORSonImage){var img=new Image();imagesNoCORS.push(img);img.src=a.src;img.id=a.id;img.onload=function(e){var img=e.currentTarget;var asset=zim.assets[img.id]=new zim.Bitmap(img).expand(0);var ev=new createjs.Event("assetload");ev.asset=asset;queue.dispatchEvent(ev);if(!queueOnly){var ev=new createjs.Event("assetload");ev.asset=asset;that.dispatchEvent(ev);}
queue.loadAssetsCount--;if(queue.loadAssetsCount==0)endAssetLoad();};}else{zim.assetIDs[a.id]=a.src;var maxNum=a.maxNum;var aType=a.type;var aLoadTimeout=zot(a.loadTimeout)?loadTimeout:a.loadTimeout;a=a.src;prepareLoad(a);var manObj={src:a,loadTimeout:aLoadTimeout*(timeType=="s"?1000:1),data:maxNum,type:aType};if(!zot(fileType))manObj.type=fileType;manifest.push(manObj);}}else{if(a.src.match(/fonts\.googleapis\.com/))googleFonts.push(a);else fonts.push(a);}}else{prepareLoad(a);var manObj={src:a,loadTimeout:loadTimeout*(timeType=="s"?1000:1)};if(!zot(fileType))manObj.type=fileType;manifest.push(manObj);}
if(soundCheck&&firstSoundCheck){var audioTag=document.createElement("audio");audioTag.setAttribute("src",((!zot(path)&&!a.match(/^http:\/\/|https:\/\//i))?path:"")+a);document.body.appendChild(audioTag);firstSoundCheck=false;}}
function prepareLoad(a){mainCount++;if(a.split){var temp=a.split("?");ext=temp[0].match(re);if(ext&&createjs.Sound.SUPPORTED_EXTENSIONS.indexOf(ext[1])>=0)soundCheck=true;}}
that.loadAssetsCount++;that.isLoading=true;var queue=new zim.Queue();queue.isLoading=true;queue.loadAssetsCount=0;if(!zot(progress)&&progress.show){progress.zimActiveLoader=queue;progress.show();}
if(fonts.length>0){var fontObjects=[];var fontObject;var fontData;for(var i=0;i<fonts.length;i++){fontData=fonts[i];fontObject={src:"url("+(fontData.src.match(/^http/i)?"":(path?path:""))+fontData.src+")"+(fontData.type?" format('"+fontData.type+"')":""),family:fontData.font};if(fontData.weight)fontObject.weight=fontData.weight;if(fontData.style)fontObject.style=fontData.style;fontObjects.push(fontObject);}
var fontLoader=new createjs.FontLoader({src:fontObjects},true);fontLoader.on("complete",fontDone);fontLoader.on("error",fontDone);fontLoader.load();queue.loadAssetsCount++;}
if(googleFonts.length>0){var fontLoader;for(var i=0;i<googleFonts.length;i++){fontData=googleFonts[i];fontObject={src:fontData.src,type:"fontcss"};queue.loadAssetsCount++;fontLoader=new createjs.FontLoader(fontObject,true);fontLoader.on("complete",fontDone);fontLoader.on("error",fontDone);fontLoader.load();}}
function fontDone(){queue.loadAssetsCount--;if(queue.loadAssetsCount==0)endAssetLoad();}
if(imagesNoCORS.length>0){for(var i=0;i<imagesNoCORS.length;i++){queue.loadAssetsCount++;}}
function svgDone(bitmap,params){queue.loadAssetsCount--;var item=params.item;var asset=zim.assets[item.id]=bitmap;asset.svg=params.svg;var ev=new createjs.Event("assetload");ev.item=item;ev.asset=asset;queue.dispatchEvent(ev);if(!queueOnly){var ev=new createjs.Event("assetload");ev.item=item;ev.asset=asset;that.dispatchEvent(ev);}
if(queue.loadAssetsCount==0)endAssetLoad();}
var startLoad=Date.now();var completeEventObject=new createjs.Event("complete");if(mainCount>0){queue.loadAssetsCount++;var preload=queue.preload=that.preload=new createjs.LoadQueue(xhr,path,crossOrigin);if(maxConnections!=1)preload.setMaxConnections(maxConnections);if(soundCheck)preload.installPlugin(createjs.Sound);preload.on("progress",function(e){queue.dispatchEvent(e);if(!queueOnly)that.dispatchEvent(e);});preload.on("error",function(e){queue.dispatchEvent(e);if(!queueOnly)that.dispatchEvent(e);});preload.on("fileload",function(e){var item=e.item;var type=e.item.type;var ext=item.id.match(re);var asset;if(type&&type=="sound"){var soundIDs=[];if(item.data&&item.data.audioSprite){for(var i=0;i<item.data.audioSprite.length;i++){soundIDs.push(item.data.audioSprite[i].id);}}else{soundIDs.push(item.id);}
for(var i=0;i<soundIDs.length;i++){~function(){var soundID=soundIDs[i];asset=zim.assets[soundID]={type:"sound",path:path,id:soundID,play:function(volume,loop,loopCount,pan,offset,delay,interrupt){var sig="volume, loop, loopCount, pan, offset, delay, interrupt";var duo;if(duo=zob(zim.assets[soundID].play,arguments,sig))return duo;var added={volume:volume,loop:loop,loopCount:loopCount,pan:pan,offset:offset,delay:delay,interrupt:interrupt};var timeType=getTIME(added.offset,null,30);if(timeType=="s"){if(added.offset)added.offset*=1000;if(added.delay)added.delay*=1000;}
if(added.loop===true)added.loop=-1;if(added.loopCount){added.loop=added.loopCount;delete added.loopCount;}
var instance=createjs.Sound.play(soundID,added);instance.getStage=function(){return stage;};return instance;}};}();}}else if(type=="image"){if(e.result.width){asset=zim.assets[item.id]=new zim.Bitmap(e.result,e.result.width,e.result.height,null,null,item.id);if(item.avoidCORS)asset.expand(0);}}else if(type=="svg"){queue.loadAssetsCount++;zim.svgToBitmap(e.result,svgDone,null,null,{svg:e.result,item:item,type:type,ext:ext});return;}else{asset=zim.assets[item.id]=e.result;}
var ev=new createjs.Event("assetload");ev.item=item;ev.asset=asset;queue.dispatchEvent(ev);if(!queueOnly){var ev=new createjs.Event("assetload");ev.item=item;ev.asset=asset;that.dispatchEvent(ev);}});that.preloadEvent=preload.on("complete",function(e){completeEventObject=e;queue.loadAssetsCount--;if(queue.loadAssetsCount==0)endAssetLoad();});try{preload.loadManifest(manifest);}catch(err){}}
function endAssetLoad(){var endLoad=Date.now();time=Math.max(0,time-(endLoad-startLoad));setTimeout(function(){that.loadAssetsCount--;if(that.loadAssetsCount<=0)that.isLoading=false;queue.isLoading=false;queue.dispatchEvent(completeEventObject);if(!queueOnly)that.dispatchEvent(completeEventObject);},time*(timeType=="s"?1000:1));}
return queue;};this.ac=function(method,args,obj){if(obj){if(!obj.commands)obj.commands=[];obj.commands.push([method,args,obj]);}else{if(!args[0].commands)args[0].commands=[];args[0].commands.push([method,args]);}};window.asset=zim.asset=this.asset=function(n,w,h,second){if(zot(n))return;n=zik(n);var fromID=zim.assetIDs[n];if(fromID)n=fromID;if(zim.assets[n])return zim.assets[n];if(second){if(that.loadFailObj=="circles")var empty=that.makeCircles(14);else var empty=that.loadFailObj;if(empty){empty.type="EmptyAsset";empty.id=n;empty.play=function(){if(zon){zogy("Frame - asset("+n+") not found");return{};}};}
return empty;}else{var assetHolder=new zim.Container(w,h);if(w&&h)assetHolder.type="ACWD";else assetHolder.type="AC";var assetLoader=that.loadAssets(n);var parts=n.split(".");if(createjs.Sound.SUPPORTED_EXTENSIONS.indexOf(parts[parts.length-1])>=0){assetHolder.type="Sound";assetHolder.play=function(){assetHolder.playParams=arguments;assetHolder.proxy=new createjs.EventDispatcher();Object.defineProperty(assetHolder.proxy,'volume',{get:function(){if(assetHolder.sound)return assetHolder.sound.volume;},set:function(value){assetHolder.volume=value;if(assetHolder.sound)assetHolder.sound.volume=value;}});Object.defineProperty(assetHolder.proxy,'pan',{get:function(){if(assetHolder.sound)return assetHolder.sound.pan;},set:function(value){assetHolder.pan=value;if(assetHolder.sound)assetHolder.sound.pan=value;}});return assetHolder.proxy;}}
assetLoader.on("complete",function(){if(n.id)n=n.id;else if(n.src)n=n.src;var loaded=that.asset(n,null,null,true);zim.assets[n]=assetHolder;if(loaded.play){assetHolder.play=loaded.play;if(assetHolder.playParams){assetHolder.sound=assetHolder.play.apply(null,assetHolder.playParams);if(assetHolder.volume!=null)assetHolder.sound.volume=assetHolder.volume;if(assetHolder.pan!=null)assetHolder.sound.pan=assetHolder.pan;}
assetHolder.sound.on("complete",function(){assetHolder.proxy.dispatchEvent("complete")});}else if(loaded.type=="Bitmap"){loaded.addTo(assetHolder);assetHolder.mouseChildren=false;assetHolder.type="Image";assetHolder.bitmap=loaded;assetHolder.image=loaded.image;assetHolder.id=loaded.id;if(assetHolder.commands){for(var i=0;i<assetHolder.commands.length;i++){if(assetHolder.commands[i][2])assetHolder[assetHolder.commands[i][0]].apply(assetHolder,assetHolder.commands[i][1]);else zim[assetHolder.commands[i][0]].apply(assetHolder,assetHolder.commands[i][1]);}}
assetHolder.commands=null;if(assetHolder.stage)assetHolder.stage.update();}else if(loaded.type=="EmptyAsset"){loaded.addTo(assetHolder);assetHolder.mouseChildren=false;assetHolder.type="EmptyAsset";if(assetHolder.stage)assetHolder.stage.update();}
assetHolder.dispatchEvent("assetLoad");assetHolder.dispatchEvent("complete");});return assetHolder;}};zim.asset.getIDs=function(){var ids=[];for(name in zim.assetIDs){ids.push(name);}
return ids;};zim.image=function(n,w,h,second){if(n.match(/^htt/i))n="https://cors.zimjs.com/"+n;return zim.asset(n,w,h,second);};zim.zimObjectIDs={};zim.object=this.object=function(name){return zim.zimObjectIDs[name];};zim.object.getNames=function(){var names=[];for(name in zim.zimObjectIDs){names.push(name);}
return names;};if(!window.zns){window.asset=this.asset;window.image=zim.image;window.object=this.object;}
this.setDefault=function(){zimDefaultFrame=zdf=that;return that;};Object.defineProperty(that,'isDefault',{get:function(){return zdf==that;},set:function(s){zogy("Frame(): isDefault is read only - see setDefault()");}});Object.defineProperty(that,'stage',{get:function(){return stage;},set:function(s){zogy("Frame(): stage is read only - see remakeCanvas(), perhaps");}});Object.defineProperty(that,'width',{get:function(){return stageW;},set:function(w){zogy("Frame(): width is read only - see remakeCanvas(), perhaps");}});Object.defineProperty(that,'height',{get:function(){return stageH;},set:function(h){zogy("Frame(): height is read only - see remakeCanvas(), perhaps");}});Object.defineProperty(this,'color',{get:function(){return color;},set:function(value){color=value;if(!zot(value)){zid(canvasID).style.backgroundColor=color;if(!zot(color)&&gpu)stage.setClearColor(zim.convertColor(color));}else{zid(canvasID).style.backgroundColor="default";}}});var _outerColor;Object.defineProperty(this,'outerColor',{get:function(){return _outerColor;},set:function(value){_outerColor=value;zet("body").css({backgroundColor:_outerColor});}});Object.defineProperty(that,'allowDefault',{get:function(){return allowDefault;},set:function(t){if(t){stage.preventSelection=false;document.body.style.overflow="visible";if(that.zil){window.removeEventListener("keydown",that.zil[0]);window.removeEventListener("wheel",that.zil[1]);window.removeEventListener("DOMMouseScroll",that.zil[2]);that.zil=null;}}else{stage.preventSelection=true;stage.enableDOMEvents(true);if(scaling=="full"||scaling=="fit"||scaling=="fill")document.body.style.overflow="hidden";if(zot(that.zil))that.zil=zil();}
allowDefault=t;if(stage.__touch)stage.__touch.preventDefault=!allowDefault;}});var eDown=new createjs.Event("keydown");this.eventRemove=eDown.remove;function keydownEvent(e){e.remove=that.eventRemove;that.altKey=e.altKey;that.ctrlKey=e.ctrlKey;that.metaKey=e.metaKey;that.shiftKey=e.shiftKey;that.dispatchEvent(e);}
window.addEventListener("keydown",keydownEvent);function keyupEvent(e){that.altKey=e.altKey;that.ctrlKey=e.ctrlKey;that.metaKey=e.metaKey;that.shiftKey=e.shiftKey;e.remove=that.eventRemove;that.dispatchEvent(e);}
window.addEventListener("keyup",keyupEvent);function wheelEvent(e){that.dispatchEvent(e);}
window.addEventListener("wheel",wheelEvent);function devicemotionEvent(e){e.remove=that.eventRemove;that.dispatchEvent(e);}
if(sensors&&window.DeviceMotionEvent){window.addEventListener("devicemotion",devicemotionEvent);}
function deviceorientationEvent(e){e.remove=that.eventRemove;var z=360-e.alpha;if(Math.abs(z-lastZ)>180-45&&Math.abs(z-lastZ)<180+45)flip=flip==0?180:0;lastZ=z;e.rotation={x:e.beta,y:e.gamma,z:(z+flip)%360};that.dispatchEvent(e);}
if(sensors&&window.DeviceOrientationEvent){var lastZ=0;var flip=0;window.addEventListener("deviceorientation",deviceorientationEvent);}
this.isFullscreen=document.fullscreenElement?true:false;this.htmlobc=zet("html").css("backgroundColor");this.fullscreen=function(mode){if(zot(mode))mode=true;if(mode){if(document.fullscreenElement)return;var elem=that.canvas.parent?that.canvas.parent:document.body;if(elem.requestFullscreen){elem.requestFullscreen();}else if(elem.webkitRequestFullscreen){elem.webkitRequestFullscreen();}else if(elem.msRequestFullscreen){elem.msRequestFullscreen();}}else{if(!document.fullscreenElement)return;if(document.exitFullscreen){document.exitFullscreen();}else if(document.webkitExitFullscreen){document.webkitExitFullscreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}}
this.isFullscreen=mode;}
document.addEventListener("fullscreenchange",function(){that.isFullscreen=document.fullscreenElement?true:false;if(document.fullscreenElement){zet("html").css("backgroundColor",that.color);that.dispatchEvent("fullscreenenter");}else{zet("html").css("backgroundColor",that.htmlobc?that.htmlobc:"transparent");that.dispatchEvent("fullscreenexit");}});this.remakeCanvas=function(width,height){if(scaling=="full")return;if(zot(width))width=stageW;if(zot(height))height=stageH;if(zid(canvasID))zid(canvasID).parentNode.removeChild(zid(canvasID));stageW=width;stageH=height;var onStage=[];for(var i=0;i<that.stage.numChildren;i++){onStage.push(that.stage.getChildAt(i));}
makeCanvas();makeStage();for(var i=0;i<onStage.length;i++){that.stage.addChild(onStage[i]);}};this.follow=function(obj,boundary,damp,dampY,leftOffset,rightOffset,upOffset,downOffset,offsetDamp,offsetDampY,horizontal,vertical,borderLock,lag){var sig="obj, boundary, damp, dampY, leftOffset, rightOffset, upOffset, downOffset, offsetDamp, offsetDampY, horizontal, vertical, borderLock, lag";var duo;if(duo=zob(that.follow,arguments,sig))return duo;that.followObj=null;if(that.followTicker)zim.Ticker.remove(that.followTicker);if(zot(obj))return;obj.dirX=obj.dirY=0;that.followObj=obj;obj.followDampX=null;obj.followDampY=null;if(zot(boundary))boundary=new zim.Boundary(0,0,that.stage.width,that.stage.height);that.followBoundary=boundary;if(zot(damp))damp=.05;if(zot(dampY))dampY=damp;if(zot(leftOffset))leftOffset=0;if(zot(rightOffset))rightOffset=0;if(zot(upOffset))upOffset=0;if(zot(downOffset))downOffset=0;if(zot(offsetDamp))offsetDamp=.02;if(zot(offsetDampY))offsetDampY=offsetDamp;if(zot(horizontal))horizontal=true;if(zot(vertical))vertical=true;if(zot(borderLock))borderLock=false;if(zot(lag))lag=false;if(!obj.parent)obj.on("added",good);else good();function good(){var container=obj.parent;that.frameBorderLock=borderLock;if(horizontal){that.followDampX=new zim.Damp(container.x,damp);that.offsetDampX=new zim.Damp(boundary.x+leftOffset+(boundary.width-leftOffset-rightOffset)/2,offsetDamp);}
if(vertical){that.followDampY=new zim.Damp(container.y,dampY);that.offsetDampY=new zim.Damp(boundary.y+upOffset+(boundary.height-upOffset-downOffset)/2,offsetDampY);}
that.followTicker=zim.Ticker.add(function(){var boundary=that.followBoundary;if(horizontal){var midH=boundary.x+leftOffset+(boundary.width-leftOffset-rightOffset)/2;that.followOffsetX=[lag?boundary.x+boundary.width-leftOffset:midH,midH,lag?boundary.x+leftOffset:midH];if(that.followObj)container.x=that.followDampX.convert(that.offsetDampX.convert(that.followOffsetX[obj.motionController?obj.motionController.dirX+1:1])-obj.x);}
if(vertical){var midV=boundary.y+upOffset+(boundary.height-upOffset-downOffset)/2;that.followOffsetY=[lag?boundary.y+boundary.height-downOffset:midV,midV,lag?boundary.y+upOffset:midV];if(that.followObj)container.y=that.followDampY.convert(that.offsetDampY.convert(that.followOffsetY[obj.motionController?obj.motionController.dirY+1:1])-obj.y);}
if(that.frameBorderLock){if(container.x>that.followBoundary.x)container.x=that.followBoundary.x;if(container.y>that.followBoundary.y)container.y=that.followBoundary.y;if(container.x<(that.followBoundary.x+that.followBoundary.width-container.width))container.x=(that.followBoundary.x+that.followBoundary.width-container.width);if(container.y<(that.followBoundary.y+that.followBoundary.height-container.height))container.y=(that.followBoundary.y+that.followBoundary.height-container.height);}});}
return obj;};this.dispose=function(a,b,disposing){if(that.zil&&that.zil.length){window.removeEventListener("keydown",that.zil[0]);window.removeEventListener("wheel",that.zil[1]);window.removeEventListener("DOMMouseScroll",that.zil[2]);}
if(shimResizeEvent)window.removeEventListener('resize',shimResizeEvent);window.removeEventListener('resize',windowResizeEvent);window.removeEventListener("keydown",keydownEvent);window.removeEventListener("keyup",keyupEvent);window.removeEventListener("wheel",wheelEvent);window.removeEventListener("devicemotion",devicemotionEvent);window.removeEventListener("deviceorientation",deviceorientationEvent);window.removeEventListener("mousedown",leftEvent,true);window.removeEventListener("mousemove",leftEvent,true);window.removeEventListener("mouseup",leftEvent);if(!allowDefault)document.body.style.overflow="auto";recursiveDispose(stage);function recursiveDispose(obj){if(obj.dispose)obj.dispose();else{obj.removeAllEventListeners();if(obj.numChildren){for(var i=obj.numChildren-1;i>=0;i--){recursiveDispose(obj.getChildAt(i));}}
if(obj.parent)obj.parent.removeChild(obj);}}
if(zid(canvasID))zid(canvasID).parentNode.removeChild(zid(canvasID));if(that==zim.tickerFrame)zim.tickerFrame=null;if(that===zdf)zdf=null;stage=null;that=null;return true;};this.orange="#f58e25";this.green="#acd241";this.pink="#e472c4";this.blue="#50c4b7";this.brown="#d1a170";this.yellow="#ebcb35";this.purple="#993399";this.red="#fb4758";this.black="#000000";this.darker="#111111";this.dark="#333333";this.grey="#555555";this.gray="#555555";this.tin="#777777";this.silver="#999999";this.fog="#aaaaaa";this.mist="#bbbbbb";this.light="#cccccc";this.moon="#dddddd";this.lighter="#eeeeee";this.white="#ffffff";this.clear="rgba(0,0,0,0)";this.faint="rgba(0,0,0,.01)";this.makeCircles=function(radius,multiple){if(zot(radius))radius=100;var colors=[that.orange,that.green,that.pink,that.blue,that.brown,that.dark];if(multiple){var c=new zim.Container({style:false});c.radius=radius;for(var i=0;i<colors.length;i++){c.addChild(new zim.Circle((c.radius/colors.length)*(colors.length-i),colors[i],null,null,null,null,null,null,false));}}else{var c=new zim.Shape({style:false});var g=c.graphics;c.radius=radius;for(var i=0;i<colors.length;i++){g.f(colors[i]).dc(0,0,(c.radius/colors.length)*(colors.length-i));}
c.setBounds(-c.radius,-c.radius,c.radius*2,c.radius*2);}
return c;};this.madeWith=function(color,text,edges,box,slats,borderColor,borderWidth){if(zot(color))color=zim.dark;if(zot(text))text="Made with ZIM";var madeWith=new zim.Container();var icon=madeWith.icon=that.makeIcon(edges,box,slats,borderColor,borderWidth).sca(.5).alp(.92).hov(1).addTo(madeWith).tap(function(){icon.alp(.92);icon.stage.update();zgo("https://zimjs.com","_blank");});var label=madeWith.label=new zim.Label(text,16,null,color).sca(.7).pos(0,-19,zim.CENTER,zim.BOTTOM,madeWith);return madeWith;};this.makeIcon=function(edges,box,slats,borderColor,borderWidth){var icon=new zim.Container(-20,-13,102,120).reg(-20,-13);if(zot(edges))edges=that.light;if(zot(box))box=that.dark;if(slats===true)slats=[that.silver,that.silver,that.silver,that.silver,that.silver];new zim.Rectangle(icon.width,icon.height,box,borderColor,borderWidth).loc(-20,-13,icon);var data=[[slats?slats[0]:"#E474C3","AieA0IAAgCIAmhlIEXAAIg5Bng",41.7,19.5],[slats?slats[1]:"#50C5B7","AiSAzIAnhlID+AAIg5Blg",35.3,33.2],[slats?slats[2]:"#F48E25","AiFA0IAmhnIDlAAIg5Bng",28.9,46.7],[slats?slats[3]:"#EBCD36","Ah4AzIAmhlIDLAAIg5Blg",22.4,60.5],[slats?slats[4]:"#ABD140","AhrA0IAAgFIAlhiICxAAIg5Bng",16.1,74.3],[edges,"AlGHRIAnhnIH+AAIgbBngAlGlpIAnhnIJmAAIg5Bng",32.7,46.5],];zim.loop(data,function(d){var shape=new zim.Shape().addTo(icon);shape.graphics.f(d[0]).p(d[1]);shape.setTransform(d[2],d[3]);});icon.mouseChildren=false;return icon;};this.makeCat=function(height){if(zot(height))height=246;var data=[[16.95,241.15,0,"black",[1.5,2,1],"AgKAhIAVhB"],[58.65,244.378,0,"#A7A7A7",[3,2,1],"AmYAAIMxAB"],[105.64,107.14,"#EF7988",0,0,"AAEArQgNAAgjghQgiggAFgIQAFgJBEgCQBEgDAGAGQAHAIgfAkQgfAlgPAAIAAAAg"],[104.84,111.34,0,"black",[1,1,1],"AABA2IAPAYQAJAPAJAGQAKAHAMAAQAbAAAXgWQAQgPAVghQAVghAAgcQAAgnglgYQgbgSgxgCIgrACAAJADIgIAzAhphVQgXAVgMAWQgKAQgIAiQgIAkAFAMQALAfAqAOQAmANAcgIQANgEANgQQALgNAGgT"],[105.05,111.4,"#757B74",0,0,"AheBrQgvgRgQgeQgPgdAQgkQAZg8AEgFQAXgfA8gGQBVgKA+ATQBRAZgYBEQgVA/gnAZQgUAOgZAKQgJAJgVgbQgUgegCAAQgDAAgWAgQgWAUgZAAQgMAAgNgEg"],[86.18,93,"black",0,0,"Aj7g0QiYg0i9AyQA0g3BcgRQBagQBfAaQBkAbBEBBQBNBHASBpQhgiYibg0gAFxiDQAzgdA6AMQA9AMA2A4QgHgBAAACQAAAAgBABQAAAAAAAAQgBAAgBAAQAAAAgBgBQh8gshOAzQhIAvhBCYQALjABzhCg"],[78.5,63.23,"#705F6C","black",[1,1,1],"AHAg5IgNmIIBfGpQgOgQgSgMQgjgXgPASgAKeDZQg2g4g9gMQg6gMgzAdQhzBCgLDBQBBiZBIgvQBNgzB9AsQAEACAAgCQAAgCAHABgAqdBuIAAnsIDmHEQgegMgsgBQhXgChFA3gAoEDzQA0g3BdgRQBagQBeAaQBkAbBFBBQBMBIASBpQhfiYibg1QiYg0i+Ayg"],[86.28,98.01,"black","black",[1,1,1],"AJSh/QgEADgHgDQgFgBgBAFQgNBXhNA9QhTBEhagZQgGgCgPAFQgUAHgEAAQCNAeBchOQBGg7AWhigApRhnQAFABAIAAQAGABAAAAQBFBsCVA7QCpBDCrgzQACAAAHAJQAEAFAFAJQjAAzitg/Qing9g/iHg"],[96.95,97.3,"#0C0436",0,0,"AlZBJQgVgVAAgeQAAgcAVgVQAVgVAeAAQAdAAAVAVQAVAVAAAcQAAAegVAVQgVAVgdAAQgeAAgVgVgAD1AcQgVgVAAgdQAAgdAVgVQAVgVAeAAQAdAAAVAVQAVAVAAAdQAAAdgVAVQgVAVgdAAQgeAAgVgVg"],[96.88,97.2,"#EA9424",0,0,"AlpBYQgbgbAAgnQAAglAbgbQAbgbAnAAQAmAAAbAbQAbAbAAAlQAAAngbAbQgbAbgmAAQgnAAgbgbgADnArQgbgbAAgmQAAgmAbgbQAbgbAmAAQAnAAAbAbQAbAbAAAmQAAAmgbAbQgbAbgnAAQgmAAgbgbg"],[96.88,97.2,"#AFCE3A",0,0,"AlzBiQgggfAAgtQAAgrAggfQAfggAtAAQAsAAAgAgQAfAfAAArQAAAtgfAfQggAggsAAQgtAAgfgggADcA1QgfgfAAgsQAAgsAfgfQAgggAsAAQAtAAAfAgQAgAfAAAsQAAAsggAfQgfAggtAAQgsAAggggg"],[78.5,64.1,0,"black",[1,1,1],"AHAhCIgNmIIBfGpQgOgQgSgMQgjgXgPASgAKeDQQg2g4g9gMQg6gMgzAdQhzBCgLDBQCqAvBlhgQBJhFAGhagAoADiQAlgiBTgOQBYgOBaARQDrAsA0DTQjAAziog/Qihg+hAiIgAqdBlIAAnsIDmHEQgegMgsgBQhXgChFA3g"],[86.375,93.9,"#EACE35",0,0,"AltB+Qiig9g/iIQAkghBTgOQBZgPBaARQDrAtA0DRQhWAXhSAAQhkAAhcgjgADxB2QALjABzhBQAzgeA6AMQA9ANA2A4QgGBYhJBGQhEBAhiAAQgxAAg4gQg"],[73.45,154.83,"black","black",[2,1,1],"AkjjDIByAMQB/ANBEAFQB/AICXgSIgKFzQj4hflLiNQgDgBAFiag"],[79.42,123.62,"#A7A7A7","black",[2,1,1],"AEBpxIgBgBQAYiNAeiQQA8kgAfgMQAggNBLEqQAlCVAfCXIAXARQAbAXAZAcQBQBZAZBnQAZBngUB+QgKA/gPArQgeASgrAWQhYAuhFAXQg8AUh0AWIhoASIAAQzItygCQAvhKA1hoQBqjRAjiXQAri/AOjLIAFimQgegHhTgeQhEgZhgg/IhTg7QgekPgQkUQggonBEgWQBFgWCbEtQAkBGA3B9QAbA9AYA3QASAqAQAmIgjhQIABAAIJmgYIBUACIBQAK"]];var catIcon=new zim.Container(157.5,246);zim.loop(data,function(d){var s=new zim.Shape().f(d[2]).s(d[3]).ss(d[4]?d[4][0]:null,d[4]?d[4][1]:null,d[4]?d[4][2]:null).p(d[5]);s.setTransform(d[0],d[1]);s.addTo(catIcon);},true);var container=new zim.Container();catIcon.sca(height/246).addTo(container).mov(0,-.4);if(mobile)container.cache();container.mouseChildren=false;return container;};};zim.extend(zim.Frame,createjs.EventDispatcher,null,"cjsEventDispatcher",false);zim.Queue=function(){this.cjsEventDispatcher_constructor();this.isLoading=true;};zim.extend(zim.Queue,createjs.EventDispatcher,null,"cjsEventDispatcher");zim.FIT="fit";zim.FILL="fill";zim.FULL="full";zim.LEFT="left";zim.RIGHT="right";zim.CENTER="center";zim.MIDDLE="middle";zim.TOP="top";zim.BOTTOM="bottom";zim.HORIZONTAL="horizontal";zim.VERTICAL="vertical";zim.BOTH="both";zim.UP="up";zim.DOWN="down";zim.AUTO="auto";zim.GET="get";zim.POST="post";zim.LOCALSTORAGE="localStorage";zim.SOCKET="socket";zim.TO="to";zim.FROM="from";zim.SINE="sine";zim.SQUARE="square";zim.TRIANGLE="triangle";zim.SAW="saw";zim.SAWTOOTH="saw";zim.ZAP="zap";zim.colorsHex=["#f58e25","#acd241","#e472c4","#50c4b7","#d1a170","#ebcb35","#993399","#fb4758","#000000","#111111","#333333","#555555","#555555","#777777","#999999","#aaaaaa","#bbbbbb","#cccccc","#dddddd","#eeeeee","#ffffff","rgba(0,0,0,.01)","rgba(0,0,0,0)"];zim.colors=["orange","green","pink","blue","brown","yellow","purple","red","black","darker","dark","grey","gray","tin","silver","fog","mist","light","moon","lighter","white","faint","clear"];for(var i=0;i<zim.colors.length;i++){zim[zim.colors[i]]=zim.colorsHex[i];}
String.prototype.darken=function(a){return zim.darken(this,a);};String.prototype.lighten=function(a){return zim.lighten(this,a);};String.prototype.toColor=function(c,a){return zim.toColor(this,c,a);};String.prototype.toAlpha=function(a){return zim.toAlpha(this,a);};var DISTILL=false;zim.distillery=[];zim.distill=function(){if(!window.zns&&zim&&(zim.DISTILL||window.DISTILL)){zim.distillery.push("83.3","83.35");}
if(zim.distillery.length>0){function onlyUnique(value,index,self){return self.indexOf(value)===index;}
zim.distillery=zim.distillery.filter(onlyUnique);zog("zim.distill() - go to https://zimjs.com/distill and enter the following:");zog(zim.distillery.join(" "));}else{zogy("must set zim.DISTILL = true;");}};zim.parseAudioSprite=function(audioSpriteData,outputAudioSprite){z_d("83.25");if(zot(audioSpriteData)||zot(audioSpriteData.resources)||zot(audioSpriteData.spritemap))return;var obj=audioSpriteData;var id=audioSpriteData.resources[0];var data=audioSpriteData.spritemap;var newData=[];var r;var finalData={src:id,data:{}};for(i in data){r=data[i];newData.push({id:i,startTime:Math.round(r.start*1000),duration:Math.round((r.end-r.start)*1000)});}
finalData.data.audioSprite=newData;if(outputAudioSprite)zog(JSON.stringify(finalData));return finalData;};zim.previewAudioSprite=function(audioSpriteData,numLetters,frame){z_d("83.26");if(zot(audioSpriteData))return;if(zot(numLetters))numLetters=3;var stage;if(zot(frame)){if(zot(zdf))return;frame=zdf;stage=frame.stage;}
var stageW=frame.width;var stageH=frame.height;var a=audioSpriteData;var tabs=[];var sounds=[];if(a.constructor=={}.constructor){if(a.resources)a=zim.parseAudioSprite(a);if(a.audioSprite){zim.loop(a.audioSprite,function(asData){tabs.push(asData[0].substr(0,numLetters));sounds.push(asData[0]);});}else if(a.data&&a.data.audioSprite){zim.loop(a.data.audioSprite,function(asData){tabs.push(asData.id.substr(0,numLetters));sounds.push(asData.id);});}}else{return;}
var soundTab=new zim.Tabs({tabs:tabs,width:stageW,currentEnabled:true}).addTo();soundTab.on("change",function(){frame.asset(sounds[soundTab.selectedIndex]).play();});return soundTab;};zim.svgToBitmap=function(svg,callback,width,height,params){z_d("83.27");if(!zot(svg.draggable)){var parser=new DOMParser();var svg=!svg.innerHTML?svg:parser.parseFromString(svg.innerHTML,"text/xml");var list=svg.getElementsByTagName("svg");var tag=list?svg.getElementsByTagName("svg")[0]:null;svg=tag;}
if(!XMLSerializer){if(zon){zog("ZIM svgToBitmap() - sorry, not supported in Browser");return;}}
var svgString=(typeof svg=="string")?svg:new XMLSerializer().serializeToString(svg);if(svgString){var first=svgString.split(">")[0];if(first.length>1){var wid=first.split(/width/i);if(wid.length==1){var w=100;var h=100;var box=first.split(/viewBox/i);if(box.length>1){var dim=box[1].split("\"")[1];if(dim){var d=dim.split(" ");if(d.length>1){w=d[d.length-2];h=d[d.length-1];}}}
svgString=svgString.replace(/svg /i,"svg  width=\""+w+"\" height=\""+h+"\" ");}}
if(!svgString.match(/xmlns/i))svgString=svgString.replace(/svg /i,"svg  xmlns='http://www.w3.org/2000/svg' ");}
var DOMURL=self.URL||self.webkitURL||self;var img=new Image();img.onload=function(){var bitmap=new zim.Bitmap(img,width,height);callback(bitmap,params);DOMURL.revokeObjectURL(obu);};var obu=DOMURL.createObjectURL(new document.Blob([svgString],{type:"image/svg+xml"}));img.src=obu;};return zim;}(zim||{});function z_d(n){if(zim&&(zim.DISTILL||window.DISTILL))zim.distillery.push(n);}
function zimify(obj,list){z_d("83.3");if(obj&&obj.noDrag)return obj;var displayMethods={drag:function(boundary,overCursor,dragCursor,all,swipe,localBounds,onTop,surround,slide,slideDamp,slideSnap,reg,removeTweens,startBounds,rect,currentTarget){if(isDUO(arguments)){arguments[0].obj=this;return zim.drag(arguments[0]);}
else{return zim.drag(this,boundary,overCursor,dragCursor,all,swipe,localBounds,onTop,surround,slide,slideDamp,slideSnap,reg,removeTweens,startBounds,rect,currentTarget);}},noDrag:function(recursive){return zim.noDrag(this,recursive);},mouse:function(){return zim.mouse(this);},noMouse:function(){return zim.noMouse(this);},effect:function(effect,x,y,width,height){return zim.effect(this,effect,x,y,width,height);},noEffect:function(effects,cache){return zim.noEffect(this,effects,cache);},updateEffects:function(redoCache){return zim.updateEffects(this,redoCache);},wire:function(target,prop,twoWay,setSource,filter,call,input){if(isDUO(arguments)){arguments[0].source=this;return zim.wire(arguments[0]);}
else{return zim.wire(this,target,prop,twoWay,setSource,filter,call,input);}},noWire:function(target,prop,input){if(isDUO(arguments)){arguments[0].source=this;return zim.noWire(arguments[0]);}
else{return zim.noWire(this,target,prop,input);}},wired:function(source,prop,twoWay,setSource,filter,call,input){if(isDUO(arguments)){arguments[0].target=this;return zim.wired(arguments[0]);}
else{return zim.wired(this,source,prop,twoWay,setSource,filter,call,input);}},noWired:function(source,prop,input){if(isDUO(arguments)){arguments[0].target=this;return zim.noWired(arguments[0]);}
else{return zim.noWired(this,source,prop,input);}},bind:function(id,props,extra,filter,bindObj){if(isDUO(arguments)){arguments[0].obj=this;return zim.bind(arguments[0]);}
else{return zim.bind(this,id,props,extra,filter,bindObj);}},noBind:function(props,removeConnectionData,call,bindObj){if(isDUO(arguments)){arguments[0].obj=this;return zim.noBind(arguments[0]);}
else{return zim.noBind(this,props,removeConnectionData,call,bindObj);}},dragBoundary:function(boundary){return zim.dragBoundary(this,boundary);},dragRect:function(boundary){return zim.dragBoundary(this,boundary);},transform:function(move,stretchX,stretchY,scale,rotate,allowToggle,visible,onTop,showStretch,showRotate,showScale,showReg,showBorder,borderColor,borderWidth,dashed,customCursors,handleSize,regSize,snapDistance,snapRotation,cache,events,ghostColor,ghostWidth,ghostDashed,ghostHidden,frame){if(isDUO(arguments)){arguments[0].obj=this;return zim.transform(arguments[0]);}
else{return zim.transform(this,move,stretchX,stretchY,scale,rotate,allowToggle,visible,onTop,showStretch,showRotate,showScale,showReg,showBorder,borderColor,borderWidth,dashed,customCursors,handleSize,regSize,snapDistance,snapRotation,cache,events,ghostColor,ghostWidth,ghostDashed,ghostHidden,frame);}},setSwipe:function(swipe){return zim.setSwipe(this,swipe);},gesture:function(move,scale,rotate,boundary,minScale,maxScale,snapRotate,localBounds,slide,slideEffect,regControl,onTop,surround,circularBounds,rect){if(isDUO(arguments)){arguments[0].obj=this;return zim.gesture(arguments[0]);}
else{return zim.gesture(this,move,scale,rotate,boundary,minScale,maxScale,snapRotate,localBounds,slide,slideEffect,regControl,onTop,surround,circularBounds,rect);}},noGesture:function(move,scale,rotate){if(isDUO(arguments)){arguments[0].obj=this;return zim.noGesture(arguments[0]);}
else{return zim.noGesture(this,move,scale,rotate);}},gestureBoundary:function(boundary,update){return zim.gestureBoundary(this,boundary,update);},gestureRect:function(boundary,update){return zim.gestureBoundary(this,boundary,update);},addPhysics:function(dynamic,contract,shape,friction,linear,angular,density,restitution,maskBits,categoryBits,physics){if(isDUO(arguments)){arguments[0].obj=this;return zim.addPhysics(arguments[0]);}
else{return zim.addPhysics(this,dynamic,contract,shape,friction,linear,angular,density,restitution,maskBits,categoryBits,physics);}},removePhysics:function(){return zim.removePhysics(this);},hitTestPoint:function(x,y,boundsCheck){return zim.hitTestPoint(this,x,y,boundsCheck);},hitTestReg:function(b,boundsCheck){return zim.hitTestReg(this,b,boundsCheck);},hitTestRect:function(b,num,boundsCheck){return zim.hitTestRect(this,b,num,boundsCheck);},hitTestCircle:function(b,num,boundsCheck){return zim.hitTestCircle(this,b,num,boundsCheck);},hitTestCircleRect:function(b,margin){return zim.hitTestCircleRect(this,b,margin);},hitTestCircles:function(b,margin){return zim.hitTestCircles(this,b,margin);},hitTestBounds:function(b,margin,boundsShape){return zim.hitTestBounds(this,b,margin,boundsShape);},boundsToGlobal:function(rect,flip,inside){return zim.boundsToGlobal(this,rect,flip,inside);},resetBounds:function(a,b,c,d){return zim.resetBounds(this,a,b,c,d);},hitTestPath:function(b,num,showPoints){return zim.hitTestPath(this,b,num,showPoints);},hitTestGrid:function(width,height,cols,rows,x,y,offsetX,offsetY,spacingX,spacingY,local,type){return zim.hitTestGrid(this,width,height,cols,rows,x,y,offsetX,offsetY,spacingX,spacingY,local,type);},animate:function(props,time,ease,call,params,wait,waitedCall,waitedParams,loop,loopCount,loopWait,loopCall,loopParams,loopWaitCall,loopWaitParams,loopPick,rewind,rewindWait,rewindCall,rewindParams,rewindWaitCall,rewindWaitParams,rewindTime,rewindEase,sequence,sequenceCall,sequenceParams,sequenceReverse,ticker,cjsProps,css,protect,override,from,set,id,events,sequenceTarget,dynamic,drag,clamp,startPaused,clean,obj,seriesWait,sequenceWait,rate,pauseOnBlur,easeAmount,easeFrequency,timeUnit,timeCheck){if(props&&(props.props||props.obj)&&isDUO(arguments)){arguments[0].target=this;return zim.animate(arguments[0]);}
else{return zim.animate(this,props,time,ease,call,params,wait,waitedCall,waitedParams,loop,loopCount,loopWait,loopCall,loopParams,loopWaitCall,loopWaitParams,loopPick,rewind,rewindWait,rewindCall,rewindParams,rewindWaitCall,rewindWaitParams,rewindTime,rewindEase,sequence,sequenceCall,sequenceParams,sequenceReverse,ticker,cjsProps,css,protect,override,from,set,id,events,sequenceTarget,dynamic,drag,clamp,startPaused,clean,obj,seriesWait,sequenceWait,rate,pauseOnBlur,easeAmount,easeFrequency,timeUnit,timeCheck);}},pauseAnimate:function(){return this;},stopAnimate:function(){return this;},wiggle:function(property,baseAmount,minAmount,maxAmount,minTime,maxTime,totalTime,type,ease,integer,id,startType,ticker,wait){if(isDUO(arguments)){arguments[0].target=this;return zim.wiggle(arguments[0]);}
else{return zim.wiggle(this,property,baseAmount,minAmount,maxAmount,minTime,maxTime,totalTime,type,ease,integer,id,startType,ticker,wait);}},loop:function(call,reverse,step,start,end){return zim.loop(this,call,reverse,step,start,end);},copyMatrix:function(source){return zim.copyMatrix(this,source);},duplicate:function(exact){return zim.duplicate(this,exact);},cur:function(type){return zim.cur(this,type);},sha:function(color,offsetX,offsetY,blur){return zim.sha(this,color,offsetX,offsetY,blur);},pos:function(x,y,horizontal,vertical,container,index,add,reg,regX,regY){if(isDUO(arguments)){arguments[0].obj=this;return zim.pos(arguments[0]);}
else{return zim.pos(this,x,y,horizontal,vertical,container,index,add,reg,regX,regY);}},loc:function(target,y,container,index,add,localToLocal,x){if(isDUO(arguments)){arguments[0].obj=this;return zim.loc(arguments[0]);}
else{return zim.loc(this,target,y,container,index,add,localToLocal,x);}},mov:function(x,y){if(isDUO(arguments)){arguments[0].obj=this;return zim.mov(arguments[0]);}
else{return zim.mov(this,x,y);}},top:function(){return zim.top(this);},bot:function(){return zim.bot(this);},ord:function(num){return zim.ord(this,num);},dep:function(depth){return zim.dep(this,depth);},nam:function(name){return zim.nam(this,name);},alp:function(alpha){return zim.alp(this,alpha);},vis:function(visibility){return zim.vis(this,visibility);},ble:function(blendMode){return zim.ble(this,blendMode);},hov:function(value,type){return zim.hov(this,value,type);},rot:function(rotation,x,y){return zim.rot(this,rotation,x,y);},siz:function(width,height,only){return zim.siz(this,width,height,only);},ske:function(skewX,skewY){return zim.ske(this,skewX,skewY);},reg:function(regX,regY,still){return zim.reg(this,regX,regY,still);},sca:function(scale,scaleY){return zim.sca(this,scale,scaleY);},scaleTo:function(boundObj,percentX,percentY,type,boundsOnly){if(isDUO(arguments)){arguments[0].obj=this;return zim.scaleTo(arguments[0]);}
else{return zim.scaleTo(this,boundObj,percentX,percentY,type,boundsOnly);}},fit:function(left,top,width,height,type){if(isDUO(arguments)){arguments[0].obj=this;return zim.fit(arguments[0]);}
else{return zim.fit(this,left,top,width,height,type);}},outline:function(color,size,boundsOnly){if(isDUO(arguments)){arguments[0].obj=this;return zim.outline(arguments[0]);}
else{return zim.outline(this,color,size,boundsOnly);}},addTo:function(container,index,localToLocal){if(isDUO(arguments)){arguments[0].obj=this;return zim.addTo(arguments[0]);}
else{return zim.addTo(this,container,index,localToLocal);}},removeFrom:function(container){return zim.removeFrom(this,container);},added:function(call,interval,maxTime){return zim.added(this,call,interval,maxTime);},movement:function(call,immediate){return zim.movement(this,call,immediate);},noMovement:function(){return zim.noMovement(this);},tap:function(call,distance,time,once,dbl,dblTime,call2){if(isDUO(arguments)){arguments[0].obj=this;return zim.tap(arguments[0]);}
else{return zim.tap(this,call,distance,time,once,dbl,dblTime,call2);}},noTap:function(){return zim.noTap(this);},hold:function(call,distance,time,once){return zim.hold(this,call,distance,time,once);},noHold:function(){return zim.noHold(this);},change:function(call,once){return zim.change(this,call,once);},noChange:function(){return zim.noChange(this);},centerReg:function(container,index,add){if(isDUO(arguments)){arguments[0].obj=this;return zim.centerReg(arguments[0]);}
else{return zim.centerReg(this,container,index,add);}},center:function(container,index,add){if(isDUO(arguments)){arguments[0].obj=this;return zim.center(arguments[0]);}
else{return zim.center(this,container,index,add);}},place:function(id){return zim.place(this,id);},placeReg:function(id){return zim.placeReg(this,id);},expand:function(padding,paddingVertical,paddingRight,paddingBottom){if(isDUO(arguments)){arguments[0].obj=this;return zim.expand(arguments[0]);}
else{return zim.expand(this,padding,paddingVertical,paddingRight,paddingBottom);}},setMask:function(mask,dynamic){return zim.setMask(this,mask,dynamic);},cloneProps:function(clone){clone.type=this.type;clone.group=this.group;clone.style=this.style;clone.alpha=this.alpha;clone.rotation=this.rotation;clone.mouseEnabled=this.mouseEnabled;clone.mouseChildren=this.mouseChildren;clone.tickEnabled=this.tickEnabled;clone.x=this.x;clone.y=this.y;clone.scaleX=this.scaleX;clone.scaleY=this.scaleY;clone.skewX=this.skewX;clone.skewY=this.skewY;if(clone.name)clone.name=this.name;clone.regX=this.regX*clone.width/(this.width||1);clone.regY=this.regY*clone.height/(this.height||1);clone.visible=this.visible;clone.shadow=this.shadow;if(!this.type||this.type=="Shape")zim.copyMatrix(clone,this);clone.compositeOperation=this.compositeOperation;clone.snapToPixel=this.snapToPixel;clone.filters=this.filters==null?null:this.filters.slice(0);clone.mask=this.mask;clone.hitArea=this.hitArea;if((!this.type||this.type=="Shape"||this.type=="Blob"||this.type=="Squiggle")&&this._bounds)clone.setBounds(this._bounds.x,this._bounds.y,this._bounds.width,this._bounds.height);return clone;},cloneChildren:function(clone,exact){if(clone.children.length)clone.removeAllChildren();var arr=clone.children;for(var i=0,l=this.children.length;i<l;i++){var childClone=this.children[i].clone(exact);childClone.parent=clone;arr.push(childClone);}
return clone;}};if(!zot(list)){var list=[];for(var m in displayMethods){list.push(m);}
return list;}
for(var i in displayMethods){if(displayMethods.hasOwnProperty(i)){obj[i]=displayMethods[i];}}
if(zim){obj.cjsLocalToGlobal=obj.localToGlobal;obj.cjsGlobalToLocal=obj.globalToLocal;obj.cjsLocalToLocal=obj.localToLocal;obj.localToGlobal=function(x,y){return zim.localToGlobal(x,y,obj,obj.cjsLocalToGlobal);};obj.globalToLocal=function(x,y){return zim.globalToLocal(x,y,obj,obj.cjsGlobalToLocal);};obj.localToLocal=function(x,y,target){return zim.localToLocal(x,y,target,obj);};if(!obj.hueBatch)zim.displayBase(obj);}
return obj;}
var ignore;function zimplify(exclude){z_d("83.35");document.Window=Window;document.Blob=Blob;ignore="ignore";if(zot(exclude))exclude=[];if(!Array.isArray(exclude))exclude=[exclude];var methods=zimify(null,true);var exceptions=["loop","stopAnimate","pauseAnimate","animate","wiggle","wire","wired"];for(var command in zim){if((methods.indexOf(command)==-1||exceptions.indexOf(command)>=0)&&exclude.indexOf(command)==-1){window[command]=zim[command];}}}
if(typeof zdf=="undefined")var zdf;zim.fastFrame=function(cjs,stage){z_d("83.355");createjs=cjs;if(zot(zdf)){stage.frame=new zim.Frame({shim:{stage:stage,canvas:stage.canvas}});zimDefaultFrame=zdf=stage.frame;zim.scaX=createjs.stageTransformable?1:stage.scaleX;zim.scaY=createjs.stageTransformable?1:stage.scaleY;return stage.frame;}};zim.addWires=function(obj){z_d("83.365");obj.wire=function(){Array.prototype.unshift.call(arguments,obj);zim.wire.apply(null,arguments);return obj;};obj.noWire=function(){Array.prototype.unshift.call(arguments,obj);zim.noWire.apply(null,arguments);return obj;};obj.wired=function(){Array.prototype.unshift.call(arguments,obj);zim.wired.apply(null,arguments);return obj;};obj.noWired=function(){Array.prototype.unshift.call(arguments,obj);zim.noWired.apply(null,arguments);return obj;};return obj;};zim.setBlurDetect=function(){z_d("83.36");zim.blurCheck=true;zim.pauseAnimateOnBlur=true;zim.pauseOnBlur=[];zim.blurDetect=(function(){var stateKey,eventKey,keys={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(stateKey in keys){if(stateKey in document){eventKey=keys[stateKey];break;}}
return function(c){if(c)document.addEventListener(eventKey,c);return!document[stateKey];};})();zim.blurDetect(function(){if(zim.blurDetect()){setTimeout(function(){if(zim.pauseOnBlur){for(var i=0;i<zim.pauseOnBlur.length;i++){var obj=zim.pauseOnBlur[i];if(!obj.pauseOnBlurPaused)obj.pause(false);}}
if(zim.pauseAnimateOnBlur&&zim.animatedObjects){for(var i=0;i<zim.animatedObjects.objects.length;i++){var obj=zim.animatedObjects.objects[i];var currentStates=zim.copy(obj.tweenStates);if(!obj.tweenStates){obj.pauseAnimate(false);}else if(zot(currentStates.all)||currentStates.all){obj.pauseAnimate(false);for(id in currentStates){if(id=="all")continue;if(!currentStates[id]){obj.pauseAnimate(true,id);}}}else{obj.pauseAnimate(true);for(id in currentStates){if(id=="all")continue;if(currentStates[id])obj.pauseAnimate(false,id);}}
if(obj.type=="Sprite")obj.paused=true;}}},300);}else{if(zim.pauseOnBlur){for(var i=0;i<zim.pauseOnBlur.length;i++){var obj=zim.pauseOnBlur[i];obj.pauseOnBlurPaused=obj.paused;obj.pause(true);}}
if(zim.pauseAnimateOnBlur&&zim.animatedObjects){zim.pauseAnimate(true,"pauseOnBlur");}}});};var ZIMONON=false;var zim=function(zim){zim.ZIMON={stringify:function(obj,key){z_d("83.39");if(zot(obj))return;if(!ZIMONON){if(zon)zogy("ZIMON - set ZIMONON=true before using ZIMON.stringify()");return;}
obj=zim.copy(obj);process(obj);return JSON.stringify({obj:obj,key:key,zimon:1,info:"https://zimjs.com/zimon/"});function process(data,parent,index){if(zot(data))return;if(Array.isArray(data)){zim.loop(data,function(d,i){process(d,data,i);});}else if(data.constructor=={}.constructor){zim.loop(data,function(p,v){process(v,data,p);});}else{if(data.type){var proxy={zimon:data.type};if(data.arguments){proxy.args=Array.prototype.slice.call(data.arguments);process(proxy.args);}
if(data.type=="series"){proxy.args=Array.prototype.slice.call(data.array);process(proxy.args);}
if(key&&key[data.type]&&key[data.type].props){proxy.props=[];zim.loop(key[data.type].props,function(p){proxy.props.push(data[p]);});}
if(parent){parent[index]=proxy;}else{obj=proxy;}}else{if(typeof data!="string"&&typeof data!="number"&&typeof data!="boolean"&&data!==null){if(zon)zogy("ZIMON - potentially bad JSON value"+data);}}}}},parse:function(string,key){z_d("83.39");if(zot(string))return;var o=JSON.parse(string);var obj=o.obj;var key=o.key;process(obj);return obj;function process(data,parent,index){if(zot(data))return;if(Array.isArray(data)){zim.loop(data,function(d,i){process(d,data,i);});}else if(zot(data.zimon)&&data.constructor=={}.constructor){zim.loop(data,function(p,v){process(v,data,p);});}else{if(data.zimon){var cl=data.zimon;function translate(n){try{return Function('return('+n+')')();}catch(err){if(zon)zogy("ZIMON - bad function scope or name: "+n);return null;}}
var scope="";if(key){if(key[cl]&&key[cl].scope){scope=key[cl].scope+".";}else if(key.scope){scope=key.scope+".";}}
var fn=translate(scope+cl);var args=data.args;if(zot(args))args=[];process(args);if(data.type=="series"){var z=zim.series(args);}else{var z=!fn?null:new(fn.bind.apply(fn,[null].concat(Array.prototype.slice.call(args))))();}
if(parent){parent[index]=z;}else{obj=z;}
if(key&&key[cl]&&key[cl].props){if(z){zim.loop(key[cl].props,function(p,i){if(!zot(data.props[i]))z[p]=data.props[i];});}}}}}}};zim.Wonder=function(wid,client,app,notes,server){var sig="wid, client, app, notes, server";var duo;if(duo=zob(zim.Wonder,arguments,sig,this))return duo;z_d("82");if(zot(wid)){zog("zim.Wonder() - please provide Wonder ID (see https://zimjs.com/wonder/)");return;}
if(zot(server))server="https://wonder.zimjs.org/wonder";var that=this;if(zot(zim.wonderSession))zim.wonderSession="W"+zim.rand(100000,999999);var data=[];var wonderInterval=setInterval(sendData,1000);var sendCount=0;function sendData(){if(data.length>0){zim.async(server+"?wonder="+JSON.stringify(data));data=[];sendCount++;}}
var lastKeyword;var wonderCheck=setInterval(function(){if(sendCount>28){data.push({id:wid,c:client,a:app,n:notes,k:lastKeyword,t:"e",v:"frequency max - terminated",s:zim.wonderSession});zog("zim.Wonder() - frequency max - terminated");that.dispose();}
sendCount=0;},30*1000);this.countsOff={};this.timesOff={};this.ordersOff={};function kw(k,t){if(zot(k)){zog("zim.Wonder "+t+" - please provide a keyword");return false;}else{if(that[t+"sOff"][k])return false;return true;}}
this.count=function(keyword){if(!kw(keyword,"count"))return;lastKeyword=keyword;data.push({id:wid,c:client,a:app,n:notes,k:keyword,t:"c",v:1,s:zim.wonderSession});};var times={};this.timeStart=function(keyword){if(!kw(keyword,"time"))return;that.timeEnd(keyword);lastKeyword=keyword;times[keyword]=new Date().getTime();};var pauseTimes={};this.timePause=function(keyword){if(!kw(keyword,"time"))return;if(pauseTimes[keyword])return;pauseTimes[keyword]=new Date().getTime();};this.timeUnpause=function(keyword){if(!kw(keyword,"time"))return;if(!pauseTimes[keyword])return;var pausedTime=new Date().getTime()-pauseTimes[keyword];if(times[keyword])times[keyword]+=pausedTime;delete pauseTimes[keyword];};this.timeEnd=function(keyword){if(!kw(keyword,"time"))return;if(!times[keyword])return;var t1=(pauseTimes[keyword])?pauseTimes[keyword]:new Date().getTime();var time=Math.round((t1-times[keyword])/1000);delete pauseTimes[keyword];delete times[keyword];data.push({id:wid,c:client,a:app,n:notes,k:keyword,t:"t",v:time,s:zim.wonderSession});};this.order=function(keyword,item){if(!kw(keyword,"order"))return;lastKeyword=keyword;if(zot(item)){zog("zim.Wonder order() - please provide an item");return;}
data.push({id:wid,c:client,a:app,n:notes,k:keyword,t:"o",v:item,s:zim.wonderSession});};this.countOff=function(keyword){that.countsOff[keyword]=1;};this.countOn=function(keyword){delete that.countOff[keyword];};this.timeOff=function(keyword){that.timesOff[keyword]=1;};this.timeOn=function(keyword){delete that.timesOff[keyword];};this.orderOff=function(keyword){that.ordersOff[keyword]=1;};this.orderOn=function(keyword){delete that.ordersOff[keyword];};this.dispose=function(a,b,disposing){sendData();clearInterval(wonderInterval);clearInterval(wonderCheck);return true;};};zim.VERSION="cat/04/zim";zim.getLatestVersions=function(call){z_d("82.2");var latestURL="https://zimjs.com/live/getLatestVersions.php";function returnLatestVersions(data){call(JSON.parse(data));}
zim.async(latestURL,returnLatestVersions,"returnLatestVersions");};zim.PWA=function(call,label,backgroundColor,color,backdropColor,pane,noScale){var sig="call, label, backgroundColor, color, backdropColor, pane, noScale";var duo;if(duo=zob(zim.PWA,arguments,sig,this))return duo;z_d("82.4");this.cjsEventDispatcher_constructor();this.type="PWA";var pwa;var that=this;if(zot(label))label=new zim.Label({text:"Please add to home screen as an app",align:LEFT,lineHeight:44,color:color});if(zot(backgroundColor))backgroundColor=zim.yellow;if(zot(pane)){pane=new zim.Pane({width:1200,height:230,label:label,backgroundColor:backgroundColor,backdropColor:backdropColor});pane.label.align=LEFT;pane.label.center();pane.label.mov(40);var pwaShape=new zim.Shape().s(dark).ss(3,1,0,3).p("AAAj0IAAFJAA8hoIBuAAIAAFdIlTAAIAAldIBuAA").sca(1.6).center(pane).mov(-pane.label.width/2-20,-10)
var pwaShape2=new zim.Shape().s(dark).ss(3,1,0,3).p("AhGAlIBGhGIBHBG").sca(1.6).center(pane).mov(-pane.label.width/2-20,-38-10)}
if(zim.mobile()&&!(window.matchMedia('(display-mode: standalone)').matches||(window.navigator.standalone)||document.referrer.includes('android-app://'))){showMessage();}else{if(call&&call.constructor===Function)call();setTimeout(function(){that.dispatchEvent("ready");},20);}
function showMessage(){this.pane=pwa=pane.show();pwa.on("close",function(){if(call&&call.constructor===Function)call();if(that.scaleEvent)frame.off("resize",that.scaleEvent);that.dispatchEvent("ready");});var frame=frame||zimDefaultFrame;if(frame&&!noScale){pwa.scaleTo(frame.stage,105).center();if(frame.scaling=="full"||frame.scaling=="tag"){that.scaleEvent=frame.on("resize",function(){pwa.scaleTo(frame.stage,105).center();});}
frame.stage.update();}}
this.show=function(){showMessage();return this;}};zim.extend(zim.PWA,createjs.EventDispatcher,null,"cjsEventDispatcher",false);return zim;}(zim||{});if(!window.zns)zimplify();